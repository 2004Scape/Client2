(()=>{"use strict";var e={5621:(e,t,i)=>{e.exports=i.p+"9f86b5397894e28b5ae2.wasm"}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}i.m=e,i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.p="/Client2/",i.b=document.baseURI||self.location.href,(()=>{const e=async e=>new Promise((t=>setTimeout(t,e))),t=async e=>new Int8Array(await(await fetch(e)).arrayBuffer());class s{id;prev;next;constructor(){this.id=0n,this.prev=this,this.next=this}unlink=()=>{this.next&&this.prev&&(this.next.prev=this.prev,this.prev.next=this.next,this.prev=null,this.next=null)}}class n{head;peeked=null;constructor(){const e=new s;e.prev=e,e.next=e,this.head=e}pushBack=e=>{e.next&&e.unlink(),e.next=this.head.next,e.prev=this.head,e.next&&(e.next.prev=e),e.prev.next=e};pushFront=e=>{e.next&&e.unlink(),e.next=this.head,e.prev=this.head.prev,e.next.prev=e,e.prev&&(e.prev.next=e)};pollFront=()=>{const e=this.head.prev;return e===this.head?null:(e?.unlink(),e)};peekFront=()=>{const e=this.head.prev;return e===this.head?(this.peeked=null,null):(this.peeked=e?.prev||null,e)};peekBack=()=>{const e=this.head.next;return e===this.head?(this.peeked=null,null):(this.peeked=e?.next||null,e)};prev=()=>{const e=this.peeked;return e===this.head?(this.peeked=null,null):(this.peeked=e?.prev||null,e)};next=()=>{const e=this.peeked;return e===this.head?(this.peeked=null,null):(this.peeked=e?.next||null,e)};clear=()=>{for(;;){const e=this.head.prev;if(e===this.head)return;e?.unlink()}}}class r extends s{nextHashable;prevHashable;constructor(){super(),this.nextHashable=this,this.prevHashable=this}uncache=()=>{this.prevHashable&&this.nextHashable&&(this.prevHashable.nextHashable=this.nextHashable,this.nextHashable.prevHashable=this.prevHashable,this.nextHashable=null,this.prevHashable=null)}}class a extends r{static CRC32_POLYNOMIAL=3988292384;static crctable=new Int32Array(256);static bitmask=new Uint32Array(33);static cacheMin=new n;static cacheMid=new n;static cacheMax=new n;static cacheMinCount=0;static cacheMidCount=0;static cacheMaxCount=0;static{for(let e=0;e<32;e++)a.bitmask[e]=(1<<e)-1;a.bitmask[32]=4294967295;for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)1==(1&t)?t=t>>>1^a.CRC32_POLYNOMIAL:t>>>=1;a.crctable[e]=t}}static crc32=e=>{let t=4294967295;for(let i=0;i<e.length;i++)t=t>>>8^a.crctable[255&(t^e[i])];return~t};data;pos;bitPos=0;random=null;constructor(e){if(!e)throw new Error("Input src packet array was null!");super(),this.data=e,this.pos=0}static alloc=e=>{let t=null;return 0===e&&a.cacheMinCount>0?(a.cacheMinCount--,t=a.cacheMin.pollFront()):1===e&&a.cacheMidCount>0?(a.cacheMidCount--,t=a.cacheMid.pollFront()):2===e&&a.cacheMaxCount>0&&(a.cacheMaxCount--,t=a.cacheMax.pollFront()),t?(t.pos=0,t):new a(0===e?new Uint8Array(100):1===e?new Uint8Array(5e3):new Uint8Array(3e4))};release=()=>{this.pos=0,100===this.data.length&&a.cacheMinCount<1e3?(a.cacheMin.pushBack(this),a.cacheMinCount++):5e3===this.data.length&&a.cacheMidCount<250?(a.cacheMid.pushBack(this),a.cacheMidCount++):3e4===this.data.length&&a.cacheMaxCount<50&&(a.cacheMax.pushBack(this),a.cacheMaxCount++)};get g1(){return this.data[this.pos++]}get g1b(){return this.data[this.pos++]<<24>>24}get g2(){return this.data[this.pos++]<<8|this.data[this.pos++]}get g2b(){let e=this.data[this.pos++]<<8|this.data[this.pos++];return e>32767&&(e-=65536),e}get g3(){return this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]}get g4(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]}get g8(){return(0xffffffffn&BigInt(this.g4))<<32n|0xffffffffn&BigInt(this.g4)}get gsmart(){return this.data[this.pos]<128?this.g1-64:this.g2-49152}get gsmarts(){return this.data[this.pos]<128?this.g1:this.g2-32768}get gjstr(){let e="";for(;10!==this.data[this.pos]&&this.pos<this.data.length;)e+=String.fromCharCode(this.data[this.pos++]);return this.pos++,e}gdata=(e,t,i)=>{for(let s=t;s<t+e;s++)i[s]=this.data[this.pos++]};p1isaac=e=>{this.data[this.pos++]=e+(this.random?.nextInt??0)&255};p1=e=>{this.data[this.pos++]=e};p2=e=>{this.data[this.pos++]=e>>>8,this.data[this.pos++]=e};ip2=e=>{this.data[this.pos++]=e,this.data[this.pos++]=e>>>8};p3=e=>{this.data[this.pos++]=e>>>16,this.data[this.pos++]=e>>>8,this.data[this.pos++]=e};p4=e=>{this.data[this.pos++]=e>>>24,this.data[this.pos++]=e>>>16,this.data[this.pos++]=e>>>8,this.data[this.pos++]=e};ip4=e=>{this.data[this.pos++]=e,this.data[this.pos++]=e>>>8,this.data[this.pos++]=e>>>16,this.data[this.pos++]=e>>>24};p8=e=>{this.p4(Number(e>>32n)),this.p4(Number(0xffffffffn&e))};pjstr=e=>{for(let t=0;t<e.length;t++)this.data[this.pos++]=e.charCodeAt(t);this.data[this.pos++]=10};pdata=(e,t,i)=>{for(let s=i;s<i+t;s++)this.data[this.pos++]=e[s]};psize1=e=>{this.data[this.pos-e-1]=e};bits=()=>{this.bitPos=8*this.pos};bytes=()=>{this.pos=(this.bitPos+7)/8|0};gBit=e=>{let t=this.bitPos>>>3,i=8-(7&this.bitPos),s=0;for(this.bitPos+=e;e>i;i=8)s+=(this.data[t++]&a.bitmask[i])<<e-i,e-=i;return s+=e===i?this.data[t]&a.bitmask[i]:this.data[t]>>>i-e&a.bitmask[e],s};rsaenc=(e,t)=>{const i=new Uint8Array(this.pos);((e,t,i,s,n)=>{for(;n--;)i[s++]=e[t++]})(this.data,0,i,0,this.pos);const s=(e=>{const t=[];for(;e>0n;)t.unshift(Number(255n&e)),e>>=8n;return new Uint8Array(t)})(((e,t,i)=>{let s=1n;for(;t>0n;)t%2n===1n&&(s=s*e%i),e=e*e%i,t>>=1n;return s})((e=>{let t=0n;for(let i=0;i<e.length;i++)t=(t<<8n)+BigInt(e[i]);return t})(i),t,e));this.pos=0,this.p1(s.length),this.pdata(s,s.length,0)}}class o{static bz2=null;static state=null;static load=async e=>{const t=new WebAssembly.Module(e),i=await async function(e,t={}){const i={env:Object.assign(Object.create(globalThis),t.env||{},{abort(e,t,i,s){e=a(e>>>0),t=a(t>>>0),i>>>=0,s>>>=0,(()=>{throw Error(`${e} in ${t}:${i}:${s}`)})()}})},{exports:s}=await WebAssembly.instantiate(e,i),n=s.memory||t.env.memory,r=Object.setPrototypeOf({newBzip2State(){return(e=s.newBzip2State()>>>0)?{stream:h(Int8Array,k(e+0)),decompressed:h(Int8Array,k(e+4)),next_in:b(e+8),avail_in:b(e+12),total_in_lo32:b(e+16),total_in_hi32:b(e+20),next_out:b(e+24),avail_out:b(e+28),total_out_lo32:b(e+32),total_out_hi32:b(e+36),state_out_ch:g(e+40),state_out_len:b(e+44),blockRandomized:0!=g(e+48),bsBuff:b(e+52),bsLive:b(e+56),currBlockNo:b(e+60),origPtr:b(e+64),tPos:b(e+68),k0:b(e+72),c_nblock_used:b(e+76),nInUse:b(e+80),save_nblock:b(e+84),unzftab:d(b,2,k(e+88)),cftab:d(b,2,k(e+92)),cftabCopy:d(b,2,k(e+96)),inUse:d((e=>0!=g(e)),0,k(e+100)),inUse16:d((e=>0!=g(e)),0,k(e+104)),seqToUnseq:d(g,0,k(e+108)),mtfa:d(g,0,k(e+112)),mtfbase:d(b,2,k(e+116)),selector:d(g,0,k(e+120)),selectorMtf:d(g,0,k(e+124)),len:o((e=>d(g,0,k(e))),2,k(e+128)),limit:o((e=>d(b,2,k(e))),2,k(e+132)),base:o((e=>d(b,2,k(e))),2,k(e+136)),perm:o((e=>d(b,2,k(e))),2,k(e+140)),minLens:d(b,2,k(e+144))}:null;var e},read(e,t,i,n,r){t=function(e){if(e){const t=f.get(e);t?f.set(e,t+1):f.set(s.__pin(e),1)}return e}(c(Int8Array,6,0,t)||p()),r=function(e){if(null==e)return 0;const t=s.__pin(s.__new(148,5));return y(t+0,c(Int8Array,6,0,e.stream)||p()),y(t+4,c(Int8Array,6,0,e.decompressed)||p()),y(t+8,e.next_in),y(t+12,e.avail_in),y(t+16,e.total_in_lo32),y(t+20,e.total_in_hi32),y(t+24,e.next_out),y(t+28,e.avail_out),y(t+32,e.total_out_lo32),y(t+36,e.total_out_hi32),w(t+40,e.state_out_ch),y(t+44,e.state_out_len),w(t+48,e.blockRandomized?1:0),y(t+52,e.bsBuff),y(t+56,e.bsLive),y(t+60,e.currBlockNo),y(t+64,e.origPtr),y(t+68,e.tPos),y(t+72,e.k0),y(t+76,e.c_nblock_used),y(t+80,e.nInUse),y(t+84,e.save_nblock),y(t+88,u(y,4,2,e.unzftab,Int32Array)||p()),y(t+92,u(y,4,2,e.cftab,Int32Array)||p()),y(t+96,u(y,4,2,e.cftabCopy,Int32Array)||p()),y(t+100,u(w,7,0,e.inUse,Uint8Array)||p()),y(t+104,u(w,7,0,e.inUse16,Uint8Array)||p()),y(t+108,u(w,8,0,e.seqToUnseq,Uint8Array)||p()),y(t+112,u(w,8,0,e.mtfa,Uint8Array)||p()),y(t+116,u(y,4,2,e.mtfbase,Int32Array)||p()),y(t+120,u(w,8,0,e.selector,Uint8Array)||p()),y(t+124,u(w,8,0,e.selectorMtf,Uint8Array)||p()),y(t+128,l(((e,t)=>{y(e,u(w,8,0,t,Uint8Array)||p())}),9,2,e.len)||p()),y(t+132,l(((e,t)=>{y(e,u(y,4,2,t,Int32Array)||p())}),10,2,e.limit)||p()),y(t+136,l(((e,t)=>{y(e,u(y,4,2,t,Int32Array)||p())}),10,2,e.base)||p()),y(t+140,l(((e,t)=>{y(e,u(y,4,2,t,Int32Array)||p())}),10,2,e.perm)||p()),y(t+144,u(y,4,2,e.minLens,Int32Array)||p()),s.__unpin(t),t}(r)||p();try{return h(Int8Array,s.read(e,t,i,n,r)>>>0)}finally{!function(e){if(e){const t=f.get(e);if(1===t)s.__unpin(e),f.delete(e);else{if(!t)throw Error(`invalid refcount '${t}' for reference '${e}'`);f.set(e,t-1)}}}(t)}}},s);function a(e){if(!e)return null;const t=e+new Uint32Array(n.buffer)[e-4>>>2]>>>1,i=new Uint16Array(n.buffer);let s=e>>>1,r="";for(;t-s>1024;)r+=String.fromCharCode(...i.subarray(s,s+=1024));return r+String.fromCharCode(...i.subarray(s,t))}function o(e,t,i){if(!i)return null;const s=k(i+4),n=m.getUint32(i+12,!0),r=new Array(n);for(let i=0;i<n;++i)r[i]=e(s+(i<<t>>>0));return r}function l(e,t,i,n){if(null==n)return 0;const r=n.length,a=s.__pin(s.__new(r<<i,1))>>>0,o=s.__pin(s.__new(16,t))>>>0;y(o+0,a),m.setUint32(o+4,a,!0),m.setUint32(o+8,r<<i,!0),m.setUint32(o+12,r,!0);for(let t=0;t<r;++t)e(a+(t<<i>>>0),n[t]);return s.__unpin(a),s.__unpin(o),o}function h(e,t){return t?new e(n.buffer,k(t+4),m.getUint32(t+8,!0)/e.BYTES_PER_ELEMENT).slice():null}function c(e,t,i,r){if(null==r)return 0;const a=r.length,o=s.__pin(s.__new(a<<i,1))>>>0,l=s.__new(12,t)>>>0;return y(l+0,o),m.setUint32(l+4,o,!0),m.setUint32(l+8,a<<i,!0),new e(n.buffer,o,a).set(r),s.__unpin(o),l}function d(e,t,i){if(!i)return null;const s=k(i-4)>>>t,n=new Array(s);for(let r=0;r<s;++r)n[r]=e(i+(r<<t>>>0));return n}function u(e,t,i,r,a){if(null==r)return 0;const o=r.length,l=s.__pin(s.__new(o<<i,t))>>>0;if(a)new a(n.buffer,l,o).set(r);else for(let t=0;t<o;t++)e(l+(t<<i>>>0),r[t]);return s.__unpin(l),l}const f=new Map;function p(){throw TypeError("value must not be null")}let m=new DataView(n.buffer);function w(e,t){try{m.setUint8(e,t,!0)}catch{m=new DataView(n.buffer),m.setUint8(e,t,!0)}}function y(e,t){try{m.setUint32(e,t,!0)}catch{m=new DataView(n.buffer),m.setUint32(e,t,!0)}}function g(e){try{return m.getUint8(e,!0)}catch{return m=new DataView(n.buffer),m.getUint8(e,!0)}}function b(e){try{return m.getInt32(e,!0)}catch{return m=new DataView(n.buffer),m.getInt32(e,!0)}}function k(e){try{return m.getUint32(e,!0)}catch{return m=new DataView(n.buffer),m.getUint32(e,!0)}}return r}(t,{env:void 0});this.bz2=i,this.state=i.newBzip2State()};static read=(e,t,i,s)=>{if(!this.bz2||!this.state)throw new Error("bz2 not found!!");return this.bz2.read(e,t,i,s,this.state)}}class l{static genHash=e=>{let t=0;e=e.toUpperCase();for(let i=0;i<e.length;i++)t=61*t+e.charCodeAt(i)-32|0;return t};buffer;compressedWhole;fileCount;fileHash;fileUnpackedSize;filePackedSize;fileOffset;fileUnpacked=[];constructor(e){let t=new a(new Uint8Array(e));const i=t.g3,s=t.g3;i===s?(this.buffer=e,this.compressedWhole=!1):(this.buffer=o.read(i,e,s,6),t=new a(new Uint8Array(this.buffer)),this.compressedWhole=!0),this.fileCount=t.g2,this.fileHash=[],this.fileUnpackedSize=[],this.filePackedSize=[],this.fileOffset=[];let n=t.pos+10*this.fileCount;for(let e=0;e<this.fileCount;e++)this.fileHash.push(t.g4),this.fileUnpackedSize.push(t.g3),this.filePackedSize.push(t.g3),this.fileOffset.push(n),n+=this.filePackedSize[e]}read=e=>{const t=l.genHash(e),i=this.fileHash.indexOf(t);return-1===i?null:this.readIndex(i)};readIndex=e=>{if(e<0||e>=this.fileCount)return null;if(this.fileUnpacked[e])return this.fileUnpacked[e];const t=this.fileOffset[e],i=t+this.filePackedSize[e];if(this.compressedWhole){const s=Uint8Array.from(this.buffer.subarray(t,t+i));return this.fileUnpacked[e]=s,s}{const t=Uint8Array.from(o.read(this.fileUnpackedSize[e],this.buffer,this.filePackedSize[e],this.fileOffset[e]));return this.fileUnpacked[e]=t,t}}}class h extends r{static pixels=new Int32Array;static width2d=0;static height2d=0;static top=0;static bottom=0;static left=0;static right=0;static boundX=0;static centerX2d=0;static centerY2d=0;static bind=(e,t,i)=>{this.pixels=e,this.width2d=t,this.height2d=i,this.setBounds(0,0,t,i)};static resetBounds=()=>{this.left=0,this.top=0,this.right=this.width2d,this.bottom=this.height2d,this.boundX=this.right-1,this.centerX2d=this.right/2|0};static setBounds=(e,t,i,s)=>{e<0&&(e=0),t<0&&(t=0),i>this.width2d&&(i=this.width2d),s>this.height2d&&(s=this.height2d),this.top=t,this.bottom=s,this.left=e,this.right=i,this.boundX=this.right-1,this.centerX2d=this.right/2|0,this.centerY2d=this.bottom/2|0};static clear=()=>{const e=this.width2d*this.height2d;for(let t=0;t<e;t++)this.pixels[t]=0};static drawRect=(e,t,i,s,n)=>{this.drawHorizontalLine(e,t,n,i),this.drawHorizontalLine(e,t+s-1,n,i),this.drawVerticalLine(e,t,n,s),this.drawVerticalLine(e+i-1,t,n,s)};static drawHorizontalLine=(e,t,i,s)=>{if(t<this.top||t>=this.bottom)return;e<this.left&&(s-=this.left-e,e=this.left),e+s>this.right&&(s=this.right-e);const n=e+t*this.width2d;for(let e=0;e<s;e++)this.pixels[n+e]=i};static drawVerticalLine=(e,t,i,s)=>{if(e<this.left||e>=this.right)return;t<this.top&&(s-=this.top-t,t=this.top),t+s>this.bottom&&(s=this.bottom-t);const n=e+t*this.width2d;for(let e=0;e<s;e++)this.pixels[n+e*this.width2d]=i};static drawLine=(e,t,i,s,n)=>{const r=Math.abs(i-e),a=Math.abs(s-t),o=e<i?1:-1,l=t<s?1:-1;let h=r-a;for(;e>=this.left&&e<this.right&&t>=this.top&&t<this.bottom&&(this.pixels[e+t*this.width2d]=n),e!==i||t!==s;){const i=2*h;i>-a&&(h-=a,e+=o),i<r&&(h+=r,t+=l)}};static fillRect=(e,t,i,s,n)=>{e<this.left&&(i-=this.left-e,e=this.left),t<this.top&&(s-=this.top-t,t=this.top),e+i>this.right&&(i=this.right-e),t+s>this.bottom&&(s=this.bottom-t);const r=this.width2d-i;let a=e+t*this.width2d;for(let e=-s;e<0;e++){for(let e=-i;e<0;e++)this.pixels[a++]=n;a+=r}}}const c=document.getElementById("canvas"),d=c.getContext("2d",{willReadFrequently:!0}),u=document.createElement("canvas");document.createElement("img"),u.getContext("2d",{willReadFrequently:!0});class f{image;width;height;ctx;pixels;constructor(e,t,i=d){this.ctx=i,this.image=this.ctx.getImageData(0,0,e,t),this.pixels=new Int32Array(e*t),this.width=e,this.height=t,this.bind()}clear=()=>{this.pixels.fill(0)};bind=()=>{h.bind(this.pixels,this.width,this.height)};draw=(e,t)=>{this.#e(),this.ctx.putImageData(this.image,e,t)};#e=()=>{const e=this.image.data;for(let t=0;t<this.pixels.length;t++){const i=this.pixels[t],s=4*t;e[s]=i>>16&255,e[s+1]=i>>8&255,e[s+2]=i>>0&255,e[s+3]=255}}}class p extends r{pixels;width;height;cropX;cropY;cropW;cropH;palette;constructor(e,t,i){super(),this.pixels=new Int8Array(e*t),this.width=this.cropW=e,this.height=this.cropH=t,this.cropX=this.cropY=0,this.palette=i}static fromArchive=(e,t,i=0)=>{const s=new a(e.read(t+".dat")),n=new a(e.read("index.dat"));n.pos=s.g2;const r=n.g2,o=n.g2,l=n.g1,h=new Int32Array(l);for(let e=1;e<l;e++)h[e]=n.g3,0===h[e]&&(h[e]=1);for(let e=0;e<i;e++)n.pos+=2,s.pos+=n.g2*n.g2,n.pos+=1;const c=n.g1,d=n.g1,u=n.g2,f=n.g2,m=new p(u,f,h);m.cropX=c,m.cropY=d,m.cropW=r,m.cropH=o;const w=m.pixels,y=n.g1;if(0===y){const e=m.width*m.height;for(let t=0;t<e;t++)w[t]=s.g1b}else if(1===y){const e=m.width,t=m.height;for(let i=0;i<e;i++)for(let n=0;n<t;n++)w[i+n*e]=s.g1b}return m};draw=(e,t)=>{e|=0,t|=0;let i=(e+=this.cropX)+(t+=this.cropY)*h.width2d,s=0,n=this.height,r=this.width,a=h.width2d-r,o=0;if(t<h.top){const e=h.top-t;n-=e,t=h.top,s+=e*r,i+=e*h.width2d}if(t+n>h.bottom&&(n-=t+n-h.bottom),e<h.left){const t=h.left-e;r-=t,e=h.left,s+=t,i+=t,o+=t,a+=t}if(e+r>h.right){const t=e+r-h.right;r-=t,o+=t,a+=t}r>0&&n>0&&this.copyImage(r,n,this.pixels,s,o,h.pixels,i,a)};flipHorizontally=()=>{const e=this.pixels,t=this.width,i=this.height;for(let s=0;s<i;s++){const i=t/2|0;for(let n=0;n<i;n++){const i=n+s*t,r=t-n-1+s*t,a=e[i];e[i]=e[r],e[r]=a}}};flipVertically=()=>{const e=this.pixels,t=this.width,i=this.height;for(let s=0;s<(i/2|0);s++)for(let n=0;n<t;n++){const r=n+s*t,a=n+(i-s-1)*t,o=e[r];e[r]=e[a],e[a]=o}};translate=(e,t,i)=>{for(let s=0;s<this.palette.length;s++){let n=this.palette[s]>>16&255;n+=e,n<0?n=0:n>255&&(n=255);let r=this.palette[s]>>8&255;r+=t,r<0?r=0:r>255&&(r=255);let a=255&this.palette[s];a+=i,a<0?a=0:a>255&&(a=255),this.palette[s]=(n<<16)+(r<<8)+a}};shrink=()=>{this.cropW|=0,this.cropH|=0,this.cropW/=2,this.cropH/=2,this.cropW|=0,this.cropH|=0;const e=new Int8Array(this.cropW*this.cropH);let t=0;for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)e[(s+this.cropX>>1)+(i+this.cropY>>1)*this.cropW]=this.pixels[t++];this.pixels=e,this.width=this.cropW,this.height=this.cropH,this.cropX=0,this.cropY=0};crop=()=>{if(this.width===this.cropW&&this.height===this.cropH)return;const e=new Int8Array(this.cropW*this.cropH);let t=0;for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)e[s+this.cropX+(i+this.cropY)*this.cropW]=this.pixels[t++];this.pixels=e,this.width=this.cropW,this.height=this.cropH,this.cropX=0,this.cropY=0};copyImage=(e,t,i,s,n,r,a,o)=>{const l=-(e>>2);e=-(3&e);for(let h=-t;h<0;h++){for(let e=l;e<0;e++){let e=i[s++];0===e?a++:r[a++]=this.palette[255&e],e=i[s++],0===e?a++:r[a++]=this.palette[255&e],e=i[s++],0===e?a++:r[a++]=this.palette[255&e],e=i[s++],0===e?a++:r[a++]=this.palette[255&e]}for(let t=e;t<0;t++){const e=i[s++];0===e?a++:r[a++]=this.palette[255&e]}a+=o,s+=n}}}class m extends Array{constructor(e,t){super(e);for(let i=0;i<e;i++)this[i]=t}}class w extends Array{constructor(e,t){super(e);for(let i=0;i<e;i++)this[i]=new Int32Array(t)}}class y extends h{static lowMemory=!1;static reciprocal15=new Int32Array(512);static reciprocal16=new Int32Array(2048);static sin=new Int32Array(2048);static cos=new Int32Array(2048);static palette=new Int32Array(65536);static textures=new m(50,null);static textureCount=0;static lineOffset=new Int32Array;static centerX=0;static centerY=0;static jagged=!0;static clipX=!1;static alpha=0;static texelPool=null;static activeTexels=new m(50,null);static poolSize=0;static cycle=0;static textureCycle=new Int32Array(50);static texturePalette=new m(50,null);static opaque=!1;static textureTranslucent=new m(50,!1);static averageTextureRGB=new Int32Array(50);static{for(let e=1;e<512;e++)this.reciprocal15[e]=32768/e|0;for(let e=1;e<2048;e++)this.reciprocal16[e]=65536/e|0;for(let e=0;e<2048;e++)this.sin[e]=65536*Math.sin(.0030679615757712823*e)|0,this.cos[e]=65536*Math.cos(.0030679615757712823*e)|0}static unload=()=>{this.reciprocal15=null,this.reciprocal15=null,this.sin=null,this.cos=null,this.lineOffset=null,this.textures=null,this.textureTranslucent=null,this.averageTextureRGB=null,this.texelPool=null,this.activeTexels=null,this.textureCycle=null,this.palette=null,this.texturePalette=null,console.log("Draw3D unloaded!")};static init2D=()=>{this.lineOffset=new Int32Array(h.height2d);for(let e=0;e<h.height2d;e++)this.lineOffset[e]=h.width2d*e;this.centerX=h.width2d/2|0,this.centerY=h.height2d/2|0};static init3D=(e,t)=>{this.lineOffset=new Int32Array(t);for(let i=0;i<t;i++)this.lineOffset[i]=e*i;this.centerX=e/2|0,this.centerY=t/2|0};static clearTexels=()=>{this.texelPool=null,this.activeTexels.fill(null)};static unpackTextures=e=>{this.textureCount=0;for(let t=0;t<50;t++)try{this.textures[t]=p.fromArchive(e,t.toString()),this.lowMemory&&128===this.textures[t]?.cropW?this.textures[t]?.shrink():this.textures[t]?.crop(),this.textureCount++}catch(e){}};static getAverageTextureRGB=e=>{if(0!==this.averageTextureRGB[e])return this.averageTextureRGB[e];const t=this.texturePalette[e];if(!t)return 0;let i=0,s=0,n=0;const r=t.length;for(let e=0;e<r;e++)i+=t[e]>>16&255,s+=t[e]>>8&255,n+=255&t[e];let a=((i/r|0)<<16)+((s/r|0)<<8)+(n/r|0);return a=this.setGamma(a,1.4),0===a&&(a=1),this.averageTextureRGB[e]=a,a};static setBrightness=e=>{const t=e+.03*Math.random()-.015;let i=0;for(let e=0;e<512;e++){const s=(e/8|0)/64+.0078125,n=(7&e)/8+.0625;for(let e=0;e<128;e++){const r=e/128;let a=r,o=r,l=r;if(0!==n){let e;e=r<.5?r*(n+1):r+n-r*n;const t=2*r-e;let i=s+.3333333333333333;i>1&&i--;let h=s-.3333333333333333;h<0&&h++,a=6*i<1?t+6*(e-t)*i:2*i<1?e:3*i<2?t+(e-t)*(.6666666666666666-i)*6:t,o=6*s<1?t+6*(e-t)*s:2*s<1?e:3*s<2?t+(e-t)*(.6666666666666666-s)*6:t,l=6*h<1?t+6*(e-t)*h:2*h<1?e:3*h<2?t+(e-t)*(.6666666666666666-h)*6:t}const h=((256*a|0)<<16)+((256*o|0)<<8)+(256*l|0);this.palette[i++]=this.setGamma(h,t)}}for(let e=0;e<50;e++){const i=this.textures[e];if(!i)continue;const s=i.palette;this.texturePalette[e]=new Int32Array(s.length);for(let i=0;i<s.length;i++){const n=this.texturePalette[e];n&&(n[i]=this.setGamma(s[i],t))}}for(let e=0;e<50;e++)this.pushTexture(e)};static setGamma=(e,t)=>{const i=(e>>16)/256,s=(e>>8&255)/256,n=(255&e)/256;return((256*Math.pow(i,t)|0)<<16)+((256*Math.pow(s,t)|0)<<8)+(256*Math.pow(n,t)|0)};static initPool=e=>{this.texelPool||(this.poolSize=e,this.lowMemory?this.texelPool=new w(e,16384):this.texelPool=new w(e,65536),this.activeTexels.fill(null))};static fillGouraudTriangle=(e,t,i,s,n,r,a,o,l)=>{let c=0,d=0;n!==s&&(c=(t-e<<16)/(n-s)|0,d=(o-a<<15)/(n-s)|0);let u=0,f=0;r!==n&&(u=(i-t<<16)/(r-n)|0,f=(l-o<<15)/(r-n)|0);let p=0,m=0;if(r!==s&&(p=(e-i<<16)/(s-r)|0,m=(a-l<<15)/(s-r)|0),s<=n&&s<=r){if(s<h.bottom)if(n>h.bottom&&(n=h.bottom),r>h.bottom&&(r=h.bottom),n<r)if(i=e<<=16,l=a<<=15,s<0&&(i-=p*s,e-=c*s,l-=m*s,a-=d*s,s=0),t<<=16,o<<=15,n<0&&(t-=u*n,o-=f*n,n=0),s!==n&&p<c||s===n&&p>u)for(r-=n,n-=s,s=y.lineOffset[s];;){if(--n<0)for(;;){if(--r<0)return;this.drawGouraudScanline(i>>16,t>>16,l>>7,o>>7,h.pixels,s,0),i+=p,t+=u,l+=m,o+=f,s+=h.width2d}this.drawGouraudScanline(i>>16,e>>16,l>>7,a>>7,h.pixels,s,0),i+=p,e+=c,l+=m,a+=d,s+=h.width2d}else for(r-=n,n-=s,s=y.lineOffset[s];;){if(--n<0)for(;;){if(--r<0)return;this.drawGouraudScanline(t>>16,i>>16,o>>7,l>>7,h.pixels,s,0),i+=p,t+=u,l+=m,o+=f,s+=h.width2d}this.drawGouraudScanline(e>>16,i>>16,a>>7,l>>7,h.pixels,s,0),i+=p,e+=c,l+=m,a+=d,s+=h.width2d}else if(t=e<<=16,o=a<<=15,s<0&&(t-=p*s,e-=c*s,o-=m*s,a-=d*s,s=0),i<<=16,l<<=15,r<0&&(i-=u*r,l-=f*r,r=0),s!==r&&p<c||s===r&&u>c)for(n-=r,r-=s,s=y.lineOffset[s];;){if(--r<0)for(;;){if(--n<0)return;this.drawGouraudScanline(i>>16,e>>16,l>>7,a>>7,h.pixels,s,0),i+=u,e+=c,l+=f,a+=d,s+=h.width2d}this.drawGouraudScanline(t>>16,e>>16,o>>7,a>>7,h.pixels,s,0),t+=p,e+=c,o+=m,a+=d,s+=h.width2d}else for(n-=r,r-=s,s=y.lineOffset[s];;){if(--r<0)for(;;){if(--n<0)return;this.drawGouraudScanline(e>>16,i>>16,a>>7,l>>7,h.pixels,s,0),i+=u,e+=c,l+=f,a+=d,s+=h.width2d}this.drawGouraudScanline(e>>16,t>>16,a>>7,o>>7,h.pixels,s,0),t+=p,e+=c,o+=m,a+=d,s+=h.width2d}}else if(n<=r){if(n<h.bottom)if(r>h.bottom&&(r=h.bottom),s>h.bottom&&(s=h.bottom),r<s)if(e=t<<=16,a=o<<=15,n<0&&(e-=c*n,t-=u*n,a-=d*n,o-=f*n,n=0),i<<=16,l<<=15,r<0&&(i-=p*r,l-=m*r,r=0),n!==r&&c<u||n===r&&c>p)for(s-=r,r-=n,n=y.lineOffset[n];;){if(--r<0)for(;;){if(--s<0)return;this.drawGouraudScanline(e>>16,i>>16,a>>7,l>>7,h.pixels,n,0),e+=c,i+=p,a+=d,l+=m,n+=h.width2d}this.drawGouraudScanline(e>>16,t>>16,a>>7,o>>7,h.pixels,n,0),e+=c,t+=u,a+=d,o+=f,n+=h.width2d}else for(s-=r,r-=n,n=y.lineOffset[n];;){if(--r<0)for(;;){if(--s<0)return;this.drawGouraudScanline(i>>16,e>>16,l>>7,a>>7,h.pixels,n,0),e+=c,i+=p,a+=d,l+=m,n+=h.width2d}this.drawGouraudScanline(t>>16,e>>16,o>>7,a>>7,h.pixels,n,0),e+=c,t+=u,a+=d,o+=f,n+=h.width2d}else if(i=t<<=16,l=o<<=15,n<0&&(i-=c*n,t-=u*n,l-=d*n,o-=f*n,n=0),e<<=16,a<<=15,s<0&&(e-=p*s,a-=m*s,s=0),r-=s,s-=n,n=y.lineOffset[n],c<u)for(;;){if(--s<0)for(;;){if(--r<0)return;this.drawGouraudScanline(e>>16,t>>16,a>>7,o>>7,h.pixels,n,0),e+=p,t+=u,a+=m,o+=f,n+=h.width2d}this.drawGouraudScanline(i>>16,t>>16,l>>7,o>>7,h.pixels,n,0),i+=c,t+=u,l+=d,o+=f,n+=h.width2d}else for(;;){if(--s<0)for(;;){if(--r<0)return;this.drawGouraudScanline(t>>16,e>>16,o>>7,a>>7,h.pixels,n,0),e+=p,t+=u,a+=m,o+=f,n+=h.width2d}this.drawGouraudScanline(t>>16,i>>16,o>>7,l>>7,h.pixels,n,0),i+=c,t+=u,l+=d,o+=f,n+=h.width2d}}else if(r<h.bottom)if(s>h.bottom&&(s=h.bottom),n>h.bottom&&(n=h.bottom),s<n)if(t=i<<=16,o=l<<=15,r<0&&(t-=u*r,i-=p*r,o-=f*r,l-=m*r,r=0),e<<=16,a<<=15,s<0&&(e-=c*s,a-=d*s,s=0),n-=s,s-=r,r=y.lineOffset[r],u<p)for(;;){if(--s<0)for(;;){if(--n<0)return;this.drawGouraudScanline(t>>16,e>>16,o>>7,a>>7,h.pixels,r,0),t+=u,e+=c,o+=f,a+=d,r+=h.width2d}this.drawGouraudScanline(t>>16,i>>16,o>>7,l>>7,h.pixels,r,0),t+=u,i+=p,o+=f,l+=m,r+=h.width2d}else for(;;){if(--s<0)for(;;){if(--n<0)return;this.drawGouraudScanline(e>>16,t>>16,a>>7,o>>7,h.pixels,r,0),t+=u,e+=c,o+=f,a+=d,r+=h.width2d}this.drawGouraudScanline(i>>16,t>>16,l>>7,o>>7,h.pixels,r,0),t+=u,i+=p,o+=f,l+=m,r+=h.width2d}else if(e=i<<=16,a=l<<=15,r<0&&(e-=u*r,i-=p*r,a-=f*r,l-=m*r,r=0),t<<=16,o<<=15,n<0&&(t-=c*n,o-=d*n,n=0),s-=n,n-=r,r=y.lineOffset[r],u<p)for(;;){if(--n<0)for(;;){if(--s<0)return;this.drawGouraudScanline(t>>16,i>>16,o>>7,l>>7,h.pixels,r,0),t+=c,i+=p,o+=d,l+=m,r+=h.width2d}this.drawGouraudScanline(e>>16,i>>16,a>>7,l>>7,h.pixels,r,0),e+=u,i+=p,a+=f,l+=m,r+=h.width2d}else for(;;){if(--n<0)for(;;){if(--s<0)return;this.drawGouraudScanline(i>>16,t>>16,l>>7,o>>7,h.pixels,r,0),t+=c,i+=p,o+=d,l+=m,r+=h.width2d}this.drawGouraudScanline(i>>16,e>>16,l>>7,a>>7,h.pixels,r,0),e+=u,i+=p,a+=f,l+=m,r+=h.width2d}};static drawGouraudScanline=(e,t,i,s,n,r,a)=>{let o;if(y.jagged){let l;if(y.clipX){if(l=t-e>3?(s-i)/(t-e)|0:0,t>h.boundX&&(t=h.boundX),e<0&&(i-=e*l,e=0),e>=t)return;r+=e,a=t-e>>2,l<<=2}else{if(!(e<t))return;r+=e,l=(a=t-e>>2)>0?(s-i)*y.reciprocal15[a]>>15:0}if(0===y.alpha)for(;;){if(--a<0){if((a=t-e&3)>0){o=y.palette[i>>8];do{n[r++]=o,a--}while(a>0);return}break}o=y.palette[i>>8],i+=l,n[r++]=o,n[r++]=o,n[r++]=o,n[r++]=o}else{const s=y.alpha,h=256-y.alpha;for(;;){if(--a<0){if((a=t-e&3)>0){o=y.palette[i>>8],o=((16711935&o)*h>>8&16711935)+((65280&o)*h>>8&65280);do{n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),a--}while(a>0)}break}o=y.palette[i>>8],i+=l,o=((16711935&o)*h>>8&16711935)+((65280&o)*h>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280)}}}else if(e<t){const l=(s-i)/(t-e)|0;if(y.clipX&&(t>h.boundX&&(t=h.boundX),e<0&&(i-=e*l,e=0),e>=t))return;if(r+=e,a=t-e,0===y.alpha)do{n[r++]=y.palette[i>>8],i+=l,a--}while(a>0);else{const e=y.alpha,t=256-y.alpha;do{o=y.palette[i>>8],i+=l,o=((16711935&o)*t>>8&16711935)+((65280&o)*t>>8&65280),n[r++]=o+((16711935&n[r])*e>>8&16711935)+((65280&n[r])*e>>8&65280),a--}while(a>0)}}};static fillTriangle=(e,t,i,s,n,r,a)=>{let o=0;n!==s&&(o=(t-e<<16)/(n-s)|0);let l=0;r!==n&&(l=(i-t<<16)/(r-n)|0);let c=0;if(r!==s&&(c=(e-i<<16)/(s-r)|0),s<=n&&s<=r){if(s<h.bottom)if(n>h.bottom&&(n=h.bottom),r>h.bottom&&(r=h.bottom),n<r)if(i=e<<=16,s<0&&(i-=c*s,e-=o*s,s=0),t<<=16,n<0&&(t-=l*n,n=0),s!==n&&c<o||s===n&&c>l)for(r-=n,n-=s,s=this.lineOffset[s];;){if(--n<0)for(;;){if(--r<0)return;this.drawScanline(i>>16,t>>16,h.pixels,s,a),i+=c,t+=l,s+=h.width2d}this.drawScanline(i>>16,e>>16,h.pixels,s,a),i+=c,e+=o,s+=h.width2d}else for(r-=n,n-=s,s=this.lineOffset[s];;){if(--n<0)for(;;){if(--r<0)return;this.drawScanline(t>>16,i>>16,h.pixels,s,a),i+=c,t+=l,s+=h.width2d}this.drawScanline(e>>16,i>>16,h.pixels,s,a),i+=c,e+=o,s+=h.width2d}else if(t=e<<=16,s<0&&(t-=c*s,e-=o*s,s=0),i<<=16,r<0&&(i-=l*r,r=0),s!==r&&c<o||s===r&&l>o)for(n-=r,r-=s,s=this.lineOffset[s];;){if(--r<0)for(;;){if(--n<0)return;this.drawScanline(i>>16,e>>16,h.pixels,s,a),i+=l,e+=o,s+=h.width2d}this.drawScanline(t>>16,e>>16,h.pixels,s,a),t+=c,e+=o,s+=h.width2d}else for(n-=r,r-=s,s=this.lineOffset[s];;){if(--r<0)for(;;){if(--n<0)return;this.drawScanline(e>>16,i>>16,h.pixels,s,a),i+=l,e+=o,s+=h.width2d}this.drawScanline(e>>16,t>>16,h.pixels,s,a),t+=c,e+=o,s+=h.width2d}}else if(n<=r){if(n<h.bottom)if(r>h.bottom&&(r=h.bottom),s>h.bottom&&(s=h.bottom),r<s)if(e=t<<=16,n<0&&(e-=o*n,t-=l*n,n=0),i<<=16,r<0&&(i-=c*r,r=0),n!==r&&o<l||n===r&&o>c)for(s-=r,r-=n,n=this.lineOffset[n];;){if(--r<0)for(;;){if(--s<0)return;this.drawScanline(e>>16,i>>16,h.pixels,n,a),e+=o,i+=c,n+=h.width2d}this.drawScanline(e>>16,t>>16,h.pixels,n,a),e+=o,t+=l,n+=h.width2d}else for(s-=r,r-=n,n=this.lineOffset[n];;){if(--r<0)for(;;){if(--s<0)return;this.drawScanline(i>>16,e>>16,h.pixels,n,a),e+=o,i+=c,n+=h.width2d}this.drawScanline(t>>16,e>>16,h.pixels,n,a),e+=o,t+=l,n+=h.width2d}else if(i=t<<=16,n<0&&(i-=o*n,t-=l*n,n=0),e<<=16,s<0&&(e-=c*s,s=0),o<l)for(r-=s,s-=n,n=this.lineOffset[n];;){if(--s<0)for(;;){if(--r<0)return;this.drawScanline(e>>16,t>>16,h.pixels,n,a),e+=c,t+=l,n+=h.width2d}this.drawScanline(i>>16,t>>16,h.pixels,n,a),i+=o,t+=l,n+=h.width2d}else for(r-=s,s-=n,n=this.lineOffset[n];;){if(--s<0)for(;;){if(--r<0)return;this.drawScanline(t>>16,e>>16,h.pixels,n,a),e+=c,t+=l,n+=h.width2d}this.drawScanline(t>>16,i>>16,h.pixels,n,a),i+=o,t+=l,n+=h.width2d}}else if(r<h.bottom)if(s>h.bottom&&(s=h.bottom),n>h.bottom&&(n=h.bottom),s<n)if(t=i<<=16,r<0&&(t-=l*r,i-=c*r,r=0),e<<=16,s<0&&(e-=o*s,s=0),l<c)for(n-=s,s-=r,r=this.lineOffset[r];;){if(--s<0)for(;;){if(--n<0)return;this.drawScanline(t>>16,e>>16,h.pixels,r,a),t+=l,e+=o,r+=h.width2d}this.drawScanline(t>>16,i>>16,h.pixels,r,a),t+=l,i+=c,r+=h.width2d}else for(n-=s,s-=r,r=this.lineOffset[r];;){if(--s<0)for(;;){if(--n<0)return;this.drawScanline(e>>16,t>>16,h.pixels,r,a),t+=l,e+=o,r+=h.width2d}this.drawScanline(i>>16,t>>16,h.pixels,r,a),t+=l,i+=c,r+=h.width2d}else if(e=i<<=16,r<0&&(e-=l*r,i-=c*r,r=0),t<<=16,n<0&&(t-=o*n,n=0),l<c)for(s-=n,n-=r,r=this.lineOffset[r];;){if(--n<0)for(;;){if(--s<0)return;this.drawScanline(t>>16,i>>16,h.pixels,r,a),t+=o,i+=c,r+=h.width2d}this.drawScanline(e>>16,i>>16,h.pixels,r,a),e+=l,i+=c,r+=h.width2d}else for(s-=n,n-=r,r=this.lineOffset[r];;){if(--n<0)for(;;){if(--s<0)return;this.drawScanline(i>>16,t>>16,h.pixels,r,a),t+=o,i+=c,r+=h.width2d}this.drawScanline(i>>16,e>>16,h.pixels,r,a),e+=l,i+=c,r+=h.width2d}};static fillTexturedTriangle=(e,t,i,s,n,r,a,o,l,c,d,u,f,p,m,w,y,g,b)=>{const k=this.getTexels(b);this.opaque=!this.textureTranslucent[b];const v=c-f,_=d-m,x=u-y,S=p-c,T=w-d,M=g-u;let A=S*d-T*c<<14;const C=T*u-M*d<<8,E=M*c-S*u<<5;let P=v*d-_*c<<14;const I=_*u-x*d<<8,B=x*c-v*u<<5;let R=_*S-v*T<<14;const F=x*T-_*M<<8,L=v*M-x*S<<5;let O=0,U=0;n!==s&&(O=(t-e<<16)/(n-s)|0,U=(o-a<<16)/(n-s)|0);let D=0,G=0;r!==n&&(D=(i-t<<16)/(r-n)|0,G=(l-o<<16)/(r-n)|0);let z=0,W=0;if(r!==s&&(z=(e-i<<16)/(s-r)|0,W=(a-l<<16)/(s-r)|0),s<=n&&s<=r){if(s<h.bottom)if(n>h.bottom&&(n=h.bottom),r>h.bottom&&(r=h.bottom),n<r){i=e<<=16,l=a<<=16,s<0&&(i-=z*s,e-=O*s,l-=W*s,a-=U*s,s=0),t<<=16,o<<=16,n<0&&(t-=D*n,o-=G*n,n=0);const c=s-this.centerY;if(A+=E*c,P+=B*c,R+=L*c,A|=0,P|=0,R|=0,s!==n&&z<O||s===n&&z>D)for(r-=n,n-=s,s=this.lineOffset[s];;){if(--n<0)for(;;){if(--r<0)return;this.drawTexturedScanline(i>>16,t>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,l>>8,o>>8),i+=z,t+=D,l+=W,o+=G,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(i>>16,e>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,l>>8,a>>8),i+=z,e+=O,l+=W,a+=U,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}else for(r-=n,n-=s,s=this.lineOffset[s];;){if(--n<0)for(;;){if(--r<0)return;this.drawTexturedScanline(t>>16,i>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,o>>8,l>>8),i+=z,t+=D,l+=W,o+=G,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(e>>16,i>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,a>>8,l>>8),i+=z,e+=O,l+=W,a+=U,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}}else{t=e<<=16,o=a<<=16,s<0&&(t-=z*s,e-=O*s,o-=W*s,a-=U*s,s=0),i<<=16,l<<=16,r<0&&(i-=D*r,l-=G*r,r=0);const c=s-this.centerY;if(A+=E*c,P+=B*c,R+=L*c,A|=0,P|=0,R|=0,(s===r||z>=O)&&(s!==r||D<=O))for(n-=r,r-=s,s=this.lineOffset[s];;){if(--r<0)for(;;){if(--n<0)return;this.drawTexturedScanline(e>>16,i>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,a>>8,l>>8),i+=D,e+=O,l+=G,a+=U,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(e>>16,t>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,a>>8,o>>8),t+=z,e+=O,o+=W,a+=U,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}else for(n-=r,r-=s,s=this.lineOffset[s];;){if(--r<0)for(;;){if(--n<0)return;this.drawTexturedScanline(i>>16,e>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,l>>8,a>>8),i+=D,e+=O,l+=G,a+=U,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(t>>16,e>>16,h.pixels,s,k,0,0,A,P,R,C,I,F,o>>8,a>>8),t+=z,e+=O,o+=W,a+=U,s+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}}}else if(n<=r){if(n<h.bottom)if(r>h.bottom&&(r=h.bottom),s>h.bottom&&(s=h.bottom),r<s){e=t<<=16,a=o<<=16,n<0&&(e-=O*n,t-=D*n,a-=U*n,o-=G*n,n=0),i<<=16,l<<=16,r<0&&(i-=z*r,l-=W*r,r=0);const c=n-this.centerY;if(A+=E*c,P+=B*c,R+=L*c,A|=0,P|=0,R|=0,n!==r&&O<D||n===r&&O>z)for(s-=r,r-=n,n=this.lineOffset[n];;){if(--r<0)for(;;){if(--s<0)return;this.drawTexturedScanline(e>>16,i>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,a>>8,l>>8),e+=O,i+=z,a+=U,l+=W,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(e>>16,t>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,a>>8,o>>8),e+=O,t+=D,a+=U,o+=G,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}else for(s-=r,r-=n,n=this.lineOffset[n];;){if(--r<0)for(;;){if(--s<0)return;this.drawTexturedScanline(i>>16,e>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,l>>8,a>>8),e+=O,i+=z,a+=U,l+=W,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(t>>16,e>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,o>>8,a>>8),e+=O,t+=D,a+=U,o+=G,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}}else{i=t<<=16,l=o<<=16,n<0&&(i-=O*n,t-=D*n,l-=U*n,o-=G*n,n=0),e<<=16,a<<=16,s<0&&(e-=z*s,a-=W*s,s=0);const c=n-this.centerY;if(A+=E*c,P+=B*c,R+=L*c,A|=0,P|=0,R|=0,r-=s,s-=n,n=this.lineOffset[n],O<D)for(;;){if(--s<0)for(;;){if(--r<0)return;this.drawTexturedScanline(e>>16,t>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,a>>8,o>>8),e+=z,t+=D,a+=W,o+=G,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(i>>16,t>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,l>>8,o>>8),i+=O,t+=D,l+=U,o+=G,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}else for(;;){if(--s<0)for(;;){if(--r<0)return;this.drawTexturedScanline(t>>16,e>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,o>>8,a>>8),e+=z,t+=D,a+=W,o+=G,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(t>>16,i>>16,h.pixels,n,k,0,0,A,P,R,C,I,F,o>>8,l>>8),i+=O,t+=D,l+=U,o+=G,n+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}}}else if(r<h.bottom)if(s>h.bottom&&(s=h.bottom),n>h.bottom&&(n=h.bottom),s<n){t=i<<=16,o=l<<=16,r<0&&(t-=D*r,i-=z*r,o-=G*r,l-=W*r,r=0),e<<=16,a<<=16,s<0&&(e-=O*s,a-=U*s,s=0);const c=r-this.centerY;if(A+=E*c,P+=B*c,R+=L*c,A|=0,P|=0,R|=0,n-=s,s-=r,r=this.lineOffset[r],D<z)for(;;){if(--s<0)for(;;){if(--n<0)return;this.drawTexturedScanline(t>>16,e>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,o>>8,a>>8),t+=D,e+=O,o+=G,a+=U,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(t>>16,i>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,o>>8,l>>8),t+=D,i+=z,o+=G,l+=W,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}else for(;;){if(--s<0)for(;;){if(--n<0)return;this.drawTexturedScanline(e>>16,t>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,a>>8,o>>8),t+=D,e+=O,o+=G,a+=U,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(i>>16,t>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,l>>8,o>>8),t+=D,i+=z,o+=G,l+=W,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}}else{e=i<<=16,a=l<<=16,r<0&&(e-=D*r,i-=z*r,a-=G*r,l-=W*r,r=0),t<<=16,o<<=16,n<0&&(t-=O*n,o-=U*n,n=0);const c=r-this.centerY;if(A+=E*c,P+=B*c,R+=L*c,A|=0,P|=0,R|=0,s-=n,n-=r,r=this.lineOffset[r],D<z)for(;;){if(--n<0)for(;;){if(--s<0)return;this.drawTexturedScanline(t>>16,i>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,o>>8,l>>8),t+=O,i+=z,o+=U,l+=W,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(e>>16,i>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,a>>8,l>>8),e+=D,i+=z,a+=G,l+=W,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}else for(;;){if(--n<0)for(;;){if(--s<0)return;this.drawTexturedScanline(i>>16,t>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,l>>8,o>>8),t+=O,i+=z,o+=U,l+=W,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}this.drawTexturedScanline(i>>16,e>>16,h.pixels,r,k,0,0,A,P,R,C,I,F,l>>8,a>>8),e+=D,i+=z,a+=G,l+=W,r+=h.width2d,A+=E,P+=B,R+=L,A|=0,P|=0,R|=0}}};static drawTexturedScanline=(e,t,i,s,n,r,a,o,l,c,d,u,f,p,m)=>{if(e>=t)return;let w,y,g,b,k,v,_,x,S;if(this.clipX){if(w=(m-p)/(t-e)|0,t>h.boundX&&(t=h.boundX),e<0&&(p-=e*w,e=0),e>=t)return;y=t-e>>3,w<<=12}else t-e>7?(y=t-e>>3,w=(m-p)*this.reciprocal15[y]>>6):(y=0,w=0);if(p<<=9,s+=e,this.lowMemory&&n)if(g=0,b=0,v=e-this.centerX,o+=(d>>3)*v,l+=(u>>3)*v,c+=(f>>3)*v,o|=0,l|=0,k=(c|=0)>>12,0!==k&&(a=l/k|0,(r=o/k|0)<0?r=0:r>4032&&(r=4032)),o+=d,l+=u,c+=f,o|=0,l|=0,k=(c|=0)>>12,0!==k&&(g=o/k|0,b=l/k|0,g<7?g=7:g>4032&&(g=4032)),_=g-r>>3,x=b-a>>3,r+=p>>3&786432,S=p>>23,this.opaque){for(;y-- >0;)i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x,i[s++]=n[(4032&a)+(r>>6)]>>>S,r=g,a=b,o+=d,l+=u,k=(c+=f)>>12,0!==k&&(g=o/k|0,b=l/k|0,g<7?g=7:g>4032&&(g=4032)),_=g-r>>3,x=b-a>>3,r+=(p+=w)>>3&786432,S=p>>23;for(y=t-e&7;y-- >0;)i[s++]=n[(4032&a)+(r>>6)]>>>S,r+=_,a+=x}else{for(;y-- >0;){let e;0!=(e=n[(4032&a)+(r>>6)]>>>S)&&(i[s]=e),s+=1,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s++,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s++,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s++,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s++,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s++,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s++,0!=(e=n[(4032&(a+=x))+((r+=_)>>6)]>>>S)&&(i[s]=e),s+=1,r=g,a=b,o+=d,l+=u,c+=f,o|=0,l|=0,k=(c|=0)>>12,0!==k&&(g=o/k|0,b=l/k|0,g<7?g=7:g>4032&&(g=4032)),_=g-r>>3,x=b-a>>3,r+=(p+=w)>>3&786432,S=p>>23}for(y=t-e&7;y-- >0;){let e;0!=(e=n[(4032&a)+(r>>6)]>>>S)&&(i[s]=e),s++,r+=_,a+=x}}else if(g=0,b=0,v=e-this.centerX,o+=(d>>3)*v,l+=(u>>3)*v,c+=(f>>3)*v,o|=0,l|=0,k=(c|=0)>>14,0!==k&&(a=l/k|0,(r=o/k|0)<0?r=0:r>16256&&(r=16256)),o+=d,l+=u,c+=f,o|=0,l|=0,k=(c|=0)>>14,0!==k&&(g=o/k|0,b=l/k|0,g<7?g=7:g>16256&&(g=16256)),_=g-r>>3,x=b-a>>3,r+=6291456&p,S=p>>23,this.opaque&&n){for(;y-- >0;)i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x,i[s++]=n[(16256&a)+(r>>7)]>>>S,r=g,a=b,o+=d,l+=u,c+=f,o|=0,l|=0,k=(c|=0)>>14,0!==k&&(g=o/k|0,b=l/k|0,g<7?g=7:g>16256&&(g=16256)),_=g-r>>3,x=b-a>>3,r+=6291456&(p+=w),S=p>>23;for(y=t-e&7;y-- >0;)i[s++]=n[(16256&a)+(r>>7)]>>>S,r+=_,a+=x}else{for(;y-- >0&&n;){let e;0!=(e=n[(16256&a)+(r>>7)]>>>S)&&(i[s]=e),s+=1,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,0!=(e=n[(16256&(a+=x))+((r+=_)>>7)]>>>S)&&(i[s]=e),s++,r=g,a=b,o+=d,l+=u,c+=f,o|=0,l|=0,k=(c|=0)>>14,0!==k&&(g=o/k|0,b=l/k|0,g<7?g=7:g>16256&&(g=16256)),_=g-r>>3,x=b-a>>3,r+=6291456&(p+=w),S=p>>23}for(y=t-e&7;y-- >0&&n;){let e;0!=(e=n[(16256&a)+(r>>7)]>>>S)&&(i[s]=e),s++,r+=_,a+=x}}};static drawScanline=(e,t,i,s,n)=>{if(this.clipX&&(t>h.boundX&&(t=h.boundX),e<0&&(e=0)),e>=t)return;s+=e;let r=t-e>>2;if(0===this.alpha)for(;;){if(r--,r<0)for(r=t-e&3;;){if(r--,r<0)return;i[s++]=n}i[s++]=n,i[s++]=n,i[s++]=n,i[s++]=n}const a=this.alpha,o=256-this.alpha;for(n=((16711935&n)*o>>8&16711935)+((65280&n)*o>>8&65280);;){if(r--,r<0)for(r=t-e&3;;){if(r--,r<0)return;i[s++]=n+((16711935&i[s])*a>>8&16711935)+((65280&i[s])*a>>8&65280)}i[s++]=n+((16711935&i[s])*a>>8&16711935)+((65280&i[s])*a>>8&65280),i[s++]=n+((16711935&i[s])*a>>8&16711935)+((65280&i[s])*a>>8&65280),i[s++]=n+((16711935&i[s])*a>>8&16711935)+((65280&i[s])*a>>8&65280),i[s++]=n+((16711935&i[s])*a>>8&16711935)+((65280&i[s])*a>>8&65280)}};static pushTexture=e=>{this.activeTexels[e]&&this.texelPool&&(this.texelPool[this.poolSize++]=this.activeTexels[e],this.activeTexels[e]=null)};static getTexels=e=>{if(this.textureCycle[e]=this.cycle++,this.activeTexels[e])return this.activeTexels[e];let t;if(this.poolSize>0&&this.texelPool)t=this.texelPool[--this.poolSize],this.texelPool[this.poolSize]=null;else{let e=0,i=-1;for(let t=0;t<this.textureCount;t++)this.activeTexels[t]&&(this.textureCycle[t]<e||-1===i)&&(e=this.textureCycle[t],i=t);t=this.activeTexels[i],this.activeTexels[i]=null}this.activeTexels[e]=t;const i=this.textures[e],s=this.texturePalette[e];if(!t||!i||!s)return null;if(this.lowMemory){this.textureTranslucent[e]=!1;for(let n=0;n<4096;n++){const r=t[n]=16316671&s[i.pixels[n]];0===r&&(this.textureTranslucent[e]=!0),t[n+4096]=r-(r>>>3)&16316671,t[n+8192]=r-(r>>>2)&16316671,t[n+12288]=r-(r>>>2)-(r>>>3)&16316671}}else{if(64===i.width)for(let e=0;e<128;e++)for(let n=0;n<128;n++)t[n+(e<<7|0)]=s[i.pixels[(n>>1)+(e>>1<<6|0)]];else for(let e=0;e<16384;e++)t[e]=s[i.pixels[e]];this.textureTranslucent[e]=!1;for(let i=0;i<16384;i++){t[i]&=16316671;const s=t[i];0===s&&(this.textureTranslucent[e]=!0),t[i+16384]=s-(s>>>3)&16316671,t[i+32768]=s-(s>>>2)&16316671,t[i+49152]=s-(s>>>2)-(s>>>3)&16316671}}return t}}const g={Backspace:{key:8,ch:8},Enter:{key:10,ch:10},Shift:{key:16,ch:65535},Escape:{key:27,ch:27},Tab:{key:9,ch:9},CapsLock:{key:20,ch:65535}," ":{key:32,ch:32},Control:{key:17,ch:65535},Alt:{key:18,ch:65535},Meta:{key:524,ch:65535},ArrowLeft:{key:37,ch:65535},ArrowRight:{key:39,ch:65535},ArrowUp:{key:38,ch:65535},ArrowDown:{key:40,ch:65535},Insert:{key:155,ch:65535},Home:{key:36,ch:65535},PageUp:{key:33,ch:65535},Delete:{key:127,ch:127},End:{key:35,ch:65535},PageDown:{key:34,ch:65535},"`":{key:192,ch:96},"~":{key:192,ch:126},"!":{key:49,ch:33},"@":{key:50,ch:64},"#":{key:51,ch:35},$:{key:52,ch:36},"%":{key:53,ch:37},"^":{key:54,ch:94},"&":{key:55,ch:38},"*":{key:56,ch:42},"(":{key:57,ch:40},")":{key:48,ch:41},"-":{key:45,ch:45},_:{key:45,ch:95},"=":{key:61,ch:61},"+":{key:61,ch:43},"[":{key:91,ch:91},"{":{key:91,ch:123},"]":{key:93,ch:93},"}":{key:93,ch:125},"\\":{key:92,ch:92},"|":{key:92,ch:124},";":{key:59,ch:59},":":{key:59,ch:58},"'":{key:222,ch:39},'"':{key:222,ch:34},",":{key:44,ch:44},"<":{key:44,ch:60},".":{key:46,ch:46},">":{key:46,ch:62},"/":{key:47,ch:47},"?":{key:47,ch:63},F1:{key:112,ch:65535},F2:{key:113,ch:65535},F3:{key:114,ch:65535},F4:{key:115,ch:65535},F5:{key:116,ch:65535},F6:{key:117,ch:65535},F7:{key:118,ch:65535},F8:{key:119,ch:65535},F9:{key:120,ch:65535},F10:{key:121,ch:65535},F11:{key:122,ch:65535},F12:{key:123,ch:65535},0:{key:48,ch:48},1:{key:49,ch:49},2:{key:50,ch:50},3:{key:51,ch:51},4:{key:52,ch:52},5:{key:53,ch:53},6:{key:54,ch:54},7:{key:55,ch:55},8:{key:56,ch:56},9:{key:57,ch:57},a:{key:65,ch:97},b:{key:66,ch:98},c:{key:67,ch:99},d:{key:68,ch:100},e:{key:69,ch:101},f:{key:70,ch:102},g:{key:71,ch:103},h:{key:72,ch:104},i:{key:73,ch:105},j:{key:74,ch:106},k:{key:75,ch:107},l:{key:76,ch:108},m:{key:77,ch:109},n:{key:78,ch:110},o:{key:79,ch:111},p:{key:80,ch:112},q:{key:81,ch:113},r:{key:82,ch:114},s:{key:83,ch:115},t:{key:84,ch:116},u:{key:85,ch:117},v:{key:86,ch:118},w:{key:87,ch:119},x:{key:88,ch:120},y:{key:89,ch:121},z:{key:90,ch:122},A:{key:65,ch:65},B:{key:66,ch:66},C:{key:67,ch:67},D:{key:68,ch:68},E:{key:69,ch:69},F:{key:70,ch:70},G:{key:71,ch:71},H:{key:72,ch:72},I:{key:73,ch:73},J:{key:74,ch:74},K:{key:75,ch:75},L:{key:76,ch:76},M:{key:77,ch:77},N:{key:78,ch:78},O:{key:79,ch:79},P:{key:80,ch:80},Q:{key:81,ch:81},R:{key:82,ch:82},S:{key:83,ch:83},T:{key:84,ch:84},U:{key:85,ch:85},V:{key:86,ch:86},W:{key:87,ch:87},X:{key:88,ch:88},Y:{key:89,ch:89},Z:{key:90,ch:90}},b=["Tab","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];class k{static enabled=!1;static outBuffer=null;static oldBuffer=null;static lastTime=0;static trackedCount=0;static lastMoveTime=0;static lastX=0;static lastY=0;static setEnabled=()=>{this.outBuffer=a.alloc(1),this.oldBuffer=null,this.lastTime=Date.now(),this.enabled=!0};static setDisabled=()=>{this.enabled=!1,this.outBuffer=null};static flush=()=>{let e=null;return this.oldBuffer&&this.enabled&&(e=this.oldBuffer),this.oldBuffer=null,e};static stop=()=>{let e=null;return this.outBuffer&&this.outBuffer.pos>0&&this.enabled&&(e=this.outBuffer),this.setDisabled(),e};static mousePressed=(e,t,i)=>{if(!(this.enabled&&e>=0&&e<789&&t>=0&&t<532))return;this.trackedCount++;const s=Date.now();let n=(s-this.lastTime)/10|0;n>250&&(n=250),this.lastTime=s,this.ensureCapacity(5),1===i?this.outBuffer?.p1(1):this.outBuffer?.p1(2),this.outBuffer?.p1(n),this.outBuffer?.p3(e+(t<<10))};static mouseReleased=e=>{if(!this.enabled)return;this.trackedCount++;const t=Date.now();let i=(t-this.lastTime)/10|0;i>250&&(i=250),this.lastTime=t,this.ensureCapacity(2),1===e?this.outBuffer?.p1(3):this.outBuffer?.p1(4),this.outBuffer?.p1(i)};static mouseMoved=(e,t)=>{if(!(this.enabled&&e>=0&&e<789&&t>=0&&t<532))return;const i=Date.now();if(i-this.lastMoveTime>=50){this.lastMoveTime=i,this.trackedCount++;let s=(i-this.lastTime)/10|0;s>250&&(s=250),this.lastTime=i,e-this.lastX<8&&e-this.lastX>=-8&&t-this.lastY<8&&t-this.lastY>=-8?(this.ensureCapacity(3),this.outBuffer?.p1(5),this.outBuffer?.p1(s),this.outBuffer?.p1(e+(t-this.lastY+8<<4)+8-this.lastX)):e-this.lastX<128&&e-this.lastX>=-128&&t-this.lastY<128&&t-this.lastY>=-128?(this.ensureCapacity(4),this.outBuffer?.p1(6),this.outBuffer?.p1(s),this.outBuffer?.p1(e+128-this.lastX),this.outBuffer?.p1(t+128-this.lastY)):(this.ensureCapacity(5),this.outBuffer?.p1(7),this.outBuffer?.p1(s),this.outBuffer?.p3(e+(t<<10))),this.lastX=e,this.lastY=t}};static keyPressed=e=>{if(!this.enabled)return;this.trackedCount++;const t=Date.now();let i=(t-this.lastTime)/10|0;i>250&&(i=250),this.lastTime=t,1e3===e?e=11:1001===e?e=12:1002===e?e=14:1003===e?e=15:e>=1008&&(e-=992),this.ensureCapacity(3),this.outBuffer?.p1(8),this.outBuffer?.p1(i),this.outBuffer?.p1(e)};static keyReleased=e=>{if(!this.enabled)return;this.trackedCount++;const t=Date.now();let i=(t-this.lastTime)/10|0;i>250&&(i=250),this.lastTime=t,1e3===e?e=11:1001===e?e=12:1002===e?e=14:1003===e?e=15:e>=1008&&(e-=992),this.ensureCapacity(3),this.outBuffer?.p1(9),this.outBuffer?.p1(i),this.outBuffer?.p1(e)};static focusGained=()=>{if(!this.enabled)return;this.trackedCount++;const e=Date.now();let t=(e-this.lastTime)/10|0;t>250&&(t=250),this.lastTime=e,this.ensureCapacity(2),this.outBuffer?.p1(10),this.outBuffer?.p1(t)};static focusLost=()=>{if(!this.enabled)return;this.trackedCount++;const e=Date.now();let t=(e-this.lastTime)/10|0;t>250&&(t=250),this.lastTime=e,this.ensureCapacity(2),this.outBuffer?.p1(11),this.outBuffer?.p1(t)};static mouseEntered=()=>{if(!this.enabled)return;this.trackedCount++;const e=Date.now();let t=(e-this.lastTime)/10|0;t>250&&(t=250),this.lastTime=e,this.ensureCapacity(2),this.outBuffer?.p1(12),this.outBuffer?.p1(t)};static mouseExited=()=>{if(!this.enabled)return;this.trackedCount++;const e=Date.now();let t=(e-this.lastTime)/10|0;t>250&&(t=250),this.lastTime=e,this.ensureCapacity(2),this.outBuffer?.p1(13),this.outBuffer?.p1(t)};static ensureCapacity=e=>{if(this.outBuffer&&this.outBuffer.pos+e>=500){const e=this.outBuffer;this.outBuffer=a.alloc(1),this.oldBuffer=e}}}class v{static getParameter(e){return new URLSearchParams(window.location.search).get(e)??""}static setParameter(e,t){const i=new URL(window.location.toString());i.searchParams.set(e,t),window.history.pushState(null,"",i.toString())}slowestMS=0;averageMS=[];averageIndexMS=0;drawArea=null;state=0;deltime=20;mindel=1;otim=[];fps=0;fpos=0;frameTime=[];redrawScreen=!0;resizeToFit=!1;idleCycles=0;mouseButton=0;mouseX=0;mouseY=0;mouseClickButton=0;mouseClickX=0;mouseClickY=0;actionKey=[];keyQueue=[];keyQueueReadPos=0;keyQueueWritePos=0;constructor(e=!1){d.fillStyle="black",d.fillRect(0,0,c.width,c.height),this.resizeToFit=e,this.resizeToFit?this.resize(window.innerWidth,window.innerHeight):this.resize(c.width,c.height)}get width(){return c.width}get height(){return c.height}resize(e,t){c.width=e,c.height=t,this.drawArea=new f(e,t),y.init2D()}async run(){window.addEventListener("resize",(()=>{this.resizeToFit&&this.resize(window.innerWidth,window.innerHeight)}),!1),window.addEventListener("keydown",this.keyPressed),window.addEventListener("keyup",this.keyReleased),window.addEventListener("mousedown",this.mousePressed),window.addEventListener("mouseup",this.mouseReleased),window.addEventListener("mouseenter",this.mouseEntered),window.addEventListener("mouseleave",this.mouseExited),window.addEventListener("mousemove",this.mouseMoved),window.addEventListener("focusin",this.focusGained),window.addEventListener("focusout",this.focusLost),window.addEventListener("beforeunload",this.unload),c.oncontextmenu=e=>{e.preventDefault()},await this.showProgress(0,"Loading..."),await this.load();for(let e=0;e<10;e++)this.otim[e]=Date.now();let t,i=0,s=256,n=1,r=0;for(;this.state>=0;){if(this.state>0&&(this.state--,0===this.state))return void this.shutdown();const a=s,o=n;s=300,n=1,t=Date.now();const l=this.otim[i];if(0===l?(s=a,n=o):t>l&&(s=2560*this.deltime/(t-l)|0),s<25?s=25:s>256&&(s=256,n=this.deltime-(t-l)/10|0),this.otim[i]=t,i=(i+1)%10,n>1)for(let e=0;e<10;e++)0!==this.otim[e]&&(this.otim[e]+=n);for(n<this.mindel&&(n=this.mindel),await e(n);r<256;)await this.update(),this.mouseClickButton=0,this.keyQueueReadPos=this.keyQueueWritePos,r+=s;r&=255,this.deltime>0&&(this.fps=1e3*s/(256*this.deltime)|0);const h=performance.now();this.redrawScreen&&this.refresh(),await this.draw(),this.frameTime[this.fpos]=(performance.now()-h)/1e3,this.fpos=(this.fpos+1)%this.frameTime.length}-1===this.state&&this.shutdown()}shutdown(){this.state=-2,this.unload()}setFramerate(e){this.deltime=1e3/e|0}start(){this.state>=0&&(this.state=0)}stop(){this.state>=0&&(this.state=4e3/this.deltime|0)}destroy(){this.state=-1}async load(){}async update(){}unload(){}async draw(){}refresh(){}async showProgress(t,i){const s=this.width,n=this.height;this.redrawScreen&&(d.fillStyle="black",d.fillRect(0,0,s,n),this.redrawScreen=!1);const r=n/2-18;d.fillStyle="rgb(140, 17, 17)",d.rect((s/2|0)-152,r,304,34),d.fillRect((s/2|0)-150,r+2,3*t,30),d.fillStyle="black",d.fillRect((s/2|0)-150+3*t,r+2,300-3*t,30),d.font="bold 13px helvetica, sans-serif",d.textAlign="center",d.fillStyle="white",d.fillText(i,s/2|0,r+22),await e(5)}keyPressed=e=>{const t=e.key;b.includes(t)&&e.preventDefault(),this.idleCycles=0;const i=g[t];if(!i)return void console.error(`Unhandled key ${t}`);const s=i.key;let n=i.ch;n<30&&(n=0),37===s?n=1:39===s?n=2:38===s?n=3:40===s?n=4:17===s?n=5:8===s||127===s?n=8:9===s?n=9:10===s?n=10:s>=112&&s<=123?n=s+1008-112:36===s?n=1e3:35===s?n=1001:33===s?n=1002:34===s&&(n=1003),n>0&&n<128&&(this.actionKey[n]=1),n>4&&(this.keyQueue[this.keyQueueWritePos]=n,this.keyQueueWritePos=this.keyQueueWritePos+1&127),k.enabled&&k.keyPressed(n)};keyReleased=e=>{const t=e.key;b.includes(t)&&e.preventDefault(),this.idleCycles=0;const i=g[t];if(!i)return void console.error(`Unhandled key ${t}`);const s=i.key;let n=i.ch;n<30&&(n=0),37===s?n=1:39===s?n=2:38===s?n=3:40===s?n=4:17===s?n=5:8===s||127===s?n=8:9===s?n=9:10===s?n=10:s>=112&&s<=123?n=s+1008-112:36===s?n=1e3:35===s?n=1001:33===s?n=1002:34===s&&(n=1003),n>0&&n<128&&(this.actionKey[n]=0),k.enabled&&k.keyReleased(n)};pollKey(){let e=-1;return this.keyQueueWritePos!==this.keyQueueReadPos&&(e=this.keyQueue[this.keyQueueReadPos],this.keyQueueReadPos=this.keyQueueReadPos+1&127),e}mousePressed=e=>{let t=e.x,i=e.y;const{top:s,left:n}=this.getInsets;t-=n,i-=s,t|=0,i|=0,this.idleCycles=0,this.mouseClickX=t,this.mouseClickY=i,2===e.buttons?(this.mouseClickButton=2,this.mouseButton=2):1===e.buttons&&(this.mouseClickButton=1,this.mouseButton=1),k.enabled};mouseReleased=e=>{this.idleCycles=0,this.mouseButton=0,k.enabled};mouseEntered=e=>{k.enabled&&k.mouseEntered()};mouseExited=e=>{k.enabled&&k.mouseExited()};mouseMoved=e=>{let t=e.x,i=e.y;const{top:s,left:n}=this.getInsets;t-=n,i-=s,t|=0,i|=0,this.idleCycles=0,this.mouseX=t,this.mouseY=i,k.enabled&&k.mouseMoved(t,i)};focusGained=e=>{this.redrawScreen=!0,this.refresh(),k.enabled&&k.focusGained()};focusLost=e=>{k.enabled&&k.focusLost()};get ms(){const e=this.frameTime.length;let t=0;for(let i=0;i<e;i++)t+=this.frameTime[i];const i=t/e;return i>this.slowestMS&&(this.slowestMS=i),this.averageMS[this.averageIndexMS]=i,this.averageIndexMS=(this.averageIndexMS+1)%250,i}get msAvg(){return this.averageMS.reduce(((e,t)=>e+t),0)/250}get getInsets(){const e=c.getBoundingClientRect(),t=window.getComputedStyle(c),i=parseFloat(t.paddingLeft||"0"),s=parseFloat(t.paddingTop||"0"),n=parseFloat(t.borderLeftWidth||"0"),r=parseFloat(t.borderTopWidth||"0"),a=e.left+n+i;return{top:e.top+r+s,left:a}}}class _{start=0;end=0;form=0;length=0;shapeDelta=null;shapePeak=null;threshold=0;position=0;delta=0;amplitude=0;ticks=0;read=e=>{this.form=e.g1,this.start=e.g4,this.end=e.g4,this.length=e.g1,this.shapeDelta=new Int32Array(this.length),this.shapePeak=new Int32Array(this.length);for(let t=0;t<this.length;t++)this.shapeDelta[t]=e.g2,this.shapePeak[t]=e.g2};reset=()=>{this.threshold=0,this.position=0,this.delta=0,this.amplitude=0,this.ticks=0};evaluate=e=>(this.ticks>=this.threshold&&this.shapePeak&&this.shapeDelta&&(this.amplitude=this.shapePeak[this.position++]<<15,this.position>=this.length&&(this.position=this.length-1),this.threshold=this.shapeDelta[this.position]/65536*e|0,this.threshold>this.ticks&&(this.delta=((this.shapePeak[this.position]<<15)-this.amplitude)/(this.threshold-this.ticks)|0)),this.amplitude+=this.delta,this.ticks++,this.amplitude-this.delta>>15)}class x{static buffer=null;static noise=null;static sin=null;static tmpPhases=new Int32Array(5);static tmpDelays=new Int32Array(5);static tmpVolumes=new Int32Array(5);static tmpSemitones=new Int32Array(5);static tmpStarts=new Int32Array(5);frequencyBase=null;amplitudeBase=null;frequencyModRate=null;frequencyModRange=null;amplitudeModRate=null;amplitudeModRange=null;release=null;attack=null;harmonicVolume=new Int32Array(5);harmonicSemitone=new Int32Array(5);harmonicDelay=new Int32Array(5);start=0;length=500;reverbVolume=100;reverbDelay=0;static init=()=>{this.noise=new Int32Array(32768);for(let e=0;e<32768;e++)Math.random()>.5?this.noise[e]=1:this.noise[e]=-1;this.sin=new Int32Array(32768);for(let e=0;e<32768;e++)this.sin[e]=16384*Math.sin(e/5215.1903)|0;this.buffer=new Int32Array(220500)};generate=(e,t)=>{for(let t=0;t<e;t++)x.buffer[t]=0;if(t<10)return x.buffer;const i=e/t|0;this.frequencyBase?.reset(),this.amplitudeBase?.reset();let s=0,n=0,r=0;this.frequencyModRate&&this.frequencyModRange&&(this.frequencyModRate.reset(),this.frequencyModRange.reset(),s=32.768*(this.frequencyModRate.end-this.frequencyModRate.start)/i|0,n=32.768*this.frequencyModRate.start/i|0);let a=0,o=0,l=0;this.amplitudeModRate&&this.amplitudeModRange&&(this.amplitudeModRate.reset(),this.amplitudeModRange.reset(),a=32.768*(this.amplitudeModRate.end-this.amplitudeModRate.start)/i|0,o=32.768*this.amplitudeModRate.start/i|0);for(let e=0;e<5;e++)this.frequencyBase&&0!==this.harmonicVolume[e]&&(x.tmpPhases[e]=0,x.tmpDelays[e]=this.harmonicDelay[e]*i,x.tmpVolumes[e]=(this.harmonicVolume[e]<<14)/100|0,x.tmpSemitones[e]=32.768*(this.frequencyBase.end-this.frequencyBase.start)*Math.pow(1.0057929410678534,this.harmonicSemitone[e])/i|0,x.tmpStarts[e]=32.768*this.frequencyBase.start/i|0);if(this.frequencyBase&&this.amplitudeBase)for(let t=0;t<e;t++){let i=this.frequencyBase.evaluate(e),h=this.amplitudeBase.evaluate(e);if(this.frequencyModRate&&this.frequencyModRange){const t=this.frequencyModRate.evaluate(e),a=this.frequencyModRange.evaluate(e);i+=this.generate2(a,r,this.frequencyModRate.form)>>1,r+=(t*s>>16)+n}if(this.amplitudeModRate&&this.amplitudeModRange){const t=this.amplitudeModRate.evaluate(e),i=this.amplitudeModRange.evaluate(e);h=h*(32768+(this.generate2(i,l,this.amplitudeModRate.form)>>1))>>15,l+=(t*a>>16)+o}for(let s=0;s<5;s++)if(0!==this.harmonicVolume[s]){const n=t+x.tmpDelays[s];n<e&&(x.buffer[n]+=this.generate2(h*x.tmpVolumes[s]>>15,x.tmpPhases[s],this.frequencyBase.form),x.tmpPhases[s]+=(i*x.tmpSemitones[s]>>16)+x.tmpStarts[s])}}if(this.release&&this.attack){this.release.reset(),this.attack.reset();let t=0,i=!0;for(let s=0;s<e;s++){const n=this.release.evaluate(e),r=this.attack.evaluate(e);let a;a=i?this.release.start+((this.release.end-this.release.start)*n>>8):this.release.start+((this.release.end-this.release.start)*r>>8),t+=256,t>=a&&(t=0,i=!i),i&&(x.buffer[s]=0)}}if(this.reverbDelay>0&&this.reverbVolume>0){const t=this.reverbDelay*i;for(let i=t;i<e;i++)x.buffer[i]+=x.buffer[i-t]*this.reverbVolume/100|0,x.buffer[i]|=0}for(let t=0;t<e;t++)x.buffer[t]<-32768&&(x.buffer[t]=-32768),x.buffer[t]>32767&&(x.buffer[t]=32767);return x.buffer};generate2=(e,t,i)=>1===i?(32767&t)<16384?e:-e:2===i?x.sin[32767&t]*e>>14:3===i?((32767&t)*e>>14)-e:4===i?x.noise[32767&(t/2607|0)]*e:0;read=e=>{this.frequencyBase=new _,this.frequencyBase.read(e),this.amplitudeBase=new _,this.amplitudeBase.read(e),0!==e.g1&&(e.pos--,this.frequencyModRate=new _,this.frequencyModRate.read(e),this.frequencyModRange=new _,this.frequencyModRange.read(e)),0!==e.g1&&(e.pos--,this.amplitudeModRate=new _,this.amplitudeModRate.read(e),this.amplitudeModRange=new _,this.amplitudeModRange.read(e)),0!==e.g1&&(e.pos--,this.release=new _,this.release.read(e),this.attack=new _,this.attack.read(e));for(let t=0;t<10;t++){const i=e.gsmarts;if(0===i)break;this.harmonicVolume[t]=i,this.harmonicSemitone[t]=e.gsmart,this.harmonicDelay[t]=e.gsmarts}this.reverbDelay=e.gsmarts,this.reverbVolume=e.gsmarts,this.length=e.g2,this.start=e.g2}}class S{static delays=new Int32Array(1e3);static waveBytes=null;static waveBuffer=null;static tracks=new m(1e3,null);tones=new m(10,null);loopBegin=0;loopEnd=0;static unpack=e=>{const t=new a(e.read("sounds.dat"));for(this.waveBytes=new Uint8Array(441e3),this.waveBuffer=new a(this.waveBytes),x.init();;){const e=t.g2;if(65535===e)break;const i=new S;i.read(t),this.tracks[e]=i,this.delays[e]=i.trim()}};static generate=(e,t)=>{if(!this.tracks[e])return null;const i=this.tracks[e];return i?.getWave(t)??null};read=e=>{for(let t=0;t<10;t++)0!==e.g1&&(e.pos--,this.tones[t]=new x,this.tones[t]?.read(e));this.loopBegin=e.g2,this.loopEnd=e.g2};trim=()=>{let e=9999999;for(let t=0;t<10;t++)this.tones[t]&&(this.tones[t].start/20|0)<e&&(e=this.tones[t].start/20|0);if(this.loopBegin<this.loopEnd&&(this.loopBegin/20|0)<e&&(e=this.loopBegin/20|0),9999999===e||0===e)return 0;for(let t=0;t<10;t++)this.tones[t]&&(this.tones[t].start-=20*e);return this.loopBegin<this.loopEnd&&(this.loopBegin-=20*e,this.loopEnd-=20*e),e};getWave=e=>{const t=this.generate(e);return S.waveBuffer.pos=0,S.waveBuffer?.p4(1380533830),S.waveBuffer?.ip4(t+36),S.waveBuffer?.p4(1463899717),S.waveBuffer?.p4(1718449184),S.waveBuffer?.ip4(16),S.waveBuffer?.ip2(1),S.waveBuffer?.ip2(1),S.waveBuffer?.ip4(22050),S.waveBuffer?.ip4(22050),S.waveBuffer?.ip2(1),S.waveBuffer?.ip2(8),S.waveBuffer?.p4(1684108385),S.waveBuffer?.ip4(t),S.waveBuffer.pos+=t,S.waveBuffer};generate=e=>{let t=0;for(let e=0;e<10;e++)this.tones[e]&&this.tones[e].length+this.tones[e].start>t&&(t=this.tones[e].length+this.tones[e].start);if(0===t)return 0;let i=22050*t/1e3|0,s=22050*this.loopBegin/1e3|0,n=22050*this.loopEnd/1e3|0;(s<0||n<0||n>i||s>=n)&&(e=0);let r=i+(n-s)*(e-1);for(let e=44;e<r+44;e++)S.waveBytes&&(S.waveBytes[e]=-128);for(let e=0;e<10;e++)if(this.tones[e]){const t=22050*this.tones[e].length/1e3|0,i=22050*this.tones[e].start/1e3|0,s=this.tones[e].generate(t,this.tones[e].length);for(let e=0;e<t;e++)S.waveBytes&&(S.waveBytes[e+i+44]+=s[e]>>8<<24>>24)}if(e>1){s+=44,n+=44,i+=44,r+=44;const t=r-i;for(let e=i-1;e>=n;e--)S.waveBytes&&(S.waveBytes[e+t]=S.waveBytes[e]);for(let t=1;t<e;t++){const e=(n-s)*t;for(let t=s;t<n;t++)S.waveBytes&&(S.waveBytes[t+e]=S.waveBytes[t])}r-=44}return r}}class T{db;constructor(e){e.onerror=this.onerror,e.onclose=this.onclose,this.db=e}static openDatabase=async()=>await new Promise(((e,t)=>{const i=indexedDB.open("lostcity",1);i.onsuccess=t=>{const i=t.target;console.log("database success!"),e(i.result)},i.onupgradeneeded=e=>{e.target.result.createObjectStore("cache")},i.onerror=e=>{const i=e.target;console.error("database error!: ",i.error),t(i.result)}}));cacheload=async e=>await new Promise((t=>{const i=this.db.transaction("cache","readonly").objectStore("cache").get(e);i.onsuccess=()=>{console.log("cacheload successful!"),t(i.result)},i.onerror=e=>{console.error("cacheload error!:",e),t(void 0)}}));cachesave=async(e,t)=>await new Promise(((i,s)=>{if(t.length>2e6)return void s();const n=this.db.transaction("cache","readwrite").objectStore("cache").put(t,e);n.onsuccess=()=>{console.log("cachesave successful!"),i()},n.onerror=e=>{console.error("cachesave error!:",e),s()}}));onclose=e=>{console.log("database close!")};onerror=e=>{console.log("database error!")};genHash=e=>{const t=e.trim();let i=0;for(let e=0;e<t.length&&e<12;e++){const s=t.charAt(e);i*=37,s>="A"&&s<="Z"?i+=s.charCodeAt(0)+1-65:s>="a"&&s<="z"?i+=s.charCodeAt(0)+1-97:s>="0"&&s<="9"&&(i+=s.charCodeAt(0)+27-48)}return i}}let M;async function A(e,t){!function(e){M||(M=window.audioContext.createGain(),M.connect(window.audioContext.destination)),M.gain.value=e/256}(t);try{const t=await window.audioContext.decodeAudioData(Uint8Array.from(e).buffer);let i=window.audioContext.createBufferSource();i.buffer=t,i.connect(M),i.start()}catch(e){console.log(e)}}var C;const E=(C="file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/tinymidipcm.mjs",function(e){var t,s,n=void 0!==(e=e||{})?e:{};n.ready=new Promise((function(e,i){t=e,s=i})),["_tsf_load_memory","_tsf_set_output","_tsf_channel_set_bank_preset","_tsf_set_max_voices","_tsf_channel_set_presetnumber","_tsf_reset","_tsf_close","_tml_load_memory","_midi_render","_malloc","_realloc","_free","_fflush","onRuntimeInitialized"].forEach((e=>{Object.getOwnPropertyDescriptor(n.ready,e)||Object.defineProperty(n.ready,e,{get:()=>V("You are getting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>V("You are setting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})}));var r=Object.assign({},n),a=[],o="object"==typeof window,l="function"==typeof importScripts,h="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,c=!o&&!h&&!l;if(n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var d,u,f,p="";if(h){if("undefined"==typeof process||!process.release||"node"!==process.release.name)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var m,w;p=l?require("path").dirname(p)+"/":__dirname+"/";var y=()=>{w||(m=require("fs"),w=require("path"))};d=(e,t)=>(y(),e=w.normalize(e),m.readFileSync(e,t?void 0:"utf8")),f=e=>{var t=d(e,!0);return t.buffer||(t=new Uint8Array(t)),F(t.buffer),t},u=(e,t,i)=>{y(),e=w.normalize(e),m.readFile(e,(function(e,s){e?i(e):t(s.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),a=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof se))throw e})),process.on("unhandledRejection",(function(e){throw e})),n.inspect=function(){return"[Emscripten Module object]"}}else if(c){if("object"==typeof process&&"function"==typeof require||"object"==typeof window||"function"==typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");"undefined"!=typeof read&&(d=function(e){return read(e)}),f=function(e){let t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(t=read(e,"binary"),F("object"==typeof t),t)},u=function(e,t,i){setTimeout((()=>t(f(e))),0)},"undefined"!=typeof scriptArgs?a=scriptArgs:void 0!==arguments&&(a=arguments),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)}else{if(!o&&!l)throw new Error("environment detection error");if(l?p=self.location.href:"undefined"!=typeof document&&document.currentScript&&(p=document.currentScript.src),C&&(p=C),p=0!==p.indexOf("blob:")?p.substr(0,p.replace(/[?#].*/,"").lastIndexOf("/")+1):"","object"!=typeof window&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");d=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},l&&(f=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),u=(e,t,i)=>{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=()=>{200==s.status||0==s.status&&s.response?t(s.response):i()},s.onerror=i,s.send(null)}}n.print||console.log.bind(console);var g,b,k,v=n.printErr||console.warn.bind(console);function _(e,t){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get:function(){V("Module."+e+" has been replaced with plain "+t+" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}})}function x(e){return"FS_createPath"===e||"FS_createDataFile"===e||"FS_createPreloadedFile"===e||"FS_unlink"===e||"addRunDependency"===e||"FS_createLazyFile"===e||"FS_createDevice"===e||"removeRunDependency"===e}Object.assign(n,r),r=null,g="fetchSettings",Object.getOwnPropertyDescriptor(n,g)&&V("`Module."+g+"` was supplied but `"+g+"` not included in INCOMING_MODULE_JS_API"),n.arguments&&(a=n.arguments),_("arguments","arguments_"),n.thisProgram&&n.thisProgram,_("thisProgram","thisProgram"),n.quit&&n.quit,_("quit","quit_"),F(void 0===n.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),F(void 0===n.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),F(void 0===n.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),F(void 0===n.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),F(void 0===n.read,"Module.read option was removed (modify read_ in JS)"),F(void 0===n.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),F(void 0===n.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),F(void 0===n.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),F(void 0===n.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),_("read","read_"),_("readAsync","readAsync"),_("readBinary","readBinary"),_("setWindowTitle","setWindowTitle"),F(!c,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable."),n.wasmBinary&&(b=n.wasmBinary),_("wasmBinary","wasmBinary"),n.noExitRuntime,_("noExitRuntime","noExitRuntime"),"object"!=typeof WebAssembly&&V("no native wasm support detected");var S,T,M,A,E,P,I,B,R=!1;function F(e,t){e||V("Assertion failed"+(t?": "+t:""))}function L(e){S=e,n.HEAP8=T=new Int8Array(e),n.HEAP16=A=new Int16Array(e),n.HEAP32=E=new Int32Array(e),n.HEAPU8=M=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=P=new Uint32Array(e),n.HEAPF32=I=new Float32Array(e),n.HEAPF64=B=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf8");var O=5242880;n.TOTAL_STACK&&F(O===n.TOTAL_STACK,"the stack size can no longer be determined at runtime");var U=n.INITIAL_MEMORY||16777216;function D(){if(!R){var e=ce(),t=P[e>>2],i=P[e+4>>2];34821223==t&&2310721022==i||V("Stack overflow! Stack cookie has been overwritten at 0x"+e.toString(16)+", expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+i.toString(16)+" 0x"+t.toString(16)),1668509029!==P[0]&&V("Runtime error: The application has corrupted its heap memory area (address zero)!")}}_("INITIAL_MEMORY","INITIAL_MEMORY"),F(U>=O,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+U+"! (TOTAL_STACK="+O+")"),F("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,"JS engine does not provide full typed array support"),F(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),F(16777216==U,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically"),function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"}();var G=[],z=[],W=[],N=!1;F(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),F(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),F(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),F(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var H=0,q=null,Y=null,j={};function V(e){n.onAbort&&n.onAbort(e),v(e="Aborted("+e+")"),R=!0;var t=new WebAssembly.RuntimeError(e);throw s(t),t}var X={error:function(){V("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init:function(){X.error()},createDataFile:function(){X.error()},createPreloadedFile:function(){X.error()},createLazyFile:function(){X.error()},open:function(){X.error()},mkdev:function(){X.error()},registerDevice:function(){X.error()},analyzePath:function(){X.error()},loadFilesFromDB:function(){X.error()},ErrnoError:function(){X.error()}};n.FS_createDataFile=X.createDataFile,n.FS_createPreloadedFile=X.createPreloadedFile;var J,Q,$,K;function Z(e){return e.startsWith("data:application/octet-stream;base64,")}function ee(e){return e.startsWith("file://")}function te(e,t){return function(){var i=e,s=t;return t||(s=n.asm),F(N,"native function `"+i+"` called before runtime initialization"),s[e]||F(s[e],"exported native function `"+i+"` not found"),s[e].apply(null,arguments)}}function ie(e){try{if(e==J&&b)return new Uint8Array(b);if(f)return f(e);throw"both async and sync fetching of the wasm failed"}catch(e){V(e)}}function se(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ne(e){for(;e.length>0;)e.shift()(n)}function re(e){re.shown||(re.shown={}),re.shown[e]||(re.shown[e]=1,h&&(e="warning: "+e),v(e))}function ae(e){try{return k.grow(e-S.byteLength+65535>>>16),L(k.buffer),1}catch(t){v("emscripten_realloc_buffer: Attempted to grow heap from "+S.byteLength+" bytes to "+e+" bytes, but got error: "+t)}}n.locateFile?Z(J="tinymidipcm.wasm")||(Q=J,J=n.locateFile?n.locateFile(Q,p):p+Q):J=new URL(i(5621),i.b).toString();var oe,le={emscripten_memcpy_big:function(e,t,i){M.copyWithin(e,t,t+i)},emscripten_resize_heap:function(e){var t=M.length;F((e>>>=0)>t);var i,s=2147483648;if(e>s)return v("Cannot enlarge memory, asked to go up to "+e+" bytes, but the limit is "+s+" bytes!"),!1;for(var n=1;n<=4;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var a=Math.min(s,(i=Math.max(e,r))+(65536-i%65536)%65536);if(ae(a))return!0}return v("Failed to grow the heap from "+t+" bytes to "+a+" bytes, not enough memory!"),!1}},he=(function(){var e,t={env:le,wasi_snapshot_preview1:le};function i(e,t){var i,s=e.exports;n.asm=s,F(k=n.asm.memory,"memory not found in wasm exports"),L(k.buffer),F(n.asm.__indirect_function_table,"table not found in wasm exports"),i=n.asm.__wasm_call_ctors,z.unshift(i),function(e){if(H--,n.monitorRunDependencies&&n.monitorRunDependencies(H),e?(F(j[e]),delete j[e]):v("warning: run dependency removed without ID"),0==H&&(null!==q&&(clearInterval(q),q=null),Y)){var t=Y;Y=null,t()}}("wasm-instantiate")}e="wasm-instantiate",H++,n.monitorRunDependencies&&n.monitorRunDependencies(H),e?(F(!j[e]),j[e]=1,null===q&&"undefined"!=typeof setInterval&&(q=setInterval((function(){if(R)return clearInterval(q),void(q=null);var e=!1;for(var t in j)e||(e=!0,v("still waiting on run dependencies:")),v("dependency: "+t);e&&v("(end of list)")}),1e4))):v("warning: run dependency added without ID");var r=n;function a(e){F(n===r,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),r=null,i(e.instance)}function c(e){return function(){if(!b&&(o||l)){if("function"==typeof fetch&&!ee(J))return fetch(J,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+J+"'";return e.arrayBuffer()})).catch((function(){return ie(J)}));if(u)return new Promise((function(e,t){u(J,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ie(J)}))}().then((function(e){return WebAssembly.instantiate(e,t)})).then((function(e){return e})).then(e,(function(e){v("failed to asynchronously prepare wasm: "+e),ee(J)&&v("warning: Loading from a file URI ("+J+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing"),V(e)}))}if(n.instantiateWasm)try{return n.instantiateWasm(t,i)}catch(e){v("Module.instantiateWasm callback failed with error: "+e),s(e)}(b||"function"!=typeof WebAssembly.instantiateStreaming||Z(J)||ee(J)||h||"function"!=typeof fetch?c(a):fetch(J,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(a,(function(e){return v("wasm streaming compile failed: "+e),v("falling back to ArrayBuffer instantiation"),c(a)}))}))).catch(s)}(),n.___wasm_call_ctors=te("__wasm_call_ctors"),n._malloc=te("malloc"),n._free=te("free"),n._tsf_load_memory=te("tsf_load_memory"),n._tsf_close=te("tsf_close"),n._tsf_reset=te("tsf_reset"),n._tsf_set_output=te("tsf_set_output"),n._tsf_set_max_voices=te("tsf_set_max_voices"),n._realloc=te("realloc"),n._tsf_channel_set_presetnumber=te("tsf_channel_set_presetnumber"),n._tsf_channel_set_bank_preset=te("tsf_channel_set_bank_preset"),n._tml_load_memory=te("tml_load_memory"),n._midi_render=te("midi_render"),n.___errno_location=te("__errno_location"),n._fflush=te("fflush"),n._emscripten_stack_init=function(){return(he=n._emscripten_stack_init=n.asm.emscripten_stack_init).apply(null,arguments)}),ce=(n._emscripten_stack_get_free=function(){return(n._emscripten_stack_get_free=n.asm.emscripten_stack_get_free).apply(null,arguments)},n._emscripten_stack_get_base=function(){return(n._emscripten_stack_get_base=n.asm.emscripten_stack_get_base).apply(null,arguments)},n._emscripten_stack_get_end=function(){return(ce=n._emscripten_stack_get_end=n.asm.emscripten_stack_get_end).apply(null,arguments)});function de(e){function i(){oe||(oe=!0,n.calledRun=!0,R||(F(!N),N=!0,D(),ne(z),t(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),F(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(D(),n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),W.unshift(e);var e;ne(W)}()))}var s;e=e||a,H>0||(he(),F(0==(3&(s=ce()))),P[s>>2]=34821223,P[s+4>>2]=2310721022,P[0]=1668509029,function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),G.unshift(e);var e;ne(G)}(),H>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),i()}),1)):i(),D()))}if(n.stackSave=te("stackSave"),n.stackRestore=te("stackRestore"),n.stackAlloc=te("stackAlloc"),n.setValue=function(e,t,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":case"i8":T[e>>0]=t;break;case"i16":A[e>>1]=t;break;case"i32":E[e>>2]=t;break;case"i64":K=[t>>>0,($=t,+Math.abs($)>=1?$>0?(0|Math.min(+Math.floor($/4294967296),4294967295))>>>0:~~+Math.ceil(($-+(~~$>>>0))/4294967296)>>>0:0)],E[e>>2]=K[0],E[e+4>>2]=K[1];break;case"float":I[e>>2]=t;break;case"double":B[e>>3]=t;break;case"*":P[e>>2]=t;break;default:V("invalid type for setValue: "+i)}},n.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return T[e>>0];case"i16":return A[e>>1];case"i32":case"i64":return E[e>>2];case"float":return I[e>>2];case"double":return B[e>>3];case"*":return P[e>>2];default:V("invalid type for getValue: "+t)}return null},["run","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","FS_createFolder","FS_createPath","FS_createDataFile","FS_createPreloadedFile","FS_createLazyFile","FS_createLink","FS_createDevice","FS_unlink","getLEB","getFunctionTables","alignFunctionTables","registerFunctions","prettyPrint","getCompilerSetting","print","printErr","callMain","abort","keepRuntimeAlive","wasmMemory","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","ptrToString","zeroMemory","stringToNewUTF8","exitJS","getHeapMax","emscripten_realloc_buffer","ENV","ERRNO_CODES","ERRNO_MESSAGES","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","getHostByName","Protocols","Sockets","getRandomDevice","warnOnce","traverseStack","UNWIND_CACHE","convertPCtoSourceLocation","readAsmConstArgsArray","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","freeTableIndexes","functionsInTableMap","getEmptyTableSlot","updateTableMap","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","PATH","PATH_FS","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16Decoder","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","allocateUTF8","allocateUTF8OnStack","writeStringToMemory","writeArrayToMemory","writeAsciiToMemory","SYSCALLS","getSocketFromFD","getSocketAddress","JSEvents","registerKeyEventCallback","specialHTMLTargets","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","currentFullscreenStrategy","restoreOldWindowedStyle","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","demangle","demangleAll","jsStackTrace","stackTrace","ExitStatus","getEnvStrings","checkWasiClock","flush_NO_FILESYSTEM","dlopenMissingError","createDyncallWrapper","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","exception_addRef","exception_decRef","Browser","setMainLoop","wget","FS","MEMFS","TTY","PIPEFS","SOCKFS","_setNetworkCallback","tempFixedLengthArray","miniTempWebGLFloatBuffers","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","GL","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","AL","SDL_unicode","SDL_ttfContext","SDL_audio","SDL","SDL_gfx","GLUT","EGL","GLFW_Window","GLFW","GLEW","IDBStore","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate"].forEach((function(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get:function(){var t="'"+e+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";x(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),V(t)}})})),["ptrToString","zeroMemory","stringToNewUTF8","exitJS","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","getHostByName","getRandomDevice","traverseStack","convertPCtoSourceLocation","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","allocateUTF8","allocateUTF8OnStack","writeStringToMemory","writeAsciiToMemory","getSocketFromFD","getSocketAddress","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","getEnvStrings","checkWasiClock","flush_NO_FILESYSTEM","createDyncallWrapper","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","ExceptionInfo","exception_addRef","exception_decRef","setMainLoop","_setNetworkCallback","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","SDL_unicode","SDL_ttfContext","SDL_audio","GLFW_Window","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate"].forEach((function(e){"undefined"==typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,e)||Object.defineProperty(globalThis,e,{configurable:!0,get:function(){var t="`"+e+"` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line";x(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),re(t)}})})),Y=function e(){oe||de(),oe||(Y=e)},n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return de(),e.ready}),P=class{constructor(e={}){this.wasmModule=void 0,this.soundfontBufferPtr=0,this.soundfontPtr=0,this.midiBufferPtr=0,this.renderInterval=e.renderInterval||100,this.sampleRate=e.sampleRate||44100,this.channels=e.channels||2,this.gain=e.gain||0,e.bufferSize?this.bufferSize=e.bufferSize:this.setBufferDuration(1),this.onPCMData=e.onPCMData||(()=>{}),this.onRenderEnd=e.onRenderEnd||(()=>{}),this.renderTimer=void 0,this.test=0}async init(){if(!this.wasmModule){if("undefined"!=typeof process){const{dirname:e}=await import("path"),{createRequire:t}=await import("module");globalThis.__dirname=e("file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/index.js"),globalThis.require=t("file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/index.js")}this.wasmModule=await E(),this.pcmBufferPtr=this.wasmModule._malloc(this.bufferSize),this.msecsPtr=this.wasmModule._malloc(8)}}setBufferDuration(e){this.bufferSize=4*this.sampleRate*this.channels*e}ensureInitialized(){if(!this.wasmModule)throw new Error(`${this.constructor.name} not initalized. call .init()`)}setSoundfont(e){this.ensureInitialized();const{_malloc:t,_free:i,_tsf_load_memory:s,_tsf_set_output:n,_tsf_channel_set_bank_preset:r,_tsf_set_max_voices:a,_tsf_channel_set_presetnumber:o}=this.wasmModule;i(this.soundfontBufferPtr),this.soundfontBufferPtr=t(e.length),this.wasmModule.HEAPU8.set(e,this.soundfontBufferPtr),this.soundfontPtr=s(this.soundfontBufferPtr,e.length),n(this.soundfontPtr,2===this.channels?0:2,this.sampleRate,this.gain)}getPCMBuffer(){this.ensureInitialized();const e=new Uint8Array(this.bufferSize);return e.set(this.wasmModule.HEAPU8.subarray(this.pcmBufferPtr,this.pcmBufferPtr+this.bufferSize)),e}getMIDIMessagePtr(e){const{_malloc:t,_free:i,_tml_load_memory:s}=this.wasmModule;return i(this.midiBufferPtr),this.midiBufferPtr=t(e.length),this.wasmModule.HEAPU8.set(e,this.midiBufferPtr),s(this.midiBufferPtr,e.length)}renderMIDIMessage(e){const{_midi_render:t}=this.wasmModule;return t(this.soundfontPtr,e,this.channels,this.sampleRate,this.pcmBufferPtr,this.bufferSize,this.msecsPtr)}render(e){if(this.ensureInitialized(),!this.soundfontPtr)throw new Error("no soundfont buffer set. call .setSoundfont");window.clearTimeout(this.renderTimer);const{setValue:t,getValue:i}=this.wasmModule;t(this.msecsPtr,0,"double"),this.wasmModule._tsf_reset(this.soundfontPtr),this.wasmModule._tsf_channel_set_bank_preset(this.soundfontPtr,9,128,0),e[0]==="R".charCodeAt(0)&&(e=e.slice(20));let s=this.getMIDIMessagePtr(e);const n=()=>{s=this.renderMIDIMessage(s);const e=this.getPCMBuffer();this.onPCMData(e),s?this.renderTimer=setTimeout(n,this.renderInterval):this.onRenderEnd(i(this.msecsPtr,"double"))};this.renderTimer=setTimeout(n,16)}};!function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.audioContext=new window.AudioContext);var e=function(t){if(window.audioContext){var i=window.audioContext.createBuffer(1,1,22050),s=window.audioContext.createBufferSource();s.buffer=i,s.connect(window.audioContext.destination),s.start?s.start(0):s.play?s.play(0):s.noteOn&&s.noteOn(0)}document.removeEventListener("touchstart",e),document.removeEventListener("touchend",e),document.removeEventListener("click",e)};document.addEventListener("touchstart",e),document.addEventListener("touchend",e),document.addEventListener("click",e)}(),(async()=>{let e=new Float32Array,t=window.audioContext.createGain();t.gain.value=.1,t.connect(window.audioContext.destination);let i=window.audioContext.currentTime,s=[];const n=new P({renderInterval:30,onPCMData:t=>{let i=new Float32Array(t.buffer),s=new Float32Array(e.length+i.length);s.set(e,0),s.set(i,e.length),e=s},onRenderEnd:e=>{},bufferSize:102400});await n.init();const r=await fetch("./SCC1_Florestan.sf2"),a=new Uint8Array(await r.arrayBuffer());function o(){if(!window.audioContext||!e.length)return;let n=window.audioContext.createBufferSource();const r=e.length/2,a=window.audioContext.createBuffer(2,r,44100);for(let t=0;t<2;t++){const i=a.getChannelData(t);let s=t;for(let t=0;t<r;t++)i[t]=e[s],s+=2}i<window.audioContext.currentTime&&(i=window.audioContext.currentTime),n.buffer=a,n.connect(t),n.start(i),s.push(n),i+=a.duration,e=new Float32Array}let l;n.setSoundfont(a),window._tinyMidiStop=async()=>{if(l&&clearInterval(l),e=new Float32Array,s.length){let e=t.gain.value;t.gain.value=0,s.forEach((e=>{e.stop(window.audioContext.currentTime)})),s=[],t.gain.value=e}},window._tinyMidiVolume=(e=1)=>{t.gain.value=e},window._tinyMidiPlay=async(e,t=1)=>{e&&(await window._tinyMidiStop(),-1!=t&&window._tinyMidiVolume(t),i=window.audioContext.currentTime,l=setInterval(o,250),n.render(e))}})();class I extends v{static HOST="https://w2.225.2004scape.org";static REPO="https://raw.githubusercontent.com/2004scape/Server/main";static CHARSET="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"£$%^&*()-_=+[{]};:'@#~,<.>/?\\| ";db=null;alreadyStarted=!1;errorStarted=!1;errorLoading=!1;errorHost=!1;ingame=!1;archiveChecksums=[];fontPlain11=null;fontPlain12=null;fontBold12=null;fontQuill8=null;packfiles=[];async loadPack(e){const t=new Map,i=await(async e=>(await fetch(e)).text())(e),s=i.split("\n");for(let e=0;e<s.length;e++){const i=s[e],n=i.indexOf("=");if(-1===n)continue;const r=parseInt(i.substring(0,n)),a=i.substring(n+1);t.set(r,a)}return t}load=async()=>{if(this.alreadyStarted)this.errorStarted=!0;else{this.alreadyStarted=!0;try{await this.showProgress(10,"Connecting to fileserver"),await o.load(await(await fetch("bz2.wasm")).arrayBuffer()),this.db=new T(await T.openDatabase());const e=new a(new Uint8Array(await t(`${I.HOST}/crc`)));for(let t=0;t<9;t++)this.archiveChecksums[t]=e.g4;const i=await this.loadArchive("sounds","sound effects",this.archiveChecksums[8],70);await this.showProgress(50,"Unpacking sounds"),S.unpack(i),await this.showProgress(100,"Getting ready to start..."),await this.populateSounds()}catch(e){this.errorLoading=!0,console.error(e)}}};update=async()=>{};draw=async()=>{};showProgress=async(e,t)=>{console.log(`${e}%: ${t}`),await super.showProgress(e,t)};async loadArchive(i,s,n,r){let o=5,h=await(this.db?.cacheload(i));if(h&&a.crc32(h)!==n&&(h=void 0),h)return new l(h);for(;!h;){await this.showProgress(r,`Requesting ${s}`);try{h=await t(`${I.HOST}/${i}${n}`)}catch(t){h=void 0;for(let t=o;t>0;t--)await this.showProgress(r,`Error loading - Will retry in ${t} secs.`),await e(1e3);o*=2,o>60&&(o=60)}}return await(this.db?.cachesave(i,h)),new l(h)}async populateSounds(){const e=document.getElementById("sounds");if(!e)return;e.innerHTML="",this.packfiles[1]=await this.loadPack(`${I.REPO}/data/pack/sound.pack`);const t=document.createElement("input");t.type="search",t.placeholder="Search",t.tabIndex=1,t.oninput=()=>{const e=document.querySelector("#soundList");if(!e)return;const i=t.value.toLowerCase().replaceAll(" ","_");for(let t=0;t<e.children.length;t++){const s=e.children[t],n=s.getAttribute("rs-id")??s.id,r=s.getAttribute("rs-debugname")??s.id;s.id.indexOf(i)>-1||n.indexOf(i)>-1||r.indexOf(i)>-1?s.style.display="":s.style.display="none"}},e.appendChild(t);const i=document.createElement("ul");i.id="soundList",i.className="list-group",e.appendChild(i);for(const[e,t]of this.packfiles[1]){const s=document.createElement("li");s.id=t,s.setAttribute("rs-id",e.toString()),s.setAttribute("rs-debugname",t),s.className="list-group-item list-group-item-center",s.innerText=t+" - "+e,0===e&&(s.className+=" active"),s.onclick=async()=>{const t=i.querySelector(".active");t&&(t.className="list-group-item list-group-item-center"),s.className="list-group-item list-group-item-center active";const n=S.generate(e,0);n&&await A(n.data.slice(0,n.pos),128)},i.appendChild(s)}}}(new I).run().then((()=>{})),window.onkeydown=function(e){return!(" "===e.key&&e.target===document.body)}})()})();