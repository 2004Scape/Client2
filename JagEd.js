(()=>{"use strict";var t={3927:(t,e,i)=>{t.exports=i.t+"0c791968973e1f25c170.wasm"},5621:(t,e,i)=>{t.exports=i.t+"9f86b5397894e28b5ae2.wasm"}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}i.i=t,i.h=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.t="/Client2/",i.b=document.baseURI||self.location.href,(()=>{async function t(t,e={}){const i={l:Object.assign(Object.create(globalThis),e.l||{},{abort(t,e,i,s){t=h(t>>>0),e=h(e>>>0),i>>>=0,s>>>=0,(()=>{throw Error(`${t} in ${e}:${i}:${s}`)})()}})},{exports:s}=await WebAssembly.instantiate(t,i),n=s.memory||e.l.memory,r=Object.setPrototypeOf({o(){return(t=s.o()>>>0)?{stream:a(Int8Array,g(t+0)),u:a(Int8Array,g(t+4)),m:I(t+8),p:I(t+12),A:I(t+16),I:I(t+20),_:I(t+24),C:I(t+28),T:I(t+32),v:I(t+36),L:A(t+40),S:I(t+44),O:0!=A(t+48),k:I(t+52),R:I(t+56),M:I(t+60),F:I(t+64),D:I(t+68),N:I(t+72),U:I(t+76),P:I(t+80),B:I(t+84),W:f(I,2,g(t+88)),G:f(I,2,g(t+92)),H:f(I,2,g(t+96)),Y:f((t=>0!=A(t)),0,g(t+100)),V:f((t=>0!=A(t)),0,g(t+104)),X:f(A,0,g(t+108)),j:f(A,0,g(t+112)),Z:f(I,2,g(t+116)),selector:f(A,0,g(t+120)),q:f(A,0,g(t+124)),K:l((t=>f(A,0,g(t))),2,g(t+128)),J:l((t=>f(I,2,g(t))),2,g(t+132)),$:l((t=>f(I,2,g(t))),2,g(t+136)),tt:l((t=>f(I,2,g(t))),2,g(t+140)),et:f(I,2,g(t+144))}:null;var t},read(t,e,i,n,r){e=function(t){if(t){const e=d.get(t);e?d.set(t,e+1):d.set(s.it(t),1)}return t}(c(Int8Array,6,0,e)||w()),r=function(t){if(null==t)return 0;const e=s.it(s.st(148,5));return p(e+0,c(Int8Array,6,0,t.stream)||w()),p(e+4,c(Int8Array,6,0,t.u)||w()),p(e+8,t.m),p(e+12,t.p),p(e+16,t.A),p(e+20,t.I),p(e+24,t._),p(e+28,t.C),p(e+32,t.T),p(e+36,t.v),m(e+40,t.L),p(e+44,t.S),m(e+48,t.O?1:0),p(e+52,t.k),p(e+56,t.R),p(e+60,t.M),p(e+64,t.F),p(e+68,t.D),p(e+72,t.N),p(e+76,t.U),p(e+80,t.P),p(e+84,t.B),p(e+88,u(p,4,2,t.W,Int32Array)||w()),p(e+92,u(p,4,2,t.G,Int32Array)||w()),p(e+96,u(p,4,2,t.H,Int32Array)||w()),p(e+100,u(m,7,0,t.Y,Uint8Array)||w()),p(e+104,u(m,7,0,t.V,Uint8Array)||w()),p(e+108,u(m,8,0,t.X,Uint8Array)||w()),p(e+112,u(m,8,0,t.j,Uint8Array)||w()),p(e+116,u(p,4,2,t.Z,Int32Array)||w()),p(e+120,u(m,8,0,t.selector,Uint8Array)||w()),p(e+124,u(m,8,0,t.q,Uint8Array)||w()),p(e+128,o(((t,e)=>{p(t,u(m,8,0,e,Uint8Array)||w())}),9,2,t.K)||w()),p(e+132,o(((t,e)=>{p(t,u(p,4,2,e,Int32Array)||w())}),10,2,t.J)||w()),p(e+136,o(((t,e)=>{p(t,u(p,4,2,e,Int32Array)||w())}),10,2,t.$)||w()),p(e+140,o(((t,e)=>{p(t,u(p,4,2,e,Int32Array)||w())}),10,2,t.tt)||w()),p(e+144,u(p,4,2,t.et,Int32Array)||w()),s.nt(e),e}(r)||w();try{return a(Int8Array,s.read(t,e,i,n,r)>>>0)}finally{!function(t){if(t){const e=d.get(t);if(1===e)s.nt(t),d.delete(t);else{if(!e)throw Error(`invalid refcount '${e}' for reference '${t}'`);d.set(t,e-1)}}}(e)}}},s);function h(t){if(!t)return null;const e=t+new Uint32Array(n.buffer)[t-4>>>2]>>>1,i=new Uint16Array(n.buffer);let s=t>>>1,r="";for(;e-s>1024;)r+=String.fromCharCode(...i.subarray(s,s+=1024));return r+String.fromCharCode(...i.subarray(s,e))}function l(t,e,i){if(!i)return null;const s=g(i+4),n=y.getUint32(i+12,!0),r=new Array(n);for(let i=0;i<n;++i)r[i]=t(s+(i<<e>>>0));return r}function o(t,e,i,n){if(null==n)return 0;const r=n.length,h=s.it(s.st(r<<i,1))>>>0,l=s.it(s.st(16,e))>>>0;p(l+0,h),y.setUint32(l+4,h,!0),y.setUint32(l+8,r<<i,!0),y.setUint32(l+12,r,!0);for(let e=0;e<r;++e)t(h+(e<<i>>>0),n[e]);return s.nt(h),s.nt(l),l}function a(t,e){return e?new t(n.buffer,g(e+4),y.getUint32(e+8,!0)/t.BYTES_PER_ELEMENT).slice():null}function c(t,e,i,r){if(null==r)return 0;const h=r.length,l=s.it(s.st(h<<i,1))>>>0,o=s.st(12,e)>>>0;return p(o+0,l),y.setUint32(o+4,l,!0),y.setUint32(o+8,h<<i,!0),new t(n.buffer,l,h).set(r),s.nt(l),o}function f(t,e,i){if(!i)return null;const s=g(i-4)>>>e,n=new Array(s);for(let r=0;r<s;++r)n[r]=t(i+(r<<e>>>0));return n}function u(t,e,i,r,h){if(null==r)return 0;const l=r.length,o=s.it(s.st(l<<i,e))>>>0;if(h)new h(n.buffer,o,l).set(r);else for(let e=0;e<l;e++)t(o+(e<<i>>>0),r[e]);return s.nt(o),o}const d=new Map;function w(){throw TypeError("value must not be null")}let y=new DataView(n.buffer);function m(t,e){try{y.setUint8(t,e,!0)}catch{y=new DataView(n.buffer),y.setUint8(t,e,!0)}}function p(t,e){try{y.setUint32(t,e,!0)}catch{y=new DataView(n.buffer),y.setUint32(t,e,!0)}}function A(t){try{return y.getUint8(t,!0)}catch{return y=new DataView(n.buffer),y.getUint8(t,!0)}}function I(t){try{return y.getInt32(t,!0)}catch{return y=new DataView(n.buffer),y.getInt32(t,!0)}}function g(t){try{return y.getUint32(t,!0)}catch{return y=new DataView(n.buffer),y.getUint32(t,!0)}}return r}class e{static rt=null;static state=null;static load=async e=>{const i=new WebAssembly.Module(e),s=await t(i,{l:void 0});this.rt=s,this.state=s.o()};static read=(t,e,i,s)=>{if(!this.rt||!this.state)throw new Error('bz2 not found!!');return this.rt.read(t,e,i,s,this.state)}}let s;function n(t,e){return s=t.exports,r.ht=e,s}async function r(t){void 0===t&&(t=new URL(i(3927),i.b));const e={lt:{}};('string'==typeof t||'function'==typeof Request&&t instanceof Request||'function'==typeof URL&&t instanceof URL)&&(t=fetch(t));const{ot:s,module:r}=await async function(t,e){if('function'==typeof Response&&t instanceof Response){if('function'==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if('application/wasm'==t.headers.get('Content-Type'))throw e;console.warn('`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n',e)}const i=await t.arrayBuffer();return await WebAssembly.instantiate(i,e)}{const i=await WebAssembly.instantiate(t,e);return i instanceof WebAssembly.Instance?{ot:i,module:t}:i}}(await t,e);return n(s,r)}let h=null,l=!1;class o extends Error{constructor(t){super(t),this.name='DecompressionError'}}let a=0,c=null,f=null;function u(t,e,i){let s;if(i){const n=e;s=t.ct(n);const r=new Uint8Array(t.memory.buffer,s,n);try{i(r)}catch(e){throw t.ft(s,n),e}return a=n,s}if('string'==typeof e){const i=a=function(t){let e=0,i=0,s=0;const n=t.length;for(;e<n;)i=t.codePointAt(e),i<=127?(s+=1,e++):i<=2047?(s+=2,e++):i<=65535?(s+=3,e++):(s+=4,e+=2);return s}(e);s=t.ct(i);const n=new Uint8Array(t.memory.buffer,s,i);return c||(c=new TextEncoder),c.encodeInto(e,n),s}const n=e;return s=t.ct(a=n.length),f&&f.length||(f=new Uint8Array(t.memory.buffer)),f.set(n,s),s}function d(t){if(!t)throw new Error('WASM not initialized')}class w{id;ut;next;constructor(){this.id=0n,this.ut=this,this.next=this}dt=()=>{this.next&&this.ut&&(this.next.ut=this.ut,this.ut.next=this.next,this.ut=null,this.next=null)}}class y extends w{wt;yt;constructor(){super(),this.wt=this,this.yt=this}At=()=>{this.yt&&this.wt&&(this.yt.wt=this.wt,this.wt.yt=this.yt,this.wt=null,this.yt=null)}}class m extends y{static It=new Int32Array;static gt=0;static _t=0;static top=0;static bottom=0;static left=0;static right=0;static Ct=0;static bt=0;static Tt=0;static bind=(t,e,i)=>{this.It=t,this.gt=e,this._t=i,this.Et(0,0,e,i)};static vt=()=>{this.left=0,this.top=0,this.right=this.gt,this.bottom=this._t,this.Ct=this.right-1,this.bt=this.right/2|0};static Et=(t,e,i,s)=>{t<0&&(t=0),e<0&&(e=0),i>this.gt&&(i=this.gt),s>this._t&&(s=this._t),this.top=e,this.bottom=s,this.left=t,this.right=i,this.Ct=this.right-1,this.bt=this.right/2|0,this.Tt=this.bottom/2|0};static clear=()=>{const t=this.gt*this._t;for(let e=0;e<t;e++)this.It[e]=0};static Lt=(t,e,i,s,n)=>{this.St(t,e,n,i),this.St(t,e+s-1,n,i),this.Ot(t,e,n,s),this.Ot(t+i-1,e,n,s)};static St=(t,e,i,s)=>{if(e<this.top||e>=this.bottom)return;t<this.left&&(s-=this.left-t,t=this.left),t+s>this.right&&(s=this.right-t);const n=t+e*this.gt;for(let t=0;t<s;t++)this.It[n+t]=i};static Ot=(t,e,i,s)=>{if(t<this.left||t>=this.right)return;e<this.top&&(s-=this.top-e,e=this.top),e+s>this.bottom&&(s=this.bottom-e);const n=t+e*this.gt;for(let t=0;t<s;t++)this.It[n+t*this.gt]=i};static kt=(t,e,i,s,n)=>{const r=Math.abs(i-t),h=Math.abs(s-e),l=t<i?1:-1,o=e<s?1:-1;let a=r-h;for(;t>=this.left&&t<this.right&&e>=this.top&&e<this.bottom&&(this.It[t+e*this.gt]=n),t!==i||e!==s;){const i=2*a;i>-h&&(a-=h,t+=l),i<r&&(a+=r,e+=o)}};static fillRect=(t,e,i,s,n)=>{t<this.left&&(i-=this.left-t,t=this.left),e<this.top&&(s-=this.top-e,e=this.top),t+i>this.right&&(i=this.right-t),e+s>this.bottom&&(s=this.bottom-e);const r=this.gt-i;let h=t+e*this.gt;for(let t=-s;t<0;t++){for(let t=-i;t<0;t++)this.It[h++]=n;h+=r}};static Rt=(t,e,i)=>{t<this.left||t>=this.right||e<this.top||e>=this.bottom||(this.It[t+e*this.gt]=i)}}const p=document.getElementById('canvas'),A=p.getContext('2d',{xt:!0}),I=document.createElement('canvas'),g=document.createElement('img'),_=I.getContext('2d',{xt:!0});class C{Mt;width;height;Ft;It;constructor(t,e,i=A){this.Ft=i,this.Mt=this.Ft.getImageData(0,0,t,e),this.It=new Int32Array(t*e),this.width=t,this.height=e,this.bind()}clear=()=>{this.It.fill(0)};bind=()=>{m.bind(this.It,this.width,this.height)};draw=(t,e)=>{this.#t(),this.Ft.putImageData(this.Mt,t,e)};#t=()=>{const t=this.Mt.data;for(let e=0;e<this.It.length;e++){const i=this.It[e],s=4*e;t[s]=i>>16&255,t[s+1]=i>>8&255,t[s+2]=i>>0&255,t[s+3]=255}}}const b=async t=>new Promise((e=>setTimeout(e,t))),T=async t=>new Int8Array(await(await fetch(t)).arrayBuffer());class E{head;Dt=null;constructor(){const t=new w;t.ut=t,t.next=t,this.head=t}Nt=t=>{t.next&&t.dt(),t.next=this.head.next,t.ut=this.head,t.next&&(t.next.ut=t),t.ut.next=t};Ut=t=>{t.next&&t.dt(),t.next=this.head,t.ut=this.head.ut,t.next.ut=t,t.ut&&(t.ut.next=t)};Pt=()=>{const t=this.head.ut;return t===this.head?null:(t?.dt(),t)};Bt=()=>{const t=this.head.ut;return t===this.head?(this.Dt=null,null):(this.Dt=t?.ut||null,t)};Wt=()=>{const t=this.head.next;return t===this.head?(this.Dt=null,null):(this.Dt=t?.next||null,t)};ut=()=>{const t=this.Dt;return t===this.head?(this.Dt=null,null):(this.Dt=t?.ut||null,t)};next=()=>{const t=this.Dt;return t===this.head?(this.Dt=null,null):(this.Dt=t?.next||null,t)};clear=()=>{for(;;){const t=this.head.ut;if(t===this.head)return;t?.dt()}}}class v extends y{static Gt=3988292384;static Ht=new Int32Array(256);static Yt=new Uint32Array(33);static Vt=new E;static Xt=new E;static jt=new E;static zt=0;static Zt=0;static qt=0;static{for(let t=0;t<32;t++)v.Yt[t]=(1<<t)-1;v.Yt[32]=4294967295;for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1==(1&e)?e=e>>>1^v.Gt:e>>>=1;v.Ht[t]=e}}static Kt=t=>{let e=4294967295;for(let i=0;i<t.length;i++)e=e>>>8^v.Ht[255&(e^t[i])];return~e};data;Jt;$t=0;random=null;constructor(t){if(!t)throw new Error('Input src packet array was null!');super(),t instanceof Int8Array?this.data=new Uint8Array(t):this.data=t,this.Jt=0}get length(){return this.data.length}get available(){return this.data.length-this.Jt}static Qt=t=>{let e=null;return 0===t&&v.zt>0?(v.zt--,e=v.Vt.Pt()):1===t&&v.Zt>0?(v.Zt--,e=v.Xt.Pt()):2===t&&v.qt>0&&(v.qt--,e=v.jt.Pt()),e?(e.Jt=0,e):new v(0===t?new Uint8Array(100):1===t?new Uint8Array(5e3):new Uint8Array(3e4))};release=()=>{this.Jt=0,100===this.data.length&&v.zt<1e3?(v.Vt.Nt(this),v.zt++):5e3===this.data.length&&v.Zt<250?(v.Xt.Nt(this),v.Zt++):3e4===this.data.length&&v.qt<50&&(v.jt.Nt(this),v.qt++)};get te(){return this.data[this.Jt++]}get ee(){return this.data[this.Jt++]<<24>>24}get ie(){return this.data[this.Jt++]<<8|this.data[this.Jt++]}get se(){let t=this.data[this.Jt++]<<8|this.data[this.Jt++];return t>32767&&(t-=65536),t}get ne(){return this.data[this.Jt++]<<16|this.data[this.Jt++]<<8|this.data[this.Jt++]}get re(){return this.data[this.Jt++]<<24|this.data[this.Jt++]<<16|this.data[this.Jt++]<<8|this.data[this.Jt++]}get he(){return(0xffffffffn&BigInt(this.re))<<32n|0xffffffffn&BigInt(this.re)}get le(){return this.data[this.Jt]<128?this.te-64:this.ie-49152}get oe(){return this.data[this.Jt]<128?this.te:this.ie-32768}get ae(){let t='';for(;10!==this.data[this.Jt]&&this.Jt<this.data.length;)t+=String.fromCharCode(this.data[this.Jt++]);return this.Jt++,t}ce=(t,e,i)=>{for(let s=e;s<e+t;s++)i[s]=this.data[this.Jt++]};fe=t=>{this.data[this.Jt++]=t+(this.random?.ue??0)&255};p1=t=>{this.data[this.Jt++]=t};p2=t=>{this.data[this.Jt++]=t>>>8,this.data[this.Jt++]=t};de=t=>{this.data[this.Jt++]=t,this.data[this.Jt++]=t>>>8};p3=t=>{this.data[this.Jt++]=t>>>16,this.data[this.Jt++]=t>>>8,this.data[this.Jt++]=t};p4=t=>{this.data[this.Jt++]=t>>>24,this.data[this.Jt++]=t>>>16,this.data[this.Jt++]=t>>>8,this.data[this.Jt++]=t};we=t=>{this.data[this.Jt++]=t,this.data[this.Jt++]=t>>>8,this.data[this.Jt++]=t>>>16,this.data[this.Jt++]=t>>>24};ye=t=>{this.p4(Number(t>>32n)),this.p4(Number(0xffffffffn&t))};me=t=>{for(let e=0;e<t.length;e++)this.data[this.Jt++]=t.charCodeAt(e);this.data[this.Jt++]=10};pe=(t,e,i)=>{for(let s=i;s<i+e;s++)this.data[this.Jt++]=t[s]};Ae=t=>{this.data[this.Jt-t-1]=t};Ie=()=>{this.$t=8*this.Jt};ge=()=>{this.Jt=(this.$t+7)/8|0};_e=t=>{let e=this.$t>>>3,i=8-(7&this.$t),s=0;for(this.$t+=t;t>i;i=8)s+=(this.data[e++]&v.Yt[i])<<t-i,t-=i;return s+=t===i?this.data[e]&v.Yt[i]:this.data[e]>>>i-t&v.Yt[t],s};Ce=(t,e)=>{const i=new Uint8Array(this.Jt);((t,e,i,s,n)=>{for(;n--;)i[s++]=t[e++]})(this.data,0,i,0,this.Jt);const s=(t=>{const e=[];for(;t>0n;)e.unshift(Number(255n&t)),t>>=8n;return new Uint8Array(e)})(((t,e,i)=>{let s=1n;for(;e>0n;)e%2n===1n&&(s=s*t%i),t=t*t%i,e>>=1n;return s})((t=>{let e=0n;for(let i=0;i<t.length;i++)e=(e<<8n)+BigInt(t[i]);return e})(i),e,t));this.Jt=0,this.p1(s.length),this.pe(s,s.length,0)}}class L extends y{It;width;height;be;Te;Ee;ve;palette;constructor(t,e,i){super(),this.It=new Int8Array(t*e),this.width=this.Ee=t,this.height=this.ve=e,this.be=this.Te=0,this.palette=i}static Le=(t,e,i=0)=>{const s=new v(t.read(e+'.dat')),n=new v(t.read('index.dat'));n.Jt=s.ie;const r=n.ie,h=n.ie,l=n.te,o=new Int32Array(l);for(let t=1;t<l;t++)o[t]=n.ne,0===o[t]&&(o[t]=1);for(let t=0;t<i;t++)n.Jt+=2,s.Jt+=n.ie*n.ie,n.Jt+=1;if(s.Jt>s.data.length||n.Jt>n.data.length)throw new Error;const a=n.te,c=n.te,f=n.ie,u=n.ie,d=new L(f,u,o);d.be=a,d.Te=c,d.Ee=r,d.ve=h;const w=d.It,y=n.te;if(0===y){const t=d.width*d.height;for(let e=0;e<t;e++)w[e]=s.ee}else if(1===y){const t=d.width,e=d.height;for(let i=0;i<t;i++)for(let n=0;n<e;n++)w[i+n*t]=s.ee}return d};draw=(t,e)=>{t|=0,e|=0;let i=(t+=this.be)+(e+=this.Te)*m.gt,s=0,n=this.height,r=this.width,h=m.gt-r,l=0;if(e<m.top){const t=m.top-e;n-=t,e=m.top,s+=t*r,i+=t*m.gt}if(e+n>m.bottom&&(n-=e+n-m.bottom),t<m.left){const e=m.left-t;r-=e,t=m.left,s+=e,i+=e,l+=e,h+=e}if(t+r>m.right){const e=t+r-m.right;r-=e,l+=e,h+=e}r>0&&n>0&&this.Se(r,n,this.It,s,l,m.It,i,h)};Oe=()=>{const t=this.It,e=this.width,i=this.height;for(let s=0;s<i;s++){const i=e/2|0;for(let n=0;n<i;n++){const i=n+s*e,r=e-n-1+s*e,h=t[i];t[i]=t[r],t[r]=h}}};ke=()=>{const t=this.It,e=this.width,i=this.height;for(let s=0;s<(i/2|0);s++)for(let n=0;n<e;n++){const r=n+s*e,h=n+(i-s-1)*e,l=t[r];t[r]=t[h],t[h]=l}};translate=(t,e,i)=>{for(let s=0;s<this.palette.length;s++){let n=this.palette[s]>>16&255;n+=t,n<0?n=0:n>255&&(n=255);let r=this.palette[s]>>8&255;r+=e,r<0?r=0:r>255&&(r=255);let h=255&this.palette[s];h+=i,h<0?h=0:h>255&&(h=255),this.palette[s]=(n<<16)+(r<<8)+h}};Re=()=>{this.Ee|=0,this.ve|=0,this.Ee/=2,this.ve/=2,this.Ee|=0,this.ve|=0;const t=new Int8Array(this.Ee*this.ve);let e=0;for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)t[(s+this.be>>1)+(i+this.Te>>1)*this.Ee]=this.It[e++];this.It=t,this.width=this.Ee,this.height=this.ve,this.be=0,this.Te=0};xe=()=>{if(this.width===this.Ee&&this.height===this.ve)return;const t=new Int8Array(this.Ee*this.ve);let e=0;for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)t[s+this.be+(i+this.Te)*this.Ee]=this.It[e++];this.It=t,this.width=this.Ee,this.height=this.ve,this.be=0,this.Te=0};Se=(t,e,i,s,n,r,h,l)=>{const o=-(t>>2);t=-(3&t);for(let a=-e;a<0;a++){for(let t=o;t<0;t++){let t=i[s++];0===t?h++:r[h++]=this.palette[255&t],t=i[s++],0===t?h++:r[h++]=this.palette[255&t],t=i[s++],0===t?h++:r[h++]=this.palette[255&t],t=i[s++],0===t?h++:r[h++]=this.palette[255&t]}for(let e=t;e<0;e++){const t=i[s++];0===t?h++:r[h++]=this.palette[255&t]}h+=l,s+=n}}}class S extends Array{constructor(t,e){super(t);for(let i=0;i<t;i++)this[i]=e}}class O extends Array{constructor(t,e,i){super(t);for(let s=0;s<t;s++){this[s]=new Array(e);for(let t=0;t<e;t++)this[s][t]=i}}}class k extends Array{constructor(t,e,i,s){super(t);for(let n=0;n<t;n++){this[n]=new Array(e);for(let t=0;t<e;t++){this[n][t]=new Array(i);for(let e=0;e<i;e++)this[n][t][e]=s}}}}class R extends Array{constructor(t,e,i,s,n){super(t);for(let r=0;r<t;r++){this[r]=new Array(e);for(let t=0;t<e;t++){this[r][t]=new Array(i);for(let e=0;e<i;e++){this[r][t][e]=new Array(s);for(let i=0;i<s;i++)this[r][t][e][i]=n}}}}}class x extends Array{constructor(t,e,i){super(t);for(let s=0;s<t;s++){this[s]=new Array(e);for(let t=0;t<e;t++)this[s][t]=new Uint8Array(i)}}}class M extends Array{constructor(t,e){super(t);for(let i=0;i<t;i++)this[i]=new Int32Array(e)}}class F extends Array{constructor(t,e,i){super(t);for(let s=0;s<t;s++){this[s]=new Array(e);for(let t=0;t<e;t++)this[s][t]=new Int32Array(i)}}}class D extends m{static Me=!1;static Fe=new Int32Array(512);static De=new Int32Array(2048);static sin=new Int32Array(2048);static cos=new Int32Array(2048);static palette=new Int32Array(65536);static Ne=new S(50,null);static Ue=0;static Pe=new Int32Array;static Be=0;static We=0;static Ge=!0;static He=!1;static alpha=0;static Ye=null;static Ve=new S(50,null);static Xe=0;static je=0;static ze=new Int32Array(50);static Ze=new S(50,null);static qe=!1;static Ke=new S(50,!1);static Je=new Int32Array(50);static{for(let t=1;t<512;t++)this.Fe[t]=32768/t|0;for(let t=1;t<2048;t++)this.De[t]=65536/t|0;for(let t=0;t<2048;t++)this.sin[t]=65536*Math.sin(.0030679615757712823*t)|0,this.cos[t]=65536*Math.cos(.0030679615757712823*t)|0}static $e=()=>{this.Fe=null,this.Fe=null,this.sin=null,this.cos=null,this.Pe=null,this.Ne=null,this.Ke=null,this.Je=null,this.Ye=null,this.Ve=null,this.ze=null,this.palette=null,this.Ze=null,console.log('Draw3D unloaded!')};static Qe=()=>{this.Pe=new Int32Array(m._t);for(let t=0;t<m._t;t++)this.Pe[t]=m.gt*t;this.Be=m.gt/2|0,this.We=m._t/2|0};static ti=(t,e)=>{this.Pe=new Int32Array(e);for(let i=0;i<e;i++)this.Pe[i]=t*i;this.Be=t/2|0,this.We=e/2|0};static ei=()=>{this.Ye=null,this.Ve.fill(null)};static ii=t=>{this.Ue=0;for(let e=0;e<50;e++)try{this.Ne[e]=L.Le(t,e.toString()),this.Me&&128===this.Ne[e]?.Ee?this.Ne[e]?.Re():this.Ne[e]?.xe(),this.Ue++}catch(t){}};static si=t=>{if(0!==this.Je[t])return this.Je[t];const e=this.Ze[t];if(!e)return 0;let i=0,s=0,n=0;const r=e.length;for(let t=0;t<r;t++)i+=e[t]>>16&255,s+=e[t]>>8&255,n+=255&e[t];let h=((i/r|0)<<16)+((s/r|0)<<8)+(n/r|0);return h=this.ni(h,1.4),0===h&&(h=1),this.Je[t]=h,h};static ri=t=>{const e=t+.03*Math.random()-.015;let i=0;for(let t=0;t<512;t++){const s=(t/8|0)/64+.0078125,n=(7&t)/8+.0625;for(let t=0;t<128;t++){const r=t/128;let h=r,l=r,o=r;if(0!==n){let t;t=r<.5?r*(n+1):r+n-r*n;const e=2*r-t;let i=s+.3333333333333333;i>1&&i--;let a=s-.3333333333333333;a<0&&a++,h=6*i<1?e+6*(t-e)*i:2*i<1?t:3*i<2?e+(t-e)*(.6666666666666666-i)*6:e,l=6*s<1?e+6*(t-e)*s:2*s<1?t:3*s<2?e+(t-e)*(.6666666666666666-s)*6:e,o=6*a<1?e+6*(t-e)*a:2*a<1?t:3*a<2?e+(t-e)*(.6666666666666666-a)*6:e}const a=((256*h|0)<<16)+((256*l|0)<<8)+(256*o|0);this.palette[i++]=this.ni(a,e)}}for(let t=0;t<50;t++){const i=this.Ne[t];if(!i)continue;const s=i.palette;this.Ze[t]=new Int32Array(s.length);for(let i=0;i<s.length;i++){const n=this.Ze[t];n&&(n[i]=this.ni(s[i],e))}}for(let t=0;t<50;t++)this.hi(t)};static ni=(t,e)=>{const i=(t>>16)/256,s=(t>>8&255)/256,n=(255&t)/256;return((256*Math.pow(i,e)|0)<<16)+((256*Math.pow(s,e)|0)<<8)+(256*Math.pow(n,e)|0)};static li=t=>{this.Ye||(this.Xe=t,this.Me?this.Ye=new M(t,16384):this.Ye=new M(t,65536),this.Ve.fill(null))};static oi=(t,e,i,s,n,r,h,l,o)=>{let a=0,c=0;n!==s&&(a=(e-t<<16)/(n-s)|0,c=(l-h<<15)/(n-s)|0);let f=0,u=0;r!==n&&(f=(i-e<<16)/(r-n)|0,u=(o-l<<15)/(r-n)|0);let d=0,w=0;if(r!==s&&(d=(t-i<<16)/(s-r)|0,w=(h-o<<15)/(s-r)|0),s<=n&&s<=r){if(s<m.bottom)if(n>m.bottom&&(n=m.bottom),r>m.bottom&&(r=m.bottom),n<r)if(i=t<<=16,o=h<<=15,s<0&&(i-=d*s,t-=a*s,o-=w*s,h-=c*s,s=0),e<<=16,l<<=15,n<0&&(e-=f*n,l-=u*n,n=0),s!==n&&d<a||s===n&&d>f)for(r-=n,n-=s,s=D.Pe[s];;){if(--n<0)for(;;){if(--r<0)return;this.ai(i>>16,e>>16,o>>7,l>>7,m.It,s,0),i+=d,e+=f,o+=w,l+=u,s+=m.gt}this.ai(i>>16,t>>16,o>>7,h>>7,m.It,s,0),i+=d,t+=a,o+=w,h+=c,s+=m.gt}else for(r-=n,n-=s,s=D.Pe[s];;){if(--n<0)for(;;){if(--r<0)return;this.ai(e>>16,i>>16,l>>7,o>>7,m.It,s,0),i+=d,e+=f,o+=w,l+=u,s+=m.gt}this.ai(t>>16,i>>16,h>>7,o>>7,m.It,s,0),i+=d,t+=a,o+=w,h+=c,s+=m.gt}else if(e=t<<=16,l=h<<=15,s<0&&(e-=d*s,t-=a*s,l-=w*s,h-=c*s,s=0),i<<=16,o<<=15,r<0&&(i-=f*r,o-=u*r,r=0),s!==r&&d<a||s===r&&f>a)for(n-=r,r-=s,s=D.Pe[s];;){if(--r<0)for(;;){if(--n<0)return;this.ai(i>>16,t>>16,o>>7,h>>7,m.It,s,0),i+=f,t+=a,o+=u,h+=c,s+=m.gt}this.ai(e>>16,t>>16,l>>7,h>>7,m.It,s,0),e+=d,t+=a,l+=w,h+=c,s+=m.gt}else for(n-=r,r-=s,s=D.Pe[s];;){if(--r<0)for(;;){if(--n<0)return;this.ai(t>>16,i>>16,h>>7,o>>7,m.It,s,0),i+=f,t+=a,o+=u,h+=c,s+=m.gt}this.ai(t>>16,e>>16,h>>7,l>>7,m.It,s,0),e+=d,t+=a,l+=w,h+=c,s+=m.gt}}else if(n<=r){if(n<m.bottom)if(r>m.bottom&&(r=m.bottom),s>m.bottom&&(s=m.bottom),r<s)if(t=e<<=16,h=l<<=15,n<0&&(t-=a*n,e-=f*n,h-=c*n,l-=u*n,n=0),i<<=16,o<<=15,r<0&&(i-=d*r,o-=w*r,r=0),n!==r&&a<f||n===r&&a>d)for(s-=r,r-=n,n=D.Pe[n];;){if(--r<0)for(;;){if(--s<0)return;this.ai(t>>16,i>>16,h>>7,o>>7,m.It,n,0),t+=a,i+=d,h+=c,o+=w,n+=m.gt}this.ai(t>>16,e>>16,h>>7,l>>7,m.It,n,0),t+=a,e+=f,h+=c,l+=u,n+=m.gt}else for(s-=r,r-=n,n=D.Pe[n];;){if(--r<0)for(;;){if(--s<0)return;this.ai(i>>16,t>>16,o>>7,h>>7,m.It,n,0),t+=a,i+=d,h+=c,o+=w,n+=m.gt}this.ai(e>>16,t>>16,l>>7,h>>7,m.It,n,0),t+=a,e+=f,h+=c,l+=u,n+=m.gt}else if(i=e<<=16,o=l<<=15,n<0&&(i-=a*n,e-=f*n,o-=c*n,l-=u*n,n=0),t<<=16,h<<=15,s<0&&(t-=d*s,h-=w*s,s=0),r-=s,s-=n,n=D.Pe[n],a<f)for(;;){if(--s<0)for(;;){if(--r<0)return;this.ai(t>>16,e>>16,h>>7,l>>7,m.It,n,0),t+=d,e+=f,h+=w,l+=u,n+=m.gt}this.ai(i>>16,e>>16,o>>7,l>>7,m.It,n,0),i+=a,e+=f,o+=c,l+=u,n+=m.gt}else for(;;){if(--s<0)for(;;){if(--r<0)return;this.ai(e>>16,t>>16,l>>7,h>>7,m.It,n,0),t+=d,e+=f,h+=w,l+=u,n+=m.gt}this.ai(e>>16,i>>16,l>>7,o>>7,m.It,n,0),i+=a,e+=f,o+=c,l+=u,n+=m.gt}}else if(r<m.bottom)if(s>m.bottom&&(s=m.bottom),n>m.bottom&&(n=m.bottom),s<n)if(e=i<<=16,l=o<<=15,r<0&&(e-=f*r,i-=d*r,l-=u*r,o-=w*r,r=0),t<<=16,h<<=15,s<0&&(t-=a*s,h-=c*s,s=0),n-=s,s-=r,r=D.Pe[r],f<d)for(;;){if(--s<0)for(;;){if(--n<0)return;this.ai(e>>16,t>>16,l>>7,h>>7,m.It,r,0),e+=f,t+=a,l+=u,h+=c,r+=m.gt}this.ai(e>>16,i>>16,l>>7,o>>7,m.It,r,0),e+=f,i+=d,l+=u,o+=w,r+=m.gt}else for(;;){if(--s<0)for(;;){if(--n<0)return;this.ai(t>>16,e>>16,h>>7,l>>7,m.It,r,0),e+=f,t+=a,l+=u,h+=c,r+=m.gt}this.ai(i>>16,e>>16,o>>7,l>>7,m.It,r,0),e+=f,i+=d,l+=u,o+=w,r+=m.gt}else if(t=i<<=16,h=o<<=15,r<0&&(t-=f*r,i-=d*r,h-=u*r,o-=w*r,r=0),e<<=16,l<<=15,n<0&&(e-=a*n,l-=c*n,n=0),s-=n,n-=r,r=D.Pe[r],f<d)for(;;){if(--n<0)for(;;){if(--s<0)return;this.ai(e>>16,i>>16,l>>7,o>>7,m.It,r,0),e+=a,i+=d,l+=c,o+=w,r+=m.gt}this.ai(t>>16,i>>16,h>>7,o>>7,m.It,r,0),t+=f,i+=d,h+=u,o+=w,r+=m.gt}else for(;;){if(--n<0)for(;;){if(--s<0)return;this.ai(i>>16,e>>16,o>>7,l>>7,m.It,r,0),e+=a,i+=d,l+=c,o+=w,r+=m.gt}this.ai(i>>16,t>>16,o>>7,h>>7,m.It,r,0),t+=f,i+=d,h+=u,o+=w,r+=m.gt}};static ai=(t,e,i,s,n,r,h)=>{let l;if(D.Ge){let o;if(D.He){if(o=e-t>3?(s-i)/(e-t)|0:0,e>m.Ct&&(e=m.Ct),t<0&&(i-=t*o,t=0),t>=e)return;r+=t,h=e-t>>2,o<<=2}else{if(!(t<e))return;r+=t,o=(h=e-t>>2)>0?(s-i)*D.Fe[h]>>15:0}if(0===D.alpha)for(;;){if(--h<0){if((h=e-t&3)>0){l=D.palette[i>>8];do{n[r++]=l,h--}while(h>0);return}break}l=D.palette[i>>8],i+=o,n[r++]=l,n[r++]=l,n[r++]=l,n[r++]=l}else{const s=D.alpha,a=256-D.alpha;for(;;){if(--h<0){if((h=e-t&3)>0){l=D.palette[i>>8],l=((16711935&l)*a>>8&16711935)+((65280&l)*a>>8&65280);do{n[r++]=l+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),h--}while(h>0)}break}l=D.palette[i>>8],i+=o,l=((16711935&l)*a>>8&16711935)+((65280&l)*a>>8&65280),n[r++]=l+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=l+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=l+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=l+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280)}}}else if(t<e){const o=(s-i)/(e-t)|0;if(D.He&&(e>m.Ct&&(e=m.Ct),t<0&&(i-=t*o,t=0),t>=e))return;if(r+=t,h=e-t,0===D.alpha)do{n[r++]=D.palette[i>>8],i+=o,h--}while(h>0);else{const t=D.alpha,e=256-D.alpha;do{l=D.palette[i>>8],i+=o,l=((16711935&l)*e>>8&16711935)+((65280&l)*e>>8&65280),n[r++]=l+((16711935&n[r])*t>>8&16711935)+((65280&n[r])*t>>8&65280),h--}while(h>0)}}};static ci=(t,e,i,s,n,r,h)=>{let l=0;n!==s&&(l=(e-t<<16)/(n-s)|0);let o=0;r!==n&&(o=(i-e<<16)/(r-n)|0);let a=0;if(r!==s&&(a=(t-i<<16)/(s-r)|0),s<=n&&s<=r){if(s<m.bottom)if(n>m.bottom&&(n=m.bottom),r>m.bottom&&(r=m.bottom),n<r)if(i=t<<=16,s<0&&(i-=a*s,t-=l*s,s=0),e<<=16,n<0&&(e-=o*n,n=0),s!==n&&a<l||s===n&&a>o)for(r-=n,n-=s,s=this.Pe[s];;){if(--n<0)for(;;){if(--r<0)return;this.fi(i>>16,e>>16,m.It,s,h),i+=a,e+=o,s+=m.gt}this.fi(i>>16,t>>16,m.It,s,h),i+=a,t+=l,s+=m.gt}else for(r-=n,n-=s,s=this.Pe[s];;){if(--n<0)for(;;){if(--r<0)return;this.fi(e>>16,i>>16,m.It,s,h),i+=a,e+=o,s+=m.gt}this.fi(t>>16,i>>16,m.It,s,h),i+=a,t+=l,s+=m.gt}else if(e=t<<=16,s<0&&(e-=a*s,t-=l*s,s=0),i<<=16,r<0&&(i-=o*r,r=0),s!==r&&a<l||s===r&&o>l)for(n-=r,r-=s,s=this.Pe[s];;){if(--r<0)for(;;){if(--n<0)return;this.fi(i>>16,t>>16,m.It,s,h),i+=o,t+=l,s+=m.gt}this.fi(e>>16,t>>16,m.It,s,h),e+=a,t+=l,s+=m.gt}else for(n-=r,r-=s,s=this.Pe[s];;){if(--r<0)for(;;){if(--n<0)return;this.fi(t>>16,i>>16,m.It,s,h),i+=o,t+=l,s+=m.gt}this.fi(t>>16,e>>16,m.It,s,h),e+=a,t+=l,s+=m.gt}}else if(n<=r){if(n<m.bottom)if(r>m.bottom&&(r=m.bottom),s>m.bottom&&(s=m.bottom),r<s)if(t=e<<=16,n<0&&(t-=l*n,e-=o*n,n=0),i<<=16,r<0&&(i-=a*r,r=0),n!==r&&l<o||n===r&&l>a)for(s-=r,r-=n,n=this.Pe[n];;){if(--r<0)for(;;){if(--s<0)return;this.fi(t>>16,i>>16,m.It,n,h),t+=l,i+=a,n+=m.gt}this.fi(t>>16,e>>16,m.It,n,h),t+=l,e+=o,n+=m.gt}else for(s-=r,r-=n,n=this.Pe[n];;){if(--r<0)for(;;){if(--s<0)return;this.fi(i>>16,t>>16,m.It,n,h),t+=l,i+=a,n+=m.gt}this.fi(e>>16,t>>16,m.It,n,h),t+=l,e+=o,n+=m.gt}else if(i=e<<=16,n<0&&(i-=l*n,e-=o*n,n=0),t<<=16,s<0&&(t-=a*s,s=0),l<o)for(r-=s,s-=n,n=this.Pe[n];;){if(--s<0)for(;;){if(--r<0)return;this.fi(t>>16,e>>16,m.It,n,h),t+=a,e+=o,n+=m.gt}this.fi(i>>16,e>>16,m.It,n,h),i+=l,e+=o,n+=m.gt}else for(r-=s,s-=n,n=this.Pe[n];;){if(--s<0)for(;;){if(--r<0)return;this.fi(e>>16,t>>16,m.It,n,h),t+=a,e+=o,n+=m.gt}this.fi(e>>16,i>>16,m.It,n,h),i+=l,e+=o,n+=m.gt}}else if(r<m.bottom)if(s>m.bottom&&(s=m.bottom),n>m.bottom&&(n=m.bottom),s<n)if(e=i<<=16,r<0&&(e-=o*r,i-=a*r,r=0),t<<=16,s<0&&(t-=l*s,s=0),o<a)for(n-=s,s-=r,r=this.Pe[r];;){if(--s<0)for(;;){if(--n<0)return;this.fi(e>>16,t>>16,m.It,r,h),e+=o,t+=l,r+=m.gt}this.fi(e>>16,i>>16,m.It,r,h),e+=o,i+=a,r+=m.gt}else for(n-=s,s-=r,r=this.Pe[r];;){if(--s<0)for(;;){if(--n<0)return;this.fi(t>>16,e>>16,m.It,r,h),e+=o,t+=l,r+=m.gt}this.fi(i>>16,e>>16,m.It,r,h),e+=o,i+=a,r+=m.gt}else if(t=i<<=16,r<0&&(t-=o*r,i-=a*r,r=0),e<<=16,n<0&&(e-=l*n,n=0),o<a)for(s-=n,n-=r,r=this.Pe[r];;){if(--n<0)for(;;){if(--s<0)return;this.fi(e>>16,i>>16,m.It,r,h),e+=l,i+=a,r+=m.gt}this.fi(t>>16,i>>16,m.It,r,h),t+=o,i+=a,r+=m.gt}else for(s-=n,n-=r,r=this.Pe[r];;){if(--n<0)for(;;){if(--s<0)return;this.fi(i>>16,e>>16,m.It,r,h),e+=l,i+=a,r+=m.gt}this.fi(i>>16,t>>16,m.It,r,h),t+=o,i+=a,r+=m.gt}};static ui=(t,e,i,s,n,r,h,l,o,a,c,f,u,d,w,y,p,A,I)=>{const g=this.di(I);this.qe=!this.Ke[I];const _=a-u,C=c-w,b=f-p,T=d-a,E=y-c,v=A-f;let L=T*c-E*a<<14;const S=E*f-v*c<<8,O=v*a-T*f<<5;let k=_*c-C*a<<14;const R=C*f-b*c<<8,x=b*a-_*f<<5;let M=C*T-_*E<<14;const F=b*E-C*v<<8,D=_*v-b*T<<5;let N=0,U=0;n!==s&&(N=(e-t<<16)/(n-s)|0,U=(l-h<<16)/(n-s)|0);let P=0,B=0;r!==n&&(P=(i-e<<16)/(r-n)|0,B=(o-l<<16)/(r-n)|0);let W=0,G=0;if(r!==s&&(W=(t-i<<16)/(s-r)|0,G=(h-o<<16)/(s-r)|0),s<=n&&s<=r){if(s<m.bottom)if(n>m.bottom&&(n=m.bottom),r>m.bottom&&(r=m.bottom),n<r){i=t<<=16,o=h<<=16,s<0&&(i-=W*s,t-=N*s,o-=G*s,h-=U*s,s=0),e<<=16,l<<=16,n<0&&(e-=P*n,l-=B*n,n=0);const a=s-this.We;if(L+=O*a,k+=x*a,M+=D*a,L|=0,k|=0,M|=0,s!==n&&W<N||s===n&&W>P)for(r-=n,n-=s,s=this.Pe[s];;){if(--n<0)for(;;){if(--r<0)return;this.wi(i>>16,e>>16,m.It,s,g,0,0,L,k,M,S,R,F,o>>8,l>>8),i+=W,e+=P,o+=G,l+=B,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(i>>16,t>>16,m.It,s,g,0,0,L,k,M,S,R,F,o>>8,h>>8),i+=W,t+=N,o+=G,h+=U,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}else for(r-=n,n-=s,s=this.Pe[s];;){if(--n<0)for(;;){if(--r<0)return;this.wi(e>>16,i>>16,m.It,s,g,0,0,L,k,M,S,R,F,l>>8,o>>8),i+=W,e+=P,o+=G,l+=B,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(t>>16,i>>16,m.It,s,g,0,0,L,k,M,S,R,F,h>>8,o>>8),i+=W,t+=N,o+=G,h+=U,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}}else{e=t<<=16,l=h<<=16,s<0&&(e-=W*s,t-=N*s,l-=G*s,h-=U*s,s=0),i<<=16,o<<=16,r<0&&(i-=P*r,o-=B*r,r=0);const a=s-this.We;if(L+=O*a,k+=x*a,M+=D*a,L|=0,k|=0,M|=0,(s===r||W>=N)&&(s!==r||P<=N))for(n-=r,r-=s,s=this.Pe[s];;){if(--r<0)for(;;){if(--n<0)return;this.wi(t>>16,i>>16,m.It,s,g,0,0,L,k,M,S,R,F,h>>8,o>>8),i+=P,t+=N,o+=B,h+=U,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(t>>16,e>>16,m.It,s,g,0,0,L,k,M,S,R,F,h>>8,l>>8),e+=W,t+=N,l+=G,h+=U,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}else for(n-=r,r-=s,s=this.Pe[s];;){if(--r<0)for(;;){if(--n<0)return;this.wi(i>>16,t>>16,m.It,s,g,0,0,L,k,M,S,R,F,o>>8,h>>8),i+=P,t+=N,o+=B,h+=U,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(e>>16,t>>16,m.It,s,g,0,0,L,k,M,S,R,F,l>>8,h>>8),e+=W,t+=N,l+=G,h+=U,s+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}}}else if(n<=r){if(n<m.bottom)if(r>m.bottom&&(r=m.bottom),s>m.bottom&&(s=m.bottom),r<s){t=e<<=16,h=l<<=16,n<0&&(t-=N*n,e-=P*n,h-=U*n,l-=B*n,n=0),i<<=16,o<<=16,r<0&&(i-=W*r,o-=G*r,r=0);const a=n-this.We;if(L+=O*a,k+=x*a,M+=D*a,L|=0,k|=0,M|=0,n!==r&&N<P||n===r&&N>W)for(s-=r,r-=n,n=this.Pe[n];;){if(--r<0)for(;;){if(--s<0)return;this.wi(t>>16,i>>16,m.It,n,g,0,0,L,k,M,S,R,F,h>>8,o>>8),t+=N,i+=W,h+=U,o+=G,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(t>>16,e>>16,m.It,n,g,0,0,L,k,M,S,R,F,h>>8,l>>8),t+=N,e+=P,h+=U,l+=B,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}else for(s-=r,r-=n,n=this.Pe[n];;){if(--r<0)for(;;){if(--s<0)return;this.wi(i>>16,t>>16,m.It,n,g,0,0,L,k,M,S,R,F,o>>8,h>>8),t+=N,i+=W,h+=U,o+=G,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(e>>16,t>>16,m.It,n,g,0,0,L,k,M,S,R,F,l>>8,h>>8),t+=N,e+=P,h+=U,l+=B,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}}else{i=e<<=16,o=l<<=16,n<0&&(i-=N*n,e-=P*n,o-=U*n,l-=B*n,n=0),t<<=16,h<<=16,s<0&&(t-=W*s,h-=G*s,s=0);const a=n-this.We;if(L+=O*a,k+=x*a,M+=D*a,L|=0,k|=0,M|=0,r-=s,s-=n,n=this.Pe[n],N<P)for(;;){if(--s<0)for(;;){if(--r<0)return;this.wi(t>>16,e>>16,m.It,n,g,0,0,L,k,M,S,R,F,h>>8,l>>8),t+=W,e+=P,h+=G,l+=B,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(i>>16,e>>16,m.It,n,g,0,0,L,k,M,S,R,F,o>>8,l>>8),i+=N,e+=P,o+=U,l+=B,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}else for(;;){if(--s<0)for(;;){if(--r<0)return;this.wi(e>>16,t>>16,m.It,n,g,0,0,L,k,M,S,R,F,l>>8,h>>8),t+=W,e+=P,h+=G,l+=B,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(e>>16,i>>16,m.It,n,g,0,0,L,k,M,S,R,F,l>>8,o>>8),i+=N,e+=P,o+=U,l+=B,n+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}}}else if(r<m.bottom)if(s>m.bottom&&(s=m.bottom),n>m.bottom&&(n=m.bottom),s<n){e=i<<=16,l=o<<=16,r<0&&(e-=P*r,i-=W*r,l-=B*r,o-=G*r,r=0),t<<=16,h<<=16,s<0&&(t-=N*s,h-=U*s,s=0);const a=r-this.We;if(L+=O*a,k+=x*a,M+=D*a,L|=0,k|=0,M|=0,n-=s,s-=r,r=this.Pe[r],P<W)for(;;){if(--s<0)for(;;){if(--n<0)return;this.wi(e>>16,t>>16,m.It,r,g,0,0,L,k,M,S,R,F,l>>8,h>>8),e+=P,t+=N,l+=B,h+=U,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(e>>16,i>>16,m.It,r,g,0,0,L,k,M,S,R,F,l>>8,o>>8),e+=P,i+=W,l+=B,o+=G,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}else for(;;){if(--s<0)for(;;){if(--n<0)return;this.wi(t>>16,e>>16,m.It,r,g,0,0,L,k,M,S,R,F,h>>8,l>>8),e+=P,t+=N,l+=B,h+=U,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(i>>16,e>>16,m.It,r,g,0,0,L,k,M,S,R,F,o>>8,l>>8),e+=P,i+=W,l+=B,o+=G,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}}else{t=i<<=16,h=o<<=16,r<0&&(t-=P*r,i-=W*r,h-=B*r,o-=G*r,r=0),e<<=16,l<<=16,n<0&&(e-=N*n,l-=U*n,n=0);const a=r-this.We;if(L+=O*a,k+=x*a,M+=D*a,L|=0,k|=0,M|=0,s-=n,n-=r,r=this.Pe[r],P<W)for(;;){if(--n<0)for(;;){if(--s<0)return;this.wi(e>>16,i>>16,m.It,r,g,0,0,L,k,M,S,R,F,l>>8,o>>8),e+=N,i+=W,l+=U,o+=G,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(t>>16,i>>16,m.It,r,g,0,0,L,k,M,S,R,F,h>>8,o>>8),t+=P,i+=W,h+=B,o+=G,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}else for(;;){if(--n<0)for(;;){if(--s<0)return;this.wi(i>>16,e>>16,m.It,r,g,0,0,L,k,M,S,R,F,o>>8,l>>8),e+=N,i+=W,l+=U,o+=G,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}this.wi(i>>16,t>>16,m.It,r,g,0,0,L,k,M,S,R,F,o>>8,h>>8),t+=P,i+=W,h+=B,o+=G,r+=m.gt,L+=O,k+=x,M+=D,L|=0,k|=0,M|=0}}};static wi=(t,e,i,s,n,r,h,l,o,a,c,f,u,d,w)=>{if(t>=e)return;let y,p,A,I,g,_,C,b,T;if(this.He){if(y=(w-d)/(e-t)|0,e>m.Ct&&(e=m.Ct),t<0&&(d-=t*y,t=0),t>=e)return;p=e-t>>3,y<<=12}else e-t>7?(p=e-t>>3,y=(w-d)*this.Fe[p]>>6):(p=0,y=0);if(d<<=9,s+=t,this.Me&&n)if(A=0,I=0,_=t-this.Be,l+=(c>>3)*_,o+=(f>>3)*_,a+=(u>>3)*_,l|=0,o|=0,g=(a|=0)>>12,0!==g&&(h=o/g|0,(r=l/g|0)<0?r=0:r>4032&&(r=4032)),l+=c,o+=f,a+=u,l|=0,o|=0,g=(a|=0)>>12,0!==g&&(A=l/g|0,I=o/g|0,A<7?A=7:A>4032&&(A=4032)),C=A-r>>3,b=I-h>>3,r+=d>>3&786432,T=d>>23,this.qe){for(;p-- >0;)i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b,i[s++]=n[(4032&h)+(r>>6)]>>>T,r=A,h=I,l+=c,o+=f,g=(a+=u)>>12,0!==g&&(A=l/g|0,I=o/g|0,A<7?A=7:A>4032&&(A=4032)),C=A-r>>3,b=I-h>>3,r+=(d+=y)>>3&786432,T=d>>23;for(p=e-t&7;p-- >0;)i[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=b}else{for(;p-- >0;){let t;0!=(t=n[(4032&h)+(r>>6)]>>>T)&&(i[s]=t),s+=1,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s++,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s++,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s++,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s++,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s++,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s++,0!=(t=n[(4032&(h+=b))+((r+=C)>>6)]>>>T)&&(i[s]=t),s+=1,r=A,h=I,l+=c,o+=f,a+=u,l|=0,o|=0,g=(a|=0)>>12,0!==g&&(A=l/g|0,I=o/g|0,A<7?A=7:A>4032&&(A=4032)),C=A-r>>3,b=I-h>>3,r+=(d+=y)>>3&786432,T=d>>23}for(p=e-t&7;p-- >0;){let t;0!=(t=n[(4032&h)+(r>>6)]>>>T)&&(i[s]=t),s++,r+=C,h+=b}}else if(A=0,I=0,_=t-this.Be,l+=(c>>3)*_,o+=(f>>3)*_,a+=(u>>3)*_,l|=0,o|=0,g=(a|=0)>>14,0!==g&&(h=o/g|0,(r=l/g|0)<0?r=0:r>16256&&(r=16256)),l+=c,o+=f,a+=u,l|=0,o|=0,g=(a|=0)>>14,0!==g&&(A=l/g|0,I=o/g|0,A<7?A=7:A>16256&&(A=16256)),C=A-r>>3,b=I-h>>3,r+=6291456&d,T=d>>23,this.qe&&n){for(;p-- >0;)i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b,i[s++]=n[(16256&h)+(r>>7)]>>>T,r=A,h=I,l+=c,o+=f,a+=u,l|=0,o|=0,g=(a|=0)>>14,0!==g&&(A=l/g|0,I=o/g|0,A<7?A=7:A>16256&&(A=16256)),C=A-r>>3,b=I-h>>3,r+=6291456&(d+=y),T=d>>23;for(p=e-t&7;p-- >0;)i[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=b}else{for(;p-- >0&&n;){let t;0!=(t=n[(16256&h)+(r>>7)]>>>T)&&(i[s]=t),s+=1,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,0!=(t=n[(16256&(h+=b))+((r+=C)>>7)]>>>T)&&(i[s]=t),s++,r=A,h=I,l+=c,o+=f,a+=u,l|=0,o|=0,g=(a|=0)>>14,0!==g&&(A=l/g|0,I=o/g|0,A<7?A=7:A>16256&&(A=16256)),C=A-r>>3,b=I-h>>3,r+=6291456&(d+=y),T=d>>23}for(p=e-t&7;p-- >0&&n;){let t;0!=(t=n[(16256&h)+(r>>7)]>>>T)&&(i[s]=t),s++,r+=C,h+=b}}};static fi=(t,e,i,s,n)=>{if(this.He&&(e>m.Ct&&(e=m.Ct),t<0&&(t=0)),t>=e)return;s+=t;let r=e-t>>2;if(0===this.alpha)for(;;){if(r--,r<0)for(r=e-t&3;;){if(r--,r<0)return;i[s++]=n}i[s++]=n,i[s++]=n,i[s++]=n,i[s++]=n}const h=this.alpha,l=256-this.alpha;for(n=((16711935&n)*l>>8&16711935)+((65280&n)*l>>8&65280);;){if(r--,r<0)for(r=e-t&3;;){if(r--,r<0)return;i[s++]=n+((16711935&i[s])*h>>8&16711935)+((65280&i[s])*h>>8&65280)}i[s++]=n+((16711935&i[s])*h>>8&16711935)+((65280&i[s])*h>>8&65280),i[s++]=n+((16711935&i[s])*h>>8&16711935)+((65280&i[s])*h>>8&65280),i[s++]=n+((16711935&i[s])*h>>8&16711935)+((65280&i[s])*h>>8&65280),i[s++]=n+((16711935&i[s])*h>>8&16711935)+((65280&i[s])*h>>8&65280)}};static hi=t=>{this.Ve[t]&&this.Ye&&(this.Ye[this.Xe++]=this.Ve[t],this.Ve[t]=null)};static di=t=>{if(this.ze[t]=this.je++,this.Ve[t])return this.Ve[t];let e;if(this.Xe>0&&this.Ye)e=this.Ye[--this.Xe],this.Ye[this.Xe]=null;else{let t=0,i=-1;for(let e=0;e<this.Ue;e++)this.Ve[e]&&(this.ze[e]<t||-1===i)&&(t=this.ze[e],i=e);e=this.Ve[i],this.Ve[i]=null}this.Ve[t]=e;const i=this.Ne[t],s=this.Ze[t];if(!e||!i||!s)return null;if(this.Me){this.Ke[t]=!1;for(let n=0;n<4096;n++){const r=e[n]=16316671&s[i.It[n]];0===r&&(this.Ke[t]=!0),e[n+4096]=r-(r>>>3)&16316671,e[n+8192]=r-(r>>>2)&16316671,e[n+12288]=r-(r>>>2)-(r>>>3)&16316671}}else{if(64===i.width)for(let t=0;t<128;t++)for(let n=0;n<128;n++)e[n+(t<<7|0)]=s[i.It[(n>>1)+(t>>1<<6|0)]];else for(let t=0;t<16384;t++)e[t]=s[i.It[t]];this.Ke[t]=!1;for(let i=0;i<16384;i++){e[i]&=16316671;const s=e[i];0===s&&(this.Ke[t]=!0),e[i+16384]=s-(s>>>3)&16316671,e[i+32768]=s-(s>>>2)&16316671,e[i+49152]=s-(s>>>2)-(s>>>3)&16316671}}return e}}const N={yi:{key:8,ch:8},mi:{key:10,ch:10},pi:{key:16,ch:65535},Ai:{key:27,ch:27},Ii:{key:9,ch:9},gi:{key:20,ch:65535},_i:{key:32,ch:32},Ci:{key:17,ch:65535},bi:{key:18,ch:65535},Ti:{key:524,ch:65535},Ei:{key:37,ch:65535},vi:{key:39,ch:65535},Li:{key:38,ch:65535},Si:{key:40,ch:65535},Oi:{key:155,ch:65535},ki:{key:36,ch:65535},Ri:{key:33,ch:65535},xi:{key:127,ch:127},Mi:{key:35,ch:65535},Fi:{key:34,ch:65535},Di:{key:192,ch:96},Ni:{key:192,ch:126},Ui:{key:49,ch:33},Pi:{key:50,ch:64},Bi:{key:51,ch:35},Wi:{key:52,ch:36},Gi:{key:53,ch:37},Hi:{key:54,ch:94},Yi:{key:55,ch:38},Vi:{key:56,ch:42},Xi:{key:57,ch:40},ji:{key:48,ch:41},zi:{key:45,ch:45},Zi:{key:45,ch:95},qi:{key:61,ch:61},Ki:{key:61,ch:43},Ji:{key:91,ch:91},$i:{key:91,ch:123},Qi:{key:93,ch:93},ts:{key:93,ch:125},es:{key:92,ch:92},ss:{key:92,ch:124},ns:{key:59,ch:59},rs:{key:59,ch:58},hs:{key:222,ch:39},ls:{key:222,ch:34},os:{key:44,ch:44},cs:{key:44,ch:60},fs:{key:46,ch:46},us:{key:46,ch:62},ds:{key:47,ch:47},ws:{key:47,ch:63},ys:{key:112,ch:65535},ps:{key:113,ch:65535},As:{key:114,ch:65535},Is:{key:115,ch:65535},gs:{key:116,ch:65535},_s:{key:117,ch:65535},Cs:{key:118,ch:65535},bs:{key:119,ch:65535},Ts:{key:120,ch:65535},Es:{key:121,ch:65535},vs:{key:122,ch:65535},Ls:{key:123,ch:65535},0:{key:48,ch:48},1:{key:49,ch:49},2:{key:50,ch:50},3:{key:51,ch:51},4:{key:52,ch:52},5:{key:53,ch:53},6:{key:54,ch:54},7:{key:55,ch:55},8:{key:56,ch:56},9:{key:57,ch:57},a:{key:65,ch:97},b:{key:66,ch:98},c:{key:67,ch:99},d:{key:68,ch:100},e:{key:69,ch:101},f:{key:70,ch:102},g:{key:71,ch:103},Ss:{key:72,ch:104},Os:{key:73,ch:105},ks:{key:74,ch:106},Rs:{key:75,ch:107},xs:{key:76,ch:108},i:{key:77,ch:109},n:{key:78,ch:110},h:{key:79,ch:111},t:{key:80,ch:112},Ms:{key:81,ch:113},r:{key:82,ch:114},s:{key:83,ch:115},Fs:{key:84,ch:116},Ds:{key:85,ch:117},Ns:{key:86,ch:118},w:{key:87,ch:119},x:{key:88,ch:120},y:{key:89,ch:121},z:{key:90,ch:122},Us:{key:65,ch:65},Ps:{key:66,ch:66},Bs:{key:67,ch:67},Ws:{key:68,ch:68},E:{key:69,ch:69},Gs:{key:70,ch:70},Hs:{key:71,ch:71},Ys:{key:72,ch:72},Vs:{key:73,ch:73},Xs:{key:74,ch:74},js:{key:75,ch:75},zs:{key:76,ch:76},Zs:{key:77,ch:77},qs:{key:78,ch:78},Ks:{key:79,ch:79},Js:{key:80,ch:80},Q:{key:81,ch:81},$s:{key:82,ch:82},Qs:{key:83,ch:83},tn:{key:84,ch:84},en:{key:85,ch:85},sn:{key:86,ch:86},nn:{key:87,ch:87},rn:{key:88,ch:88},hn:{key:89,ch:89},ln:{key:90,ch:90}},U=['Tab','F1','F2','F3','F4','F5','F6','F7','F8','F9','F10','ArrowLeft','ArrowRight','ArrowUp','ArrowDown'];class P{static enabled=!1;static on=null;static an=null;static cn=0;static fn=0;static un=0;static dn=0;static wn=0;static yn=()=>{this.on=v.Qt(1),this.an=null,this.cn=Date.now(),this.enabled=!0};static mn=()=>{this.enabled=!1,this.on=null};static flush=()=>{let t=null;return this.an&&this.enabled&&(t=this.an),this.an=null,t};static stop=()=>{let t=null;return this.on&&this.on.Jt>0&&this.enabled&&(t=this.on),this.mn(),t};static pn=(t,e,i)=>{if(!(this.enabled&&t>=0&&t<789&&e>=0&&e<532))return;this.fn++;const s=Date.now();let n=(s-this.cn)/10|0;n>250&&(n=250),this.cn=s,this.An(5),1===i?this.on?.p1(1):this.on?.p1(2),this.on?.p1(n),this.on?.p3(t+(e<<10))};static In=t=>{if(!this.enabled)return;this.fn++;const e=Date.now();let i=(e-this.cn)/10|0;i>250&&(i=250),this.cn=e,this.An(2),1===t?this.on?.p1(3):this.on?.p1(4),this.on?.p1(i)};static gn=(t,e)=>{if(!(this.enabled&&t>=0&&t<789&&e>=0&&e<532))return;const i=Date.now();if(i-this.un>=50){this.un=i,this.fn++;let s=(i-this.cn)/10|0;s>250&&(s=250),this.cn=i,t-this.dn<8&&t-this.dn>=-8&&e-this.wn<8&&e-this.wn>=-8?(this.An(3),this.on?.p1(5),this.on?.p1(s),this.on?.p1(t+(e-this.wn+8<<4)+8-this.dn)):t-this.dn<128&&t-this.dn>=-128&&e-this.wn<128&&e-this.wn>=-128?(this.An(4),this.on?.p1(6),this.on?.p1(s),this.on?.p1(t+128-this.dn),this.on?.p1(e+128-this.wn)):(this.An(5),this.on?.p1(7),this.on?.p1(s),this.on?.p3(t+(e<<10))),this.dn=t,this.wn=e}};static _n=t=>{if(!this.enabled)return;this.fn++;const e=Date.now();let i=(e-this.cn)/10|0;i>250&&(i=250),this.cn=e,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.An(3),this.on?.p1(8),this.on?.p1(i),this.on?.p1(t)};static Cn=t=>{if(!this.enabled)return;this.fn++;const e=Date.now();let i=(e-this.cn)/10|0;i>250&&(i=250),this.cn=e,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.An(3),this.on?.p1(9),this.on?.p1(i),this.on?.p1(t)};static bn=()=>{if(!this.enabled)return;this.fn++;const t=Date.now();let e=(t-this.cn)/10|0;e>250&&(e=250),this.cn=t,this.An(2),this.on?.p1(10),this.on?.p1(e)};static Tn=()=>{if(!this.enabled)return;this.fn++;const t=Date.now();let e=(t-this.cn)/10|0;e>250&&(e=250),this.cn=t,this.An(2),this.on?.p1(11),this.on?.p1(e)};static En=()=>{if(!this.enabled)return;this.fn++;const t=Date.now();let e=(t-this.cn)/10|0;e>250&&(e=250),this.cn=t,this.An(2),this.on?.p1(12),this.on?.p1(e)};static vn=()=>{if(!this.enabled)return;this.fn++;const t=Date.now();let e=(t-this.cn)/10|0;e>250&&(e=250),this.cn=t,this.An(2),this.on?.p1(13),this.on?.p1(e)};static An=t=>{if(this.on&&this.on.Jt+t>=500){const t=this.on;this.on=v.Qt(1),this.an=t}}}class B{static getParameter(t){return new URLSearchParams(window.location.search).get(t)??''}static setParameter(t,e){const i=new URL(window.location.toString());i.searchParams.set(t,e),window.history.pushState(null,'',i.toString())}Ln=0;Sn=[];On=0;kn=null;state=0;Rn=20;xn=1;Mn=[];Fn=0;Dn=0;Nn=[];Un=!0;Pn=!1;Bn=0;Wn=0;Gn=0;Hn=0;Yn=0;Vn=0;Xn=0;jn=[];zn=[];Zn=0;qn=0;constructor(t=!1){A.fillStyle='black',A.fillRect(0,0,p.width,p.height),this.Pn=t,this.Pn?this.resize(window.innerWidth,window.innerHeight):this.resize(p.width,p.height)}get width(){return p.width}get height(){return p.height}resize(t,e){p.width=t,p.height=e,this.kn=new C(t,e),D.Qe()}async Kn(){window.addEventListener('resize',(()=>{this.Pn&&this.resize(window.innerWidth,window.innerHeight)}),!1),window.addEventListener('keydown',this._n),window.addEventListener('keyup',this.Cn),window.addEventListener('mousedown',this.pn),window.addEventListener('mouseup',this.In),window.addEventListener('mouseenter',this.En),window.addEventListener('mouseleave',this.vn),window.addEventListener('mousemove',this.gn),window.addEventListener('focusin',this.bn),window.addEventListener('focusout',this.Tn),window.addEventListener('beforeunload',this.$e),p.oncontextmenu=t=>{t.preventDefault()},await this.Jn(0,'Loading...'),await this.load();for(let t=0;t<10;t++)this.Mn[t]=Date.now();let t,e=0,i=256,s=1,n=0;for(;this.state>=0;){if(this.state>0&&(this.state--,0===this.state))return void this.$n();const r=i,h=s;i=300,s=1,t=Date.now();const l=this.Mn[e];if(0===l?(i=r,s=h):t>l&&(i=2560*this.Rn/(t-l)|0),i<25?i=25:i>256&&(i=256,s=this.Rn-(t-l)/10|0),this.Mn[e]=t,e=(e+1)%10,s>1)for(let t=0;t<10;t++)0!==this.Mn[t]&&(this.Mn[t]+=s);for(s<this.xn&&(s=this.xn),await b(s);n<256;)await this.update(),this.Yn=0,this.Zn=this.qn,n+=i;n&=255,this.Rn>0&&(this.Fn=1e3*i/(256*this.Rn)|0);const o=performance.now();this.Un&&this.refresh(),await this.draw(),this.Nn[this.Dn]=(performance.now()-o)/1e3,this.Dn=(this.Dn+1)%this.Nn.length}-1===this.state&&this.$n()}$n(){this.state=-2,this.$e()}Qn(t){this.Rn=1e3/t|0}start(){this.state>=0&&(this.state=0)}stop(){this.state>=0&&(this.state=4e3/this.Rn|0)}destroy(){this.state=-1}async load(){}async update(){}$e(){}async draw(){}refresh(){}async Jn(t,e){const i=this.width,s=this.height;this.Un&&(A.fillStyle='black',A.fillRect(0,0,i,s),this.Un=!1);const n=s/2-18;A.fillStyle='rgb(140, 17, 17)',A.rect((i/2|0)-152,n,304,34),A.fillRect((i/2|0)-150,n+2,3*t,30),A.fillStyle='black',A.fillRect((i/2|0)-150+3*t,n+2,300-3*t,30),A.font='bold 13px helvetica, sans-serif',A.textAlign='center',A.fillStyle='white',A.fillText(e,i/2|0,n+22),await b(5)}_n=t=>{const e=t.key;U.includes(e)&&t.preventDefault(),this.Bn=0;const i=N[e];if(!i)return void console.error(`Unhandled key ${e}`);const s=i.key;let n=i.ch;n<30&&(n=0),37===s?n=1:39===s?n=2:38===s?n=3:40===s?n=4:17===s?n=5:8===s||127===s?n=8:9===s?n=9:10===s?n=10:s>=112&&s<=123?n=s+1008-112:36===s?n=1e3:35===s?n=1001:33===s?n=1002:34===s&&(n=1003),n>0&&n<128&&(this.jn[n]=1),n>4&&(this.zn[this.qn]=n,this.qn=this.qn+1&127),P.enabled&&P._n(n)};Cn=t=>{const e=t.key;U.includes(e)&&t.preventDefault(),this.Bn=0;const i=N[e];if(!i)return void console.error(`Unhandled key ${e}`);const s=i.key;let n=i.ch;n<30&&(n=0),37===s?n=1:39===s?n=2:38===s?n=3:40===s?n=4:17===s?n=5:8===s||127===s?n=8:9===s?n=9:10===s?n=10:s>=112&&s<=123?n=s+1008-112:36===s?n=1e3:35===s?n=1001:33===s?n=1002:34===s&&(n=1003),n>0&&n<128&&(this.jn[n]=0),P.enabled&&P.Cn(n)};tr(){let t=-1;return this.qn!==this.Zn&&(t=this.zn[this.Zn],this.Zn=this.Zn+1&127),t}pn=t=>{let e=t.x,i=t.y;const{top:s,left:n}=this.er;e-=n,i-=s;const r=p.getBoundingClientRect();e*=p.width/r.width,i*=p.height/r.height,e|=0,i|=0,this.Bn=0,this.Vn=e,this.Xn=i,2===t.buttons?(this.Yn=2,this.Wn=2):1===t.buttons&&(this.Yn=1,this.Wn=1),P.enabled};In=t=>{this.Bn=0,this.Wn=0,P.enabled};En=t=>{P.enabled&&P.En()};vn=t=>{P.enabled&&P.vn()};gn=t=>{let e=t.x,i=t.y;const{top:s,left:n}=this.er;e-=n,i-=s;const r=p.getBoundingClientRect();e*=p.width/r.width,i*=p.height/r.height,e|=0,i|=0,this.Bn=0,this.Gn=e,this.Hn=i,P.enabled&&P.gn(e,i)};bn=t=>{this.Un=!0,this.refresh(),P.enabled&&P.bn()};Tn=t=>{P.enabled&&P.Tn()};get ms(){const t=this.Nn.length;let e=0;for(let i=0;i<t;i++)e+=this.Nn[i];const i=e/t;return i>this.Ln&&(this.Ln=i),this.Sn[this.On]=i,this.On=(this.On+1)%250,i}get ir(){return this.Sn.reduce(((t,e)=>t+e),0)/250}get er(){const t=p.getBoundingClientRect(),e=window.getComputedStyle(p),i=parseFloat(e.paddingLeft||'0'),s=parseFloat(e.paddingTop||'0'),n=parseFloat(e.borderLeftWidth||'0'),r=parseFloat(e.borderTopWidth||'0'),h=t.left+n+i;return{top:t.top+r+s,left:h}}}class W{db;constructor(t){t.onerror=this.onerror,t.onclose=this.onclose,this.db=t}static openDatabase=async()=>await new Promise(((t,e)=>{const i=indexedDB.open('lostcity',1);i.onsuccess=e=>{const i=e.target;console.log('database success!'),t(i.result)},i.onupgradeneeded=t=>{t.target.result.createObjectStore('cache')},i.onerror=t=>{const i=t.target;console.error('database error!: ',i.error),e(i.result)}}));sr=async t=>await new Promise((e=>{const i=this.db.transaction('cache','readonly').objectStore('cache').get(t);i.onsuccess=()=>{e(i.result)},i.onerror=t=>{e(void 0)}}));nr=async(t,e)=>await new Promise(((i,s)=>{const n=this.db.transaction('cache','readwrite').objectStore('cache').put(e,t);n.onsuccess=()=>{i()},n.onerror=t=>{s()}}));onclose=t=>{console.log('database close!')};onerror=t=>{console.log('database error!')};rr=t=>{const e=t.trim();let i=0;for(let t=0;t<e.length&&t<12;t++){const s=e.charAt(t);i*=37,s>='A'&&s<='Z'?i+=s.charCodeAt(0)+1-65:s>='a'&&s<='z'?i+=s.charCodeAt(0)+1-97:s>='0'&&s<='9'&&(i+=s.charCodeAt(0)+27-48)}return i}}class G{static rr=t=>{let e=0;t=t.toUpperCase();for(let i=0;i<t.length;i++)e=61*e+t.charCodeAt(i)-32|0;return e};buffer;hr;lr;ar;cr;ur;dr;wr=[];constructor(t){t instanceof Uint8Array&&(t=new Int8Array(t));let i=new v(new Uint8Array(t));const s=i.ne,n=i.ne;s===n?(this.buffer=t,this.hr=!1):(this.buffer=e.read(s,t,n,6),i=new v(new Uint8Array(this.buffer)),this.hr=!0),this.lr=i.ie,this.ar=[],this.cr=[],this.ur=[],this.dr=[];let r=i.Jt+10*this.lr;for(let t=0;t<this.lr;t++)this.ar.push(i.re),this.cr.push(i.ne),this.ur.push(i.ne),this.dr.push(r),r+=this.ur[t]}read=t=>{const e=G.rr(t),i=this.ar.indexOf(e);return-1===i?null:this.yr(i)};yr=t=>{if(t<0||t>=this.lr)return null;if(this.wr[t])return this.wr[t];const i=this.dr[t],s=i+this.ur[t];if(this.hr){const e=Uint8Array.from(this.buffer.subarray(i,i+s));return this.wr[t]=e,e}{const i=Uint8Array.from(e.read(this.cr[t],this.buffer,this.ur[t],this.dr[t]));return this.wr[t]=i,i}}}class H{static mr=new Uint8Array(520);pr;Ar;store;constructor(t,e,i){this.pr=new v(t),this.Ar=new v(e),this.store=i+1}get lr(){return this.Ar.length/6}read(t,e=!1){this.Ar.Jt=6*t;const i=this.Ar.ne;let s=this.Ar.ne;if(s<=0||s>this.pr.length/520)return null;const n=new Uint8Array(i);let r=0;for(let e=0;r<i;e++){if(0===s)return null;this.pr.Jt=520*s;let h=i-r;h>512&&(h=512),this.pr.ce(h+8,0,H.mr);const l=(255&H.mr[0])<<8|255&H.mr[1],o=(255&H.mr[2])<<8|255&H.mr[3],a=(255&H.mr[4])<<16|(255&H.mr[5])<<8|255&H.mr[6],c=255&H.mr[7];if(l!==t||o!==e||c!==this.store)return null;if(a<0||a>this.pr.length/520)return null;for(let t=0;t<h;t++)n[r++]=H.mr[t+8];s=a}return e?n:1===this.store?new G(n):function(t,e){d(h);const i=u(h,t,e),s=h.Ir(i,a)>>>0;if(h.ft(i,a),4294967295===s){const t=h.gr(),e=h._r(),i=new Uint8Array(h.memory.buffer,t,e),s=(new TextDecoder).decode(i);throw new o(s)}const n=h.buffer()>>>0;return new Uint8Array(h.memory.buffer,n,s)}(n)}}class Y{static Cr=[];static br=t=>{const e=new v(t.read('base_head.dat')),i=new v(t.read('base_type.dat')),s=new v(t.read('base_label.dat')),n=e.ie;e.Jt+=2;for(let t=0;t<n;t++){const t=e.ie,n=e.te,r=new Uint8Array(n),h=new S(n,null);for(let t=0;t<n;t++){r[t]=i.te;const e=s.te,n=new Uint8Array(e);for(let t=0;t<e;t++)n[t]=s.te;h[t]=n}this.Cr[t]=new Y,this.Cr[t].length=n,this.Cr[t].types=r,this.Cr[t].labels=h}};length=0;types=null;labels=null}class V{static Cr=[];static br=t=>{const e=new v(t.read('frame_head.dat')),i=new v(t.read('frame_tran1.dat')),s=new v(t.read('frame_tran2.dat')),n=new v(t.read('frame_del.dat')),r=e.ie;e.Jt+=2;const h=new Int32Array(500),l=new Int32Array(500),o=new Int32Array(500),a=new Int32Array(500);for(let t=0;t<r;t++){const t=e.ie,r=this.Cr[t]=new V;r.delay=n.te;const c=e.ie,f=Y.Cr[c];r.$=f;const u=e.te;let d=-1,w=0;for(let t=0;t<u;t++){if(!f.types)throw new Error('SeqBase not loaded!!!');const e=i.te;if(e>0){if(0!==f.types[t])for(let e=t-1;e>d;e--)if(0===f.types[e]){h[w]=e,l[w]=0,o[w]=0,a[w]=0,w++;break}h[w]=t;let i=0;3===f.types[h[w]]&&(i=128),l[w]=0==(1&e)?i:s.le,o[w]=0==(2&e)?i:s.le,a[w]=0==(4&e)?i:s.le,d=t,w++}}r.length=w,r.Tr=new Int32Array(w),r.x=new Int32Array(w),r.y=new Int32Array(w),r.z=new Int32Array(w);for(let t=0;t<w;t++)r.Tr[t]=h[t],r.x[t]=l[t],r.y[t]=o[t],r.z[t]=a[t]}};delay=0;$=null;length=0;Tr=null;x=null;y=null;z=null}class X{Er=0;vr=0;Lr=0;Sr=-1;Or=-1;kr=-1;Rr=-1;Mr=-1;Fr=-1;Dr=-1;Nr=-1;Ur=-1;Pr=0;Br=-1;Wr=-1;Gr=-1;data=null}class j{x=0;y=0;z=0;w=0}class z extends y{static metadata=null;static head=null;static Hr=null;static Yr=null;static Vr=null;static Xr=null;static jr=null;static zr=null;static Zr=null;static qr=null;static Kr=null;static Jr=null;static $r=null;static Qr=null;static axis=null;static th=new S(4096,!1);static eh=new S(4096,!1);static ih=new Int32Array(4096);static sh=new Int32Array(4096);static nh=new Int32Array(4096);static rh=new Int32Array(4096);static hh=new Int32Array(4096);static lh=new Int32Array(4096);static oh=new Int32Array(1500);static ah=new M(1500,512);static fh=new Int32Array(12);static uh=new M(12,2e3);static dh=new Int32Array(2e3);static wh=new Int32Array(2e3);static yh=new Int32Array(12);static mh=new Int32Array(10);static ph=new Int32Array(10);static Ah=new Int32Array(10);static Ih=0;static gh=0;static _h=0;static Ch=!1;static Gn=0;static Hn=0;static bh=0;static Th=new Int32Array(1e3);static Eh=!1;static br(t){try{z.head=new v(t.read('ob_head.dat')),z.Hr=new v(t.read('ob_face1.dat')),z.Yr=new v(t.read('ob_face2.dat')),z.Vr=new v(t.read('ob_face3.dat')),z.Xr=new v(t.read('ob_face4.dat')),z.jr=new v(t.read('ob_face5.dat')),z.zr=new v(t.read('ob_point1.dat')),z.Zr=new v(t.read('ob_point2.dat')),z.qr=new v(t.read('ob_point3.dat')),z.Kr=new v(t.read('ob_point4.dat')),z.Jr=new v(t.read('ob_point5.dat')),z.$r=new v(t.read('ob_vertex1.dat')),z.Qr=new v(t.read('ob_vertex2.dat')),z.axis=new v(t.read('ob_axis.dat')),z.head.Jt=0,z.zr.Jt=0,z.Zr.Jt=0,z.qr.Jt=0,z.Kr.Jt=0,z.$r.Jt=0,z.Qr.Jt=0;const e=z.head.ie;z.metadata=new S(e+100,null);let i=0,s=0,n=0,r=0,h=0,l=0,o=0;for(let t=0;t<e;t++){const t=z.head.ie,e=new X;e.Er=z.head.ie,e.vr=z.head.ie,e.Lr=z.head.te,e.Sr=z.zr.Jt,e.Or=z.Zr.Jt,e.kr=z.qr.Jt,e.Rr=z.Kr.Jt,e.Fr=z.$r.Jt,e.Dr=z.Qr.Jt;const a=z.head.te,c=z.head.te,f=z.head.te,u=z.head.te,d=z.head.te;for(let t=0;t<e.Er;t++){const t=z.zr.te;0!=(1&t)&&z.Zr.le,0!=(2&t)&&z.qr.le,0!=(4&t)&&z.Kr.le}for(let t=0;t<e.vr;t++){1===z.Qr.te&&(z.$r.le,z.$r.le),z.$r.le}e.Nr=n,n+=2*e.vr,1===a&&(e.Ur=r,r+=e.vr),255===c?(e.Pr=h,h+=e.vr):e.Pr=-c-1,1===f&&(e.Br=l,l+=e.vr),1===u&&(e.Wr=o,o+=e.vr),1===d&&(e.Mr=s,s+=e.Er),e.Gr=i,i+=e.Lr,z.metadata[t]=e}}catch(t){console.log('Error loading model index'),console.error(t)}}static Lh(t,e){if(null===z.metadata&&(z.metadata=[]),null===t){const t=new X;return t.Er=0,t.vr=0,t.Lr=0,void(z.metadata[e]=t)}const i=new v(t);i.Jt=i.length-18;const s=new X;s.data=t,s.Er=i.ie,s.vr=i.ie,s.Lr=i.te,z.metadata[e]=s;const n=i.te,r=i.te,h=i.te,l=i.te,o=i.te,a=i.ie,c=i.ie,f=i.ie,u=i.ie;let d=0;s.Sr=d,d+=s.Er,s.Dr=d,d+=s.vr,s.Pr=d,255===r?d+=s.vr:s.Pr=-r-1,s.Wr=d,1===l?d+=s.vr:s.Wr=-1,s.Ur=d,1===n?d+=s.vr:s.Ur=-1,s.Mr=d,1===o?d+=s.Er:s.Mr=-1,s.Br=d,1===h?d+=s.vr:s.Br=-1,s.Fr=d,d+=u,s.Nr=d,d+=2*s.vr,s.Gr=d,d+=6*s.Lr,s.Or=d,d+=a,s.kr=d,d+=c,s.Rr=d,d+=f}static $e(){z.metadata=null,z.head=null,z.Hr=null,z.Yr=null,z.Vr=null,z.Xr=null,z.jr=null,z.zr=null,z.Zr=null,z.qr=null,z.Kr=null,z.Jr=null,z.$r=null,z.Qr=null,z.axis=null,z.th=null,z.eh=null,z.ih=null,z.sh=null,z.nh=null,z.rh=null,z.hh=null,z.lh=null,z.oh=null,z.ah=null,z.fh=null,z.uh=null,z.dh=null,z.wh=null,z.yh=null}static Sh(t,e,i){return 2==(2&i)?(e<0?e=0:e>127&&(e=127),127-e):((e=e*(127&t)>>7)<2?e=2:e>126&&(e=126),(65408&t)+e)}static Oh=(t,e,i)=>{const s=t.Er,n=t.vr,r=t.Lr;let h,l,o,a,c;if(e){h=new Int32Array(s);for(let e=0;e<s;e++)h[e]=t.kh[e]}else h=t.kh;let f=null,u=null;if(i){l=new Int32Array(n),o=new Int32Array(n),a=new Int32Array(n);for(let e=0;e<n;e++)t.Rh&&(l[e]=t.Rh[e]),t.xh&&(o[e]=t.xh[e]),t.Mh&&(a[e]=t.Mh[e]);if(c=new Int32Array(n),t.Fh)for(let e=0;e<n;e++)c[e]=t.Fh[e];else for(let t=0;t<n;t++)c[t]=0;f=new S(s,null);for(let e=0;e<s;e++){const i=f[e]=new j;if(t.Dh){const s=t.Dh[e];s&&(i.x=s.x,i.y=s.y,i.z=s.z,i.w=s.w)}}u=t.Nh}else l=t.Rh,o=t.xh,a=t.Mh,c=t.Fh;return new z({Er:s,Uh:t.Uh,kh:h,Ph:t.Ph,vr:n,Bh:t.Bh,Wh:t.Wh,Gh:t.Gh,Rh:l,xh:o,Mh:a,Fh:c,Hh:t.Hh,Yh:t.Yh,Vh:t.Vh,priority:t.priority,Lr:r,Xh:t.Xh,jh:t.jh,zh:t.zh,Zh:t.Zh,qh:t.qh,Kh:t.Kh,Jh:t.Jh,$h:t.$h,Qh:t.Qh,tl:t.tl,el:t.el,il:t.il,Dh:f,Nh:u})};static sl=(t,e,i,s)=>{const n=t.Er,r=t.vr,h=t.Lr;let l,o,a,c,f;if(s)l=t.Uh,o=t.kh,a=t.Ph;else{l=new Int32Array(n),o=new Int32Array(n),a=new Int32Array(n);for(let e=0;e<n;e++)l[e]=t.Uh[e],o[e]=t.kh[e],a[e]=t.Ph[e]}if(e)c=t.Vh;else{c=new Int32Array(r);for(let e=0;e<r;e++)t.Vh&&(c[e]=t.Vh[e])}if(i)f=t.Yh;else if(f=new Int32Array(r),t.Yh)for(let e=0;e<r;e++)f[e]=t.Yh[e];else for(let t=0;t<r;t++)f[t]=0;return new z({Er:n,Uh:l,kh:o,Ph:a,vr:r,Bh:t.Bh,Wh:t.Wh,Gh:t.Gh,Rh:null,xh:null,Mh:null,Fh:t.Fh,Hh:t.Hh,Yh:f,Vh:c,priority:t.priority,Lr:h,Xh:t.Xh,jh:t.jh,zh:t.zh,nl:t.nl,rl:t.rl})};static hl=(t,e)=>{const i=t.Er,s=t.vr,n=t.Lr,r=new Int32Array(i),h=new Int32Array(i),l=new Int32Array(i);for(let e=0;e<i;e++)r[e]=t.Uh[e],h[e]=t.kh[e],l[e]=t.Ph[e];let o;if(e)o=t.Yh;else if(o=new Int32Array(s),t.Yh)for(let e=0;e<s;e++)o[e]=t.Yh[e];else for(let t=0;t<s;t++)o[t]=0;return new z({Er:i,Uh:r,kh:h,Ph:l,vr:s,Bh:t.Bh,Wh:t.Wh,Gh:t.Gh,Rh:t.Rh,xh:t.xh,Mh:t.Mh,Fh:t.Fh,Hh:t.Hh,Yh:o,Vh:t.Vh,priority:t.priority,Lr:n,Xh:t.Xh,jh:t.jh,zh:t.zh,ll:t.ll,ol:t.ol})};static al=(t,e)=>{let i=!1,s=!1,n=!1,r=!1,h=0,l=0,o=0,a=-1;for(let c=0;c<e;c++){const e=t[c];e&&(h+=e.Er,l+=e.vr,o+=e.Lr,i||=null!==e.Fh,e.Hh?s=!0:(-1===a&&(a=e.priority),a!==e.priority&&(s=!0)),n||=null!==e.Yh,r||=null!==e.Vh)}const c=new Int32Array(h),f=new Int32Array(h),u=new Int32Array(h),d=new Int32Array(l),w=new Int32Array(l),y=new Int32Array(l),m=new Int32Array(l),p=new Int32Array(l),A=new Int32Array(l),I=new Int32Array(o),g=new Int32Array(o),_=new Int32Array(o);let C=null;i&&(C=new Int32Array(l));let b=null;s&&(b=new Int32Array(l));let T=null;n&&(T=new Int32Array(l));let E=null;r&&(E=new Int32Array(l)),h=0,l=0,o=0;for(let a=0;a<e;a++){const e=t[a];if(e){const t=h;for(let t=0;t<e.Er;t++)c[h]=e.Uh[t],f[h]=e.kh[t],u[h]=e.Ph[t],h++;for(let h=0;h<e.vr;h++)d[l]=e.Bh[h]+t,w[l]=e.Wh[h]+t,y[l]=e.Gh[h]+t,e.Rh&&(m[l]=e.Rh[h]),e.xh&&(p[l]=e.xh[h]),e.Mh&&(A[l]=e.Mh[h]),i&&(e.Fh?C&&(C[l]=e.Fh[h]):C&&(C[l]=0)),s&&(e.Hh?b&&(b[l]=e.Hh[h]):b&&(b[l]=e.priority)),n&&(e.Yh?T&&(T[l]=e.Yh[h]):T&&(T[l]=0)),r&&e.Vh&&E&&(E[l]=e.Vh[h]),l++;for(let i=0;i<e.Lr;i++)I[o]=e.Xh[i]+t,g[o]=e.jh[i]+t,_[o]=e.zh[i]+t,o++}}const v=new z({Er:h,Uh:c,kh:f,Ph:u,vr:l,Bh:d,Wh:w,Gh:y,Rh:m,xh:p,Mh:A,Fh:C,Hh:b,Yh:T,Vh:E,priority:a,Lr:o,Xh:I,jh:g,zh:_});return v.cl(),v};static fl=(t,e)=>{let i=!1,s=!1,n=!1,r=!1,h=0,l=0,o=0,a=-1;for(let c=0;c<e;c++){const e=t[c];e&&(h+=e.Er,l+=e.vr,o+=e.Lr,i||=null!==e.Fh,e.Hh?s=!0:(-1===a&&(a=e.priority),a!==e.priority&&(s=!0)),n||=null!==e.Yh,r||=null!==e.rl)}const c=new Int32Array(h),f=new Int32Array(h),u=new Int32Array(h),d=new Int32Array(h),w=new Int32Array(l),y=new Int32Array(l),m=new Int32Array(l),p=new Int32Array(o),A=new Int32Array(o),I=new Int32Array(o);let g=null;i&&(g=new Int32Array(l));let _=null;s&&(_=new Int32Array(l));let C=null;n&&(C=new Int32Array(l));let b=null;r&&(b=new Int32Array(l));const T=new Int32Array(l);h=0,l=0,o=0;const E=(t,e,i,s,n,r,h)=>{let l=-1;const o=t.Uh[e],a=t.kh[e],c=t.Ph[e];for(let t=0;t<h;t++)if(o===i[t]&&a===s[t]&&c===n[t]){l=t;break}return-1===l&&(i[h]=o,s[h]=a,n[h]=c,r&&t.nl&&(r[h]=t.nl[e]),l=h++),{vertex:l,Er:h}};for(let a=0;a<e;a++){const e=t[a];if(e){for(let t=0;t<e.vr;t++){i&&(e.Fh?g&&(g[l]=e.Fh[t]):g&&(g[l]=0)),s&&(e.Hh?_&&(_[l]=e.Hh[t]):_&&(_[l]=e.priority)),n&&(e.Yh?C&&(C[l]=e.Yh[t]):C&&(C[l]=0)),r&&e.rl&&b&&(b[l]=e.rl[t]),e.Vh&&(T[l]=e.Vh[t]);const o=E(e,e.Bh[t],c,f,u,d,h);h=o.Er;const a=E(e,e.Wh[t],c,f,u,d,h);h=a.Er;const p=E(e,e.Gh[t],c,f,u,d,h);h=p.Er,w[l]=o.vertex,y[l]=a.vertex,m[l]=p.vertex,l++}for(let t=0;t<e.Lr;t++){const i=E(e,e.Xh[t],c,f,u,d,h);h=i.Er;const s=E(e,e.jh[t],c,f,u,d,h);h=s.Er;const n=E(e,e.zh[t],c,f,u,d,h);h=n.Er,p[o]=i.vertex,A[o]=s.vertex,I[o]=n.vertex,o++}}}return new z({Er:h,Uh:c,kh:f,Ph:u,vr:l,Bh:w,Wh:y,Gh:m,Rh:null,xh:null,Mh:null,Fh:g,Hh:_,Yh:C,Vh:T,priority:a,Lr:o,Xh:p,jh:A,zh:I,nl:d,rl:b})};static model=t=>{if(!z.metadata)throw new Error('cant loading model metadata!!!!!');const e=z.metadata[t];if(!e)throw console.log(`Error model:${t} not found!`),new Error('cant loading model metadata!!!!!');if(!(z.head&&z.Hr&&z.Yr&&z.Vr&&z.Xr&&z.jr&&z.zr&&z.Zr&&z.qr&&z.Kr&&z.Jr&&z.$r&&z.Qr&&z.axis))throw new Error('cant loading model!!!!!');const i=e.Er,s=e.vr,n=e.Lr,r=new Int32Array(i),h=new Int32Array(i),l=new Int32Array(i),o=new Int32Array(s),a=new Int32Array(s),c=new Int32Array(s),f=new Int32Array(n),u=new Int32Array(n),d=new Int32Array(n);let w=null;e.Mr>=0&&(w=new Int32Array(i));let y=null;e.Ur>=0&&(y=new Int32Array(s));let m=null,p=0;e.Pr>=0?m=new Int32Array(s):p=-e.Pr-1;let A=null;e.Br>=0&&(A=new Int32Array(s));let I=null;e.Wr>=0&&(I=new Int32Array(s));const g=new Int32Array(s);z.zr.Jt=e.Sr,z.Zr.Jt=e.Or,z.qr.Jt=e.kr,z.Kr.Jt=e.Rr,z.Jr.Jt=e.Mr;let _,C,b,T=0,E=0,v=0;for(let t=0;t<i;t++){const e=z.zr.te;_=0,0!=(1&e)&&(_=z.Zr.le),C=0,0!=(2&e)&&(C=z.qr.le),b=0,0!=(4&e)&&(b=z.Kr.le),r[t]=T+_,h[t]=E+C,l[t]=v+b,T=r[t],E=h[t],v=l[t],w&&(w[t]=z.Jr.te)}z.Hr.Jt=e.Nr,z.Yr.Jt=e.Ur,z.Vr.Jt=e.Pr,z.Xr.Jt=e.Br,z.jr.Jt=e.Wr;for(let t=0;t<s;t++)g[t]=z.Hr.ie,y&&(y[t]=z.Yr.te),m&&(m[t]=z.Vr.te),A&&(A[t]=z.Xr.te),I&&(I[t]=z.jr.te);z.$r.Jt=e.Fr,z.Qr.Jt=e.Dr,_=0,C=0,b=0;let L=0;for(let t=0;t<s;t++){const e=z.Qr.te;if(1===e)_=z.$r.le+L,L=_,C=z.$r.le+L,L=C,b=z.$r.le+L,L=b;else if(2===e)C=b,b=z.$r.le+L,L=b;else if(3===e)_=b,b=z.$r.le+L,L=b;else if(4===e){const t=_;_=C,C=t,b=z.$r.le+L,L=b}o[t]=_,a[t]=C,c[t]=b}z.axis.Jt=6*e.Gr;for(let t=0;t<n;t++)f[t]=z.axis.ie,u[t]=z.axis.ie,d[t]=z.axis.ie;return new z({Er:i,Uh:r,kh:h,Ph:l,vr:s,Bh:o,Wh:a,Gh:c,Rh:null,xh:null,Mh:null,Fh:y,Hh:m,Yh:A,Vh:g,priority:p,Lr:n,Xh:f,jh:u,zh:d,nl:w,rl:I})};static ul=(t,e)=>{if(!z.metadata||!z.metadata[e])throw new Error('No model metadata');const i=z.metadata[e];if(i.data=t,!i.data.length)throw new Error('No model data');const s=i.Er,n=i.vr,r=i.Lr,h=new Int32Array(s),l=new Int32Array(s),o=new Int32Array(s),a=new Int32Array(n),c=new Int32Array(n),f=new Int32Array(n),u=new Int32Array(r),d=new Int32Array(r),w=new Int32Array(r);let y=null;i.Mr>=0&&(y=new Int32Array(s));let m=null;i.Ur>=0&&(m=new Int32Array(n));let p=null,A=0;i.Pr>=0?p=new Int32Array(n):A=-i.Pr-1;let I=null;i.Br>=0&&(I=new Int32Array(n));let g=null;i.Wr>=0&&(g=new Int32Array(n));const _=new Int32Array(n),C=new v(i.data);C.Jt=i.Sr;const b=new v(i.data);b.Jt=i.Or;const T=new v(i.data);T.Jt=i.kr;const E=new v(i.data);E.Jt=i.Rr;const L=new v(i.data);L.Jt=i.Mr;let S,O,k,R=0,x=0,M=0;for(let t=0;t<s;t++){const e=C.te;S=0,0!=(1&e)&&(S=b.le),O=0,0!=(2&e)&&(O=T.le),k=0,0!=(4&e)&&(k=E.le),h[t]=R+S,l[t]=x+O,o[t]=M+k,R=h[t],x=l[t],M=o[t],y&&(y[t]=L.te)}const F=new v(i.data);F.Jt=i.Nr;const D=new v(i.data);D.Jt=i.Ur;const N=new v(i.data);N.Jt=i.Pr;const U=new v(i.data);U.Jt=i.Br;const P=new v(i.data);P.Jt=i.Wr;for(let t=0;t<n;t++)_[t]=F.ie,m&&(m[t]=D.te),p&&(p[t]=N.te),I&&(I[t]=U.te),g&&(g[t]=P.te);const B=new v(i.data);B.Jt=i.Fr;const W=new v(i.data);W.Jt=i.Dr,S=0,O=0,k=0;let G=0;for(let t=0;t<n;t++){const e=W.te;if(1===e)S=B.le+G,G=S,O=B.le+G,G=O,k=B.le+G,G=k;else if(2===e)O=k,k=B.le+G,G=k;else if(3===e)S=k,k=B.le+G,G=k;else if(4===e){const t=S;S=O,O=t,k=B.le+G,G=k}a[t]=S,c[t]=O,f[t]=k}const H=new v(i.data);H.Jt=6*i.Gr;for(let t=0;t<r;t++)u[t]=H.ie,d[t]=H.ie,w[t]=H.ie;return new z({Er:s,Uh:h,kh:l,Ph:o,vr:n,Bh:a,Wh:c,Gh:f,Rh:null,xh:null,Mh:null,Fh:m,Hh:p,Yh:I,Vh:_,priority:A,Lr:r,Xh:u,jh:d,zh:w,nl:y,rl:g})};Er;Uh;kh;Ph;vr;Bh;Wh;Gh;Rh;xh;Mh;Fh;Hh;Yh;Vh;priority;Lr;Xh;jh;zh;Zh;qh;Kh;Jh;$h;Qh;tl;el;il;nl;rl;ll;ol;Dh;Nh;dl=0;wl=!1;yl=-1;ml=-1;constructor(t){super(),this.Er=t.Er,this.Uh=t.Uh,this.kh=t.kh,this.Ph=t.Ph,this.vr=t.vr,this.Bh=t.Bh,this.Wh=t.Wh,this.Gh=t.Gh,this.Rh=t.Rh,this.xh=t.xh,this.Mh=t.Mh,this.Fh=t.Fh,this.Hh=t.Hh,this.Yh=t.Yh,this.Vh=t.Vh,this.priority=t.priority,this.Lr=t.Lr,this.Xh=t.Xh,this.jh=t.jh,this.zh=t.zh,this.Zh=t.Zh??0,this.qh=t.qh??0,this.Kh=t.Kh??0,this.Jh=t.Jh??0,this.$h=t.$h??0,this.Qh=t.Qh??0,this.tl=t.tl??0,this.el=t.el??0,this.il=t.il??0,this.nl=t.nl??null,this.rl=t.rl??null,this.ll=t.ll??null,this.ol=t.ol??null,this.Dh=t.Dh??null,this.Nh=t.Nh??null}cl=()=>{this.tl=0,this.$h=0,this.Qh=0;for(let t=0;t<this.Er;t++){const e=this.Uh[t],i=this.kh[t],s=this.Ph[t];-i>this.tl&&(this.tl=-i),i>this.Qh&&(this.Qh=i);const n=e*e+s*s;n>this.$h&&(this.$h=n)}this.$h=Math.sqrt(this.$h)+.99|0,this.il=Math.sqrt(this.$h*this.$h+this.tl*this.tl)+.99|0,this.el=this.il+(Math.sqrt(this.$h*this.$h+this.Qh*this.Qh)+.99|0)};pl=()=>{this.tl=0,this.Qh=0;for(let t=0;t<this.Er;t++){const e=this.kh[t];-e>this.tl&&(this.tl=-e),e>this.Qh&&(this.Qh=e)}this.il=Math.sqrt(this.$h*this.$h+this.tl*this.tl)+.99|0,this.el=this.il+(Math.sqrt(this.$h*this.$h+this.Qh*this.Qh)+.99|0)};Al=()=>{if(this.nl){const t=new Int32Array(256);let e=0;for(let i=0;i<this.Er;i++){const s=this.nl[i];t[s]++,s>e&&(e=s)}this.ll=new S(e+1,null);for(let i=0;i<=e;i++)this.ll[i]=new Int32Array(t[i]),t[i]=0;let i=0;for(;i<this.Er;){const e=this.nl[i],s=this.ll[e];s&&(s[t[e]++]=i++)}this.nl=null}if(this.rl){const t=new Int32Array(256);let e=0;for(let i=0;i<this.vr;i++){const s=this.rl[i];t[s]++,s>e&&(e=s)}this.ol=new S(e+1,null);for(let i=0;i<=e;i++)this.ol[i]=new Int32Array(t[i]),t[i]=0;let i=0;for(;i<this.vr;){const e=this.rl[i],s=this.ol[e];s&&(s[t[e]++]=i++)}this.rl=null}};Il=(t,e,i)=>{if(-1!==t)if(i&&-1!==e){const s=V.Cr[t],n=V.Cr[e],r=s.$;z.Ih=0,z.gh=0,z._h=0;let h=0,l=i[h++];for(let t=0;t<s.length;t++){if(!s.Tr)continue;const e=s.Tr[t];for(;e>l;)l=i[h++];r&&r.types&&s.x&&s.y&&s.z&&r.labels&&(e!==l||0===r.types[e])&&this.gl(s.x[t],s.y[t],s.z[t],r.labels[e],r.types[e])}z.Ih=0,z.gh=0,z._h=0,h=0,l=i[h++];for(let t=0;t<n.length;t++){if(!n.Tr)continue;const e=n.Tr[t];for(;e>l;)l=i[h++];r&&r.types&&n.x&&n.y&&n.z&&r.labels&&(e===l||0===r.types[e])&&this.gl(n.x[t],n.y[t],n.z[t],r.labels[e],r.types[e])}}else this._l(t)};_l=t=>{if(!this.ll||-1===t||!V.Cr[t])return;const e=V.Cr[t],i=e.$;z.Ih=0,z.gh=0,z._h=0;for(let t=0;t<e.length;t++){if(!(e.Tr&&e.x&&e.y&&e.z&&i&&i.labels&&i.types))continue;const s=e.Tr[t];this.gl(e.x[t],e.y[t],e.z[t],i.labels[s],i.types[s])}};Cl=()=>{for(let t=0;t<this.Er;t++){const e=this.Uh[t];this.Uh[t]=this.Ph[t],this.Ph[t]=-e}};bl=t=>{const e=D.sin[t],i=D.cos[t];for(let t=0;t<this.Er;t++){const s=this.kh[t]*i-this.Ph[t]*e>>16;this.Ph[t]=this.kh[t]*e+this.Ph[t]*i>>16,this.kh[t]=s}};translate=(t,e,i)=>{for(let s=0;s<this.Er;s++)this.Uh[s]+=e,this.kh[s]+=t,this.Ph[s]+=i};Tl=(t,e)=>{if(this.Vh)for(let i=0;i<this.vr;i++)this.Vh[i]===t&&(this.Vh[i]=e)};El=()=>{for(let t=0;t<this.Er;t++)this.Ph[t]=-this.Ph[t];for(let t=0;t<this.vr;t++){const e=this.Bh[t];this.Bh[t]=this.Gh[t],this.Gh[t]=e}};scale=(t,e,i)=>{for(let s=0;s<this.Er;s++)this.Uh[s]=this.Uh[s]*t/128|0,this.kh[s]=this.kh[s]*e/128|0,this.Ph[s]=this.Ph[s]*i/128|0};vl=(t,e,i,s,n,r)=>{const h=e*(0|Math.sqrt(i*i+s*s+n*n))>>8;if(this.Rh&&this.xh&&this.Mh||(this.Rh=new Int32Array(this.vr),this.xh=new Int32Array(this.vr),this.Mh=new Int32Array(this.vr)),!this.Dh){this.Dh=new S(this.Er,null);for(let t=0;t<this.Er;t++)this.Dh[t]=new j}for(let e=0;e<this.vr;e++){const r=this.Bh[e],l=this.Wh[e],o=this.Gh[e],a=this.Uh[l]-this.Uh[r],c=this.kh[l]-this.kh[r],f=this.Ph[l]-this.Ph[r],u=this.Uh[o]-this.Uh[r],d=this.kh[o]-this.kh[r],w=this.Ph[o]-this.Ph[r];let y=c*w-d*f,m=f*u-w*a,p=a*d-u*c;for(;y>8192||m>8192||p>8192||y<-8192||m<-8192||p<-8192;)y>>=1,m>>=1,p>>=1;let A=0|Math.sqrt(y*y+m*m+p*p);if(A<=0&&(A=1),y=256*y/A|0,m=256*m/A|0,p=256*p/A|0,this.Fh&&0!=(1&this.Fh[e])){const r=t+((i*y+s*m+n*p)/(h+(h/2|0))|0);this.Vh&&(this.Rh[e]=z.Sh(this.Vh[e],r,this.Fh[e]))}else{let t=this.Dh[r];t&&(t.x+=y,t.y+=m,t.z+=p,t.w++),t=this.Dh[l],t&&(t.x+=y,t.y+=m,t.z+=p,t.w++),t=this.Dh[o],t&&(t.x+=y,t.y+=m,t.z+=p,t.w++)}}if(r)this.Ll(t,h,i,s,n);else{this.Nh=new S(this.Er,null);for(let t=0;t<this.Er;t++){const e=this.Dh[t],i=new j;e&&(i.x=e.x,i.y=e.y,i.z=e.z,i.w=e.w),this.Nh[t]=i}}r?this.cl():this.Sl()};Ll=(t,e,i,s,n)=>{for(let r=0;r<this.vr;r++){const h=this.Bh[r],l=this.Wh[r],o=this.Gh[r];if(!this.Fh&&this.Vh&&this.Dh&&this.Rh&&this.xh&&this.Mh){const a=this.Vh[r],c=this.Dh[h];c&&(this.Rh[r]=z.Sh(a,t+((i*c.x+s*c.y+n*c.z)/(e*c.w)|0),0));const f=this.Dh[l];f&&(this.xh[r]=z.Sh(a,t+((i*f.x+s*f.y+n*f.z)/(e*f.w)|0),0));const u=this.Dh[o];u&&(this.Mh[r]=z.Sh(a,t+((i*u.x+s*u.y+n*u.z)/(e*u.w)|0),0))}else if(this.Fh&&0==(1&this.Fh[r])&&this.Vh&&this.Dh&&this.Rh&&this.xh&&this.Mh){const a=this.Vh[r],c=this.Fh[r],f=this.Dh[h];f&&(this.Rh[r]=z.Sh(a,t+((i*f.x+s*f.y+n*f.z)/(e*f.w)|0),c));const u=this.Dh[l];u&&(this.xh[r]=z.Sh(a,t+((i*u.x+s*u.y+n*u.z)/(e*u.w)|0),c));const d=this.Dh[o];d&&(this.Mh[r]=z.Sh(a,t+((i*d.x+s*d.y+n*d.z)/(e*d.w)|0),c))}}if(this.Dh=null,this.Nh=null,this.nl=null,this.rl=null,this.Fh)for(let t=0;t<this.vr;t++)if(2==(2&this.Fh[t]))return;this.Vh=null};Ol=(t,e,i,s,n,r,h)=>{const l=D.sin[t],o=D.cos[t],a=D.sin[e],c=D.cos[e],f=D.sin[i],u=D.cos[i],d=D.sin[s],w=D.cos[s],y=r*d+h*w>>16;for(let s=0;s<this.Er;s++){let m,p=this.Uh[s],A=this.kh[s],I=this.Ph[s];0!==i&&(m=A*f+p*u>>16,A=A*u-p*f>>16,p=m),0!==t&&(m=A*o-I*l>>16,I=A*l+I*o>>16,A=m),0!==e&&(m=I*a+p*c>>16,I=I*c-p*a>>16,p=m),p+=n,A+=r,I+=h,m=A*w-I*d>>16,I=A*d+I*w>>16,A=m,z.ih&&z.sh&&z.nh&&(z.nh[s]=I-y,z.ih[s]=D.Be+((p<<9)/I|0),z.sh[s]=D.We+((A<<9)/I|0)),this.Lr>0&&z.rh&&z.hh&&z.lh&&(z.rh[s]=p,z.hh[s]=A,z.lh[s]=I)}try{this.kl(!1,!1,0)}catch(t){}};draw=(t,e,i,s,n,r,h,l,o)=>{const a=l*n-r*s>>16,c=h*e+a*i>>16,f=this.$h*i>>16,u=c+f;if(u<=50||c>=3500)return;const d=l*s+r*n>>16;let w=d-this.$h<<9;if((w/u|0)>=m.bt)return;let y=d+this.$h<<9;if((y/u|0)<=-m.bt)return;const p=h*i-a*e>>16,A=this.$h*e>>16;let I=p+A<<9;if((I/u|0)<=-m.Tt)return;let g=p-(A+(this.tl*i>>16))<<9;if((g/u|0)>=m.Tt)return;let _=c-(f+(this.tl*e>>16))<=50,C=!1;if(o>0&&z.Ch){let t=c-f;t<=50&&(t=50),d>0?(w=w/u|0,y=y/t|0):(y=y/u|0,w=w/t|0),p>0?(g=g/u|0,I=I/t|0):(I=I/u|0,g=g/t|0);const e=z.Gn-D.Be,i=z.Hn-D.We;e>w&&e<y&&i>g&&i<I&&(this.wl?z.Th[z.bh++]=o:C=!0)}const b=D.Be,T=D.We;let E=0,v=0;0!==t&&(E=D.sin[t],v=D.cos[t]);for(let o=0;o<this.Er;o++){let a,f=this.Uh[o],u=this.kh[o],d=this.Ph[o];0!==t&&(a=d*E+f*v>>16,d=d*v-f*E>>16,f=a),f+=r,u+=h,d+=l,a=d*s+f*n>>16,d=d*n-f*s>>16,f=a,a=u*i-d*e>>16,d=u*e+d*i>>16,u=a,z.nh&&(z.nh[o]=d-c),d>=50&&z.ih&&z.sh?(z.ih[o]=b+((f<<9)/d|0),z.sh[o]=T+((u<<9)/d|0)):z.ih&&(z.ih[o]=-5e3,_=!0),(_||this.Lr>0)&&z.rh&&z.hh&&z.lh&&(z.rh[o]=f,z.hh[o]=u,z.lh[o]=d)}try{this.kl(_,C,o)}catch(t){}};kl=(t,e,i,s=!1)=>{z.Eh&&(this.yl=-1,this.ml=-1);for(let t=0;t<this.el;t++)z.oh&&(z.oh[t]=0);for(let s=0;s<this.vr;s++)if((!this.Fh||-1!==this.Fh[s])&&z.ih&&z.sh&&z.nh&&z.ah&&z.oh){const n=this.Bh[s],r=this.Wh[s],h=this.Gh[s],l=z.ih[n],o=z.ih[r],a=z.ih[h],c=z.sh[n],f=z.sh[r],u=z.sh[h],d=z.nh[n],w=z.nh[r],y=z.nh[h];if(!t||-5e3!==l&&-5e3!==o&&-5e3!==a){e&&this.Rl(z.Gn,z.Hn,c,f,u,l,o,a)&&(z.Th[z.bh++]=i,e=!1);if((l-o)*(u-f)-(c-f)*(a-o)<=0)continue;if(z.eh&&(z.eh[s]=!1),z.th&&(z.th[s]=l<0||o<0||a<0||l>m.Ct||o>m.Ct||a>m.Ct),z.ah&&z.oh){const t=((d+w+y)/3|0)+this.il;z.ah[t][z.oh[t]++]=s,z.Eh&&this.Rl(z.Gn,z.Hn,c,f,u,l,o,a)&&this.ml<t&&(this.yl=s,this.ml=t)}}else if(z.eh&&(z.eh[s]=!0),z.ah&&z.oh){const t=((d+w+y)/3|0)+this.il;z.ah[t][z.oh[t]++]=s}}if(!this.Hh&&z.oh){for(let t=this.el-1;t>=0;t--){const e=z.oh[t];if(!(e<=0)&&z.ah){const i=z.ah[t];for(let t=0;t<e;t++)this.xl(i[t],s)}}return}for(let t=0;t<12;t++)z.fh&&z.yh&&(z.fh[t]=0,z.yh[t]=0);if(z.oh)for(let t=this.el-1;t>=0;t--){const e=z.oh[t];if(e>0&&z.ah){const i=z.ah[t];for(let s=0;s<e;s++)if(this.Hh&&z.fh&&z.uh){const e=i[s],n=this.Hh[e],r=z.fh[n]++;z.uh[n][r]=e,n<10&&z.yh?z.yh[n]+=t:10===n&&z.dh?z.dh[r]=t:z.wh&&(z.wh[r]=t)}}}let n=0;z.fh&&z.yh&&(z.fh[1]>0||z.fh[2]>0)&&(n=(z.yh[1]+z.yh[2])/(z.fh[1]+z.fh[2])|0);let r=0;z.fh&&z.yh&&(z.fh[3]>0||z.fh[4]>0)&&(r=(z.yh[3]+z.yh[4])/(z.fh[3]+z.fh[4])|0);let h=0;if(z.fh&&z.yh&&(z.fh[6]>0||z.fh[8]>0)&&(h=(z.yh[6]+z.yh[8])/(z.fh[6]+z.fh[8])|0),z.fh&&z.uh){let t,e=0,i=z.fh[10],l=z.uh[10],o=z.dh;e===i&&(e=0,i=z.fh[11],l=z.uh[11],o=z.wh),t=e<i&&o?o[e]:-1e3;for(let a=0;a<10;a++){for(;0===a&&t>n;)this.xl(l[e++],s),e===i&&l!==z.uh[11]&&(e=0,i=z.fh[11],l=z.uh[11],o=z.wh),t=e<i&&o?o[e]:-1e3;for(;3===a&&t>r;)this.xl(l[e++],s),e===i&&l!==z.uh[11]&&(e=0,i=z.fh[11],l=z.uh[11],o=z.wh),t=e<i&&o?o[e]:-1e3;for(;5===a&&t>h;)this.xl(l[e++],s),e===i&&l!==z.uh[11]&&(e=0,i=z.fh[11],l=z.uh[11],o=z.wh),t=e<i&&o?o[e]:-1e3;const c=z.fh[a],f=z.uh[a];for(let t=0;t<c;t++)this.xl(f[t],s)}for(;-1e3!==t;)this.xl(l[e++],s),e===i&&l!==z.uh[11]&&(e=0,l=z.uh[11],i=z.fh[11],o=z.wh),t=e<i&&o?o[e]:-1e3}};xl=(t,e=!1)=>{if(z.eh&&z.eh[t])return void this.Ml(t,e);const i=this.Bh[t],s=this.Wh[t],n=this.Gh[t];let r;if(z.th&&(D.He=z.th[t]),this.Yh?D.alpha=this.Yh[t]:D.alpha=0,r=this.Fh?3&this.Fh[t]:0,e&&z.ih&&z.sh&&this.Rh&&this.xh&&this.Mh)D.kt(z.ih[i],z.sh[i],z.ih[s],z.sh[s],D.palette[this.Rh[t]]),D.kt(z.ih[s],z.sh[s],z.ih[n],z.sh[n],D.palette[this.xh[t]]),D.kt(z.ih[n],z.sh[n],z.ih[i],z.sh[i],D.palette[this.Mh[t]]);else if(0===r&&this.Rh&&this.xh&&this.Mh&&z.ih&&z.sh)D.oi(z.ih[i],z.ih[s],z.ih[n],z.sh[i],z.sh[s],z.sh[n],this.Rh[t],this.xh[t],this.Mh[t]);else if(1===r&&this.Rh&&z.ih&&z.sh)D.ci(z.ih[i],z.ih[s],z.ih[n],z.sh[i],z.sh[s],z.sh[n],D.palette[this.Rh[t]]);else if(2===r&&this.Fh&&this.Vh&&this.Rh&&this.xh&&this.Mh&&z.ih&&z.sh&&z.rh&&z.hh&&z.lh){const e=this.Fh[t]>>2,r=this.Xh[e],h=this.jh[e],l=this.zh[e];D.ui(z.ih[i],z.ih[s],z.ih[n],z.sh[i],z.sh[s],z.sh[n],this.Rh[t],this.xh[t],this.Mh[t],z.rh[r],z.hh[r],z.lh[r],z.rh[h],z.rh[l],z.hh[h],z.hh[l],z.lh[h],z.lh[l],this.Vh[t])}else if(3===r&&this.Fh&&this.Vh&&this.Rh&&z.ih&&z.sh&&z.rh&&z.hh&&z.lh){const e=this.Fh[t]>>2,r=this.Xh[e],h=this.jh[e],l=this.zh[e];D.ui(z.ih[i],z.ih[s],z.ih[n],z.sh[i],z.sh[s],z.sh[n],this.Rh[t],this.Rh[t],this.Rh[t],z.rh[r],z.hh[r],z.lh[r],z.rh[h],z.rh[l],z.hh[h],z.hh[l],z.lh[h],z.lh[l],this.Vh[t])}};Ml=(t,e=!1)=>{let i=0;if(z.lh){const e=D.Be,s=D.We,n=this.Bh[t],r=this.Wh[t],h=this.Gh[t],l=z.lh[n],o=z.lh[r],a=z.lh[h];if(l>=50&&z.ih&&z.sh&&this.Rh)z.mh[i]=z.ih[n],z.ph[i]=z.sh[n],z.Ah[i++]=this.Rh[t];else if(z.rh&&z.hh&&this.Rh){const c=z.rh[n],f=z.hh[n],u=this.Rh[t];if(a>=50&&this.Mh){const n=(50-l)*D.De[a-l];z.mh[i]=e+((c+((z.rh[h]-c)*n>>16)<<9)/50|0),z.ph[i]=s+((f+((z.hh[h]-f)*n>>16)<<9)/50|0),z.Ah[i++]=u+((this.Mh[t]-u)*n>>16)}if(o>=50&&this.xh){const n=(50-l)*D.De[o-l];z.mh[i]=e+((c+((z.rh[r]-c)*n>>16)<<9)/50|0),z.ph[i]=s+((f+((z.hh[r]-f)*n>>16)<<9)/50|0),z.Ah[i++]=u+((this.xh[t]-u)*n>>16)}}if(o>=50&&z.ih&&z.sh&&this.xh)z.mh[i]=z.ih[r],z.ph[i]=z.sh[r],z.Ah[i++]=this.xh[t];else if(z.rh&&z.hh&&this.xh){const c=z.rh[r],f=z.hh[r],u=this.xh[t];if(l>=50&&this.Rh){const r=(50-o)*D.De[l-o];z.mh[i]=e+((c+((z.rh[n]-c)*r>>16)<<9)/50|0),z.ph[i]=s+((f+((z.hh[n]-f)*r>>16)<<9)/50|0),z.Ah[i++]=u+((this.Rh[t]-u)*r>>16)}if(a>=50&&this.Mh){const n=(50-o)*D.De[a-o];z.mh[i]=e+((c+((z.rh[h]-c)*n>>16)<<9)/50|0),z.ph[i]=s+((f+((z.hh[h]-f)*n>>16)<<9)/50|0),z.Ah[i++]=u+((this.Mh[t]-u)*n>>16)}}if(a>=50&&z.ih&&z.sh&&this.Mh)z.mh[i]=z.ih[h],z.ph[i]=z.sh[h],z.Ah[i++]=this.Mh[t];else if(z.rh&&z.hh&&this.Mh){const c=z.rh[h],f=z.hh[h],u=this.Mh[t];if(o>=50&&this.xh){const n=(50-a)*D.De[o-a];z.mh[i]=e+((c+((z.rh[r]-c)*n>>16)<<9)/50|0),z.ph[i]=s+((f+((z.hh[r]-f)*n>>16)<<9)/50|0),z.Ah[i++]=u+((this.xh[t]-u)*n>>16)}if(l>=50&&this.Rh){const r=(50-a)*D.De[l-a];z.mh[i]=e+((c+((z.rh[n]-c)*r>>16)<<9)/50|0),z.ph[i]=s+((f+((z.hh[n]-f)*r>>16)<<9)/50|0),z.Ah[i++]=u+((this.Rh[t]-u)*r>>16)}}}const s=z.mh[0],n=z.mh[1],r=z.mh[2],h=z.ph[0],l=z.ph[1],o=z.ph[2];if(!((s-n)*(o-l)-(h-l)*(r-n)<=0))if(D.He=!1,3===i){let i;if((s<0||n<0||r<0||s>m.Ct||n>m.Ct||r>m.Ct)&&(D.He=!0),i=this.Fh?3&this.Fh[t]:0,e)D.kt(s,n,h,l,z.Ah[0]),D.kt(n,r,l,o,z.Ah[1]),D.kt(r,s,o,h,z.Ah[2]);else if(0===i)D.oi(s,n,r,h,l,o,z.Ah[0],z.Ah[1],z.Ah[2]);else if(1===i&&this.Rh)D.ci(s,n,r,h,l,o,D.palette[this.Rh[t]]);else if(2===i&&this.Fh&&this.Vh&&z.rh&&z.hh&&z.lh){const e=this.Fh[t]>>2,i=this.Xh[e],a=this.jh[e],c=this.zh[e];D.ui(s,n,r,h,l,o,z.Ah[0],z.Ah[1],z.Ah[2],z.rh[i],z.hh[i],z.lh[i],z.rh[a],z.rh[c],z.hh[a],z.hh[c],z.lh[a],z.lh[c],this.Vh[t])}else if(3===i&&this.Fh&&this.Vh&&this.Rh&&z.rh&&z.hh&&z.lh){const e=this.Fh[t]>>2,i=this.Xh[e],a=this.jh[e],c=this.zh[e];D.ui(s,n,r,h,l,o,this.Rh[t],this.Rh[t],this.Rh[t],z.rh[i],z.hh[i],z.lh[i],z.rh[a],z.rh[c],z.hh[a],z.hh[c],z.lh[a],z.lh[c],this.Vh[t])}}else if(4===i){let i;if((s<0||n<0||r<0||s>m.Ct||n>m.Ct||r>m.Ct||z.mh[3]<0||z.mh[3]>m.Ct)&&(D.He=!0),i=this.Fh?3&this.Fh[t]:0,e)D.kt(s,n,h,l,z.Ah[0]),D.kt(n,r,l,o,z.Ah[1]),D.kt(r,z.mh[3],o,z.ph[3],z.Ah[2]),D.kt(z.mh[3],s,z.ph[3],h,z.Ah[3]);else if(0===i)D.oi(s,n,r,h,l,o,z.Ah[0],z.Ah[1],z.Ah[2]),D.oi(s,r,z.mh[3],h,o,z.ph[3],z.Ah[0],z.Ah[2],z.Ah[3]);else if(1===i){if(this.Rh){const e=D.palette[this.Rh[t]];D.ci(s,n,r,h,l,o,e),D.ci(s,r,z.mh[3],h,o,z.ph[3],e)}}else if(2===i&&this.Fh&&this.Vh&&z.rh&&z.hh&&z.lh){const e=this.Fh[t]>>2,i=this.Xh[e],a=this.jh[e],c=this.zh[e];D.ui(s,n,r,h,l,o,z.Ah[0],z.Ah[1],z.Ah[2],z.rh[i],z.hh[i],z.lh[i],z.rh[a],z.rh[c],z.hh[a],z.hh[c],z.lh[a],z.lh[c],this.Vh[t]),D.ui(s,r,z.mh[3],h,o,z.ph[3],z.Ah[0],z.Ah[2],z.Ah[3],z.rh[i],z.hh[i],z.lh[i],z.rh[a],z.rh[c],z.hh[a],z.hh[c],z.lh[a],z.lh[c],this.Vh[t])}else if(3===i&&this.Fh&&this.Vh&&this.Rh&&z.rh&&z.hh&&z.lh){const e=this.Fh[t]>>2,i=this.Xh[e],a=this.jh[e],c=this.zh[e];D.ui(s,n,r,h,l,o,this.Rh[t],this.Rh[t],this.Rh[t],z.rh[i],z.hh[i],z.lh[i],z.rh[a],z.rh[c],z.hh[a],z.hh[c],z.lh[a],z.lh[c],this.Vh[t]),D.ui(s,r,z.mh[3],h,o,z.ph[3],this.Rh[t],this.Rh[t],this.Rh[t],z.rh[i],z.hh[i],z.lh[i],z.rh[a],z.rh[c],z.hh[a],z.hh[c],z.lh[a],z.lh[c],this.Vh[t])}}};gl=(t,e,i,s,n)=>{if(!s)return;const r=s.length;if(0===n){let n=0;z.Ih=0,z.gh=0,z._h=0;for(let t=0;t<r;t++){if(!this.ll)continue;const e=s[t];if(e<this.ll.length){const t=this.ll[e];if(t)for(let e=0;e<t.length;e++){const i=t[e];z.Ih+=this.Uh[i],z.gh+=this.kh[i],z._h+=this.Ph[i],n++}}}n>0?(z.Ih=(z.Ih/n|0)+t,z.gh=(z.gh/n|0)+e,z._h=(z._h/n|0)+i):(z.Ih=t,z.gh=e,z._h=i)}else if(1===n)for(let n=0;n<r;n++){const r=s[n];if(!this.ll||r>=this.ll.length)continue;const h=this.ll[r];if(h)for(let s=0;s<h.length;s++){const n=h[s];this.Uh[n]+=t,this.kh[n]+=e,this.Ph[n]+=i}}else if(2===n)for(let n=0;n<r;n++){const r=s[n];if(!this.ll||r>=this.ll.length)continue;const h=this.ll[r];if(h)for(let s=0;s<h.length;s++){const n=h[s];this.Uh[n]-=z.Ih,this.kh[n]-=z.gh,this.Ph[n]-=z._h;const r=8*(255&t),l=8*(255&e),o=8*(255&i);let a,c;if(0!==o){a=D.sin[o],c=D.cos[o];const t=this.kh[n]*a+this.Uh[n]*c>>16;this.kh[n]=this.kh[n]*c-this.Uh[n]*a>>16,this.Uh[n]=t}if(0!==r){a=D.sin[r],c=D.cos[r];const t=this.kh[n]*c-this.Ph[n]*a>>16;this.Ph[n]=this.kh[n]*a+this.Ph[n]*c>>16,this.kh[n]=t}if(0!==l){a=D.sin[l],c=D.cos[l];const t=this.Ph[n]*a+this.Uh[n]*c>>16;this.Ph[n]=this.Ph[n]*c-this.Uh[n]*a>>16,this.Uh[n]=t}this.Uh[n]+=z.Ih,this.kh[n]+=z.gh,this.Ph[n]+=z._h}}else if(3===n)for(let n=0;n<r;n++){const r=s[n];if(!this.ll||r>=this.ll.length)continue;const h=this.ll[r];if(h)for(let s=0;s<h.length;s++){const n=h[s];this.Uh[n]-=z.Ih,this.kh[n]-=z.gh,this.Ph[n]-=z._h,this.Uh[n]=this.Uh[n]*t/128|0,this.kh[n]=this.kh[n]*e/128|0,this.Ph[n]=this.Ph[n]*i/128|0,this.Uh[n]+=z.Ih,this.kh[n]+=z.gh,this.Ph[n]+=z._h}}else if(5===n&&this.ol&&this.Yh)for(let e=0;e<r;e++){const i=s[e];if(i>=this.ol.length)continue;const n=this.ol[i];if(n)for(let e=0;e<n.length;e++){const i=n[e];this.Yh[i]+=8*t,this.Yh[i]<0&&(this.Yh[i]=0),this.Yh[i]>255&&(this.Yh[i]=255)}}};Sl=()=>{this.tl=0,this.$h=0,this.Qh=0,this.Zh=999999,this.qh=-999999,this.Jh=-99999,this.Kh=99999;for(let t=0;t<this.Er;t++){const e=this.Uh[t],i=this.kh[t],s=this.Ph[t];e<this.Zh&&(this.Zh=e),e>this.qh&&(this.qh=e),s<this.Kh&&(this.Kh=s),s>this.Jh&&(this.Jh=s),-i>this.tl&&(this.tl=-i),i>this.Qh&&(this.Qh=i);const n=e*e+s*s;n>this.$h&&(this.$h=n)}this.$h=0|Math.sqrt(this.$h),this.il=0|Math.sqrt(this.$h*this.$h+this.tl*this.tl),this.el=this.il+(0|Math.sqrt(this.$h*this.$h+this.Qh*this.Qh))};Rl=(t,e,i,s,n,r,h,l)=>!(e<i&&e<s&&e<n)&&(!(e>i&&e>s&&e>n)&&(!(t<r&&t<h&&t<l)&&(t<=r||t<=h||t<=l)));Fl=t=>{if(!(z.ih&&z.sh&&this.Rh&&this.xh&&this.Mh))return;const e=this.Bh[t],i=this.Wh[t],s=this.Gh[t];D.kt(z.ih[e],z.sh[e],z.ih[i],z.sh[i],D.palette[1e3]),D.kt(z.ih[i],z.sh[i],z.ih[s],z.sh[s],D.palette[1e3]),D.kt(z.ih[s],z.sh[s],z.ih[e],z.sh[e],D.palette[1e3])}}class Z{head;constructor(){this.head=new y}push=t=>{t.yt&&t.At(),t.yt=this.head.yt,t.wt=this.head,t.yt&&(t.yt.wt=t),t.wt.yt=t};pop=()=>{const t=this.head.wt;return t===this.head?null:(t?.At(),t)}}class q{size;Dl;constructor(t){this.size=t,this.Dl=[];for(let e=0;e<t;e++)this.Dl[e]=new w}get=t=>{const e=this.Dl[Number(t&BigInt(this.size-1))];if(!e.ut)return null;for(let i=e.ut;i!==e;i=i.ut)if(i&&i.id===t)return i;return null};put=(t,e)=>{e.next&&e.dt();const i=this.Dl[Number(t&BigInt(this.size-1))];e.next=i.next,e.ut=i,e.next&&(e.next.ut=e),e.ut.next=e,e.id=t}}class K{Nl;Ul;history;available;constructor(t){this.Nl=t,this.available=t,this.Ul=new q(1024),this.history=new Z}get=t=>{const e=this.Ul.get(t);return e&&this.history.push(e),e};put=(t,e)=>{if(0===this.available){const t=this.history.pop();t?.dt(),t?.At()}else this.available--;this.Ul.put(t,e),this.history.push(e)};clear=()=>{const t=this.history.pop();t?(t.dt(),t.At()):this.available=this.Nl}}class J extends y{It;width;height;be;Te;Ee;ve;constructor(t,e){super(),this.It=new Int32Array(t*e),this.width=this.Ee=t,this.height=this.ve=e,this.be=this.Te=0}static Pl=async(t,e)=>{const i=t.read(e+'.dat');if(!i)throw new Error(`${e} jpeg not found!`);const s=await(async t=>{255!==t[0]&&(t[0]=255),URL.revokeObjectURL(g.src),g.src=URL.createObjectURL(new Blob([t],{type:'image/jpeg'})),await new Promise((t=>g.onload=()=>t())),_.clearRect(0,0,I.width,I.height);const e=g.naturalWidth,i=g.naturalHeight;return I.width=e,I.height=i,_.drawImage(g,0,0),_.getImageData(0,0,e,i)})(i),n=new J(s.width,s.height),r=n.It,h=s.data;for(let t=0;t<r.length;t++){const e=4*t;r[t]=h[e+3]<<24|h[e]<<16|h[e+1]<<8|h[e+2]<<0}return n};static Le=(t,e,i=0)=>{const s=new v(t.read(e+'.dat')),n=new v(t.read('index.dat'));n.Jt=s.ie;const r=n.ie,h=n.ie,l=[],o=n.te-1;for(let t=0;t<o;t++)l[t+1]=n.ne,0===l[t+1]&&(l[t+1]=1);for(let t=0;t<i;t++)n.Jt+=2,s.Jt+=n.ie*n.ie,n.Jt+=1;if(s.Jt>s.data.length||n.Jt>n.data.length)throw new Error;const a=n.te,c=n.te,f=n.ie,u=n.ie,d=new J(f,u);d.be=a,d.Te=c,d.Ee=r,d.ve=h;const w=n.te;if(0===w){const t=d.width*d.height;for(let e=0;e<t;e++)d.It[e]=l[s.te]}else if(1===w){const t=d.width;for(let e=0;e<t;e++){const i=d.height;for(let n=0;n<i;n++)d.It[e+n*t]=l[s.te]}}return d};bind=()=>{m.bind(this.It,this.width,this.height)};draw=(t,e)=>{t|=0,e|=0;let i=(t+=this.be)+(e+=this.Te)*m.gt,s=0,n=this.height,r=this.width,h=m.gt-r,l=0;if(e<m.top){const t=m.top-e;n-=t,e=m.top,s+=t*r,i+=t*m.gt}if(e+n>m.bottom&&(n-=e+n-m.bottom),t<m.left){const e=m.left-t;r-=e,t=m.left,s+=e,i+=e,l+=e,h+=e}if(t+r>m.right){const e=t+r-m.right;r-=e,l+=e,h+=e}r>0&&n>0&&this.Bl(r,n,this.It,s,l,m.It,i,h)};Wl=(t,e,i)=>{e|=0,i|=0;let s=(e+=this.be)+(i+=this.Te)*m.gt,n=0,r=this.height,h=this.width,l=m.gt-h,o=0;if(i<m.top){const t=m.top-i;r-=t,i=m.top,n+=t*h,s+=t*m.gt}if(i+r>m.bottom&&(r-=i+r-m.bottom),e<m.left){const t=m.left-e;h-=t,e=m.left,n+=t,s+=t,o+=t,l+=t}if(e+h>m.right){const t=e+h-m.right;h-=t,o+=t,l+=t}h>0&&r>0&&this.Gl(h,r,this.It,n,o,m.It,s,l,t)};Hl=(t,e)=>{t|=0,e|=0;let i=(t+=this.be)+(e+=this.Te)*m.gt,s=0,n=this.height,r=this.width,h=m.gt-r,l=0;if(e<m.top){const t=m.top-e;n-=t,e=m.top,s+=t*r,i+=t*m.gt}if(e+n>m.bottom&&(n-=e+n-m.bottom),t<m.left){const e=m.left-t;r-=e,t=m.left,s+=e,i+=e,l+=e,h+=e}if(t+r>m.right){const e=t+r-m.right;r-=e,l+=e,h+=e}r>0&&n>0&&this.Yl(r,n,this.It,s,l,m.It,i,h)};Oe=()=>{const t=this.It,e=this.width,i=this.height;for(let s=0;s<i;s++){const i=e/2|0;for(let n=0;n<i;n++){const i=n+s*e,r=e-n-1+s*e,h=t[i];t[i]=t[r],t[r]=h}}};ke=()=>{const t=this.It,e=this.width,i=this.height;for(let s=0;s<(i/2|0);s++)for(let n=0;n<e;n++){const r=n+s*e,h=n+(i-s-1)*e,l=t[r];t[r]=t[h],t[h]=l}};translate=(t,e,i)=>{for(let s=0;s<this.It.length;s++){const n=this.It[s];if(0!==n){let r=n>>16&255;r+=t,r<1?r=1:r>255&&(r=255);let h=n>>8&255;h+=e,h<1?h=1:h>255&&(h=255);let l=255&n;l+=i,l<1?l=1:l>255&&(l=255),this.It[s]=(r<<16)+(h<<8)+l}}};xe=(t,e,i,s)=>{t|=0,e|=0,i|=0,s|=0;try{const n=this.width;let r=0,h=0;const l=this.Ee,o=this.ve,a=(l<<16)/i|0,c=(o<<16)/s|0;t+=(this.be*i+l-1)/l|0,e+=(this.Te*s+o-1)/o|0,this.be*i%l!=0&&(r=(l-this.be*i%l<<16)/i|0),this.Te*s%o!=0&&(h=(o-this.Te*s%o<<16)/s|0),i=i*(this.width-(r>>16))/l|0,s=s*(this.height-(h>>16))/o|0;let f=t+e*m.gt,u=m.gt-i;if(e<m.top){const t=m.top-e;s-=t,e=0,f+=t*m.gt,h+=c*t}if(e+s>m.bottom&&(s-=e+s-m.bottom),t<m.left){const e=m.left-t;i-=e,t=0,f+=e,r+=a*e,u+=e}if(t+i>m.right){const e=t+i-m.right;i-=e,u+=e}this.scale(i,s,this.It,r,h,m.It,u,f,n,a,c)}catch(t){console.error('error in sprite clipping routine')}};Vl=(t,e,i,s,n,r,h,l,o,a)=>{t|=0,e|=0,i|=0,s|=0;try{const c=-i/2|0,f=-s/2|0,u=65536*Math.sin(o/326.11)|0,d=65536*Math.cos(o/326.11)|0,w=u*a>>8,y=d*a>>8;let p=(h<<16)+f*w+c*y,A=f*y-c*w+(l<<16),I=t+e*m.gt;for(let t=0;t<s;t++){const e=n[t];let i=I+e,s=p+y*e,h=A-w*e;for(let e=-r[t];e<0;e++)m.It[i++]=this.It[(s>>16)+(h>>16)*this.width],s+=y,h-=w;p+=w,A+=y,I+=m.gt}}catch(t){}};Xl=(t,e,i)=>{t|=0,e|=0;let s=(t+=this.be)+(e+=this.Te)*m.gt,n=0,r=this.height,h=this.width,l=m.gt-h,o=0;if(e<m.top){const t=m.top-e;r-=t,e=m.top,n+=t*h,s+=t*m.gt}if(e+r>m.bottom&&(r-=e+r-m.bottom),t<m.left){const e=m.left-t;h-=e,t=m.left,n+=e,s+=e,o+=e,l+=e}if(t+h>m.right){const e=t+h-m.right;h-=e,o+=e,l+=e}h>0&&r>0&&this.jl(h,r,this.It,o,n,m.It,s,l,i.It)};scale=(t,e,i,s,n,r,h,l,o,a,c)=>{try{const f=s;for(let u=-e;u<0;u++){const e=(n>>16)*o;for(let n=-t;n<0;n++){const t=i[(s>>16)+e];0===t?l++:r[l++]=t,s+=a}n+=c,s=f,l+=h}}catch(t){console.error('error in plot_scale')}};Yl=(t,e,i,s,n,r,h,l)=>{const o=-(t>>2);t=-(3&t);for(let a=-e;a<0;a++){for(let t=o;t<0;t++)r[h++]=i[s++],r[h++]=i[s++],r[h++]=i[s++],r[h++]=i[s++];for(let e=t;e<0;e++)r[h++]=i[s++];h+=l,s+=n}};Gl=(t,e,i,s,n,r,h,l,o)=>{const a=256-o;for(let c=-e;c<0;c++){for(let e=-t;e<0;e++){const t=i[s++];if(0===t)h++;else{const e=r[h];r[h++]=((16711935&t)*o+(16711935&e)*a&4278255360)+((65280&t)*o+(65280&e)*a&16711680)>>8}}h+=l,s+=n}};Bl=(t,e,i,s,n,r,h,l)=>{const o=-(t>>2);t=-(3&t);for(let a=-e;a<0;a++){for(let t=o;t<0;t++){let t=i[s++];0===t?h++:r[h++]=t,t=i[s++],0===t?h++:r[h++]=t,t=i[s++],0===t?h++:r[h++]=t,t=i[s++],0===t?h++:r[h++]=t}for(let e=t;e<0;e++){const t=i[s++];0===t?h++:r[h++]=t}h+=l,s+=n}};jl=(t,e,i,s,n,r,h,l,o)=>{const a=-(t>>2);t=-(3&t);for(let c=-e;c<0;c++){for(let t=a;t<0;t++){let t=i[n++];0!==t&&0===o[h]?r[h++]=t:h++,t=i[n++],0!==t&&0===o[h]?r[h++]=t:h++,t=i[n++],0!==t&&0===o[h]?r[h++]=t:h++,t=i[n++],0!==t&&0===o[h]?r[h++]=t:h++}for(let e=t;e<0;e++){const t=i[n++];0!==t&&0===o[h]?r[h++]=t:h++}h+=l,n+=s}}}class ${static zl=['_','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','0','1','2','3','4','5','6','7','8','9'];static Zl=t=>{t=t.trim();let e=0n;for(let i=0;i<t.length&&i<12;i++){const s=t.charCodeAt(i);e*=37n,s>=65&&s<=90?e+=BigInt(s+1-65):s>=97&&s<=122?e+=BigInt(s+1-97):s>=48&&s<=57&&(e+=BigInt(s+27-48))}return e};static ql=t=>{if(t<0n||t>=6582952005840035281n)return'invalid_name';if(t%37n===0n)return'invalid_name';let e=0;const i=Array(12);for(;0n!==t;){const s=t;t/=37n,i[11-e++]=this.zl[Number(s-37n*t)]}return i.slice(12-e).join('')};static Kl=t=>{const e=[...t.toLowerCase()];let i=!0;for(let t=0;t<e.length;t++){const s=e[t];i&&s>='a'&&s<='z'&&(e[t]=s.toUpperCase(),i=!1),'.'!==s&&'!'!==s||(i=!0)}return e.join('')};static Jl=t=>{let e='';for(let i=0;i<t.length;i++)e+='*';return e};static $l=t=>(t>>24&255)+'.'+(t>>16&255)+'.'+(t>>8&255)+'.'+(255&t);static Ql=t=>{if(0===t.length)return t;const e=[...t];for(let t=0;t<e.length;t++)'_'===e[t]&&(e[t]=' ',t+1<e.length&&e[t+1]>='a'&&e[t+1]<='z'&&(e[t+1]=String.fromCharCode(e[t+1].charCodeAt(0)+'A'.charCodeAt(0)-97)));return e[0]>='a'&&e[0]<='z'&&(e[0]=String.fromCharCode(e[0].charCodeAt(0)+'A'.charCodeAt(0)-97)),e.join('')};static eo=t=>{const e=t.toUpperCase();let i=0n;for(let t=0;t<e.length;t++)i=61n*i+BigInt(e.charCodeAt(t))-32n,i=i+(i>>56n)&0xffffffffffffffn;return i}}class Q{static Cr=[];static io=null;static so=null;static no=0;static ro=1;static ho=2;static lo=3;static oo=4;static ao=5;static co=6;static fo=7;static uo=1;static do=2;static wo=3;static yo=4;static mo=5;static po=6;static Ao=1;static Io=100;static _o=101;static Co=200;static bo=201;static To=202;static Eo=203;static vo=205;static Lo=300;static So=301;static Oo=302;static ko=303;static Ro=304;static xo=305;static Mo=306;static Fo=307;static Do=308;static No=309;static Uo=310;static Po=311;static Bo=312;static Wo=313;static Go=314;static Ho=315;static Yo=316;static Vo=317;static Xo=318;static jo=319;static zo=320;static Zo=321;static qo=322;static Ko=323;static Jo=324;static $o=325;static Qo=326;static ta=327;static ea=401;static ia=500;static sa=501;static na=502;static ra=503;static ha=600;static la=601;static oa=602;static aa=603;static ca=604;static fa=605;static ua=606;static da=607;static wa=608;static ya=609;static ma=610;static pa=611;static Aa=612;static Ia=613;static ga=650;static _a=651;static Ca=652;static ba=653;static Ta=654;static Ea=655;static br=(t,e,i)=>{this.io=new K(5e4),this.so=new K(5e4);const s=new v(t.read('data'));let n=-1;for(s.Jt+=2;s.Jt<s.data.length;){let t=s.ie;65535===t&&(n=s.ie,t=s.ie);const r=this.Cr[t]=new Q;r.id=t,r.va=n,r.type=s.te,r.La=s.te,r.Sa=s.ie,r.width=s.ie,r.height=s.ie,r.Oa=s.te,0===r.Oa?r.Oa=-1:r.Oa=(r.Oa-1<<8)+s.te;const h=s.te;if(h>0){r.ka=new Uint8Array(h),r.Ra=new Uint16Array(h);for(let t=0;t<h;t++)r.ka[t]=s.te,r.Ra[t]=s.ie}const l=s.te;if(l>0){r.scripts=new S(l,null);for(let t=0;t<l;t++){const e=s.ie,i=new Uint16Array(e);r.scripts[t]=i;for(let t=0;t<e;t++)i[t]=s.ie}}if(r.type===Q.no){r.scroll=s.ie,r.hide=1===s.te;const t=s.te;r.xa=new Array(t),r.Ma=new Array(t),r.Fa=new Array(t);for(let e=0;e<t;e++)r.xa[e]=s.ie,r.Ma[e]=s.se,r.Fa[e]=s.se}if(r.type===Q.ro&&(s.Jt+=3),r.type===Q.ho){r.Da=new Int32Array(r.width*r.height),r.Na=new Int32Array(r.width*r.height),r.draggable=1===s.te,r.Ua=1===s.te,r.Pa=1===s.te,r.Ba=s.te,r.Wa=s.te,r.Ga=new Int16Array(20),r.Ha=new Int16Array(20),r.Ya=new S(20,null);for(let t=0;t<20;t++)if(1===s.te){r.Ga[t]=s.se,r.Ha[t]=s.se;const i=s.ae;if(i.length>0){const s=i.lastIndexOf(',');r.Ya[t]=this.Va(e,i.substring(0,s),parseInt(i.substring(s+1),10))}}r.Xa=new S(5,null);for(let t=0;t<5;t++){const e=s.ae;r.Xa[t]=e,0===e.length&&(r.Xa[t]=null)}}if(r.type===Q.lo&&(r.fill=1===s.te),r.type===Q.oo||r.type===Q.ro){r.ja=1===s.te;const t=s.te;i&&(r.font=i[t]),r.za=1===s.te}if(r.type===Q.oo&&(r.text=s.ae,r.Za=s.ae),r.type!==Q.ro&&r.type!==Q.lo&&r.type!==Q.oo||(r.qa=s.re),r.type!==Q.lo&&r.type!==Q.oo||(r.Ka=s.re,r.Ja=s.re),r.type===Q.ao){const t=s.ae;if(t.length>0){const i=t.lastIndexOf(',');r.$a=this.Va(e,t.substring(0,i),parseInt(t.substring(i+1),10))}const i=s.ae;if(i.length>0){const t=i.lastIndexOf(',');r.Qa=this.Va(e,i.substring(0,t),parseInt(i.substring(t+1),10))}}if(r.type===Q.co){const t=s.te;0!==t&&(r.model=this.tc((t-1<<8)+s.te));const e=s.te;0!==e&&(r.ec=this.tc((e-1<<8)+s.te)),r.ic=s.te,0===r.ic?r.ic=-1:r.ic=(r.ic-1<<8)+s.te,r.sc=s.te,0===r.sc?r.sc=-1:r.sc=(r.sc-1<<8)+s.te,r.zoom=s.ie,r.nc=s.ie,r.rc=s.ie}if(r.type===Q.fo){r.Da=new Int32Array(r.width*r.height),r.Na=new Int32Array(r.width*r.height),r.ja=1===s.te;const t=s.te;i&&(r.font=i[t]),r.za=1===s.te,r.qa=s.re,r.Ba=s.se,r.Wa=s.se,r.Ua=1===s.te,r.Xa=new S(5,null);for(let t=0;t<5;t++){const e=s.ae;r.Xa[t]=e,0===e.length&&(r.Xa[t]=null)}}r.La!==Q.do&&r.type!==Q.ho||(r.hc=s.ae,r.action=s.ae,r.lc=s.ie),r.La!==Q.uo&&r.La!==Q.yo&&r.La!==Q.mo&&r.La!==Q.po||(r.oc=s.ae,0===r.oc.length&&(r.La===Q.uo?r.oc='Ok':r.La===Q.yo||r.La===Q.mo?r.oc='Select':r.La===Q.po&&(r.oc='Continue')))}this.io=null,this.so=null};static Va=(t,e,i)=>{const s=$.eo(e)<<8n|BigInt(i);if(this.io){const t=this.io.get(s);if(t)return t}let n;try{n=J.Le(t,e,i),this.io?.put(s,n)}catch(t){return null}return n};static tc=t=>{if(this.so){const e=this.so.get(BigInt(t));if(e)return e}const e=z.model(t);return this.so?.put(BigInt(t),e),e};id=-1;va=-1;type=-1;La=-1;Sa=0;width=0;height=0;Oa=-1;ka=null;Ra=null;scripts=null;scroll=0;hide=!1;draggable=!1;Ua=!1;Pa=!1;Ba=0;Wa=0;Ga=null;Ha=null;Ya=null;Xa=null;fill=!1;ja=!1;font=null;za=!1;text=null;Za=null;qa=0;Ka=0;Ja=0;$a=null;Qa=null;model=null;ec=null;ic=-1;sc=-1;zoom=0;nc=0;rc=0;hc=null;action=null;lc=-1;oc=null;xa=null;Ma=null;Fa=null;x=0;y=0;ac=0;Da=null;Na=null;cc=0;fc=0;tc=(t,e,i)=>{let s=this.model;if(i&&(s=this.ec),!s)return null;if(-1===t&&-1===e&&!s.Vh)return s;const n=z.sl(s,!0,!0,!1);return-1===t&&-1===e||n.Al(),-1!==t&&n._l(t),-1!==e&&n._l(e),n.vl(64,768,-50,-10,-50,!0),n};uc(){if(this.va===this.id)return this.x;let t=Q.Cr[this.va];if(!t.xa||!t.Ma||!t.Fa)return this.x;let e=t.xa.indexOf(this.id);if(-1===e)return this.x;let i=t.Ma[e];for(;t.va!==t.id;){const s=Q.Cr[t.va];s.xa&&s.Ma&&s.Fa&&(e=s.xa.indexOf(t.id),-1!==e&&(i+=s.Ma[e])),t=s}return i}dc(){if(this.va===this.id)return this.y;let t=Q.Cr[this.va];if(!t.xa||!t.Ma||!t.Fa)return this.y;let e=t.xa.indexOf(this.id);if(-1===e)return this.y;let i=t.Fa[e];for(;t.va!==t.id;){const s=Q.Cr[t.va];s.xa&&s.Ma&&s.Fa&&(e=s.xa.indexOf(t.id),-1!==e&&(i+=s.Fa[e])),t=s}return i}outline(t){const e=this.uc(),i=this.dc();m.Lt(e,i,this.width,this.height,t)}move(t,e){if(this.va===this.id)return;this.x=0,this.y=0;const i=Q.Cr[this.va];if(i.xa&&i.Ma&&i.Fa){const s=i.xa.indexOf(this.id);-1!==s&&(i.Ma[s]=t,i.Fa[s]=e)}}delete(){if(this.va===this.id)return;const t=Q.Cr[this.va];if(t.xa&&t.Ma&&t.Fa){const e=t.xa.indexOf(this.id);-1!==e&&(t.xa.splice(e,1),t.Ma.splice(e,1),t.Fa.splice(e,1))}}}var tt,et=(tt="file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/tinymidipcm.mjs",function(t){var e,s,n=void 0!==(t=t||{})?t:{};n.ready=new Promise((function(t,i){e=t,s=i})),["_tsf_load_memory","_tsf_set_output","_tsf_channel_set_bank_preset","_tsf_set_max_voices","_tsf_channel_set_presetnumber","_tsf_reset","_tsf_close","_tml_load_memory","_midi_render","_malloc","_realloc","_free","_fflush","onRuntimeInitialized"].forEach((t=>{Object.getOwnPropertyDescriptor(n.ready,t)||Object.defineProperty(n.ready,t,{get:()=>j('You are getting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js'),set:()=>j('You are setting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js')})}));var r=Object.assign({},n),h=[],l='object'==typeof window,o='function'==typeof importScripts,a='object'==typeof process&&'object'==typeof process.versions&&'string'==typeof process.versions.node,c=!l&&!a&&!o;if(n.wc)throw new Error('Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)');var f,u,d,w='';if(a){if('undefined'==typeof process||!process.release||'node'!==process.release.name)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');var y,m;w=o?require('path').yc(w)+'/':__dirname+'/';var p=()=>{m||(y=require('fs'),m=require('path'))};f=(t,e)=>(p(),t=m.normalize(t),y.mc(t,e?void 0:'utf8')),d=t=>{var e=f(t,!0);return e.buffer||(e=new Uint8Array(e)),M(e.buffer),e},u=(t,e,i)=>{p(),t=m.normalize(t),y.Ac(t,(function(t,s){t?i(t):e(s.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,'/'),h=process.argv.slice(2),process.on('uncaughtException',(function(t){if(!(t instanceof nt))throw t})),process.on('unhandledRejection',(function(t){throw t})),n.Ic=function(){return'[Emscripten Module object]'}}else if(c){if('object'==typeof process&&'function'==typeof require||'object'==typeof window||'function'==typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');'undefined'!=typeof read&&(f=function(t){return read(t)}),d=function(t){let e;return'function'==typeof readbuffer?new Uint8Array(readbuffer(t)):(e=read(t,'binary'),M('object'==typeof e),e)},u=function(t,e,i){setTimeout((()=>e(d(t))),0)},'undefined'!=typeof scriptArgs?h=scriptArgs:void 0!==arguments&&(h=arguments),'undefined'!=typeof print&&('undefined'==typeof console&&(console={}),console.log=print,console.warn=console.error='undefined'!=typeof printErr?printErr:print)}else{if(!l&&!o)throw new Error('environment detection error');if(o?w=self.location.href:'undefined'!=typeof document&&document.currentScript&&(w=document.currentScript.src),tt&&(w=tt),w=0!==w.indexOf('blob:')?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf('/')+1):'','object'!=typeof window&&'function'!=typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');f=t=>{var e=new XMLHttpRequest;return e.open('GET',t,!1),e.send(null),e.responseText},o&&(d=t=>{var e=new XMLHttpRequest;return e.open('GET',t,!1),e.responseType='arraybuffer',e.send(null),new Uint8Array(e.response)}),u=(t,e,i)=>{var s=new XMLHttpRequest;s.open('GET',t,!0),s.responseType='arraybuffer',s.onload=()=>{200==s.status||0==s.status&&s.response?e(s.response):i()},s.onerror=i,s.send(null)}}n.print||console.log.bind(console);var A,I,g=n.gc||console.warn.bind(console);function _(t,e){Object.getOwnPropertyDescriptor(n,t)||Object.defineProperty(n,t,{configurable:!0,get:function(){j('Module.'+t+' has been replaced with plain '+e+' (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)')}})}function C(t){return'FS_createPath'===t||'FS_createDataFile'===t||'FS_createPreloadedFile'===t||'FS_unlink'===t||'addRunDependency'===t||'FS_createLazyFile'===t||'FS_createDevice'===t||'removeRunDependency'===t}Object.assign(n,r),r=null,A='fetchSettings',Object.getOwnPropertyDescriptor(n,A)&&j('`Module.'+A+'` was supplied but `'+A+'` not included in INCOMING_MODULE_JS_API'),n.arguments&&(h=n.arguments),_('arguments','arguments_'),n._c&&n._c,_('thisProgram','thisProgram'),n.Cc&&n.Cc,_('quit','quit_'),M(void 0===n.bc,'Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead'),M(void 0===n.Tc,'Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead'),M(void 0===n.Ec,'Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead'),M(void 0===n.vc,'Module.filePackagePrefixURL option was removed, use Module.locateFile instead'),M(void 0===n.read,'Module.read option was removed (modify read_ in JS)'),M(void 0===n.Lc,'Module.readAsync option was removed (modify readAsync in JS)'),M(void 0===n.Sc,'Module.readBinary option was removed (modify readBinary in JS)'),M(void 0===n.Oc,'Module.setWindowTitle option was removed (modify setWindowTitle in JS)'),M(void 0===n.kc,'Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY'),_('read','read_'),_('readAsync','readAsync'),_('readBinary','readBinary'),_('setWindowTitle','setWindowTitle'),M(!c,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable."),n.Rc&&(I=n.Rc),_('wasmBinary','wasmBinary');var b;n.xc;_('noExitRuntime','noExitRuntime'),'object'!=typeof WebAssembly&&j('no native wasm support detected');var T,E,v,L,S,O,k,R,x=!1;function M(t,e){t||j('Assertion failed'+(e?': '+e:''))}function F(t){T=t,n.Mc=E=new Int8Array(t),n.Fc=L=new Int16Array(t),n.Dc=S=new Int32Array(t),n.Nc=v=new Uint8Array(t),n.Uc=new Uint16Array(t),n.Pc=O=new Uint32Array(t),n.Bc=k=new Float32Array(t),n.Wc=R=new Float64Array(t)}'undefined'!=typeof TextDecoder&&new TextDecoder('utf8');var D=5242880;n.Gc&&M(D===n.Gc,'the stack size can no longer be determined at runtime');var N=n.Hc||16777216;function U(){if(!x){var t=ft(),e=O[t>>2],i=O[t+4>>2];34821223==e&&2310721022==i||j('Stack overflow! Stack cookie has been overwritten at 0x'+t.toString(16)+', expected hex dwords 0x89BACDFE and 0x2135467, but received 0x'+i.toString(16)+' 0x'+e.toString(16)),1668509029!==O[0]&&j('Runtime error: The application has corrupted its heap memory area (address zero)!')}}_('INITIAL_MEMORY','INITIAL_MEMORY'),M(N>=D,'INITIAL_MEMORY should be larger than TOTAL_STACK, was '+N+'! (TOTAL_STACK='+D+')'),M('undefined'!=typeof Int32Array&&'undefined'!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,'JS engine does not provide full typed array support'),M(!n.Yc,'Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally'),M(16777216==N,'Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically'),function(){var t=new Int16Array(1),e=new Int8Array(t.buffer);if(t[0]=25459,115!==e[0]||99!==e[1])throw'Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)'}();var P=[],B=[],W=[],G=!1;M(Math.imul,'This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),M(Math.fround,'This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),M(Math.clz32,'This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),M(Math.trunc,'This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill');var H=0,Y=null,V=null,X={};function j(t){n.Vc&&n.Vc(t),g(t='Aborted('+t+')'),x=!0;var e=new WebAssembly.RuntimeError(t);throw s(e),e}var z={error:function(){j('Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM')},init:function(){z.error()},Xc:function(){z.error()},jc:function(){z.error()},zc:function(){z.error()},open:function(){z.error()},Zc:function(){z.error()},qc:function(){z.error()},Kc:function(){z.error()},Jc:function(){z.error()},$c:function(){z.error()}};n.Qc=z.Xc,n.tf=z.jc;var Z,q,K,J,$='data:application/octet-stream;base64,';function Q(t){return t.startsWith($)}function et(t){return t.startsWith('file://')}function it(t,e){return function(){var i=t,s=e;return e||(s=n.ef),M(G,'native function `'+i+'` called before runtime initialization'),s[t]||M(s[t],'exported native function `'+i+'` not found'),s[t].apply(null,arguments)}}function st(t){try{if(t==Z&&I)return new Uint8Array(I);if(d)return d(t);throw"both async and sync fetching of the wasm failed"}catch(t){j(t)}}function nt(t){this.name='ExitStatus',this.message='Program terminated with exit('+t+')',this.status=t}function rt(t){for(;t.length>0;)t.shift()(n)}function ht(t){ht.if||(ht.if={}),ht.if[t]||(ht.if[t]=1,a&&(t='warning: '+t),g(t))}function lt(t){try{return b.sf(t-T.byteLength+65535>>>16),F(b.buffer),1}catch(e){g('emscripten_realloc_buffer: Attempted to grow heap from '+T.byteLength+' bytes to '+t+' bytes, but got error: '+e)}}n.nf?Q(Z='tinymidipcm.wasm')||(q=Z,Z=n.nf?n.nf(q,w):w+q):Z=new URL(i(5621),i.b).toString();var ot,at={rf:function(t,e,i){v.copyWithin(t,e,e+i)},hf:function(t){var e=v.length;M((t>>>=0)>e);var i,s,n=2147483648;if(t>n)return g('Cannot enlarge memory, asked to go up to '+t+' bytes, but the limit is '+n+' bytes!'),!1;for(var r=1;r<=4;r*=2){var h=e*(1+.2/r);h=Math.min(h,t+100663296);var l=Math.min(n,(i=Math.max(t,h))+((s=65536)-i%s)%s);if(lt(l))return!0}return g('Failed to grow the heap from '+e+' bytes to '+l+' bytes, not enough memory!'),!1}},ct=(function(){var t,e={l:at,lf:at};function i(t,e){var i,s=t.exports;n.ef=s,M(b=n.ef.memory,"memory not found in wasm exports"),F(b.buffer),M(n.ef.af,"table not found in wasm exports"),i=n.ef.cf,B.unshift(i),function(t){if(H--,n.ff&&n.ff(H),t?(M(X[t]),delete X[t]):g('warning: run dependency removed without ID'),0==H&&(null!==Y&&(clearInterval(Y),Y=null),V)){var e=V;V=null,e()}}('wasm-instantiate')}t='wasm-instantiate',H++,n.ff&&n.ff(H),t?(M(!X[t]),X[t]=1,null===Y&&'undefined'!=typeof setInterval&&(Y=setInterval((function(){if(x)return clearInterval(Y),void(Y=null);var t=!1;for(var e in X)t||(t=!0,g('still waiting on run dependencies:')),g('dependency: '+e);t&&g('(end of list)')}),1e4))):g('warning: run dependency added without ID');var r=n;function h(t){M(n===r,'the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?'),r=null,i(t.ot)}function c(t){return function(){if(!I&&(l||o)){if('function'==typeof fetch&&!et(Z))return fetch(Z,{credentials:'same-origin'}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+Z+"'";return t.arrayBuffer()})).catch((function(){return st(Z)}));if(u)return new Promise((function(t,e){u(Z,(function(e){t(new Uint8Array(e))}),e)}))}return Promise.resolve().then((function(){return st(Z)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(t){return t})).then(t,(function(t){g('failed to asynchronously prepare wasm: '+t),et(Z)&&g('warning: Loading from a file URI ('+Z+') is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing'),j(t)}))}if(n.uf)try{return n.uf(e,i)}catch(t){g('Module.instantiateWasm callback failed with error: '+t),s(t)}(I||'function'!=typeof WebAssembly.instantiateStreaming||Q(Z)||et(Z)||a||'function'!=typeof fetch?c(h):fetch(Z,{credentials:'same-origin'}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(h,(function(t){return g('wasm streaming compile failed: '+t),g('falling back to ArrayBuffer instantiation'),c(h)}))}))).catch(s)}(),n.df=it("__wasm_call_ctors"),n.wf=it("malloc"),n.yf=it("free"),n.mf=it("tsf_load_memory"),n.pf=it("tsf_close"),n.Af=it("tsf_reset"),n.If=it("tsf_set_output"),n.gf=it("tsf_set_max_voices"),n._f=it("realloc"),n.Cf=it("tsf_channel_set_presetnumber"),n.bf=it("tsf_channel_set_bank_preset"),n.Tf=it("tml_load_memory"),n.Ef=it("midi_render"),n.vf=it("__errno_location"),n.Lf=it("fflush"),n.Sf=function(){return(ct=n.Sf=n.ef.Of).apply(null,arguments)}),ft=(n.kf=function(){return(n.kf=n.ef.Rf).apply(null,arguments)},n.xf=function(){return(n.xf=n.ef.Mf).apply(null,arguments)},n.Ff=function(){return(ft=n.Ff=n.ef.Df).apply(null,arguments)});function ut(){var t;ct(),M(0==(3&(t=ft()))),O[t>>2]=34821223,O[t+4>>2]=2310721022,O[0]=1668509029}function dt(t){function i(){ot||(ot=!0,n.Nf=!0,x||(M(!G),G=!0,U(),rt(B),e(n),n.Uf&&n.Uf(),M(!n.Pf,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(U(),n.Bf)for('function'==typeof n.Bf&&(n.Bf=[n.Bf]);n.Bf.length;)t=n.Bf.shift(),W.unshift(t);var t;rt(W)}()))}t=t||h,H>0||(ut(),function(){if(n.Wf)for('function'==typeof n.Wf&&(n.Wf=[n.Wf]);n.Wf.length;)t=n.Wf.shift(),P.unshift(t);var t;rt(P)}(),H>0||(n.Gf?(n.Gf('Running...'),setTimeout((function(){setTimeout((function(){n.Gf('')}),1),i()}),1)):i(),U()))}if(n.Hf=it("stackSave"),n.Yf=it("stackRestore"),n.Vf=it("stackAlloc"),n.Xf=function(t,e,i="i8"){switch(i.endsWith('*')&&(i='*'),i){case'i1':case'i8':E[t>>0]=e;break;case'i16':L[t>>1]=e;break;case'i32':S[t>>2]=e;break;case'i64':J=[e>>>0,(K=e,+Math.abs(K)>=1?K>0?(0|Math.min(+Math.floor(K/4294967296),4294967295))>>>0:~~+Math.ceil((K-+(~~K>>>0))/4294967296)>>>0:0)],S[t>>2]=J[0],S[t+4>>2]=J[1];break;case'float':k[t>>2]=e;break;case'double':R[t>>3]=e;break;case'*':O[t>>2]=e;break;default:j('invalid type for setValue: '+i)}},n.jf=function(t,e="i8"){switch(e.endsWith('*')&&(e='*'),e){case'i1':case'i8':return E[t>>0];case'i16':return L[t>>1];case'i32':case'i64':return S[t>>2];case'float':return k[t>>2];case'double':return R[t>>3];case'*':return O[t>>2];default:j('invalid type for getValue: '+e)}return null},['run','UTF8ArrayToString','UTF8ToString','stringToUTF8Array','stringToUTF8','lengthBytesUTF8','addOnPreRun','addOnInit','addOnPreMain','addOnExit','addOnPostRun','addRunDependency','removeRunDependency','FS_createFolder','FS_createPath','FS_createDataFile','FS_createPreloadedFile','FS_createLazyFile','FS_createLink','FS_createDevice','FS_unlink','getLEB','getFunctionTables','alignFunctionTables','registerFunctions','prettyPrint','getCompilerSetting','print','printErr','callMain','abort','keepRuntimeAlive','wasmMemory','stackAlloc','stackSave','stackRestore','getTempRet0','setTempRet0','writeStackCookie','checkStackCookie','ptrToString','zeroMemory','stringToNewUTF8','exitJS','getHeapMax','emscripten_realloc_buffer','ENV','ERRNO_CODES','ERRNO_MESSAGES','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','DNS','getHostByName','Protocols','Sockets','getRandomDevice','warnOnce','traverseStack','UNWIND_CACHE','convertPCtoSourceLocation','readAsmConstArgsArray','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','handleException','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','freeTableIndexes','functionsInTableMap','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','PATH','PATH_FS','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16Decoder','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeArrayToMemory','writeAsciiToMemory','SYSCALLS','getSocketFromFD','getSocketAddress','JSEvents','registerKeyEventCallback','specialHTMLTargets','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','currentFullscreenStrategy','restoreOldWindowedStyle','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','demangle','demangleAll','jsStackTrace','stackTrace','ExitStatus','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','dlopenMissingError','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','uncaughtExceptionCount','exceptionLast','exceptionCaught','ExceptionInfo','exception_addRef','exception_decRef','Browser','setMainLoop','wget','FS','MEMFS','TTY','PIPEFS','SOCKFS','_setNetworkCallback','tempFixedLengthArray','miniTempWebGLFloatBuffers','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','GL','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','AL','SDL_unicode','SDL_ttfContext','SDL_audio','SDL','SDL_gfx','GLUT','EGL','GLFW_Window','GLFW','GLEW','IDBStore','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){Object.getOwnPropertyDescriptor(n,t)||Object.defineProperty(n,t,{configurable:!0,get:function(){var e="'"+t+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";C(t)&&(e+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),j(e)}})})),['ptrToString','zeroMemory','stringToNewUTF8','exitJS','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','getHostByName','getRandomDevice','traverseStack','convertPCtoSourceLocation','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeAsciiToMemory','getSocketFromFD','getSocketAddress','registerKeyEventCallback','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','ExceptionInfo','exception_addRef','exception_decRef','setMainLoop','_setNetworkCallback','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','SDL_unicode','SDL_ttfContext','SDL_audio','GLFW_Window','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){'undefined'==typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,t)||Object.defineProperty(globalThis,t,{configurable:!0,get:function(){var e='`'+t+'` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line';C(t)&&(e+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),ht(e)}})})),V=function t(){ot||dt(),ot||(V=t)},n.zf)for('function'==typeof n.zf&&(n.zf=[n.zf]);n.zf.length>0;)n.zf.pop()();return dt(),t.ready});const it=et;const st=class{constructor(t={}){this.Zf=void 0,this.qf=0,this.Kf=0,this.Jf=0,this.$f=t.$f||100,this.sampleRate=t.sampleRate||44100,this.Qf=t.Qf||2,this.gain=t.gain||0,t.bufferSize?this.bufferSize=t.bufferSize:this.tu(1),this.eu=t.eu||(()=>{}),this.iu=t.iu||(()=>{}),this.su=void 0,this.test=0}async init(){if(!this.Zf){if('undefined'!=typeof process){const{yc:t}=await import('path'),{nu:e}=await import('module');globalThis.__dirname=t("file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/index.js"),globalThis.require=e("file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/index.js")}this.Zf=await it(),this.ru=this.Zf.wf(this.bufferSize),this.hu=this.Zf.wf(8)}}tu(t){this.bufferSize=4*this.sampleRate*this.Qf*t}lu(){if(!this.Zf)throw new Error(`${this.constructor.name} not initalized. call .init()`)}ou(t){this.lu();const{wf:e,yf:i,mf:s,If:n,bf:r,gf:h,Cf:l}=this.Zf;i(this.qf),this.qf=e(t.length),this.Zf.Nc.set(t,this.qf),this.Kf=s(this.qf,t.length),n(this.Kf,2===this.Qf?0:2,this.sampleRate,this.gain)}au(){this.lu();const t=new Uint8Array(this.bufferSize);return t.set(this.Zf.Nc.subarray(this.ru,this.ru+this.bufferSize)),t}cu(t){const{wf:e,yf:i,Tf:s}=this.Zf;return i(this.Jf),this.Jf=e(t.length),this.Zf.Nc.set(t,this.Jf),s(this.Jf,t.length)}fu(t){const{Ef:e}=this.Zf;return e(this.Kf,t,this.Qf,this.sampleRate,this.ru,this.bufferSize,this.hu)}uu(t){if(this.lu(),!this.Kf)throw new Error('no soundfont buffer set. call .setSoundfont');window.clearTimeout(this.su);const{Xf:e,jf:i}=this.Zf;e(this.hu,0,'double'),this.Zf.Af(this.Kf),this.Zf.bf(this.Kf,9,128,0),t[0]==='R'.charCodeAt(0)&&(t=t.slice(20));let s=this.cu(t);const n=()=>{s=this.fu(s);const t=this.au();this.eu(t),s?this.su=setTimeout(n,this.$f):this.iu(i(this.hu,'double'))};this.su=setTimeout(n,16)}};!function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.audioContext=new window.AudioContext);var t=function(e){if(window.audioContext){var i=window.audioContext.createBuffer(1,1,22050),s=window.audioContext.createBufferSource();s.buffer=i,s.connect(window.audioContext.destination),s.start?s.start(0):s.play?s.play(0):s.noteOn&&s.noteOn(0)}document.removeEventListener('touchstart',t),document.removeEventListener('touchend',t),document.removeEventListener('click',t)};document.addEventListener('touchstart',t),document.addEventListener('touchend',t),document.addEventListener('click',t)}(),(async()=>{let t=new Float32Array,e=window.audioContext.createGain();e.gain.value=.1,e.connect(window.audioContext.destination);let i=window.audioContext.currentTime,s=[];const n=new st({$f:30,eu:e=>{let i=new Float32Array(e.buffer),s=new Float32Array(t.length+i.length);s.set(t,0),s.set(i,t.length),t=s},iu:t=>{},bufferSize:102400});await n.init();const r=await fetch('./SCC1_Florestan.sf2'),h=new Uint8Array(await r.arrayBuffer());function l(){if(!window.audioContext||!t.length)return;let n=window.audioContext.createBufferSource();const r=t.length/2,h=window.audioContext.createBuffer(2,r,44100);for(let e=0;e<2;e++){const i=h.getChannelData(e);let s=e;for(let e=0;e<r;e++)i[e]=t[s],s+=2}i<window.audioContext.currentTime&&(i=window.audioContext.currentTime),n.buffer=h,n.connect(e),n.start(i),s.push(n),i+=h.duration,t=new Float32Array}let o;n.ou(h),window._tinyMidiStop=async()=>{if(o&&clearInterval(o),t=new Float32Array,s.length){let t=e.gain.value;e.gain.value=0,s.forEach((t=>{t.stop(window.audioContext.currentTime)})),s=[],e.gain.value=t}},window._tinyMidiVolume=(t=1)=>{e.gain.value=t},window._tinyMidiPlay=async(t,e=1)=>{t&&(await window._tinyMidiStop(),-1!=e&&window._tinyMidiVolume(e),i=window.audioContext.currentTime,o=setInterval(l,250),n.uu(t))}})();class nt{level;y;x;z;model;du;wu;yu;mu;pu;Au;Iu;info;gu=0;je=0;constructor(t,e,i,s,n,r,h,l,o,a,c,f,u){this.level=t,this.y=e,this.x=i,this.z=s,this.model=n,this.du=r,this.wu=h,this.yu=l,this.mu=o,this.pu=a,this.Au=c,this.Iu=f,this.info=u}}class rt extends w{level;x;z;_u;Cu;bu;Tu=null;Eu=null;vu=null;Lu=null;Su=null;Ou=null;ku=null;Ru=0;xu=0;Mu=0;visible=!1;update=!1;Fu=!1;Du=0;Nu=0;Uu=0;Pu=0;constructor(t,e,i){super(),this._u=this.level=t,this.x=e,this.z=i,this.Cu=new S(5,null),this.bu=new Int32Array(5)}}class ht{Bu;Wu;Gu;Hu;type;Zh;qh;Kh;Jh;Qh;tl;mode=0;Yu=0;Vu=0;Xu=0;ju=0;zu=0;Zu=0;constructor(t,e,i,s,n,r,h,l,o,a,c){this.Bu=t,this.Wu=e,this.Gu=i,this.Hu=s,this.type=n,this.Zh=r,this.qh=h,this.Kh=l,this.Jh=o,this.Qh=a,this.tl=c}}class lt{static OPEN=0;static qu=1;static Ku=2;static Ju=4;static $u=8;static Qu=lt.qu<<4;static td=lt.Ku<<4;static ed=lt.Ju<<4;static sd=lt.$u<<4;static nd=256;static rd=512;static hd=1024;static ld=2048;static od=4096;static ad=lt.rd<<4;static fd=lt.hd<<4;static ud=lt.ld<<4;static dd=lt.od<<4;static wd=lt.nd<<9;static yd=524288;static md=2097152;static pd=lt.md|lt.yd;static Ad=lt.nd|lt.pd;static Id=lt.Ku|lt.Ad;static gd=lt.$u|lt.Ad;static _d=lt.Ku|lt.Ju|lt.gd;static Cd=lt.td|lt.Ad;static bd=lt.$u|lt.Qu|lt.Cd;static Td=lt.sd|lt.Ad;static Ed=lt.qu|lt.Ku|lt.Td;static vd=lt.td|lt.ed|lt.Td;static Ld=16777215}var ot;!function(t){t[t.Sd=0]="WEST",t[t.Od=1]="NORTH",t[t.kd=2]="EAST",t[t.Rd=3]="SOUTH"}(ot||(ot={}));const at=ot;var ct;!function(t){t[t.xd=0]="WALL",t[t.Md=1]="WALL_DECOR",t[t.Fd=2]="GROUND",t[t.Dd=3]="GROUND_DECOR"}(ct||(ct={}));var ft;!function(t){t[t.Nd=0]="WALL_STRAIGHT",t[t.Ud=1]="WALL_DIAGONAL_CORNER",t[t.Pd=2]="WALL_L",t[t.Bd=3]="WALL_SQUARE_CORNER",t[t.Wd=4]="WALLDECOR_STRAIGHT_NOOFFSET",t[t.Gd=5]="WALLDECOR_STRAIGHT_OFFSET",t[t.Hd=6]="WALLDECOR_DIAGONAL_OFFSET",t[t.Yd=7]="WALLDECOR_DIAGONAL_NOOFFSET",t[t.Vd=8]="WALLDECOR_DIAGONAL_BOTH",t[t.Xd=9]="WALL_DIAGONAL",t[t.jd=10]="CENTREPIECE_STRAIGHT",t[t.zd=11]="CENTREPIECE_DIAGONAL",t[t.Zd=12]="ROOF_STRAIGHT",t[t.qd=13]="ROOF_DIAGONAL_WITH_ROOFEDGE",t[t.Kd=14]="ROOF_DIAGONAL",t[t.Jd=15]="ROOF_L_CONCAVE",t[t.$d=16]="ROOF_L_CONVEX",t[t.Qd=17]="ROOF_FLAT",t[t.tw=18]="ROOFEDGE_STRAIGHT",t[t.ew=19]="ROOFEDGE_DIAGONAL_CORNER",t[t.iw=20]="ROOFEDGE_L",t[t.sw=21]="ROOFEDGE_SQUARE_CORNER",t[t.Dd=22]="GROUND_DECOR"}(ft||(ft={}));const ut=ft;class dt{static Od=1;static kd=2;static Rd=4;static Sd=8;static nw=dt.Sd|dt.Rd;static rw=dt.Sd|dt.Od;static hw=dt.kd|dt.Rd;static lw=dt.kd|dt.Od}class wt{static ow=4;static aw=104;static index=(t,e)=>t*wt.aw+e;offsetX;cw;sizeX;sizeZ;flags;constructor(){this.offsetX=0,this.cw=0,this.sizeX=wt.aw,this.sizeZ=wt.aw,this.flags=new Int32Array(this.sizeX*this.sizeZ),this.reset()}reset=()=>{for(let t=0;t<this.sizeX;t++)for(let e=0;e<this.sizeZ;e++){const i=wt.index(t,e);0===t||0===e||t===this.sizeX-1||e===this.sizeZ-1?this.flags[i]=lt.Ld:this.flags[i]=lt.OPEN}};fw=(t,e)=>{this.flags[wt.index(t-this.offsetX,e-this.cw)]|=lt.md};uw=(t,e)=>{this.flags[wt.index(t-this.offsetX,e-this.cw)]&=~lt.md};dw=(t,e,i,s,n,r)=>{let h=lt.nd;r&&(h|=lt.wd);const l=t-this.offsetX,o=e-this.cw;if(n===at.Od||n===at.Rd){const t=i;i=s,s=t}for(let t=l;t<l+i;t++)if(t>=0&&t<this.sizeX)for(let e=o;e<o+s;e++)e>=0&&e<this.sizeZ&&this.add(t,e,h)};ww=(t,e,i,s,n,r)=>{let h=lt.nd;r&&(h|=lt.wd);const l=t-this.offsetX,o=e-this.cw;if(n===at.Od||n===at.Rd){const t=i;i=s,s=t}for(let t=l;t<l+i;t++)if(t>=0&&t<this.sizeX)for(let e=o;e<o+s;e++)e>=0&&e<this.sizeZ&&this.remove(t,e,h)};yw=(t,e,i,s,n)=>{const r=t-this.offsetX,h=e-this.cw,l=n?lt.dd:lt.sd,o=n?lt.od:lt.$u,a=n?lt.hd:lt.Ku,c=n?lt.fd:lt.td,f=n?lt.rd:lt.qu,u=n?lt.ad:lt.Qu,d=n?lt.ld:lt.Ju,w=n?lt.ud:lt.ed;i===ut.Nd?s===at.Sd?(this.add(r,h,l),this.add(r-1,h,o)):s===at.Od?(this.add(r,h,a),this.add(r,h+1,c)):s===at.kd?(this.add(r,h,o),this.add(r+1,h,l)):s===at.Rd&&(this.add(r,h,c),this.add(r,h-1,a)):i===ut.Ud||i===ut.Bd?s===at.Sd?(this.add(r,h,f),this.add(r-1,h+1,u)):s===at.Od?(this.add(r,h,d),this.add(r+1,h+1,w)):s===at.kd?(this.add(r,h,u),this.add(r+1,h-1,f)):s===at.Rd&&(this.add(r,h,w),this.add(r-1,h-1,d)):i===ut.Pd&&(s===at.Sd?(this.add(r,h,a|l),this.add(r-1,h,o),this.add(r,h+1,c)):s===at.Od?(this.add(r,h,a|o),this.add(r,h+1,c),this.add(r+1,h,l)):s===at.kd?(this.add(r,h,c|o),this.add(r+1,h,l),this.add(r,h-1,a)):s===at.Rd&&(this.add(r,h,c|l),this.add(r,h-1,a),this.add(r-1,h,o))),n&&this.yw(t,e,i,s,!1)};mw=(t,e,i,s,n)=>{const r=t-this.offsetX,h=e-this.cw,l=n?lt.dd:lt.sd,o=n?lt.od:lt.$u,a=n?lt.hd:lt.Ku,c=n?lt.fd:lt.td,f=n?lt.rd:lt.qu,u=n?lt.ad:lt.Qu,d=n?lt.ld:lt.Ju,w=n?lt.ud:lt.ed;i===ut.Nd?s===at.Sd?(this.remove(r,h,l),this.remove(r-1,h,o)):s===at.Od?(this.remove(r,h,a),this.remove(r,h+1,c)):s===at.kd?(this.remove(r,h,o),this.remove(r+1,h,l)):s===at.Rd&&(this.remove(r,h,c),this.remove(r,h-1,a)):i===ut.Ud||i===ut.Bd?s===at.Sd?(this.remove(r,h,f),this.remove(r-1,h+1,u)):s===at.Od?(this.remove(r,h,d),this.remove(r+1,h+1,w)):s===at.kd?(this.remove(r,h,u),this.remove(r+1,h-1,f)):s===at.Rd&&(this.remove(r,h,w),this.remove(r-1,h-1,d)):i===ut.Pd&&(s===at.Sd?(this.remove(r,h,a|l),this.remove(r-1,h,o),this.remove(r,h+1,c)):s===at.Od?(this.remove(r,h,a|o),this.remove(r,h+1,c),this.remove(r+1,h,l)):s===at.kd?(this.remove(r,h,c|o),this.remove(r+1,h,l),this.remove(r,h-1,a)):s===at.Rd&&(this.remove(r,h,c|l),this.remove(r,h-1,a),this.remove(r-1,h,o))),n&&this.mw(t,e,i,s,!1)};pw=(t,e,i,s,n,r)=>{if(t===i&&e===s)return!0;const h=t-this.offsetX,l=e-this.cw,o=i-this.offsetX,a=s-this.cw,c=wt.index(h,l);if(n===ut.Nd){if(r===at.Sd){if(h===o-1&&l===a)return!0;if(h===o&&l===a+1&&(this.flags[c]&lt.Cd)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Id)===lt.OPEN)return!0}else if(r===at.Od){if(h===o&&l===a+1)return!0;if(h===o-1&&l===a&&(this.flags[c]&lt.gd)===lt.OPEN)return!0;if(h===o+1&&l===a&&(this.flags[c]&lt.Td)===lt.OPEN)return!0}else if(r===at.kd){if(h===o+1&&l===a)return!0;if(h===o&&l===a+1&&(this.flags[c]&lt.Cd)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Id)===lt.OPEN)return!0}else if(r===at.Rd){if(h===o&&l===a-1)return!0;if(h===o-1&&l===a&&(this.flags[c]&lt.gd)===lt.OPEN)return!0;if(h===o+1&&l===a&&(this.flags[c]&lt.Td)===lt.OPEN)return!0}}else if(n===ut.Pd){if(r===at.Sd){if(h===o-1&&l===a)return!0;if(h===o&&l===a+1)return!0;if(h===o+1&&l===a&&(this.flags[c]&lt.Td)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Id)===lt.OPEN)return!0}else if(r===at.Od){if(h===o-1&&l===a&&(this.flags[c]&lt.gd)===lt.OPEN)return!0;if(h===o&&l===a+1)return!0;if(h===o+1&&l===a)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Id)===lt.OPEN)return!0}else if(r===at.kd){if(h===o-1&&l===a&&(this.flags[c]&lt.gd)===lt.OPEN)return!0;if(h===o&&l===a+1&&(this.flags[c]&lt.Cd)===lt.OPEN)return!0;if(h===o+1&&l===a)return!0;if(h===o&&l===a-1)return!0}else if(r===at.Rd){if(h===o-1&&l===a)return!0;if(h===o&&l===a+1&&(this.flags[c]&lt.Cd)===lt.OPEN)return!0;if(h===o+1&&l===a&&(this.flags[c]&lt.Td)===lt.OPEN)return!0;if(h===o&&l===a-1)return!0}}else if(n===ut.Xd){if(h===o&&l===a+1&&(this.flags[c]&lt.td)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Ku)===lt.OPEN)return!0;if(h===o-1&&l===a&&(this.flags[c]&lt.$u)===lt.OPEN)return!0;if(h===o+1&&l===a&&(this.flags[c]&lt.sd)===lt.OPEN)return!0}return!1};Aw=(t,e,i,s,n,r)=>{if(t===i&&e===s)return!0;const h=t-this.offsetX,l=e-this.cw,o=i-this.offsetX,a=s-this.cw,c=wt.index(h,l);if(n===ut.Hd||n===ut.Yd){if(n===ut.Yd&&(r=r+2&3),r===at.Sd){if(h===o+1&&l===a&&(this.flags[c]&lt.sd)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Ku)===lt.OPEN)return!0}else if(r===at.Od){if(h===o-1&&l===a&&(this.flags[c]&lt.$u)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Ku)===lt.OPEN)return!0}else if(r===at.kd){if(h===o-1&&l===a&&(this.flags[c]&lt.$u)===lt.OPEN)return!0;if(h===o&&l===a+1&&(this.flags[c]&lt.td)===lt.OPEN)return!0}else if(r===at.Rd){if(h===o+1&&l===a&&(this.flags[c]&lt.sd)===lt.OPEN)return!0;if(h===o&&l===a+1&&(this.flags[c]&lt.td)===lt.OPEN)return!0}}else if(n===ut.Vd){if(h===o&&l===a+1&&(this.flags[c]&lt.td)===lt.OPEN)return!0;if(h===o&&l===a-1&&(this.flags[c]&lt.Ku)===lt.OPEN)return!0;if(h===o-1&&l===a&&(this.flags[c]&lt.$u)===lt.OPEN)return!0;if(h===o+1&&l===a&&(this.flags[c]&lt.sd)===lt.OPEN)return!0}return!1};Iw=(t,e,i,s,n,r,h)=>{const l=i+n-1,o=s+r-1,a=wt.index(t-this.offsetX,e-this.cw);return t>=i&&t<=l&&e>=s&&e<=o||(t===i-1&&e>=s&&e<=o&&(this.flags[a]&lt.$u)===lt.OPEN&&(h&dt.Sd)===lt.OPEN||(t===l+1&&e>=s&&e<=o&&(this.flags[a]&lt.sd)===lt.OPEN&&(h&dt.kd)===lt.OPEN||(e===s-1&&t>=i&&t<=l&&(this.flags[a]&lt.Ku)===lt.OPEN&&(h&dt.Rd)===lt.OPEN||e===o+1&&t>=i&&t<=l&&(this.flags[a]&lt.td)===lt.OPEN&&(h&dt.Od)===lt.OPEN)))};add=(t,e,i)=>{this.flags[wt.index(t,e)]|=i};remove=(t,e,i)=>{this.flags[wt.index(t,e)]&=lt.Ld-i}}class yt{y;x;z;model;Iu;info;constructor(t,e,i,s,n,r){this.y=t,this.x=e,this.z=i,this.model=s,this.Iu=n,this.info=r}}class mt{y;x;z;gw;_w;Cw;bw;Iu;info;constructor(t,e,i,s,n,r,h,l,o){this.y=t,this.x=e,this.z=i,this.gw=s,this._w=n,this.Cw=r,this.bw=h,this.Iu=l,this.info=o}}class pt{y;x;z;type;angle;model;Iu;info;constructor(t,e,i,s,n,r,h,l){this.y=t,this.x=e,this.z=i,this.type=s,this.angle=n,this.model=r,this.Iu=h,this.info=l}}class At{y;x;z;Tw;Ew;Lw;Iu;offset;constructor(t,e,i,s,n,r,h,l){this.y=t,this.x=e,this.z=i,this.Tw=s,this.Ew=n,this.Lw=r,this.Iu=h,this.offset=l}}class It{Sw;Ow;kw;Rw;xw;color;flat;constructor(t,e,i,s,n,r,h){this.Sw=t,this.Ow=e,this.kw=i,this.Rw=s,this.xw=n,this.color=r,this.flat=h}}class gt{static Mw=new Int32Array(6);static Fw=new Int32Array(6);static Dw=new Int32Array(6);static Nw=new Int32Array(6);static Uw=new Int32Array(6);static Pw=[Int32Array.of(1,3,5,7),Int32Array.of(1,3,5,7),Int32Array.of(1,3,5,7),Int32Array.of(1,3,5,7,6),Int32Array.of(1,3,5,7,6),Int32Array.of(1,3,5,7,6),Int32Array.of(1,3,5,7,6),Int32Array.of(1,3,5,7,2,6),Int32Array.of(1,3,5,7,2,8),Int32Array.of(1,3,5,7,2,8),Int32Array.of(1,3,5,7,11,12),Int32Array.of(1,3,5,7,11,12),Int32Array.of(1,3,5,7,13,14)];static Bw=[Int32Array.of(0,1,2,3,0,0,1,3),Int32Array.of(1,1,2,3,1,0,1,3),Int32Array.of(0,1,2,3,1,0,1,3),Int32Array.of(0,0,1,2,0,0,2,4,1,0,4,3),Int32Array.of(0,0,1,4,0,0,4,3,1,1,2,4),Int32Array.of(0,0,4,3,1,0,1,2,1,0,2,4),Int32Array.of(0,1,2,4,1,0,1,4,1,0,4,3),Int32Array.of(0,4,1,2,0,4,2,5,1,0,4,5,1,0,5,3),Int32Array.of(0,4,1,2,0,4,2,3,0,4,3,5,1,0,4,5),Int32Array.of(0,0,4,5,1,4,1,2,1,4,2,3,1,4,3,5),Int32Array.of(0,0,1,5,0,1,4,5,0,1,2,4,1,0,5,3,1,5,4,3,1,4,2,3),Int32Array.of(1,0,1,5,1,1,4,5,1,1,2,4,0,0,5,3,0,5,4,3,0,4,2,3),Int32Array.of(1,0,5,4,1,0,1,5,0,0,4,3,0,4,5,3,0,5,2,3,0,1,2,5)];static Ww=128;static Gw=this.Ww/2|0;static Hw=this.Ww/4|0;static Yw=3*this.Ww/4|0;Uh;kh;Ph;Vw;Xw;jw;zw;Zw;qw;Kw;flat;shape;rotation;Jw;$w;constructor(t,e,i,s,n,r,h,l,o,a,c,f,u,d,w,y,m,p,A){this.flat=!(m!==s||m!==d||m!==l),this.shape=e,this.rotation=r,this.Jw=u,this.$w=o;const I=gt.Pw[e],g=I.length;this.Uh=new Int32Array(g),this.kh=new Int32Array(g),this.Ph=new Int32Array(g);const _=new Int32Array(g),C=new Int32Array(g),b=t*gt.Ww,T=p*gt.Ww;for(let t=0;t<g;t++){let e,o,c,u,p,g=I[t];0==(1&g)&&g<=8&&(g=1+(g-r-r-1&7)),g>8&&g<=12&&(g=9+(g-r-9&3)),g>12&&g<=16&&(g=13+(g-r-13&3)),1===g?(e=b,o=T,c=m,u=h,p=a):2===g?(e=b+gt.Gw,o=T,c=m+s>>1,u=h+A>>1,p=a+i>>1):3===g?(e=b+gt.Ww,o=T,c=s,u=A,p=i):4===g?(e=b+gt.Ww,o=T+gt.Gw,c=s+d>>1,u=A+n>>1,p=i+w>>1):5===g?(e=b+gt.Ww,o=T+gt.Ww,c=d,u=n,p=w):6===g?(e=b+gt.Gw,o=T+gt.Ww,c=d+l>>1,u=n+y>>1,p=w+f>>1):7===g?(e=b,o=T+gt.Ww,c=l,u=y,p=f):8===g?(e=b,o=T+gt.Gw,c=l+m>>1,u=y+h>>1,p=f+a>>1):9===g?(e=b+gt.Gw,o=T+gt.Hw,c=m+s>>1,u=h+A>>1,p=a+i>>1):10===g?(e=b+gt.Yw,o=T+gt.Gw,c=s+d>>1,u=A+n>>1,p=i+w>>1):11===g?(e=b+gt.Gw,o=T+gt.Yw,c=d+l>>1,u=n+y>>1,p=w+f>>1):12===g?(e=b+gt.Hw,o=T+gt.Gw,c=l+m>>1,u=y+h>>1,p=f+a>>1):13===g?(e=b+gt.Hw,o=T+gt.Hw,c=m,u=h,p=a):14===g?(e=b+gt.Yw,o=T+gt.Hw,c=s,u=A,p=i):15===g?(e=b+gt.Yw,o=T+gt.Yw,c=d,u=n,p=w):(e=b+gt.Hw,o=T+gt.Yw,c=l,u=y,p=f),this.Uh[t]=e,this.kh[t]=c,this.Ph[t]=o,_[t]=u,C[t]=p}const E=gt.Bw[e],v=E.length/4|0;this.zw=new Int32Array(v),this.Zw=new Int32Array(v),this.qw=new Int32Array(v),this.Vw=new Int32Array(v),this.Xw=new Int32Array(v),this.jw=new Int32Array(v),this.Kw=-1!==c?new Int32Array(v):null;let L=0;for(let t=0;t<v;t++){const e=E[L];let i=E[L+1],s=E[L+2],n=E[L+3];L+=4,i<4&&(i=i-r&3),s<4&&(s=s-r&3),n<4&&(n=n-r&3),this.zw[t]=i,this.Zw[t]=s,this.qw[t]=n,0===e?(this.Vw[t]=_[i],this.Xw[t]=_[s],this.jw[t]=_[n],this.Kw&&(this.Kw[t]=-1)):(this.Vw[t]=C[i],this.Xw[t]=C[s],this.jw[t]=C[n],this.Kw&&(this.Kw[t]=c))}}}var _t;!function(t){t[t.Qw=0]="PLAIN",t[t.ty=1]="DIAGONAL",t[t.ey=2]="LEFT_SEMI_DIAGONAL_SMALL",t[t.iy=3]="RIGHT_SEMI_DIAGONAL_SMALL",t[t.sy=4]="LEFT_SEMI_DIAGONAL_BIG",t[t.ny=5]="RIGHT_SEMI_DIAGONAL_BIG",t[t.Gw=6]="HALF_SQUARE",t[t.Hw=7]="CORNER_SMALL",t[t.Yw=8]="CORNER_BIG",t[t.hy=9]="FAN_SMALL",t[t.ly=10]="FAN_BIG",t[t.oy=11]="TRAPEZIUM"}(_t||(_t={}));const Ct=_t;class bt{static uy=new R(8,32,51,51,!1);static wy=new S(100,null);static yy=new Int32Array(wt.ow);static my=new O(wt.ow,500,null);static py=new S(500,null);static Ay=new E;static je=0;static Iy=0;static gy=0;static _y=0;static Cy=0;static by=0;static Ty=0;static Ey=0;static vy=0;static Ly=0;static Sy=0;static Oy=0;static ky=0;static Ry=0;static xy=0;static My=0;static Fy=0;static Dy=0;static Ny=0;static Uy=0;static Py=0;static By=0;static Wy=!1;static Gy=null;static Hy=Int32Array.of(19,55,38,155,255,110,137,205,76);static Yy=Int32Array.of(160,192,80,96,0,144,80,48,160);static Vy=Int32Array.of(76,8,137,4,0,1,38,2,19);static Xy=Int32Array.of(0,0,2,0,0,2,1,1,0);static jy=Int32Array.of(2,0,0,2,0,0,0,4,4);static zy=Int32Array.of(0,4,4,8,0,0,8,0,0);static Zy=Int32Array.of(1,1,0,0,0,8,0,0,8);static qy=Int32Array.of(53,-53,-53,53);static Ky=Int32Array.of(-53,-53,53,53);static Jy=Int32Array.of(-45,45,45,-45);static $y=Int32Array.of(45,45,-45,-45);static Qy=[new Int32Array(16),Int32Array.of(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Int32Array.of(1,0,0,0,1,1,0,0,1,1,1,0,1,1,1,1),Int32Array.of(1,1,0,0,1,1,0,0,1,0,0,0,1,0,0,0),Int32Array.of(0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,1),Int32Array.of(0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1),Int32Array.of(1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1),Int32Array.of(1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0),Int32Array.of(0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0),Int32Array.of(1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1),Int32Array.of(1,1,1,1,1,1,0,0,1,0,0,0,1,0,0,0),Int32Array.of(0,0,0,0,0,0,1,1,0,1,1,1,0,1,1,1),Int32Array.of(0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1)];static tm=[Int32Array.of(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15),Int32Array.of(12,8,4,0,13,9,5,1,14,10,6,2,15,11,7,3),Int32Array.of(15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0),Int32Array.of(3,7,11,15,2,6,10,14,1,5,9,13,0,4,8,12)];static im=Int32Array.of(41,39248,41,4643,41,41,41,41,41,41,41,41,41,41,41,43086,41,41,41,41,41,41,41,8602,41,28992,41,41,41,41,41,5056,41,41,41,41,41,41,41,41,41,41,41,41,41,41,3131,41,41,41);static sm=0;static Gn=0;static Hn=0;static nm=-1;static rm=-1;static Me=!0;static init=(t,e,i,s,n)=>{this.Iy=0,this.gy=0,this._y=t,this.Cy=e,this.by=t/2|0,this.Ty=e/2|0;const r=new R(9,32,53,53,!1);for(let t=128;t<=384;t+=32)for(let e=0;e<2048;e+=64){this.Ey=D.sin[t],this.vy=D.cos[t],this.Ly=D.sin[e],this.Sy=D.cos[e];const h=(t-128)/32|0,l=e/64|0;for(let t=-26;t<=26;t++)for(let e=-26;e<=26;e++){const o=128*t,a=128*e;let c=!1;for(let t=-i;t<=s;t+=128)if(this.hm(o,a,n[h]+t)){c=!0;break}r[h][l][t+25+1][e+25+1]=c}}for(let t=0;t<8;t++)for(let e=0;e<32;e++)for(let i=-25;i<25;i++)for(let s=-25;s<25;s++){let n=!1;t:for(let h=-1;h<=1;h++)for(let l=-1;l<=1;l++){if(r[t][e][i+h+25+1][s+l+25+1]){n=!0;break t}if(r[t][(e+1)%31][i+h+25+1][s+l+25+1]){n=!0;break t}if(r[t+1][e][i+h+25+1][s+l+25+1]){n=!0;break t}if(r[t+1][(e+1)%31][i+h+25+1][s+l+25+1]){n=!0;break t}}this.uy[t][e][i+25][s+25]=n}};static $e=()=>{this.wy=null,this.yy=null,this.my=null,this.Ay=null,this.uy=null,this.py=null,this.Gy=null,console.log('World3D unloaded!')};static lm=(t,e,i,s,n,r,h,l)=>{bt.my[t][bt.yy[t]++]=new ht(i/128|0,r/128|0,n/128|0,l/128|0,e,i,r,n,l,s,h)};static hm=(t,e,i)=>{const s=e*this.Ly+t*this.Sy>>16,n=e*this.Sy-t*this.Ly>>16,r=i*this.Ey+n*this.vy>>16,h=i*this.vy-n*this.Ey>>16;if(r<50||r>3500)return!1;const l=this.by+((s<<9)/r|0),o=this.Ty+((h<<9)/r|0);return l>=this.Iy&&l<=this._y&&o>=this.gy&&o<=this.Cy};om;Wu;Hu;am;fm;um;dm;wm;ym;pm=0;Am=0;Im=0;constructor(t,e,i,s){this.om=i,this.Wu=s,this.Hu=e,this.fm=new k(i,s,e,null),this.dm=new F(i,s+1,e+1),this.am=t,this.um=new S(5e3,null),this.wm=new Int32Array(1e4),this.ym=new Int32Array(1e4),this.reset()}reset=()=>{for(let t=0;t<this.om;t++)for(let e=0;e<this.Wu;e++)for(let i=0;i<this.Hu;i++)this.fm[t][e][i]=null;for(let t=0;t<wt.ow;t++){for(let e=0;e<bt.yy[t];e++)bt.my[t][e]=null;bt.yy[t]=0}for(let t=0;t<this.pm;t++)this.um[t]=null;this.pm=0,bt.wy.fill(null)};gm=t=>{this.Am=t;for(let e=0;e<this.Wu;e++)for(let i=0;i<this.Hu;i++)this.fm[t][e][i]=new rt(t,e,i)};_m=(t,e)=>{const i=this.fm[0][t][e];for(let i=0;i<3;i++){this.fm[i][t][e]=this.fm[i+1][t][e];const s=this.fm[i][t][e];s&&s.level--}this.fm[0][t][e]||(this.fm[0][t][e]=new rt(0,t,e));const s=this.fm[0][t][e];s&&(s.ku=i),this.fm[3][t][e]=null};Cm=(t,e,i,s)=>{const n=this.fm[t][e][i];n&&(n.Mu=s)};bm=(t,e,i,s,n,r,h,l,o,a,c,f,u,d,w,y,m,p,A,I)=>{if(s===Ct.Qw){for(let s=t;s>=0;s--)this.fm[s][e][i]||(this.fm[s][e][i]=new rt(s,e,i));const s=this.fm[t][e][i];s&&(s.Tu=new It(c,f,u,d,-1,A,!1))}else if(s===Ct.ty){for(let s=t;s>=0;s--)this.fm[s][e][i]||(this.fm[s][e][i]=new rt(s,e,i));const s=this.fm[t][e][i];s&&(s.Tu=new It(w,y,m,p,r,I,h===l&&h===o&&h===a))}else{for(let s=t;s>=0;s--)this.fm[s][e][i]||(this.fm[s][e][i]=new rt(s,e,i));const g=this.fm[t][e][i];g&&(g.Eu=new gt(e,s,y,l,u,n,c,a,I,w,r,p,A,o,m,d,h,i,f))}};Tm=(t,e,i,s,n,r,h)=>{this.fm[e][i][s]||(this.fm[e][i][s]=new rt(e,i,s));const l=this.fm[e][i][s];l&&(l.Su=new yt(n,128*i+64,128*s+64,t,r,h))};Em=(t,e,i)=>{const s=this.fm[t][e][i];s&&(s.Su=null)};vm=(t,e,i,s,n,r,h,l)=>{let o=0;const a=this.fm[s][t][e];if(a)for(let t=0;t<a.Ru;t++){const e=a.Cu[t];if(!e||!e.model)continue;const i=e.model.dl;i>o&&(o=i)}else this.fm[s][t][e]=new rt(s,t,e);const c=this.fm[s][t][e];c&&(c.Ou=new At(i,128*t+64,128*e+64,r,h,l,n,o))};Lm=(t,e,i)=>{const s=this.fm[t][e][i];s&&(s.Ou=null)};yw=(t,e,i,s,n,r,h,l,o,a)=>{if(!h&&!l)return;for(let s=t;s>=0;s--)this.fm[s][e][i]||(this.fm[s][e][i]=new rt(s,e,i));const c=this.fm[t][e][i];c&&(c.vu=new mt(s,128*e+64,128*i+64,n,r,h,l,o,a))};mw=(t,e,i,s)=>{const n=this.fm[t][e][i];1===s&&n&&(n.vu=null)};Sm=(t,e,i,s,n,r,h,l,o,a,c)=>{if(!l)return;for(let s=t;s>=0;s--)this.fm[s][e][i]||(this.fm[s][e][i]=new rt(s,e,i));const f=this.fm[t][e][i];f&&(f.Lu=new pt(s,128*e+n+64,128*i+r+64,c,a,l,h,o))};Om=(t,e,i)=>{const s=this.fm[t][e][i];s&&(s.Lu=null)};km=(t,e,i,s)=>{const n=this.fm[t][e][i];if(!n)return;const r=n.Lu;if(!r)return;const h=128*e+64,l=128*i+64;r.x=h+((r.x-h)*s/16|0),r.z=l+((r.z-l)*s/16|0)};Rm=(t,e,i,s)=>{if(!s)return;const n=this.fm[t][e][i];if(!n)return;const r=n.Lu;r&&(r.model=s)};xm=(t,e,i,s)=>{if(!s)return;const n=this.fm[t][e][i];if(!n)return;const r=n.Su;r&&(r.model=s)};Mm=(t,e,i,s)=>{if(!s)return;const n=this.fm[t][e][i];if(!n)return;const r=n.vu;r&&(r.Cw=s)};Fm=(t,e,i,s,n)=>{if(!s)return;const r=this.fm[i][t][e];if(!r)return;const h=r.vu;h&&(h.Cw=s,h.bw=n)};dw=(t,e,i,s,n,r,h,l,o,a,c)=>{if(!n&&!r)return!0;const f=128*e+64*o,u=128*i+64*a;return this.Dm(f,u,s,t,e,i,o,a,n,r,h,l,c,!1)};Nm=(t,e,i,s,n,r,h,l,o,a)=>{if(!n&&!r)return!0;let c=e-o,f=s-o,u=e+o,d=s+o;return a&&(l>640&&l<1408&&(d+=128),l>1152&&l<1920&&(u+=128),(l>1664||l<384)&&(f-=128),l>128&&l<896&&(c-=128)),c=c/128|0,f=f/128|0,u=u/128|0,d=d/128|0,this.Dm(e,s,i,t,c,f,u+1-c,d-f+1,n,r,h,0,l,!0)};Um=(t,e,i,s,n,r,h,l,o,a,c,f)=>!o&&!a||this.Dm(e,s,i,t,n,r,h+1-n,l-r+1,o,a,c,0,f,!0);ww=(t,e,i)=>{const s=this.fm[t][e][i];if(s)for(let t=0;t<s.Ru;t++){const n=s.Cu[t];if(n&&2==(n.Iu>>29&3)&&n.yu===e&&n.pu===i)return void this.Pm(n)}};Bm=(t,e,i,s)=>{if(!s)return;const n=this.fm[t][e][i];if(n)for(let t=0;t<n.Ru;t++){const e=n.Cu[t];if(e&&2==(e.Iu>>29&3))return void(e.model=s)}};Wm=()=>{for(let t=0;t<this.pm;t++){const e=this.um[t];e&&this.Pm(e),this.um[t]=null}this.pm=0};Gm=(t,e,i)=>{const s=this.fm[t][e][i];return s&&s.vu?s.vu.Iu:0};Hm=(t,e,i)=>{const s=this.fm[t][i][e];return s&&s.Lu?s.Lu.Iu:0};Ym=(t,e,i)=>{const s=this.fm[t][e][i];if(!s)return 0;for(let t=0;t<s.Ru;t++){const n=s.Cu[t];if(n&&2==(n.Iu>>29&3)&&n.yu===e&&n.pu===i)return n.Iu}return 0};Vm=(t,e,i)=>{const s=this.fm[t][e][i];return s&&s.Su?s.Su.Iu:0};Xm=(t,e,i,s)=>{const n=this.fm[t][e][i];if(n){if(n.vu&&n.vu.Iu===s)return 255&n.vu.info;if(n.Lu&&n.Lu.Iu===s)return 255&n.Lu.info;if(n.Su&&n.Su.Iu===s)return 255&n.Su.info;for(let t=0;t<n.Ru;t++){const e=n.Cu[t];if(e&&e.Iu===s)return 255&e.info}return-1}return-1};jm=(t,e,i,s,n)=>{const r=e*(0|Math.sqrt(i*i+s*s+n*n))>>8;for(let e=0;e<this.om;e++)for(let h=0;h<this.Wu;h++)for(let l=0;l<this.Hu;l++){const o=this.fm[e][h][l];if(!o)continue;const a=o.vu;a&&a.Cw&&a.Cw.Dh&&(this.zm(e,h,l,1,1,a.Cw),a.bw&&a.bw.Dh&&(this.zm(e,h,l,1,1,a.bw),this.Zm(a.Cw,a.bw,0,0,0,!1),a.bw.Ll(t,r,i,s,n)),a.Cw.Ll(t,r,i,s,n));for(let a=0;a<o.Ru;a++){const c=o.Cu[a];c&&c.model&&c.model.Dh&&(this.zm(e,h,l,c.mu+1-c.yu,c.Au-c.pu+1,c.model),c.model.Ll(t,r,i,s,n))}const c=o.Su;c&&c.model&&c.model.Dh&&(this.qm(e,h,l,c.model),c.model.Ll(t,r,i,s,n))}};qm=(t,e,i,s)=>{if(e<this.Wu){const n=this.fm[t][e+1][i];n&&n.Su&&n.Su.model&&n.Su.model.Dh&&this.Zm(s,n.Su.model,128,0,0,!0)}if(i<this.Wu){const n=this.fm[t][e][i+1];n&&n.Su&&n.Su.model&&n.Su.model.Dh&&this.Zm(s,n.Su.model,0,0,128,!0)}if(e<this.Wu&&i<this.Hu){const n=this.fm[t][e+1][i+1];n&&n.Su&&n.Su.model&&n.Su.model.Dh&&this.Zm(s,n.Su.model,128,0,128,!0)}if(e<this.Wu&&i>0){const n=this.fm[t][e+1][i-1];n&&n.Su&&n.Su.model&&n.Su.model.Dh&&this.Zm(s,n.Su.model,128,0,-128,!0)}};zm=(t,e,i,s,n,r)=>{let h=!0,l=e;const o=e+s,a=i-1,c=i+n;for(let f=t;f<=t+1;f++)if(f!==this.om){for(let u=l;u<=o;u++)if(!(u<0||u>=this.Wu))for(let l=a;l<=c;l++){if(l<0||l>=this.Hu||h&&u<o&&l<c&&(l>=i||u===e))continue;const a=this.fm[f][u][l];if(!a)continue;const d=128*(u-e)+64*(1-s),w=128*(l-i)+64*(1-n),y=((this.am[f][u][l]+this.am[f][u+1][l]+this.am[f][u][l+1]+this.am[f][u+1][l+1])/4|0)-((this.am[t][e][i]+this.am[t][e+1][i]+this.am[t][e][i+1]+this.am[t][e+1][i+1])/4|0),m=a.vu;m&&m.Cw&&m.Cw.Dh&&this.Zm(r,m.Cw,d,y,w,h),m&&m.bw&&m.bw.Dh&&this.Zm(r,m.bw,d,y,w,h);for(let t=0;t<a.Ru;t++){const l=a.Cu[t];if(!l||!l.model||!l.model.Dh)continue;const o=l.mu+1-l.yu,c=l.Au+1-l.pu;this.Zm(r,l.model,128*(l.yu-e)+64*(o-s),y,128*(l.pu-i)+64*(c-n),h)}}l--,h=!1}};Zm=(t,e,i,s,n,r)=>{this.Im++;let h=0;const l=e.Uh,o=e.Er;if(t.Dh&&t.Nh)for(let r=0;r<t.Er;r++){const a=t.Dh[r],c=t.Nh[r];if(c&&0!==c.w){const f=t.kh[r]-s;if(f>e.Qh)continue;const u=t.Uh[r]-i;if(u<e.Zh||u>e.qh)continue;const d=t.Ph[r]-n;if(d<e.Kh||d>e.Jh)continue;if(e.Dh&&e.Nh)for(let t=0;t<o;t++){const i=e.Dh[t],s=e.Nh[t];u!==l[t]||d!==e.Ph[t]||f!==e.kh[t]||s&&0===s.w||(a&&i&&s&&(a.x+=s.x,a.y+=s.y,a.z+=s.z,a.w+=s.w,i.x+=c.x,i.y+=c.y,i.z+=c.z,i.w+=c.w,h++),this.wm[r]=this.Im,this.ym[t]=this.Im)}}}if(!(h<3)&&r){if(t.Fh)for(let e=0;e<t.vr;e++)this.wm[t.Bh[e]]===this.Im&&this.wm[t.Wh[e]]===this.Im&&this.wm[t.Gh[e]]===this.Im&&(t.Fh[e]=-1);if(e.Fh)for(let t=0;t<e.vr;t++)this.ym[e.Bh[t]]===this.Im&&this.ym[e.Wh[t]]===this.Im&&this.ym[e.Gh[t]]===this.Im&&(e.Fh[t]=-1)}};Km=(t,e,i,s,n,r)=>{const h=this.fm[t][e][i];if(!h)return;const l=h.Tu;if(l){const t=l.color;if(0!==t)for(let e=0;e<4;e++)s[n]=t,s[n+1]=t,s[n+2]=t,s[n+3]=t,n+=r;return}const o=h.Eu;if(!o)return;const a=o.shape,c=o.rotation,f=o.Jw,u=o.$w,d=bt.Qy[a],w=bt.tm[c];let y=0;if(0===f)for(let t=0;t<4;t++)0!==d[w[y++]]&&(s[n]=u),0!==d[w[y++]]&&(s[n+1]=u),0!==d[w[y++]]&&(s[n+2]=u),0!==d[w[y++]]&&(s[n+3]=u),n+=r;else for(let t=0;t<4;t++)s[n]=0===d[w[y++]]?f:u,s[n+1]=0===d[w[y++]]?f:u,s[n+2]=0===d[w[y++]]?f:u,s[n+3]=0===d[w[y++]]?f:u,n+=r};click=(t,e)=>{bt.Wy=!0,bt.Gn=t,bt.Hn=e,bt.nm=-1,bt.rm=-1};draw=(t,e,i,s,n,r,h)=>{t<0?t=0:t>=128*this.Wu&&(t=128*this.Wu-1),i<0?i=0:i>=128*this.Hu&&(i=128*this.Hu-1),bt.je++,bt.Ey=D.sin[r],bt.vy=D.cos[r],bt.Ly=D.sin[n],bt.Sy=D.cos[n],bt.Gy=bt.uy[(r-128)/32|0][n/64|0],bt.Oy=t,bt.ky=e,bt.Ry=i,bt.xy=t/128|0,bt.My=i/128|0,bt.Py=s,bt.Fy=bt.xy-25,bt.Fy<0&&(bt.Fy=0),bt.Ny=bt.My-25,bt.Ny<0&&(bt.Ny=0),bt.Dy=bt.xy+25,bt.Dy>this.Wu&&(bt.Dy=this.Wu),bt.Uy=bt.My+25,bt.Uy>this.Hu&&(bt.Uy=this.Hu),this.Jm(),bt.By=0;for(let t=this.Am;t<this.om;t++){const i=this.fm[t];for(let n=bt.Fy;n<bt.Dy;n++)for(let r=bt.Ny;r<bt.Uy;r++){const h=i[n][r];h&&(h.Mu<=s&&(bt.Gy[n+25-bt.xy][r+25-bt.My]||this.am[t][n][r]-e>=2e3)?(h.visible=!0,h.update=!0,h.Fu=h.Ru>0,bt.By++):(h.visible=!1,h.update=!1,h.Du=0))}}for(let t=this.Am;t<this.om;t++){const e=this.fm[t];for(let t=-25;t<=0;t++){const i=bt.xy+t,s=bt.xy-t;if(!(i<bt.Fy&&s>=bt.Dy))for(let t=-25;t<=0;t++){const n=bt.My+t,r=bt.My-t;let l;if(i>=bt.Fy&&(n>=bt.Ny&&(l=e[i][n],l&&l.visible&&this.$m(l,!0,h)),r<bt.Uy&&(l=e[i][r],l&&l.visible&&this.$m(l,!0,h))),s<bt.Dy&&(n>=bt.Ny&&(l=e[s][n],l&&l.visible&&this.$m(l,!0,h)),r<bt.Uy&&(l=e[s][r],l&&l.visible&&this.$m(l,!0,h))),0===bt.By)return void(bt.Wy=!1)}}}for(let t=this.Am;t<this.om;t++){const e=this.fm[t];for(let t=-25;t<=0;t++){const i=bt.xy+t,s=bt.xy-t;if(!(i<bt.Fy&&s>=bt.Dy))for(let t=-25;t<=0;t++){const n=bt.My+t,r=bt.My-t;let l;if(i>=bt.Fy&&(n>=bt.Ny&&(l=e[i][n],l&&l.visible&&this.$m(l,!1,h)),r<bt.Uy&&(l=e[i][r],l&&l.visible&&this.$m(l,!1,h))),s<bt.Dy&&(n>=bt.Ny&&(l=e[s][n],l&&l.visible&&this.$m(l,!1,h)),r<bt.Uy&&(l=e[s][r],l&&l.visible&&this.$m(l,!1,h))),0===bt.By)return void(bt.Wy=!1)}}}};Dm=(t,e,i,s,n,r,h,l,o,a,c,f,u,d)=>{if(!o&&!a)return!1;for(let t=n;t<n+h;t++)for(let e=r;e<r+l;e++){if(t<0||e<0||t>=this.Wu||e>=this.Hu)return!1;const i=this.fm[s][t][e];if(i&&i.Ru>=5)return!1}const w=new nt(s,i,t,e,o,a,u,n,n+h-1,r,r+l-1,c,f);for(let t=n;t<n+h;t++)for(let e=r;e<r+l;e++){let i=0;t>n&&(i|=1),t<n+h-1&&(i+=4),e>r&&(i+=8),e<r+l-1&&(i+=2);for(let i=s;i>=0;i--)this.fm[i][t][e]||(this.fm[i][t][e]=new rt(i,t,e));const o=this.fm[s][t][e];o&&(o.Cu[o.Ru]=w,o.bu[o.Ru]=i,o.xu|=i,o.Ru++)}return d&&(this.um[this.pm++]=w),!0};Pm=t=>{for(let e=t.yu;e<=t.mu;e++)for(let i=t.pu;i<=t.Au;i++){const s=this.fm[t.level][e][i];if(s){for(let e=0;e<s.Ru;e++)if(s.Cu[e]===t){s.Ru--;for(let t=e;t<s.Ru;t++)s.Cu[t]=s.Cu[t+1],s.bu[t]=s.bu[t+1];s.Cu[s.Ru]=null;break}s.xu=0;for(let t=0;t<s.Ru;t++)s.xu|=s.bu[t]}}};Jm=()=>{const t=bt.yy[bt.Py],e=bt.my[bt.Py];bt.sm=0;for(let i=0;i<t;i++){const t=e[i];if(!t)continue;let s,n,r,h;if(1===t.type){if(s=t.Bu+25-bt.xy,s>=0&&s<=50){n=t.Gu+25-bt.My,n<0&&(n=0),r=t.Hu+25-bt.My,r>50&&(r=50);let e=!1;for(;n<=r;)if(bt.Gy&&bt.Gy[s][n++]){e=!0;break}if(e){if(h=bt.Oy-t.Zh,h>32)t.mode=1;else{if(h>=-32)continue;t.mode=2,h=-h}t.Xu=(t.Kh-bt.Ry<<8)/h|0,t.ju=(t.Jh-bt.Ry<<8)/h|0,t.zu=(t.Qh-bt.ky<<8)/h|0,t.Zu=(t.tl-bt.ky<<8)/h|0,bt.py[bt.sm++]=t}}}else if(2===t.type){if(s=t.Gu+25-bt.My,s>=0&&s<=50){n=t.Bu+25-bt.xy,n<0&&(n=0),r=t.Wu+25-bt.xy,r>50&&(r=50);let e=!1;for(;n<=r;)if(bt.Gy&&bt.Gy[n++][s]){e=!0;break}if(e){if(h=bt.Ry-t.Kh,h>32)t.mode=3;else{if(h>=-32)continue;t.mode=4,h=-h}t.Yu=(t.Zh-bt.Oy<<8)/h|0,t.Vu=(t.qh-bt.Oy<<8)/h|0,t.zu=(t.Qh-bt.ky<<8)/h|0,t.Zu=(t.tl-bt.ky<<8)/h|0,bt.py[bt.sm++]=t}}}else if(4===t.type&&(s=t.Qh-bt.ky,s>128&&(n=t.Gu+25-bt.My,n<0&&(n=0),r=t.Hu+25-bt.My,r>50&&(r=50),n<=r))){let e=t.Bu+25-bt.xy;e<0&&(e=0),h=t.Wu+25-bt.xy,h>50&&(h=50);let i=!1;t:for(let t=e;t<=h;t++)for(let e=n;e<=r;e++)if(bt.Gy&&bt.Gy[t][e]){i=!0;break t}i&&(t.mode=5,t.Yu=(t.Zh-bt.Oy<<8)/s|0,t.Vu=(t.qh-bt.Oy<<8)/s|0,t.Xu=(t.Kh-bt.Ry<<8)/s|0,t.ju=(t.Jh-bt.Ry<<8)/s|0,bt.py[bt.sm++]=t)}}};$m=(t,e,i)=>{for(bt.Ay.Nt(t);;){let t;do{if(t=bt.Ay.Pt(),!t)return}while(!t.update);const s=t.x,n=t.z,r=t.level,h=t._u,l=this.fm[r];if(t.visible){if(e){if(r>0){const t=this.fm[r-1][s][n];if(t&&t.update)continue}if(s<=bt.xy&&s>bt.Fy){const e=l[s-1][n];if(e&&e.update&&(e.visible||0==(1&t.xu)))continue}if(s>=bt.xy&&s<bt.Dy-1){const e=l[s+1][n];if(e&&e.update&&(e.visible||0==(4&t.xu)))continue}if(n<=bt.My&&n>bt.Ny){const e=l[s][n-1];if(e&&e.update&&(e.visible||0==(8&t.xu)))continue}if(n>=bt.My&&n<bt.Uy-1){const e=l[s][n+1];if(e&&e.update&&(e.visible||0==(2&t.xu)))continue}}else e=!0;if(t.visible=!1,t.ku){const e=t.ku;e.Tu?this.Qm(0,s,n)||this.tp(e.Tu,0,s,n,bt.Ey,bt.vy,bt.Ly,bt.Sy):e.Eu&&!this.Qm(0,s,n)&&this.ep(s,n,e.Eu,bt.Ey,bt.vy,bt.Ly,bt.Sy);const r=e.vu;r&&r.Cw?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,r.x-bt.Oy,r.y-bt.ky,r.z-bt.Ry,r.Iu);for(let t=0;t<e.Ru;t++){const s=e.Cu[t];if(s){let t=s.model;t||(t=s.du?.draw(i)??null),t?.draw(s.wu,bt.Ey,bt.vy,bt.Ly,bt.Sy,s.x-bt.Oy,s.y-bt.ky,s.z-bt.Ry,s.Iu)}}}let o=!1;t.Tu?this.Qm(h,s,n)||(o=!0,this.tp(t.Tu,h,s,n,bt.Ey,bt.vy,bt.Ly,bt.Sy)):t.Eu&&!this.Qm(h,s,n)&&(o=!0,this.ep(s,n,t.Eu,bt.Ey,bt.vy,bt.Ly,bt.Sy));let a=0,c=0;const f=t.vu,u=t.Lu;if((f||u)&&(bt.xy===s?a+=1:bt.xy<s&&(a+=2),bt.My===n?a+=3:bt.My>n&&(a+=6),c=bt.Hy[a],t.Pu=bt.Vy[a]),f&&(0==(f.gw&bt.Yy[a])?t.Du=0:16===f.gw?(t.Du=3,t.Nu=bt.Xy[a],t.Uu=3-t.Nu):32===f.gw?(t.Du=6,t.Nu=bt.jy[a],t.Uu=6-t.Nu):64===f.gw?(t.Du=12,t.Nu=bt.zy[a],t.Uu=12-t.Nu):(t.Du=9,t.Nu=bt.Zy[a],t.Uu=9-t.Nu),0==(f.gw&c)||this.ip(h,s,n,f.gw)||f.Cw?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,f.x-bt.Oy,f.y-bt.ky,f.z-bt.Ry,f.Iu),0==(f._w&c)||this.ip(h,s,n,f._w)||f.bw?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,f.x-bt.Oy,f.y-bt.ky,f.z-bt.Ry,f.Iu)),u&&!this.visible(h,s,n,u.model.tl))if(0!=(u.type&c))u.model.draw(u.angle,bt.Ey,bt.vy,bt.Ly,bt.Sy,u.x-bt.Oy,u.y-bt.ky,u.z-bt.Ry,u.Iu);else if(0!=(768&u.type)){const t=u.x-bt.Oy,e=u.y-bt.ky,i=u.z-bt.Ry,s=u.angle;let n,r;if(n=s===at.Od||s===at.kd?-t:t,r=s===at.kd||s===at.Rd?-i:i,0!=(256&u.type)&&r<n){const n=t+bt.qy[s],r=i+bt.Ky[s];u.model.draw(512*s+256,bt.Ey,bt.vy,bt.Ly,bt.Sy,n,e,r,u.Iu)}if(0!=(512&u.type)&&r>n){const n=t+bt.Jy[s],r=i+bt.$y[s];u.model.draw(512*s+1280&2047,bt.Ey,bt.vy,bt.Ly,bt.Sy,n,e,r,u.Iu)}}if(o){const e=t.Su;e&&e.model?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,e.x-bt.Oy,e.y-bt.ky,e.z-bt.Ry,e.Iu);const i=t.Ou;i&&0===i.offset&&(i.Lw&&i.Lw.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,i.x-bt.Oy,i.y-bt.ky,i.z-bt.Ry,i.Iu),i.Ew&&i.Ew.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,i.x-bt.Oy,i.y-bt.ky,i.z-bt.Ry,i.Iu),i.Tw&&i.Tw.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,i.x-bt.Oy,i.y-bt.ky,i.z-bt.Ry,i.Iu))}const d=t.xu;if(0!==d){if(s<bt.xy&&0!=(4&d)){const t=l[s+1][n];t&&t.update&&bt.Ay.Nt(t)}if(n<bt.My&&0!=(2&d)){const t=l[s][n+1];t&&t.update&&bt.Ay.Nt(t)}if(s>bt.xy&&0!=(1&d)){const t=l[s-1][n];t&&t.update&&bt.Ay.Nt(t)}if(n>bt.My&&0!=(8&d)){const t=l[s][n-1];t&&t.update&&bt.Ay.Nt(t)}}}if(0!==t.Du){let e=!0;for(let i=0;i<t.Ru;i++){const s=t.Cu[i];if(s&&(s.je!==bt.je&&(t.bu[i]&t.Du)===t.Nu)){e=!1;break}}if(e){const e=t.vu;e&&!this.ip(h,s,n,e.gw)&&e.Cw?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,e.x-bt.Oy,e.y-bt.ky,e.z-bt.Ry,e.Iu),t.Du=0}}if(t.Fu){const e=t.Ru;t.Fu=!1;let r=0;t:for(let i=0;i<e;i++){const e=t.Cu[i];if(!e||e.je===bt.je)continue;for(let i=e.yu;i<=e.mu;i++)for(let s=e.pu;s<=e.Au;s++){const n=l[i][s];if(n){if(!n.visible){if(0===n.Du)continue;let r=0;if(i>e.yu&&(r+=1),i<e.mu&&(r+=4),s>e.pu&&(r+=8),s<e.Au&&(r+=2),(r&n.Du)!==t.Uu)continue}t.Fu=!0;continue t}}bt.wy[r++]=e;let s=bt.xy-e.yu;const n=e.mu-bt.xy;n>s&&(s=n);const h=bt.My-e.pu,o=e.Au-bt.My;e.gu=o>h?s+o:s+h}for(;;){let t=-50,e=-1;for(let i=0;i<r;i++){const s=bt.wy[i];s&&(s.je!==bt.je&&s.gu>t&&(t=s.gu,e=i))}if(-1===e)break;const o=bt.wy[e];if(o){o.je=bt.je;let t=o.model;t||(t=o.du?.draw(i)??null),t&&!this.sp(h,o.yu,o.mu,o.pu,o.Au,t.tl)&&t.draw(o.wu,bt.Ey,bt.vy,bt.Ly,bt.Sy,o.x-bt.Oy,o.y-bt.ky,o.z-bt.Ry,o.Iu);for(let t=o.yu;t<=o.mu;t++)for(let e=o.pu;e<=o.Au;e++){const i=l[t][e];i&&(0!==i.Du?bt.Ay.Nt(i):t===s&&e===n||!i.update||bt.Ay.Nt(i))}}}if(t.Fu)continue}if(!t.update||0!==t.Du)continue;if(s<=bt.xy&&s>bt.Fy){const t=l[s-1][n];if(t&&t.update)continue}if(s>=bt.xy&&s<bt.Dy-1){const t=l[s+1][n];if(t&&t.update)continue}if(n<=bt.My&&n>bt.Ny){const t=l[s][n-1];if(t&&t.update)continue}if(n>=bt.My&&n<bt.Uy-1){const t=l[s][n+1];if(t&&t.update)continue}t.update=!1,bt.By--;const o=t.Ou;if(o&&0!==o.offset&&(o.Lw&&o.Lw.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,o.x-bt.Oy,o.y-bt.ky-o.offset,o.z-bt.Ry,o.Iu),o.Ew&&o.Ew.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,o.x-bt.Oy,o.y-bt.ky-o.offset,o.z-bt.Ry,o.Iu),o.Tw&&o.Tw.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,o.x-bt.Oy,o.y-bt.ky-o.offset,o.z-bt.Ry,o.Iu)),0!==t.Pu){const e=t.Lu;if(e&&!this.visible(h,s,n,e.model.tl))if(0!=(e.type&t.Pu))e.model.draw(e.angle,bt.Ey,bt.vy,bt.Ly,bt.Sy,e.x-bt.Oy,e.y-bt.ky,e.z-bt.Ry,e.Iu);else if(0!=(768&e.type)){const t=e.x-bt.Oy,i=e.y-bt.ky,s=e.z-bt.Ry,n=e.angle;let r,h;if(r=n===at.Od||n===at.kd?-t:t,h=n===at.kd||n===at.Rd?-s:s,0!=(256&e.type)&&h>=r){const r=t+bt.qy[n],h=s+bt.Ky[n];e.model.draw(512*n+256,bt.Ey,bt.vy,bt.Ly,bt.Sy,r,i,h,e.Iu)}if(0!=(512&e.type)&&h<=r){const r=t+bt.Jy[n],h=s+bt.$y[n];e.model.draw(512*n+1280&2047,bt.Ey,bt.vy,bt.Ly,bt.Sy,r,i,h,e.Iu)}}const i=t.vu;i&&(0==(i._w&t.Pu)||this.ip(h,s,n,i._w)||i.bw?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,i.x-bt.Oy,i.y-bt.ky,i.z-bt.Ry,i.Iu),0==(i.gw&t.Pu)||this.ip(h,s,n,i.gw)||i.Cw?.draw(0,bt.Ey,bt.vy,bt.Ly,bt.Sy,i.x-bt.Oy,i.y-bt.ky,i.z-bt.Ry,i.Iu))}if(r<this.om-1){const t=this.fm[r+1][s][n];t&&t.update&&bt.Ay.Nt(t)}if(s<bt.xy){const t=l[s+1][n];t&&t.update&&bt.Ay.Nt(t)}if(n<bt.My){const t=l[s][n+1];t&&t.update&&bt.Ay.Nt(t)}if(s>bt.xy){const t=l[s-1][n];t&&t.update&&bt.Ay.Nt(t)}if(n>bt.My){const t=l[s][n-1];t&&t.update&&bt.Ay.Nt(t)}}};tp=(t,e,i,s,n,r,h,l)=>{let o,a,c,f,u=o=(i<<7)-bt.Oy,d=a=(s<<7)-bt.Ry,w=c=u+128,y=f=d+128,p=this.am[e][i][s]-bt.ky,A=this.am[e][i+1][s]-bt.ky,I=this.am[e][i+1][s+1]-bt.ky,g=this.am[e][i][s+1]-bt.ky,_=d*h+u*l>>16;if(d=d*l-u*h>>16,u=_,_=p*r-d*n>>16,d=p*n+d*r>>16,p=_,d<50)return;if(_=a*h+w*l>>16,a=a*l-w*h>>16,w=_,_=A*r-a*n>>16,a=A*n+a*r>>16,A=_,a<50)return;if(_=y*h+c*l>>16,y=y*l-c*h>>16,c=_,_=I*r-y*n>>16,y=I*n+y*r>>16,I=_,y<50)return;if(_=f*h+o*l>>16,f=f*l-o*h>>16,o=_,_=g*r-f*n>>16,f=g*n+f*r>>16,g=_,f<50)return;const C=D.Be+((u<<9)/d|0),b=D.We+((p<<9)/d|0),T=D.Be+((w<<9)/a|0),E=D.We+((A<<9)/a|0),v=D.Be+((c<<9)/y|0),L=D.We+((I<<9)/y|0),S=D.Be+((o<<9)/f|0),O=D.We+((g<<9)/f|0);if(D.alpha=0,(v-S)*(E-O)-(L-O)*(T-S)>0)if(D.He=v<0||S<0||T<0||v>m.Ct||S>m.Ct||T>m.Ct,bt.Wy&&this.np(bt.Gn,bt.Hn,L,O,E,v,S,T)&&(bt.nm=i,bt.rm=s),-1===t.xw)12345678!==t.kw&&D.oi(v,S,T,L,O,E,t.kw,t.Rw,t.Ow);else if(bt.Me){const e=bt.im[t.xw];D.oi(v,S,T,L,O,E,this.rp(e,t.kw),this.rp(e,t.Rw),this.rp(e,t.Ow))}else t.flat?D.ui(v,S,T,L,O,E,t.kw,t.Rw,t.Ow,u,p,d,w,o,A,g,a,f,t.xw):D.ui(v,S,T,L,O,E,t.kw,t.Rw,t.Ow,c,I,y,o,w,g,A,f,a,t.xw);if(!((C-T)*(O-E)-(b-E)*(S-T)<=0))if(D.He=C<0||T<0||S<0||C>m.Ct||T>m.Ct||S>m.Ct,bt.Wy&&this.np(bt.Gn,bt.Hn,b,E,O,C,T,S)&&(bt.nm=i,bt.rm=s),-1!==t.xw){if(!bt.Me)return void D.ui(C,T,S,b,E,O,t.Sw,t.Ow,t.Rw,u,p,d,w,o,A,g,a,f,t.xw);const e=bt.im[t.xw];D.oi(C,T,S,b,E,O,this.rp(e,t.Sw),this.rp(e,t.Ow),this.rp(e,t.Rw))}else 12345678!==t.Sw&&D.oi(C,T,S,b,E,O,t.Sw,t.Ow,t.Rw)};ep=(t,e,i,s,n,r,h)=>{let l=i.Uh.length;for(let t=0;t<l;t++){let e=i.Uh[t]-bt.Oy,l=i.kh[t]-bt.ky,o=i.Ph[t]-bt.Ry,a=o*r+e*h>>16;if(o=o*h-e*r>>16,e=a,a=l*n-o*s>>16,o=l*s+o*n>>16,l=a,o<50)return;i.Kw&&(gt.Dw[t]=e,gt.Nw[t]=l,gt.Uw[t]=o),gt.Mw[t]=D.Be+((e<<9)/o|0),gt.Fw[t]=D.We+((l<<9)/o|0)}D.alpha=0,l=i.zw.length;for(let s=0;s<l;s++){const n=i.zw[s],r=i.Zw[s],h=i.qw[s],l=gt.Mw[n],o=gt.Mw[r],a=gt.Mw[h],c=gt.Fw[n],f=gt.Fw[r],u=gt.Fw[h];if((l-o)*(u-f)-(c-f)*(a-o)>0)if(D.He=l<0||o<0||a<0||l>m.Ct||o>m.Ct||a>m.Ct,bt.Wy&&this.np(bt.Gn,bt.Hn,c,f,u,l,o,a)&&(bt.nm=t,bt.rm=e),i.Kw&&-1!==i.Kw[s])if(bt.Me){const t=bt.im[i.Kw[s]];D.oi(l,o,a,c,f,u,this.rp(t,i.Vw[s]),this.rp(t,i.Xw[s]),this.rp(t,i.jw[s]))}else i.flat?D.ui(l,o,a,c,f,u,i.Vw[s],i.Xw[s],i.jw[s],gt.Dw[0],gt.Nw[0],gt.Uw[0],gt.Dw[1],gt.Dw[3],gt.Nw[1],gt.Nw[3],gt.Uw[1],gt.Uw[3],i.Kw[s]):D.ui(l,o,a,c,f,u,i.Vw[s],i.Xw[s],i.jw[s],gt.Dw[n],gt.Nw[n],gt.Uw[n],gt.Dw[r],gt.Dw[h],gt.Nw[r],gt.Nw[h],gt.Uw[r],gt.Uw[h],i.Kw[s]);else 12345678!==i.Vw[s]&&D.oi(l,o,a,c,f,u,i.Vw[s],i.Xw[s],i.jw[s])}};Qm=(t,e,i)=>{const s=this.dm[t][e][i];if(s===-bt.je)return!1;if(s===bt.je)return!0;{const s=e<<7,n=i<<7;return this.hp(s+1,this.am[t][e][i],n+1)&&this.hp(s+128-1,this.am[t][e+1][i],n+1)&&this.hp(s+128-1,this.am[t][e+1][i+1],n+128-1)&&this.hp(s+1,this.am[t][e][i+1],n+128-1)?(this.dm[t][e][i]=bt.je,!0):(this.dm[t][e][i]=-bt.je,!1)}};ip=(t,e,i,s)=>{if(!this.Qm(t,e,i))return!1;const n=e<<7,r=i<<7,h=this.am[t][e][i]-1,l=h-120,o=h-230,a=h-238;if(s<16){if(1===s){if(n>bt.Oy){if(!this.hp(n,h,r))return!1;if(!this.hp(n,h,r+128))return!1}if(t>0){if(!this.hp(n,l,r))return!1;if(!this.hp(n,l,r+128))return!1}return!!this.hp(n,o,r)&&this.hp(n,o,r+128)}if(2===s){if(r<bt.Ry){if(!this.hp(n,h,r+128))return!1;if(!this.hp(n+128,h,r+128))return!1}if(t>0){if(!this.hp(n,l,r+128))return!1;if(!this.hp(n+128,l,r+128))return!1}return!!this.hp(n,o,r+128)&&this.hp(n+128,o,r+128)}if(4===s){if(n<bt.Oy){if(!this.hp(n+128,h,r))return!1;if(!this.hp(n+128,h,r+128))return!1}if(t>0){if(!this.hp(n+128,l,r))return!1;if(!this.hp(n+128,l,r+128))return!1}return!!this.hp(n+128,o,r)&&this.hp(n+128,o,r+128)}if(8===s){if(r>bt.Ry){if(!this.hp(n,h,r))return!1;if(!this.hp(n+128,h,r))return!1}if(t>0){if(!this.hp(n,l,r))return!1;if(!this.hp(n+128,l,r))return!1}return!!this.hp(n,o,r)&&this.hp(n+128,o,r)}}return!!this.hp(n+64,a,r+64)&&(16===s?this.hp(n,o,r+128):32===s?this.hp(n+128,o,r+128):64===s?this.hp(n+128,o,r):128===s?this.hp(n,o,r):(console.warn('Warning unsupported wall type!'),!0))};visible=(t,e,i,s)=>{if(this.Qm(t,e,i)){const n=e<<7,r=i<<7;return this.hp(n+1,this.am[t][e][i]-s,r+1)&&this.hp(n+128-1,this.am[t][e+1][i]-s,r+1)&&this.hp(n+128-1,this.am[t][e+1][i+1]-s,r+128-1)&&this.hp(n+1,this.am[t][e][i+1]-s,r+128-1)}return!1};sp=(t,e,i,s,n,r)=>{let h,l;if(e!==i||s!==n){for(h=e;h<=i;h++)for(l=s;l<=n;l++)if(this.dm[t][h][l]===-bt.je)return!1;l=1+(e<<7);const o=2+(s<<7),a=this.am[t][e][s]-r;if(!this.hp(l,a,o))return!1;const c=(i<<7)-1;if(!this.hp(c,a,o))return!1;const f=(n<<7)-1;return!!this.hp(l,a,f)&&this.hp(c,a,f)}return!!this.Qm(t,e,s)&&(h=e<<7,l=s<<7,this.hp(h+1,this.am[t][e][s]-r,l+1)&&this.hp(h+128-1,this.am[t][e+1][s]-r,l+1)&&this.hp(h+128-1,this.am[t][e+1][s+1]-r,l+128-1)&&this.hp(h+1,this.am[t][e][s+1]-r,l+128-1))};hp=(t,e,i)=>{for(let s=0;s<bt.sm;s++){const n=bt.py[s];if(n)if(1===n.mode){const s=n.Zh-t;if(s>0){const t=n.Kh+(n.Xu*s>>8),r=n.Jh+(n.ju*s>>8),h=n.Qh+(n.zu*s>>8),l=n.tl+(n.Zu*s>>8);if(i>=t&&i<=r&&e>=h&&e<=l)return!0}}else if(2===n.mode){const s=t-n.Zh;if(s>0){const t=n.Kh+(n.Xu*s>>8),r=n.Jh+(n.ju*s>>8),h=n.Qh+(n.zu*s>>8),l=n.tl+(n.Zu*s>>8);if(i>=t&&i<=r&&e>=h&&e<=l)return!0}}else if(3===n.mode){const s=n.Kh-i;if(s>0){const i=n.Zh+(n.Yu*s>>8),r=n.qh+(n.Vu*s>>8),h=n.Qh+(n.zu*s>>8),l=n.tl+(n.Zu*s>>8);if(t>=i&&t<=r&&e>=h&&e<=l)return!0}}else if(4===n.mode){const s=i-n.Kh;if(s>0){const i=n.Zh+(n.Yu*s>>8),r=n.qh+(n.Vu*s>>8),h=n.Qh+(n.zu*s>>8),l=n.tl+(n.Zu*s>>8);if(t>=i&&t<=r&&e>=h&&e<=l)return!0}}else if(5===n.mode){const s=e-n.Qh;if(s>0){const e=n.Zh+(n.Yu*s>>8),r=n.qh+(n.Vu*s>>8),h=n.Kh+(n.Xu*s>>8),l=n.Jh+(n.ju*s>>8);if(t>=e&&t<=r&&i>=h&&i<=l)return!0}}}return!1};np=(t,e,i,s,n,r,h,l)=>{if(e<i&&e<s&&e<n)return!1;if(e>i&&e>s&&e>n)return!1;if(t<r&&t<h&&t<l)return!1;if(t>r&&t>h&&t>l)return!1;const o=(e-s)*(l-h)-(t-h)*(n-s);return((e-i)*(h-r)-(t-r)*(s-i))*o>0&&o*((e-n)*(r-l)-(t-l)*(i-n))>0};rp=(t,e)=>((e=(127-e)*(127&t)/160|0)<2?e=2:e>126&&(e=126),(65408&t)+e)}class Tt{id=-1;lp=null;op=(t,e)=>{for(this.id=t;;){const i=e.te;if(0===i)break;this.decode(t,i,e)}}}class Et extends Tt{static count=0;static Cr=[];static br=t=>{const e=new v(t.read('flo.dat'));this.count=e.ie;for(let t=0;t<this.count;t++)this.Cr[t]=new Et,this.Cr[t].op(t,e)};static ap=(t,e,i)=>(i>179&&(e=e/2|0),i>192&&(e=e/2|0),i>217&&(e=e/2|0),i>243&&(e=e/2|0),((t/4|0)<<10)+((e/32|0)<<7)+(i/2|0));static cp=(t,e)=>-1===t?12345678:((e=e*(127&t)/128|0)<2?e=2:e>126&&(e=126),(65408&t)+e);static fp=(t,e)=>-2===t?12345678:-1===t?(e<0?e=0:e>127&&(e=127),127-e):((e=e*(127&t)/128|0)<2?e=2:e>126&&(e=126),(65408&t)+e);up=0;texture=-1;dp=!1;wp=!0;name=null;yp=0;mp=0;pp=0;Ap=0;Ip=0;gp=0;decode=(t,e,i)=>{1===e?(this.up=i.ne,this.setColor(this.up)):2===e?this.texture=i.te:3===e?this.dp=!0:5===e?this.wp=!1:6===e?this.name=i.ae:console.log('Error unrecognised config code: ',e)};setColor=t=>{const e=(t>>16&255)/256,i=(t>>8&255)/256,s=(255&t)/256;let n=e;i<e&&(n=i),s<n&&(n=s);let r=e;i>e&&(r=i),s>r&&(r=s);let h=0,l=0;const o=(n+r)/2;n!==r&&(o<.5&&(l=(r-n)/(r+n)),o>=.5&&(l=(r-n)/(2-r-n)),e===r?h=(i-s)/(r-n):i===r?h=(s-e)/(r-n)+2:s===r&&(h=(e-i)/(r-n)+4)),h/=6,this.yp=256*h|0,this.mp=256*l|0,this.pp=256*o|0,this.mp<0?this.mp=0:this.mp>255&&(this.mp=255),this.pp<0?this.pp=0:this.pp>255&&(this.pp=255),this.Ap=o>.5?(1-o)*l*512|0:o*l*512|0,this.Ap<1&&(this.Ap=1),this.Ip=h*this.Ap|0;let a=this.yp+(16*Math.random()|0)-8;a<0?a=0:a>255&&(a=255);let c=this.mp+(48*Math.random()|0)-24;c<0?c=0:c>255&&(c=255);let f=this.pp+(48*Math.random()|0)-24;f<0?f=0:f>255&&(f=255),this.gp=Et.ap(a,c,f)}}class vt extends Tt{static count=0;static cache=null;static pr=null;static _p=null;static Cp=0;static bp=new K(500);static Tp=new K(30);static br=t=>{this.pr=new v(t.read('loc.dat'));const e=new v(t.read('loc.idx'));this.count=e.ie,this._p=new Int32Array(this.count);let i=2;for(let t=0;t<this.count;t++)this._p[t]=i,i+=e.ie;this.cache=new S(10,null);for(let t=0;t<10;t++)this.cache[t]=new vt};static get=t=>{if(!this.cache||!this._p||!this.pr)throw new Error('LocType not loaded!!!');for(let e=0;e<10;e++){const i=this.cache[e];if(i&&i.index===t)return i}this.Cp=(this.Cp+1)%10;const e=this.cache[this.Cp];return this.pr.Jt=this._p[t],e.index=t,e.reset(),e.op(t,this.pr),e.Ep||(e.Ep=new Int32Array(1)),-1===e.vp&&e.Ep&&(e.active=e.Ep.length>0&&e.Ep[0]===ut.jd,e.Lp&&(e.active=!0)),e};static $e=()=>{this.bp=null,this.Tp=null,this._p=null,this.cache=null,this.pr=null};index=-1;Sp=null;Ep=null;name=null;Op=null;kp=null;Rp=null;width=1;length=1;xp=!0;Mp=!0;active=!1;vp=-1;Fp=!1;Dp=!1;wp=!1;ic=-1;Np=!1;Up=16;Pp=0;Bp=0;Lp=null;Wp=-1;Gp=-1;Hp=!1;Yp=!0;Vp=128;Xp=128;jp=128;zp=0;Zp=0;qp=0;Kp=0;Jp=!1;decode=(t,e,i)=>{if(1===e){const t=i.te;this.Sp=new Int32Array(t),this.Ep=new Int32Array(t);for(let e=0;e<t;e++)this.Sp[e]=i.ie,this.Ep[e]=i.te}else if(2===e)this.name=i.ae;else if(3===e)this.Op=i.ae;else if(14===e)this.width=i.te;else if(15===e)this.length=i.te;else if(17===e)this.xp=!1;else if(18===e)this.Mp=!1;else if(19===e)this.vp=i.te,1===this.vp&&(this.active=!0);else if(21===e)this.Fp=!0;else if(22===e)this.Dp=!0;else if(23===e)this.wp=!0;else if(24===e)this.ic=i.ie,65535===this.ic&&(this.ic=-1);else if(25===e)this.Np=!0;else if(28===e)this.Up=i.te;else if(29===e)this.Pp=i.ee;else if(39===e)this.Bp=i.ee;else if(e>=30&&e<39)this.Lp||(this.Lp=new S(5,null)),this.Lp[e-30]=i.ae,'hidden'===this.Lp[e-30]?.toLowerCase()&&(this.Lp[e-30]=null);else if(40===e){const t=i.te;this.kp=new Uint16Array(t),this.Rp=new Uint16Array(t);for(let e=0;e<t;e++)this.kp[e]=i.ie,this.Rp[e]=i.ie}else 60===e?this.Wp=i.ie:62===e?this.Hp=!0:64===e?this.Yp=!1:65===e?this.Vp=i.ie:66===e?this.Xp=i.ie:67===e?this.jp=i.ie:68===e?this.Gp=i.ie:69===e?this.zp=i.te:70===e?this.Zp=i.se:71===e?this.qp=i.se:72===e?this.Kp=i.se:73===e&&(this.Jp=!0)};tc=(t,e,i,s,n,r,h)=>{if(!this.Ep)return null;let l=-1;for(let e=0;e<this.Ep.length;e++)if(this.Ep[e]===t){l=e;break}if(-1===l)return null;const o=BigInt(BigInt(this.index)<<6n)+BigInt(BigInt(l)<<3n)+BigInt(e)+BigInt(BigInt(h)+1n<<32n);let a=vt.Tp?.get(o);if(a){if((this.Fp||this.Dp)&&(a=z.Oh(a,this.Fp,this.Dp)),this.Fp){const t=(i+s+n+r)/4|0;for(let e=0;e<a.Er;e++){const h=a.Uh[e],l=i+((s-i)*(h+64)/128|0),o=l+((r+((n-r)*(h+64)/128|0)-l)*(a.Ph[e]+64)/128|0);a.kh[e]+=o-t}a.pl()}return a}if(!this.Sp)return null;if(l>=this.Sp.length)return null;let c=this.Sp[l];if(-1===c)return null;const f=this.Hp!==e>3;f&&(c+=65536);let u=vt.bp?.get(BigInt(c));u||(u=z.model(65535&c),f&&u.El(),vt.bp?.put(BigInt(c),u));const d=128!==this.Vp||128!==this.Xp||128!==this.jp,w=0!==this.Zp||0!==this.qp||0!==this.Kp;let y=z.sl(u,!this.kp,!this.Np,e===at.Sd&&-1===h&&!d&&!w);for(-1!==h&&(y.Al(),y._l(h),y.ol=null,y.ll=null);e-- >0;)y.Cl();if(this.kp&&this.Rp)for(let t=0;t<this.kp.length;t++)y.Tl(this.kp[t],this.Rp[t]);if(d&&y.scale(this.Vp,this.Xp,this.jp),w&&y.translate(this.qp,this.Zp,this.Kp),y.vl(64+(255&this.Pp),5*(255&this.Bp)+768,-50,-10,-50,!this.Dp),this.xp&&(y.dl=y.tl),vt.Tp?.put(o,y),(this.Fp||this.Dp)&&(y=z.Oh(y,this.Fp,this.Dp)),this.Fp){const t=(i+s+n+r)/4|0;for(let e=0;e<y.Er;e++){const h=y.Uh[e],l=i+((s-i)*(h+64)/128|0),o=l+((r+((n-r)*(h+64)/128|0)-l)*(y.Ph[e]+64)/128|0);y.kh[e]+=o-t}y.pl()}return y};reset=()=>{this.Sp=null,this.Ep=null,this.name=null,this.Op=null,this.kp=null,this.Rp=null,this.width=1,this.length=1,this.xp=!0,this.Mp=!0,this.active=!1,this.vp=-1,this.Fp=!1,this.Dp=!1,this.wp=!1,this.ic=-1,this.Up=16,this.Pp=0,this.Bp=0,this.Lp=null,this.Np=!1,this.Wp=-1,this.Gp=-1,this.Hp=!1,this.Yp=!0,this.Vp=128,this.Xp=128,this.jp=128,this.zp=0,this.Zp=0,this.qp=0,this.Kp=0,this.Jp=!1}}class Lt extends w{$p;Qp;tA;eA;index;iA;cc;fc;constructor(t,e,i,s,n,r,h){super(),this.$p=e,this.Qp=i,this.tA=s,this.eA=n,this.index=t,this.iA=r,h&&-1!==r.sA&&this.iA.delay?(this.cc=Math.random()*this.iA.nA|0,this.fc=Math.random()*this.iA.delay[this.cc]|0):(this.cc=-1,this.fc=0)}}class St extends Tt{static count=0;static Cr=[];static br=t=>{const e=new v(t.read('seq.dat'));this.count=e.ie;for(let t=0;t<this.count;t++)this.Cr[t]=new St,this.Cr[t].op(t,e),0===this.Cr[t].nA&&(this.Cr[t].nA=1,this.Cr[t].frames=new Int16Array(1),this.Cr[t].frames[0]=-1,this.Cr[t].rA=new Int16Array(1),this.Cr[t].rA[0]=-1,this.Cr[t].delay=new Int16Array(1),this.Cr[t].delay[0]=-1)};nA=0;frames=null;rA=null;delay=null;sA=-1;hA=null;lA=!1;priority=5;oA=-1;aA=-1;cA=99;duration=0;decode=(t,e,i)=>{if(1===e){this.nA=i.te,this.frames=new Int16Array(this.nA),this.rA=new Int16Array(this.nA),this.delay=new Int16Array(this.nA);for(let t=0;t<this.nA;t++)this.frames[t]=i.ie,this.rA[t]=i.ie,65535===this.rA[t]&&(this.rA[t]=-1),this.delay[t]=i.ie,0===this.delay[t]&&(this.delay[t]=V.Cr[this.frames[t]].delay),0===this.delay[t]&&(this.delay[t]=1),this.duration+=this.delay[t]}else if(2===e)this.sA=i.ie;else if(3===e){const t=i.te;this.hA=new Int32Array(t+1);for(let e=0;e<t;e++)this.hA[e]=i.te;this.hA[t]=9999999}else if(4===e)this.lA=!0;else if(5===e)this.priority=i.te;else if(6===e)this.oA=i.ie;else if(7===e)this.aA=i.ie;else{if(8!==e)throw new Error(`Unrecognized seq config code: ${e}`);this.cA=i.te}}}class Ot{static RED=16711680;static GREEN=65280;static BLUE=255;static fA=16776960;static uA=65535;static dA=16711935;static wA=16777215;static yA=0;static mA=16748608;static pA=8388608;static AA=128;static IA=16756736;static gA=16740352;static _A=16723968;static CA=12648192;static bA=8453888;static TA=4259584;static EA=9179409;static vA=6116423;static LA=2301979;static SA=5063219;static OA=7759444;static kA=3353893;static RA=8388736;static xA=13350793;static MA=Int32Array.of(Ot.fA,Ot.RED,Ot.GREEN,Ot.uA,Ot.dA,Ot.wA)}class kt{static FA=Int32Array.of(1,2,4,8);static DA=Int32Array.of(16,32,64,128);static NA=Int32Array.of(1,0,-1,0);static UA=Int32Array.of(0,-1,0,1);static PA=(17*Math.random()|0)-8;static BA=(33*Math.random()|0)-16;static Me=!0;static WA=0;static GA=!1;static HA=(t,e)=>{let i=this.YA(t+45365,e+91923,4)+(this.YA(t+10294,e+37821,2)-128>>1)+(this.YA(t,e,1)-128>>2)-128;return i=35+(.3*i|0),i<10?i=10:i>60&&(i=60),i};static YA=(t,e,i)=>{const s=t/i|0,n=t&i-1,r=e/i|0,h=e&i-1,l=this.VA(s,r),o=this.VA(s+1,r),a=this.VA(s,r+1),c=this.VA(s+1,r+1),f=this.XA(l,o,n,i),u=this.XA(a,c,n,i);return this.XA(f,u,h,i)};static XA=(t,e,i,s)=>{const n=65536-D.cos[1024*i/s|0]>>1;return(t*(65536-n)>>16)+(e*n>>16)};static VA=(t,e)=>((this.jA(t-1,e-1)+this.jA(t+1,e-1)+this.jA(t-1,e+1)+this.jA(t+1,e+1))/16|0)+((this.jA(t-1,e)+this.jA(t+1,e)+this.jA(t,e-1)+this.jA(t,e+1))/8|0)+(this.jA(t,e)/4|0);static jA=(t,e)=>{const i=t+57*e,s=i<<13^i,n=BigInt(s)*(BigInt(s)*BigInt(s)*15731n+789221n)+1376312589n&0x7fffffffn;return 255&Number(n>>19n)};static dw=(t,e,i,s,n,r,h,l,o,a,c)=>{const f=n[c][e][i],u=n[c][e+1][i],d=n[c][e+1][i+1],w=n[c][e][i+1],y=f+u+d+w>>2,m=vt.get(l);let p=e+(i<<7)+(l<<14)+1073741824|0;m.active||(p+=-2147483648),p|=0;const A=((a<<6)+o|0)<<24>>24;if(o===ut.Dd)s?.Tm(m.tc(ut.Dd,a,f,u,d,w,-1),t,e,i,y,p,A),m.xp&&m.active&&h.fw(e,i),-1!==m.ic&&r.Nt(new Lt(l,t,3,e,i,St.Cr[m.ic],!0));else if(o===ut.jd||o===ut.zd){const n=m.tc(ut.jd,a,f,u,d,w,-1);if(n){let r,h,l=0;o===ut.zd&&(l+=256),a===at.Od||a===at.Rd?(r=m.length,h=m.width):(r=m.width,h=m.length),s?.dw(t,e,i,y,n,null,p,A,r,h,l)}m.xp&&h.dw(e,i,m.width,m.length,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,2,e,i,St.Cr[m.ic],!0))}else if(o>=ut.Zd)s?.dw(t,e,i,y,m.tc(o,a,f,u,d,w,-1),null,p,A,1,1,0),m.xp&&h.dw(e,i,m.width,m.length,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,2,e,i,St.Cr[m.ic],!0));else if(o===ut.Nd)s?.yw(t,e,i,y,kt.FA[a],0,m.tc(ut.Nd,a,f,u,d,w,-1),null,p,A),m.xp&&h.yw(e,i,o,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,0,e,i,St.Cr[m.ic],!0));else if(o===ut.Ud)s?.yw(t,e,i,y,kt.DA[a],0,m.tc(ut.Ud,a,f,u,d,w,-1),null,p,A),m.xp&&h.yw(e,i,o,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,0,e,i,St.Cr[m.ic],!0));else if(o===ut.Pd){const n=a+1&3;s?.yw(t,e,i,y,kt.FA[a],kt.FA[n],m.tc(ut.Pd,a+4,f,u,d,w,-1),m.tc(ut.Pd,n,f,u,d,w,-1),p,A),m.xp&&h.yw(e,i,o,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,0,e,i,St.Cr[m.ic],!0))}else if(o===ut.Bd)s?.yw(t,e,i,y,kt.DA[a],0,m.tc(ut.Bd,a,f,u,d,w,-1),null,p,A),m.xp&&h.yw(e,i,o,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,0,e,i,St.Cr[m.ic],!0));else if(o===ut.Xd)s?.dw(t,e,i,y,m.tc(o,a,f,u,d,w,-1),null,p,A,1,1,0),m.xp&&h.dw(e,i,m.width,m.length,a,m.Mp),-1!==m.ic&&r.Nt(new Lt(l,t,2,e,i,St.Cr[m.ic],!0));else if(o===ut.Wd)s?.Sm(t,e,i,y,0,0,p,m.tc(ut.Wd,at.Sd,f,u,d,w,-1),A,512*a,kt.FA[a]),-1!==m.ic&&r.Nt(new Lt(l,t,1,e,i,St.Cr[m.ic],!0));else if(o===ut.Gd){let n=16;if(s){const r=s.Gm(t,e,i);r>0&&(n=vt.get(r>>14&32767).Up)}s?.Sm(t,e,i,y,kt.NA[a]*n,kt.UA[a]*n,p,m.tc(ut.Wd,at.Sd,f,u,d,w,-1),A,512*a,kt.FA[a]),-1!==m.ic&&r.Nt(new Lt(l,t,1,e,i,St.Cr[m.ic],!0))}else o===ut.Hd?(s?.Sm(t,e,i,y,0,0,p,m.tc(ut.Wd,at.Sd,f,u,d,w,-1),A,a,256),-1!==m.ic&&r.Nt(new Lt(l,t,1,e,i,St.Cr[m.ic],!0))):o===ut.Yd?(s?.Sm(t,e,i,y,0,0,p,m.tc(ut.Wd,at.Sd,f,u,d,w,-1),A,a,512),-1!==m.ic&&r.Nt(new Lt(l,t,1,e,i,St.Cr[m.ic],!0))):o===ut.Vd&&(s?.Sm(t,e,i,y,0,0,p,m.tc(ut.Wd,at.Sd,f,u,d,w,-1),A,a,768),-1!==m.ic&&r.Nt(new Lt(l,t,1,e,i,St.Cr[m.ic],!0)))};Wu;Hu;zA;ZA;qA;KA;JA;$A;QA;tI;eI;iI;sI;nI;rI;hI;constructor(t,e,i,s){this.Wu=t,this.Hu=e,this.zA=i,this.ZA=s,this.qA=new x(wt.ow,t,e),this.KA=new x(wt.ow,t,e),this.JA=new x(wt.ow,t,e),this.$A=new x(wt.ow,t,e),this.hI=new F(wt.ow,t+1,e+1),this.QA=new x(wt.ow,t+1,e+1),this.tI=new M(t+1,e+1),this.eI=new Int32Array(e),this.iI=new Int32Array(e),this.sI=new Int32Array(e),this.nI=new Int32Array(e),this.rI=new Int32Array(e)}lI=(t,e)=>{for(let t=0;t<wt.ow;t++)for(let i=0;i<wt.aw;i++)for(let s=0;s<wt.aw;s++)if(1==(1&this.ZA[t][i][s])){let n=t;2==(2&this.ZA[1][i][s])&&n--,n>=0&&e[n]?.fw(i,s)}kt.PA+=(5*Math.random()|0)-2,kt.PA<-8?kt.PA=-8:kt.PA>8&&(kt.PA=8),kt.BA+=(5*Math.random()|0)-2,kt.BA<-16?kt.BA=-16:kt.BA>16&&(kt.BA=16);for(let e=0;e<wt.ow;e++){const i=this.QA[e],s=96,n=-50,r=-10,h=-50,l=768*(0|Math.sqrt(n*n+r*r+h*h))>>8;for(let t=1;t<this.Hu-1;t++)for(let o=1;o<this.Wu-1;o++){const a=this.zA[e][o+1][t]-this.zA[e][o-1][t],c=this.zA[e][o][t+1]-this.zA[e][o][t-1],f=0|Math.sqrt(a*a+c*c+65536),u=s+((n*((a<<8)/f|0)+r*(65536/f|0)+h*((c<<8)/f|0))/l|0),d=(i[o-1][t]>>2)+(i[o+1][t]>>3)+(i[o][t-1]>>2)+(i[o][t+1]>>3)+(i[o][t]>>1);this.tI[o][t]=u-d}for(let t=0;t<this.Hu;t++)this.eI[t]=0,this.iI[t]=0,this.sI[t]=0,this.nI[t]=0,this.rI[t]=0;for(let i=-5;i<this.Wu+5;i++){for(let t=0;t<this.Hu;t++){const s=i+5;let n;if(s>=0&&s<this.Wu){const i=255&this.qA[e][s][t];if(i>0){const e=Et.Cr[i-1];this.eI[t]+=e.Ip,this.iI[t]+=e.mp,this.sI[t]+=e.pp,this.nI[t]+=e.Ap,n=this.rI[t]++}}const r=i-5;if(r>=0&&r<this.Wu){const i=255&this.qA[e][r][t];if(i>0){const e=Et.Cr[i-1];this.eI[t]-=e.Ip,this.iI[t]-=e.mp,this.sI[t]-=e.pp,this.nI[t]-=e.Ap,n=this.rI[t]--}}}if(i>=1&&i<this.Wu-1){let s=0,n=0,r=0,h=0,l=0;for(let o=-5;o<this.Hu+5;o++){const a=o+5;a>=0&&a<this.Hu&&(s+=this.eI[a],n+=this.iI[a],r+=this.sI[a],h+=this.nI[a],l+=this.rI[a]);const c=o-5;if(c>=0&&c<this.Hu&&(s-=this.eI[c],n-=this.iI[c],r-=this.sI[c],h-=this.nI[c],l-=this.rI[c]),o>=1&&o<this.Hu-1&&(!kt.Me||0==(16&this.ZA[e][i][o])&&this.oI(e,i,o)===kt.WA)){const a=255&this.qA[e][i][o],c=255&this.KA[e][i][o];if(a>0||c>0){const f=this.zA[e][i][o],u=this.zA[e][i+1][o],d=this.zA[e][i+1][o+1],w=this.zA[e][i][o+1],y=this.tI[i][o],m=this.tI[i+1][o],p=this.tI[i+1][o+1],A=this.tI[i][o+1];let I=-1,g=-1;if(a>0){const t=256*s/h|0,e=n/l|0;let i=r/l|0;I=Et.ap(t,e,i);const o=t+kt.PA&255;i+=kt.BA,i<0?i=0:i>255&&(i=255),g=Et.ap(o,e,i)}if(e>0){let t=0!==a||this.JA[e][i][o]===Ct.Qw;c>0&&!Et.Cr[c-1].wp&&(t=!1),t&&f===u&&f===d&&f===w&&(this.hI[e][i][o]|=2340)}let _=0;if(-1!==I&&(_=D.palette[Et.cp(g,96)]),0===c)t?.bm(e,i,o,Ct.Qw,at.Sd,-1,f,u,d,w,Et.cp(I,y),Et.cp(I,m),Et.cp(I,p),Et.cp(I,A),Ot.yA,Ot.yA,Ot.yA,Ot.yA,_,Ot.yA);else{const s=this.JA[e][i][o]+1,n=this.$A[e][i][o],r=Et.Cr[c-1];let h,l,a=r.texture;a>=0?(l=D.si(a),h=-1):r.up===Ot.dA?(l=0,h=-2,a=-1):(h=Et.ap(r.yp,r.mp,r.pp),l=D.palette[Et.fp(r.gp,96)]),t?.bm(e,i,o,s,n,a,f,u,d,w,Et.cp(I,y),Et.cp(I,m),Et.cp(I,p),Et.cp(I,A),Et.fp(h,y),Et.fp(h,m),Et.fp(h,p),Et.fp(h,A),_,l)}}}}}}for(let i=1;i<this.Hu-1;i++)for(let s=1;s<this.Wu-1;s++)t?.Cm(e,s,i,this.oI(e,s,i))}kt.GA||t?.jm(64,768,-50,-10,-50);for(let e=0;e<this.Wu;e++)for(let i=0;i<this.Hu;i++)2==(2&this.ZA[1][e][i])&&t?._m(e,i);if(!kt.GA){let t=1,e=2,i=4;for(let s=0;s<wt.ow;s++){s>0&&(t<<=3,e<<=3,i<<=3);for(let n=0;n<=s;n++)for(let r=0;r<=this.Hu;r++)for(let h=0;h<=this.Wu;h++){if(0!=(this.hI[n][h][r]&t)){let e=r,i=r,l=n,o=n;for(;e>0&&0!=(this.hI[n][h][e-1]&t);)e--;for(;i<this.Hu&&0!=(this.hI[n][h][i+1]&t);)i++;t:for(;l>0;){for(let s=e;s<=i;s++)if(0==(this.hI[l-1][h][s]&t))break t;l--}t:for(;o<s;){for(let s=e;s<=i;s++)if(0==(this.hI[o+1][h][s]&t))break t;o++}if((o+1-l)*(i+1-e)>=8){const n=this.zA[o][h][e]-240,r=this.zA[l][h][e];bt.lm(s,1,128*h,n,128*e,128*h,r,128*i+128);for(let s=l;s<=o;s++)for(let n=e;n<=i;n++)this.hI[s][h][n]&=~t}}if(0!=(this.hI[n][h][r]&e)){let t=h,i=h,l=n,o=n;for(;t>0&&0!=(this.hI[n][t-1][r]&e);)t--;for(;i<this.Wu&&0!=(this.hI[n][i+1][r]&e);)i++;t:for(;l>0;){for(let s=t;s<=i;s++)if(0==(this.hI[l-1][s][r]&e))break t;l--}t:for(;o<s;){for(let s=t;s<=i;s++)if(0==(this.hI[o+1][s][r]&e))break t;o++}if((o+1-l)*(i+1-t)>=8){const n=this.zA[o][t][r]-240,h=this.zA[l][t][r];bt.lm(s,2,128*t,n,128*r,128*i+128,h,128*r);for(let s=l;s<=o;s++)for(let n=t;n<=i;n++)this.hI[s][n][r]&=~e}}if(0!=(this.hI[n][h][r]&i)){let t=h,e=h,l=r,o=r;for(;l>0&&0!=(this.hI[n][h][l-1]&i);)l--;for(;o<this.Hu&&0!=(this.hI[n][h][o+1]&i);)o++;t:for(;t>0;){for(let e=l;e<=o;e++)if(0==(this.hI[n][t-1][e]&i))break t;t--}t:for(;e<this.Wu;){for(let t=l;t<=o;t++)if(0==(this.hI[n][e+1][t]&i))break t;e++}if((e+1-t)*(o+1-l)>=4){const r=this.zA[n][t][l];bt.lm(s,4,128*t,r,128*l,128*e+128,r,128*o+128);for(let s=t;s<=e;s++)for(let t=l;t<=o;t++)this.hI[n][s][t]&=~i}}}}}};aI=(t,e,i,s)=>{let n=0;for(let t=0;t<Et.count;t++)if('water'===Et.Cr[t].name?.toLowerCase()){n=t+1<<24>>24;break}for(let r=t;r<t+i;r++)for(let t=e;t<e+s;t++)if(t>=0&&t<this.Wu&&r>=0&&r<this.Hu){this.KA[0][t][r]=n;for(let e=0;e<wt.ow;e++)this.zA[e][t][r]=0,this.ZA[e][t][r]=0}};cI=(t,e,i,s,n)=>{const r=new v(new Uint8Array(n));for(let n=0;n<wt.ow;n++)for(let h=0;h<64;h++)for(let l=0;l<64;l++){const o=h+i,a=l+s;let c;if(o>=0&&o<wt.aw&&a>=0&&a<wt.aw)for(this.ZA[n][o][a]=0;;){if(c=r.te,0===c){0===n?this.zA[0][o][a]=8*-kt.HA(o+t+932731,a+556238+e):this.zA[n][o][a]=this.zA[n-1][o][a]-240;break}if(1===c){let t=r.te;1===t&&(t=0),0===n?this.zA[0][o][a]=8*-t:this.zA[n][o][a]=this.zA[n-1][o][a]-8*t;break}c<=49?(this.KA[n][o][a]=r.ee,this.JA[n][o][a]=((c-2)/4|0)<<24>>24,this.$A[n][o][a]=(c-2&3)<<24>>24):c<=81?this.ZA[n][o][a]=c-49<<24>>24:this.qA[n][o][a]=c-81<<24>>24}else for(;c=r.te,0!==c;){if(1===c){r.te;break}c<=49&&r.te}}};fI=(t,e,i,s,n,r)=>{const h=new v(new Uint8Array(s));let l=-1;for(;;){const s=h.oe;if(0===s)return;l+=s;let o=0;for(;;){const s=h.oe;if(0===s)break;o+=s-1;const a=63&o,c=o>>6&63,f=o>>12,u=h.te,d=u>>2,w=3&u,y=c+n,m=a+r;if(y>0&&m>0&&y<wt.aw-1&&m<wt.aw-1){let s=f;2==(2&this.ZA[1][y][m])&&(s=f-1);let n=null;s>=0&&(n=i[s]),this.dw(f,y,m,t,e,n,l,d,w)}}}};dw=(t,e,i,s,n,r,h,l,o)=>{if(kt.Me){if(0!=(16&this.ZA[t][e][i]))return;if(this.oI(t,e,i)!==kt.WA)return}const a=this.zA[t][e][i],c=this.zA[t][e+1][i],f=this.zA[t][e+1][i+1],u=this.zA[t][e][i+1],d=a+c+f+u>>2,w=vt.get(h);let y=e+(i<<7)+(h<<14)+1073741824|0;w.active||(y+=-2147483648),y|=0;const m=((o<<6)+l|0)<<24>>24;if(l===ut.Dd)(!kt.Me||w.active||w.Jp)&&(s?.Tm(w.tc(ut.Dd,o,a,c,f,u,-1),t,e,i,d,y,m),w.xp&&w.active&&r&&r.fw(e,i),-1!==w.ic&&n.Nt(new Lt(h,t,3,e,i,St.Cr[w.ic],!0)));else if(l===ut.jd||l===ut.zd){const p=w.tc(ut.jd,o,a,c,f,u,-1);if(p){let n,r,h=0;if(l===ut.zd&&(h+=256),o===at.Od||o===at.Rd?(n=w.length,r=w.width):(n=w.width,r=w.length),s?.dw(t,e,i,d,p,null,y,m,n,r,h)&&w.Yp)for(let s=0;s<=n;s++)for(let n=0;n<=r;n++){let r=p.$h/4|0;r>30&&(r=30),r>this.QA[t][e+s][i+n]&&(this.QA[t][e+s][i+n]=r<<24>>24)}}w.xp&&r&&r.dw(e,i,w.width,w.length,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,2,e,i,St.Cr[w.ic],!0))}else if(l>=ut.Zd)s?.dw(t,e,i,d,w.tc(l,o,a,c,f,u,-1),null,y,m,1,1,0),l>=ut.Zd&&l<=ut.Qd&&l!==ut.qd&&t>0&&(this.hI[t][e][i]|=2340),w.xp&&r&&r.dw(e,i,w.width,w.length,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,2,e,i,St.Cr[w.ic],!0));else if(l===ut.Nd)s?.yw(t,e,i,d,kt.FA[o],0,w.tc(ut.Nd,o,a,c,f,u,-1),null,y,m),o===at.Sd?(w.Yp&&(this.QA[t][e][i]=50,this.QA[t][e][i+1]=50),w.wp&&(this.hI[t][e][i]|=585)):o===at.Od?(w.Yp&&(this.QA[t][e][i+1]=50,this.QA[t][e+1][i+1]=50),w.wp&&(this.hI[t][e][i+1]|=1170)):o===at.kd?(w.Yp&&(this.QA[t][e+1][i]=50,this.QA[t][e+1][i+1]=50),w.wp&&(this.hI[t][e+1][i]|=585)):o===at.Rd&&(w.Yp&&(this.QA[t][e][i]=50,this.QA[t][e+1][i]=50),w.wp&&(this.hI[t][e][i]|=1170)),w.xp&&r&&r.yw(e,i,l,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,0,e,i,St.Cr[w.ic],!0)),16!==w.Up&&s?.km(t,e,i,w.Up);else if(l===ut.Ud)s?.yw(t,e,i,d,kt.DA[o],0,w.tc(ut.Ud,o,a,c,f,u,-1),null,y,m),w.Yp&&(o===at.Sd?this.QA[t][e][i+1]=50:o===at.Od?this.QA[t][e+1][i+1]=50:o===at.kd?this.QA[t][e+1][i]=50:o===at.Rd&&(this.QA[t][e][i]=50)),w.xp&&r&&r.yw(e,i,l,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,0,e,i,St.Cr[w.ic],!0));else if(l===ut.Pd){const p=o+1&3;s?.yw(t,e,i,d,kt.FA[o],kt.FA[p],w.tc(ut.Pd,o+4,a,c,f,u,-1),w.tc(ut.Pd,p,a,c,f,u,-1),y,m),w.wp&&(o===at.Sd?(this.hI[t][e][i]|=265,this.hI[t][e][i+1]|=1170):o===at.Od?(this.hI[t][e][i+1]|=1170,this.hI[t][e+1][i]|=585):o===at.kd?(this.hI[t][e+1][i]|=585,this.hI[t][e][i]|=1170):o===at.Rd&&(this.hI[t][e][i]|=1170,this.hI[t][e][i]|=585)),w.xp&&r&&r.yw(e,i,l,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,0,e,i,St.Cr[w.ic],!0)),16!==w.Up&&s?.km(t,e,i,w.Up)}else if(l===ut.Bd)s?.yw(t,e,i,d,kt.DA[o],0,w.tc(ut.Bd,o,a,c,f,u,-1),null,y,m),w.Yp&&(o===at.Sd?this.QA[t][e][i+1]=50:o===at.Od?this.QA[t][e+1][i+1]=50:o===at.kd?this.QA[t][e+1][i]=50:o===at.Rd&&(this.QA[t][e][i]=50)),w.xp&&r&&r.yw(e,i,l,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,0,e,i,St.Cr[w.ic],!0));else if(l===ut.Xd)s?.dw(t,e,i,d,w.tc(l,o,a,c,f,u,-1),null,y,m,1,1,0),w.xp&&r&&r.dw(e,i,w.width,w.length,o,w.Mp),-1!==w.ic&&n.Nt(new Lt(h,t,2,e,i,St.Cr[w.ic],!0));else if(l===ut.Wd)s?.Sm(t,e,i,d,0,0,y,w.tc(ut.Wd,at.Sd,a,c,f,u,-1),m,512*o,kt.FA[o]),-1!==w.ic&&n.Nt(new Lt(h,t,1,e,i,St.Cr[w.ic],!0));else if(l===ut.Gd){let r=16;if(s){const n=s.Gm(t,e,i);n>0&&(r=vt.get(n>>14&32767).Up)}s?.Sm(t,e,i,d,kt.NA[o]*r,kt.UA[o]*r,y,w.tc(ut.Wd,at.Sd,a,c,f,u,-1),m,512*o,kt.FA[o]),-1!==w.ic&&n.Nt(new Lt(h,t,1,e,i,St.Cr[w.ic],!0))}else l===ut.Hd?(s?.Sm(t,e,i,d,0,0,y,w.tc(ut.Wd,at.Sd,a,c,f,u,-1),m,o,256),-1!==w.ic&&n.Nt(new Lt(h,t,1,e,i,St.Cr[w.ic],!0))):l===ut.Yd?(s?.Sm(t,e,i,d,0,0,y,w.tc(ut.Wd,at.Sd,a,c,f,u,-1),m,o,512),-1!==w.ic&&n.Nt(new Lt(h,t,1,e,i,St.Cr[w.ic],!0))):l===ut.Vd&&(s?.Sm(t,e,i,d,0,0,y,w.tc(ut.Wd,at.Sd,a,c,f,u,-1),m,o,768),-1!==w.ic&&n.Nt(new Lt(h,t,1,e,i,St.Cr[w.ic],!0)))};oI=(t,e,i)=>0==(8&this.ZA[t][e][i])?t<=0||0==(2&this.ZA[1][e][i])?t:t-1:0}class Rt extends w{}class xt extends Rt{x=0;z=0;wu=0;uI=!1;size=1;dI=-1;wI=-1;yI=-1;mI=-1;pI=-1;AI=-1;II=-1;gI=null;_I=100;CI=0;bI=0;TI=0;EI=0;vI=-1e3;LI=0;SI=0;OI=-1;kI=0;RI=0;xI=-1;MI=0;FI=0;DI=-1;NI=0;UI=0;BI=0;WI=0;GI=-1;HI=0;YI=0;VI=0;XI=0;jI=0;zI=0;ZI=0;qI=0;KI=0;JI=0;$I=0;je=0;height=0;QI=0;pathLength=0;tg=new Int32Array(10);eg=new Int32Array(10);ig=new S(10,!1);sg=0;ng=-1;rg=-1;hg=-1;lg=-1;move=(t,e,i)=>{if(-1!==this.DI&&St.Cr[this.DI].priority<=1&&(this.DI=-1),!t){const t=e-this.tg[0],s=i-this.eg[0];if(t>=-8&&t<=8&&s>=-8&&s<=8){this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.tg[t]=this.tg[t-1],this.eg[t]=this.eg[t-1],this.ig[t]=this.ig[t-1];return this.tg[0]=e,this.eg[0]=i,void(this.ig[0]=!1)}}this.pathLength=0,this.sg=0,this.tg[0]=e,this.eg[0]=i,this.x=128*this.tg[0]+64*this.size,this.z=128*this.eg[0]+64*this.size};step=(t,e)=>{let i=this.tg[0],s=this.eg[0];0===e?(i--,s++):1===e?s++:2===e?(i++,s++):3===e?i--:4===e?i++:5===e?(i--,s--):6===e?s--:7===e&&(i++,s--),-1!==this.DI&&St.Cr[this.DI].priority<=1&&(this.DI=-1),this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.tg[t]=this.tg[t-1],this.eg[t]=this.eg[t-1],this.ig[t]=this.ig[t-1];this.tg[0]=i,this.eg[0]=s,this.ig[0]=t}}class Mt extends Tt{static count=0;static Cr=[];static so=new K(30);static br=t=>{const e=new v(t.read('spotanim.dat'));this.count=e.ie;for(let t=0;t<this.count;t++)this.Cr[t]=new Mt,this.Cr[t].index=t,this.Cr[t].op(t,e)};index=0;model=0;ic=-1;iA=null;Np=!1;kp=new Uint16Array(6);Rp=new Uint16Array(6);og=128;ag=128;orientation=0;Pp=0;Bp=0;decode=(t,e,i)=>{if(1===e)this.model=i.ie;else if(2===e)this.ic=i.ie,St.Cr&&(this.iA=St.Cr[this.ic]);else if(3===e)this.Np=!0;else if(4===e)this.og=i.ie;else if(5===e)this.ag=i.ie;else if(6===e)this.orientation=i.ie;else if(7===e)this.Pp=i.te;else if(8===e)this.Bp=i.te;else if(e>=40&&e<50)this.kp[e-40]=i.ie;else{if(!(e>=50&&e<60))throw new Error(`Unrecognized spotanim config code: ${e}`);this.Rp[e-50]=i.ie}};tc=()=>{let t=Mt.so?.get(BigInt(this.index));if(t)return t;t=z.model(this.model);for(let e=0;e<6;e++)0!==this.kp[0]&&t.Tl(this.kp[e],this.Rp[e]);return Mt.so?.put(BigInt(this.index),t),t}}class Ft extends Tt{static count=0;static Cr=[];static br=t=>{const e=new v(t.read('idk.dat'));this.count=e.ie;for(let t=0;t<this.count;t++)this.Cr[t]=new Ft,this.Cr[t].op(t,e)};type=-1;Sp=null;cg=new Int32Array(5).fill(-1);kp=new Int32Array(6);Rp=new Int32Array(6);disable=!1;decode=(t,e,i)=>{if(1===e)this.type=i.te;else if(2===e){const t=i.te;this.Sp=new Int32Array(t);for(let e=0;e<t;e++)this.Sp[e]=i.ie}else if(3===e)this.disable=!0;else if(e>=40&&e<50)this.kp[e-40]=i.ie;else if(e>=50&&e<60)this.Rp[e-50]=i.ie;else{if(!(e>=60&&e<70))throw new Error(`Unrecognized idk config code: ${e}`);this.cg[e-60]=i.ie}};tc=()=>{if(!this.Sp)return null;const t=new S(this.Sp.length,null);for(let e=0;e<this.Sp.length;e++)t[e]=z.model(this.Sp[e]);let e;e=1===t.length?t[0]:z.fl(t,t.length);for(let t=0;t<6&&0!==this.kp[t];t++)e?.Tl(this.kp[t],this.Rp[t]);return e};fg=()=>{let t=0;const e=new S(5,null);for(let i=0;i<5;i++)-1!==this.cg[i]&&(e[t++]=z.model(this.cg[i]));const i=z.fl(e,t);for(let t=0;t<6&&0!==this.kp[t];t++)i.Tl(this.kp[t],this.Rp[t]);return i}}class Dt extends Tt{static count=0;static cache=null;static pr=null;static _p=null;static Cp=0;static ug=!0;static so=new K(50);static dg=new K(200);static br=(t,e)=>{this.ug=e,this.pr=new v(t.read('obj.dat'));const i=new v(t.read('obj.idx'));this.count=i.ie,this._p=new Int32Array(this.count);let s=2;for(let t=0;t<this.count;t++)this._p[t]=s,s+=i.ie;this.cache=new S(10,null);for(let t=0;t<10;t++)this.cache[t]=new Dt};static get=t=>{if(!this.cache||!this._p||!this.pr)throw new Error('ObjType not loaded!!!');for(let e=0;e<10;e++){const i=this.cache[e];if(i&&i.index===t)return i}this.Cp=(this.Cp+1)%10;const e=this.cache[this.Cp];return this.pr.Jt=this._p[t],e.index=t,e.reset(),e.op(t,this.pr),-1!==e.wg&&e.yg(),!this.ug&&e.mg&&(e.name='Members Object',e.Op="Login to a members' server to use this object.",e.Lp=null,e.Xa=null),e};static $e=()=>{this.so=null,this.dg=null,this._p=null,this.cache=null,this.pr=null};static pg=(t,e)=>{if(Dt.dg){let i=Dt.dg.get(BigInt(t));if(i&&i.ve!==e&&-1!==i.ve&&(i.dt(),i=null),i)return i}let i=Dt.get(t);if(i.Ag||(e=-1),i.Ag&&i.Ig&&e>1){let t=-1;for(let s=0;s<10;s++)e>=i.Ig[s]&&0!==i.Ig[s]&&(t=i.Ag[s]);-1!==t&&(i=Dt.get(t))}const s=new J(32,32),n=D.Be,r=D.We,h=D.Pe,l=m.It,o=m.gt,a=m._t,c=m.left,f=m.right,u=m.top,d=m.bottom;D.Ge=!1,m.bind(s.It,32,32),m.fillRect(0,0,32,32,Ot.yA),D.Qe();const w=i.gg(1),y=D.sin[i._g]*i.Cg>>16,p=D.cos[i._g]*i.Cg>>16;w.Ol(0,i.bg,i.Tg,i._g,i.Eg,y+(w.tl/2|0)+i.vg,p+i.vg);for(let t=31;t>=0;t--)for(let e=31;e>=0;e--)0===s.It[t+32*e]&&(t>0&&s.It[t+32*e-1]>1||e>0&&s.It[t+32*(e-1)]>1||t<31&&s.It[t+32*e+1]>1||e<31&&s.It[t+32*(e+1)]>1)&&(s.It[t+32*e]=1);for(let t=31;t>=0;t--)for(let e=31;e>=0;e--)0===s.It[t+32*e]&&t>0&&e>0&&s.It[t+32*(e-1)-1]>0&&(s.It[t+32*e]=3153952);if(-1!==i.wg){const t=this.pg(i.Lg,10),e=t.Ee,s=t.ve;t.Ee=32,t.ve=32,t.xe(5,5,22,22),t.Ee=e,t.ve=s}return Dt.dg?.put(BigInt(t),s),m.bind(l,o,a),m.Et(c,u,f,d),D.Be=n,D.We=r,D.Pe=h,D.Ge=!0,i.Sg?s.Ee=33:s.Ee=32,s.ve=e,s};index=-1;model=0;name=null;Op=null;kp=null;Rp=null;Cg=2e3;_g=0;bg=0;Tg=0;Eg=0;vg=0;Og=!1;kg=-1;Sg=!1;Rg=1;mg=!1;Lp=null;Xa=null;xg=-1;Mg=-1;Fg=0;Dg=-1;Ng=-1;Ug=0;Pg=-1;Bg=-1;Wg=-1;Gg=-1;Hg=-1;Yg=-1;Ag=null;Ig=null;Lg=-1;wg=-1;decode=(t,e,i)=>{if(1===e)this.model=i.ie;else if(2===e)this.name=i.ae;else if(3===e)this.Op=i.ae;else if(4===e)this.Cg=i.ie;else if(5===e)this._g=i.ie;else if(6===e)this.bg=i.ie;else if(7===e)this.Eg=i.se,this.Eg>32767&&(this.Eg-=65536);else if(8===e)this.vg=i.se,this.vg>32767&&(this.vg-=65536);else if(9===e)this.Og=!0;else if(10===e)this.kg=i.ie;else if(11===e)this.Sg=!0;else if(12===e)this.Rg=i.re;else if(16===e)this.mg=!0;else if(23===e)this.xg=i.ie,this.Fg=i.ee;else if(24===e)this.Mg=i.ie;else if(25===e)this.Dg=i.ie,this.Ug=i.ee;else if(26===e)this.Ng=i.ie;else if(e>=30&&e<35)this.Lp||(this.Lp=new S(5,null)),this.Lp[e-30]=i.ae,'hidden'===this.Lp[e-30]?.toLowerCase()&&(this.Lp[e-30]=null);else if(e>=35&&e<40)this.Xa||(this.Xa=new S(5,null)),this.Xa[e-35]=i.ae;else if(40===e){const t=i.te;this.kp=new Uint16Array(t),this.Rp=new Uint16Array(t);for(let e=0;e<t;e++)this.kp[e]=i.ie,this.Rp[e]=i.ie}else 78===e?this.Pg=i.ie:79===e?this.Bg=i.ie:90===e?this.Wg=i.ie:91===e?this.Hg=i.ie:92===e?this.Gg=i.ie:93===e?this.Yg=i.ie:95===e?this.Tg=i.ie:97===e?this.Lg=i.ie:98===e?this.wg=i.ie:e>=100&&e<110&&(this.Ag&&this.Ig||(this.Ag=new Uint16Array(10),this.Ig=new Uint16Array(10)),this.Ag[e-100]=i.ie,this.Ig[e-100]=i.ie)};Vg=t=>{let e=this.xg;if(1===t&&(e=this.Dg),-1===e)return null;let i=this.Mg,s=this.Pg;1===t&&(i=this.Ng,s=this.Bg);let n=z.model(e);if(-1!==i){const t=z.model(i);if(-1===s){const e=[n,t];n=z.fl(e,2)}else{const e=[n,t,z.model(s)];n=z.fl(e,3)}}if(0===t&&0!==this.Fg&&n.translate(this.Fg,0,0),1===t&&0!==this.Ug&&n.translate(this.Ug,0,0),this.kp&&this.Rp)for(let t=0;t<this.kp.length;t++)n.Tl(this.kp[t],this.Rp[t]);return n};fg=t=>{let e=this.Wg;if(1===t&&(e=this.Hg),-1===e)return null;let i=this.Gg;1===t&&(i=this.Yg);let s=z.model(e);if(-1!==i){const t=[s,z.model(i)];s=z.fl(t,2)}if(this.kp&&this.Rp)for(let t=0;t<this.kp.length;t++)s.Tl(this.kp[t],this.Rp[t]);return s};gg=t=>{if(this.Ag&&this.Ig&&t>1){let e=-1;for(let i=0;i<10;i++)t>=this.Ig[i]&&0!==this.Ig[i]&&(e=this.Ag[i]);if(-1!==e)return Dt.get(e).gg(1)}if(Dt.so){const t=Dt.so.get(BigInt(this.index));if(t)return t}const e=z.model(this.model);if(this.kp&&this.Rp)for(let t=0;t<this.kp.length;t++)e.Tl(this.kp[t],this.Rp[t]);return e.vl(64,768,-50,-10,-50,!0),e.wl=!0,Dt.so?.put(BigInt(this.index),e),e};yg=()=>{const t=Dt.get(this.wg);this.model=t.model,this.Cg=t.Cg,this._g=t._g,this.bg=t.bg,this.Tg=t.Tg,this.Eg=t.Eg,this.vg=t.vg,this.kp=t.kp,this.Rp=t.Rp;const e=Dt.get(this.Lg);this.name=e.name,this.mg=e.mg,this.Rg=e.Rg;let i='a';const s=(e.name||'').toLowerCase().charAt(0);'a'!==s&&'e'!==s&&'i'!==s&&'o'!==s&&'u'!==s||(i='an'),this.Op=`Swap this note at any bank for ${i} ${e.name}.`,this.Sg=!0};reset=()=>{this.model=0,this.name=null,this.Op=null,this.kp=null,this.Rp=null,this.Cg=2e3,this._g=0,this.bg=0,this.Tg=0,this.Eg=0,this.vg=0,this.Og=!1,this.kg=-1,this.Sg=!1,this.Rg=1,this.mg=!1,this.Lp=null,this.Xa=null,this.xg=-1,this.Mg=-1,this.Fg=0,this.Dg=-1,this.Ng=-1,this.Ug=0,this.Pg=-1,this.Bg=-1,this.Wg=-1,this.Gg=-1,this.Hg=-1,this.Yg=-1,this.Ag=null,this.Ig=null,this.Lg=-1,this.wg=-1}}class Nt extends xt{static Xg=[9104,10275,7595,3610,7975,8526,918,38802,24466,10145,58654,5027,1457,16565,34991,25486];static jg=[[6798,107,10283,16,4797,7744,5799,4634,33697,22433,2983,54193],[8741,12,64030,43162,7735,8404,1701,38430,24094,10153,56621,4783,1341,16578,35003,25239],[25238,8742,12,64030,43162,7735,8404,1701,38430,24094,10153,56621,4783,1341,16578,35003],[4626,11146,6439,12,4758,10270],[4550,4537,5681,5673,5790,6806,8076,4574]];static so=new K(200);name=null;visible=!1;zg=0;Zg=0;qg=new Uint16Array(12);Kg=new Uint16Array(5);Jg=0;$g=0n;y=0;Qg=0;t_=0;e_=0;i_=0;s_=0;n_=null;Bu=0;Gu=0;Wu=0;Hu=0;Me=!1;draw(t){if(!this.visible)return null;let e=this.r_();if(this.height=e.tl,e.wl=!0,this.Me)return e;if(-1!==this.GI&&-1!==this.HI){const t=Mt.Cr[this.GI],i=z.sl(t.tc(),!0,!t.Np,!1);i.translate(-this.XI,0,0),i.Al(),t.iA&&t.iA.frames&&i._l(t.iA.frames[this.HI]),i.ol=null,i.ll=null,128===t.og&&128===t.ag||i.scale(t.og,t.ag,t.og),i.vl(t.Pp+64,t.Bp+850,-30,-50,-30,!0);const s=[e,i];e=z.al(s,2)}if(this.n_&&(t>=this.t_&&(this.n_=null),t>=this.Qg&&t<this.t_)){const t=this.n_;if(t){t.translate(this.i_-this.y,this.e_-this.x,this.s_-this.z),512===this.QI?(t.Cl(),t.Cl(),t.Cl()):1024===this.QI?(t.Cl(),t.Cl()):1536===this.QI&&t.Cl();const i=[e,t];e=z.al(i,2),512===this.QI?t.Cl():1024===this.QI?(t.Cl(),t.Cl()):1536===this.QI&&(t.Cl(),t.Cl(),t.Cl()),t.translate(this.y-this.i_,this.x-this.e_,this.z-this.s_)}}return e.wl=!0,e}isVisible=()=>this.visible;read=t=>{t.Jt=0,this.zg=t.te,this.Zg=t.te;for(let e=0;e<12;e++){const i=t.te;this.qg[e]=0===i?0:(i<<8)+t.te}for(let e=0;e<5;e++){let i=t.te;(i<0||i>=Nt.jg[e].length)&&(i=0),this.Kg[e]=i}this.dI=t.ie,65535===this.dI&&(this.dI=-1),this.wI=t.ie,65535===this.wI&&(this.wI=-1),this.yI=t.ie,65535===this.yI&&(this.yI=-1),this.mI=t.ie,65535===this.mI&&(this.mI=-1),this.pI=t.ie,65535===this.pI&&(this.pI=-1),this.AI=t.ie,65535===this.AI&&(this.AI=-1),this.II=t.ie,65535===this.II&&(this.II=-1),this.name=$.Ql($.ql(t.he)),this.Jg=t.te,this.visible=!0,this.$g=0n;for(let t=0;t<12;t++)this.$g<<=0x4n,this.qg[t]>=256&&(this.$g+=BigInt(this.qg[t])-256n);this.qg[0]>=256&&(this.$g+=BigInt(this.qg[0])-256n>>4n),this.qg[1]>=256&&(this.$g+=BigInt(this.qg[1])-256n>>8n);for(let t=0;t<5;t++)this.$g<<=0x3n,this.$g+=BigInt(this.Kg[t]);this.$g<<=0x1n,this.$g+=BigInt(this.zg)};fg=()=>{if(!this.visible)return null;const t=new S(12,null);let e=0;for(let i=0;i<12;i++){const s=this.qg[i];if(s>=256&&s<512&&(t[e++]=Ft.Cr[s-256].fg()),s>=512){const i=Dt.get(s-512).fg(this.zg);i&&(t[e++]=i)}}const i=z.fl(t,e);for(let t=0;t<5;t++)0!==this.Kg[t]&&(i.Tl(Nt.jg[t][0],Nt.jg[t][this.Kg[t]]),1===t&&i.Tl(Nt.Xg[0],Nt.Xg[this.Kg[t]]));return i};r_=()=>{let t=this.$g,e=-1,i=-1,s=-1,n=-1;if(this.DI>=0&&0===this.BI){const r=St.Cr[this.DI];if(r.frames&&(e=r.frames[this.NI]),this.xI>=0&&this.xI!==this.dI){const t=St.Cr[this.xI].frames;t&&(i=t[this.MI])}r.oA>=0&&(s=r.oA,t+=BigInt(s-this.qg[5])<<8n),r.aA>=0&&(n=r.aA,t+=BigInt(n-this.qg[3])<<16n)}else if(this.xI>=0){const t=St.Cr[this.xI].frames;t&&(e=t[this.MI])}let r=Nt.so?.get(t);if(!r){const e=new S(12,null);let i=0;for(let t=0;t<12;t++){let r=this.qg[t];if(n>=0&&3===t&&(r=n),s>=0&&5===t&&(r=s),r>=256&&r<512){const t=Ft.Cr[r-256].tc();t&&(e[i++]=t)}if(r>=512){const t=Dt.get(r-512).Vg(this.zg);t&&(e[i++]=t)}}r=z.fl(e,i);for(let t=0;t<5;t++)0!==this.Kg[t]&&(r.Tl(Nt.jg[t][0],Nt.jg[t][this.Kg[t]]),1===t&&r.Tl(Nt.Xg[0],Nt.Xg[this.Kg[t]]));r.Al(),r.vl(64,850,-30,-50,-30,!0),Nt.so?.put(t,r)}if(this.Me)return r;const h=z.hl(r,!0);return-1!==e&&-1!==i?h.Il(e,i,St.Cr[this.DI].hA):-1!==e&&h._l(e),h.cl(),h.ol=null,h.ll=null,h}}class Ut extends Tt{static count=0;static cache=null;static pr=null;static _p=null;static Cp=0;static so=new K(30);static br=t=>{this.pr=new v(t.read('npc.dat'));const e=new v(t.read('npc.idx'));this.count=e.ie,this._p=new Int32Array(this.count);let i=2;for(let t=0;t<this.count;t++)this._p[t]=i,i+=e.ie;this.cache=new S(20,null);for(let t=0;t<20;t++)this.cache[t]=new Ut};static get=t=>{if(!this.cache||!this._p||!this.pr)throw new Error('LocType not loaded!!!');for(let e=0;e<20;e++){const i=this.cache[e];if(i&&i.index===t)return i}this.Cp=(this.Cp+1)%20;const e=this.cache[this.Cp]=new Ut;return this.pr.Jt=this._p[t],e.index=t,e.op(t,this.pr),e};static $e=()=>{this.so=null,this._p=null,this.cache=null,this.pr=null};index=-1;name=null;Op=null;size=1;Sp=null;cg=null;Np=!1;h_=-1;l_=-1;o_=-1;a_=-1;c_=-1;f_=!1;kp=null;Rp=null;Lp=null;u_=-1;d_=-1;w_=-1;y_=!0;m_=-1;og=128;ag=128;decode=(t,e,i)=>{if(1===e){const t=i.te;this.Sp=new Uint16Array(t);for(let e=0;e<t;e++)this.Sp[e]=i.ie}else if(2===e)this.name=i.ae;else if(3===e)this.Op=i.ae;else if(12===e)this.size=i.ee;else if(13===e)this.h_=i.ie;else if(14===e)this.l_=i.ie;else if(16===e)this.Np=!0;else if(17===e)this.l_=i.ie,this.o_=i.ie,this.a_=i.ie,this.c_=i.ie;else if(e>=30&&e<40)this.Lp||(this.Lp=new S(5,null)),this.Lp[e-30]=i.ae,'hidden'===this.Lp[e-30]?.toLowerCase()&&(this.Lp[e-30]=null);else if(40===e){const t=i.te;this.kp=new Uint16Array(t),this.Rp=new Uint16Array(t);for(let e=0;e<t;e++)this.kp[e]=i.ie,this.Rp[e]=i.ie}else if(60===e){const t=i.te;this.cg=new Uint16Array(t);for(let e=0;e<t;e++)this.cg[e]=i.ie}else 90===e?this.u_=i.ie:91===e?this.d_=i.ie:92===e?this.w_=i.ie:93===e?this.y_=!1:95===e?this.m_=i.ie:97===e?this.og=i.ie:98===e&&(this.ag=i.ie)};r_=(t,e,i)=>{let s=null,n=null;if(Ut.so&&(n=Ut.so.get(BigInt(this.index)),!n&&this.Sp)){const t=new S(this.Sp.length,null);for(let e=0;e<this.Sp.length;e++)t[e]=z.model(this.Sp[e]);if(n=1===t.length?t[0]:z.fl(t,t.length),this.kp&&this.Rp)for(let t=0;t<this.kp.length;t++)n?.Tl(this.kp[t],this.Rp[t]);n?.Al(),n?.vl(64,850,-30,-50,-30,!0),n&&Ut.so.put(BigInt(this.index),n)}return n?(s=z.hl(n,!this.Np),-1!==t&&-1!==e?s.Il(t,e,i):-1!==t&&s._l(t),128===this.og&&128===this.ag||s.scale(this.og,this.ag,this.og),s.cl(),s.ol=null,s.ll=null,1===this.size&&(s.wl=!0),s):null};fg=()=>{if(!this.cg)return null;const t=new S(this.cg.length,null);for(let e=0;e<this.cg.length;e++)t[e]=z.model(this.cg[e]);let e;if(e=1===t.length?t[0]:z.fl(t,t.length),this.kp&&this.Rp)for(let t=0;t<this.kp.length;t++)e?.Tl(this.kp[t],this.Rp[t]);return e}}class Pt extends Tt{static count=0;static Cr=[];static p_=[];static A_=0;static br=t=>{const e=new v(t.read('varp.dat'));this.count=e.ie;for(let t=0;t<this.count;t++)this.Cr[t]=new Pt,this.Cr[t].op(t,e)};kg=null;I_=0;g_=0;__=!1;C_=!0;b_=0;T_=0;E_=!1;v_=!1;decode(t,e,i){if(1===e)this.I_=i.te;else if(2===e)this.g_=i.te;else if(3===e)this.__=!0,Pt.p_[Pt.A_++]=t;else if(4===e)this.C_=!1;else if(5===e)this.b_=i.ie;else if(6===e)this.E_=!0;else if(7===e)this.T_=i.re;else if(8===e)this.v_=!0;else{if(10!==e)throw new Error(`Error unrecognised config code: ${e}`);this.kg=i.ae}}}class Bt extends B{static L_=225;static S_=10;static O_=0;static mg=!0;static Me=!1;static k_='';static R_='';static x_=!1;static M_='https://raw.githubusercontent.com/2004scape/Server/main';static exponent=58778699976184461502525193738213253649000149147835990136706041084440742975821n;static F_=7162900525229798032761816791230527296329313291232324290237849263501208207972894053929065636522363163621000728841182238772712427862772219676577293600221789n;static D_=0;static N_=0;static U_=0;static P_=0;static B_=0;static W_=0;static G_=0;static H_=0;static Y_=0;static V_=0;static X_=0;static j_=0;static z_=0;static Z_=0;static q_=0;static K_=()=>{bt.Me=!1,D.Me=!1,Bt.Me=!1,kt.Me=!1};static J_=()=>{bt.Me=!0,D.Me=!0,Bt.Me=!0,kt.Me=!0};Q_=2048;tC=2047;eC=!1;iC=!1;sC=!1;nC=!1;db=null;rC=0;hC=!1;lC=[];stream=null;in=v.Qt(1);oC=v.Qt(1);aC=v.Qt(1);cC=0n;fC=0;uC=0;dC=0;wC=null;yC=0;packetSize=0;mC=0;pC=0;AC=0;IC=null;gC=!0;_C=0;CC=0;bC=null;TC=null;EC=null;vC=null;LC=null;SC=null;OC=null;kC=null;RC=null;xC=null;MC=null;FC='';DC='';username='';password='';NC=null;UC=null;PC=null;BC=null;WC=[];GC=!1;HC=null;YC=null;VC=null;XC=null;jC=null;zC=null;ZC=null;qC=null;KC=null;JC=null;$C=new Int32Array(256);QC=0;tb=0;eb=0;ib=null;sb=null;nb=null;rb=null;hb=null;lb=null;ob=null;ab=null;cb=null;fb=null;ub=null;wb=null;yb=null;mb=null;pb=null;Ab=null;Ib=null;gb=null;_b=null;Cb=null;bb=null;Tb=new Int32Array(33);Eb=new Int32Array(33);vb=new Int32Array(151);Lb=new Int32Array(151);Sb=null;Ob=null;kb=null;Rb=null;xb=null;Mb=null;Fb=new S(13,null);Db=null;Nb=null;Ub=new S(50,null);Pb=new S(50,null);Bb=new S(20,null);Wb=new S(20,null);Gb=null;Hb=new S(8,null);Yb=null;Vb=null;Xb=null;jb=null;zb=null;Zb=null;qb=null;Kb=null;Jb=null;$b=null;Qb=null;tT=null;eT=null;iT=null;sT=null;nT=null;rT=null;hT=null;lT=new S(1e3,null);oT=!1;aT=!1;cT=!1;fT=!1;uT=-1;dT=0;wT=0;yT=0;mT=0;pT=0;AT=0;IT=!1;gT=0;_T=0;CT=0;bT=0;TT=0;ET=0;vT=[];LT=-1;ST=-1;OT=new Q;kT=78;RT=0;xT=0;MT=[];FT=0;DT=0;NT=0;UT=0;PT=0;BT=0;WT=0;GT=0;HT=[];YT=[];VT=[];XT=[];jT=null;zT=-1;ZT=3;qT=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];KT=0;JT=0;$T=0;QT=!1;tE=0;eE=!1;iE='';sE='';nE=0;rE='';hE=!1;lE=-1;oE=new S(100,null);aE=new S(100,null);messageType=new Int32Array(100);cE=new Int32Array(100);fE=0;uE=0;dE=0;wE='';yE=0;mE=0;pE=0;AE=0;IE=0;gE=0;_E=0;CE=0;bE=0;TE=!1;EE=0;vE=0;LE=0;SE=0;OE=null;kE=0;RE=0;xE=0;ME=0;FE=!1;DE=[];NE=[];UE=0;PE=0;BE=0;WE=null;GE=0;HE=new Int32Array(500);YE=new Int32Array(500);VE=new Int32Array(500);XE=new Int32Array(500);jE=0;zE=0;ZE=0;qE='';KE=!1;JE=-1;$E=0;QE=0;tv=0;ev=0;iv=0;sv=new Int32Array(1e3);nv=new Int32Array(1e3);rv=null;hv=0;lv=0;ov=0;av=0;cv=0;fv=!1;uv=0;dv=0;wv=0;yv=0;mv=2;pv=2;Av=1;Iv=new Int32Array(5);gv=new S(5,!1);_v=new Int32Array(5);Cv=new Int32Array(5);bv=new Int32Array(5);Tv=0;Ev=0;vv=0;Lv=0;Sv=0;Ov=0;kv=0;Rv=0;xv=0;Mv=1;Fv=2;Dv=-1;Ih=0;_h=0;Nv=0;Uv=0;Pv=0;Bv=0;Wv=null;Gv=null;Hv=null;Yv=0;Vv=0;Xv=new Int8Array(16384);jv=new S(wt.ow,null);zv=0;Zv=0;qv=128;Kv=0;Jv=0;$v=0;Qv=0;tL=0;zA=null;ZA=null;eL=new M(wt.aw,wt.aw);iL=0;sL=0;nL=0;rL=0;hL=0;lL=0;oL=0;aL=0;cL=0;fL=0;uL=0;dL=0;wL=new S(this.Q_,null);yL=0;mL=new Int32Array(this.Q_);pL=0;AL=0;IL=new Int32Array(this.Q_);gL=new Int32Array(1e3);_L=new S(this.Q_,null);CL=new S(8192,null);bL=0;TL=new Int32Array(8192);EL=new E;vL=new E;LL=new E;um=new E;SL=new k(wt.ow,wt.aw,wt.aw,null);OL=new E;kL=new Int32Array(4e3);RL=new Int32Array(4e3);xL=new Int32Array(wt.aw*wt.aw);ML=new Int32Array(wt.aw*wt.aw);FL=0;DL=null;NL=0;UL=0;PL=-1;BL=0;WL=0;GL=0;HL=0;YL=!1;VL=!0;XL=!1;jL=new Int32Array(7);zL=new Int32Array(5);ZL=0;qL=0;static KL=50;JL=new Int32Array(Bt.KL);$L=new Int32Array(Bt.KL);QL=new Int32Array(Bt.KL);tS=new Int32Array(Bt.KL);eS=new Int32Array(Bt.KL);iS=new Int32Array(Bt.KL);sS=new Int32Array(Bt.KL);nS=new S(Bt.KL,null);rS=new S(100,null);hS=new BigInt64Array(100);lS=new Int32Array(100);oS=null;aS=0;cS=!0;fS=new Int32Array(50);uS=new Int32Array(50);dS=new Int32Array(50);wS=192;yS=-1;mS=-1;pS=0;AS=0;IS=0;gS=!0;_S=null;CS=0;bS=0;TS=192;$e=()=>{try{this.stream&&this.stream.close()}catch(t){}this.stream=null,window._tinyMidiStop&&window._tinyMidiStop(),this.oC=null,this.aC=null,this.in=null,this.Hv=null,this.Wv=null,this.Gv=null,this.zA=null,this.ZA=null,this.rv=null,this.jv=null,this.xL=null,this.ML=null,this.kL=null,this.RL=null,this.Xv=null,this.sb=null,this.nb=null,this.rb=null,this.hb=null,this.lb=null,this.ob=null,this.ab=null,this.cb=null,this.fb=null,this.ub=null,this.wb=null,this.yb=null,this.mb=null,this.pb=null,this.Ab=null,this.Ib=null,this.gb=null,this.Sb=null,this.kb=null,this.Ob=null,this.Rb=null,this.xb=null,this.Mb=null,this.Fb=null,this.qb=null,this.Kb=null,this.Jb=null,this.$b=null,this.Qb=null,this.tT=null,this.eT=null,this.iT=null,this.sT=null,this.nT=null,this.Nb=null,this.Bb=null,this.Wb=null,this.Hb=null,this.Yb=null,this.Vb=null,this.Xb=null,this.jb=null,this.Ub=null,this.Pb=null,this.eL=null,this.wL=null,this.mL=null,this.IL=null,this._L=null,this.gL=null,this.CL=null,this.TL=null,this.SL=null,this.OL=null,this.um=null,this.EL=null,this.vL=null,this.LL=null,this.VE=null,this.XE=null,this.HE=null,this.YE=null,this.vT=null,this.DE=null,this.sv=null,this.nv=null,this.lT=null,this.Db=null,this.rS=null,this.hS=null,this.lS=null,this.vC=null,this.LC=null,this.bC=null,this.TC=null,this.EC=null,this.SC=null,this.OC=null,this.kC=null,this.RC=null,this.ES(),vt.$e(),Ut.$e(),Dt.$e(),Et.Cr=null,Ft.Cr=null,Q.Cr=null,St.Cr=null,Mt.Cr=null,Mt.so=null,Pt.Cr=null,this.kn=null,Nt.so=null,D.$e(),bt.$e(),z.$e(),Y.Cr=[],V.Cr=[]};ES=()=>{this.GC=!1,this.ib&&(clearInterval(this.ib),this.ib=null),this.xC=null,this.MC=null,this.WC=[],this.ZC=null,this.qC=null,this.KC=null,this.JC=null,this.XC=null,this.VC=null,this.jC=null,this.zC=null,this.HC=null,this.YC=null};vS=async(t,e,i,s)=>{let n=5,r=await(this.db?.sr(t));if(r&&v.Kt(r)!==i&&(r=void 0),r)return new G(r);for(;!r;){await this.Jn(s,`Requesting ${e}`);try{r=await T(`${Bt.R_}/${t}${i}`)}catch(t){r=void 0;for(let t=n;t>0;t--)await this.Jn(s,`Error loading - Will retry in ${t} secs.`),await b(1e3);n*=2,n>60&&(n=60)}}return await(this.db?.nr(t,r)),new G(r)};LS=async(t,i,s)=>{let n=await(this.db?.sr(t+'.mid'));if(n&&12345678!==i&&v.Kt(n)!==i&&(n=void 0),!n)try{n=await T(`${Bt.R_}/${t}_${i}.mid`),s!==n.length&&(n=n.slice(0,s))}catch(t){}if(!n)return;await(this.db?.nr(t+'.mid',n));const r=new v(Uint8Array.from(n)).re;!function(t,e){window._tinyMidiPlay&&window._tinyMidiPlay(t,e/256)}(e.read(r,n,s,4),this.TS)};SS=()=>{if(A.fillStyle='black',A.fillRect(0,0,this.width,this.height),this.Qn(1),this.sC){this.GC=!1,A.font='bold 16px helvetica, sans-serif',A.textAlign='left',A.fillStyle='yellow';let t=35;A.fillText('Sorry, an error has occured whilst loading RuneScape',30,t),t+=50,A.fillStyle='white',A.fillText('To fix this try the following (in order):',30,t),t+=50,A.font='bold 12px helvetica, sans-serif',A.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,A.fillText('2: Try clearing your web-browsers cache from tools->internet options',30,t),t+=30,A.fillText('3: Try using a different game-world',30,t),t+=30,A.fillText('4: Try rebooting your computer',30,t),t+=30,A.fillText('5: Try selecting a different version of Java from the play-game menu',30,t)}if(this.nC&&(this.GC=!1,A.font='bold 20px helvetica, sans-serif',A.textAlign='left',A.fillStyle='white',A.fillText('Error - unable to load game!',50,50),A.fillText('To play RuneScape make sure you play from',50,100),A.fillText('https://2004scape.org',50,150)),this.iC){this.GC=!1,A.font='bold 13px helvetica, sans-serif',A.textAlign='left',A.fillStyle='yellow';let t=35;A.fillText('Error a copy of RuneScape already appears to be loaded',30,t),t+=50,A.fillStyle='white',A.fillText('To fix this try the following (in order):',30,t),t+=50,A.font='bold 12px helvetica, sans-serif',A.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,A.fillText('2: Try rebooting your computer, and reloading',30,t)}};OS=t=>{if(!t.ka)return!1;for(let e=0;e<t.ka.length;e++){const i=this.kS(t,e);if(!t.Ra)return!1;const s=t.Ra[e];if(2===t.ka[e]){if(i>=s)return!1}else if(3===t.ka[e]){if(i<=s)return!1}else if(4===t.ka[e]){if(i===s)return!1}else if(i!==s)return!1}return!0};RS=(t,e,i,s,n)=>{this.zb?.draw(t,e),this.Zb?.draw(t,e+n-16),m.fillRect(t,e+16,16,n-32,Ot.LA);let r=(n-32)*n/s|0;r<8&&(r=8);const h=(n-r-32)*i/(s-n)|0;m.fillRect(t,e+h+16,16,r,Ot.SA),m.Ot(t,e+h+16,Ot.OA,r),m.Ot(t+1,e+h+16,Ot.OA,r),m.St(t,e+h+16,Ot.OA,16),m.St(t,e+h+17,Ot.OA,16),m.Ot(t+15,e+h+16,Ot.kA,r),m.Ot(t+14,e+h+17,Ot.kA,r-1),m.St(t,e+h+r+15,Ot.kA,16),m.St(t+1,e+h+r+14,Ot.kA,15)};xS=(t,e)=>{let i=!1;const s=Q.Cr[t];if(!s.xa)return!1;for(let t=0;t<s.xa.length&&-1!==s.xa[t];t++){const n=Q.Cr[s.xa[t]];if(1===n.type&&(i||=this.xS(n.id,e)),6===n.type&&(-1!==n.ic||-1!==n.sc)){let t;if(t=this.OS(n)?n.sc:n.ic,-1!==t){const s=St.Cr[t];if(n.fc+=e,s.delay)for(;n.fc>s.delay[n.cc];)n.fc-=s.delay[n.cc]+1,n.cc++,n.cc>=s.nA&&(n.cc-=s.sA,(n.cc<0||n.cc>=s.nA)&&(n.cc=0)),i=!0}}}return i};MS=(t,e,i,s,n=!1)=>{if(0!==t.type||!t.xa||t.hide&&this.yE!==t.id&&this.mE!==t.id&&this.pE!==t.id)return;const r=m.left,h=m.top,l=m.right,o=m.bottom;m.Et(e,i,e+t.width,i+t.height);const a=t.xa.length;for(let r=0;r<a;r++){if(!t.Ma||!t.Fa)continue;let h=t.Ma[r]+e,l=t.Fa[r]+i-s;const o=Q.Cr[t.xa[r]];if(h+=o.x,l+=o.y,n&&m.Lt(h,l,o.width,o.height,Ot.wA),o.Sa>0&&this.FS(o),o.type===Q.no)o.ac>o.scroll-o.height&&(o.ac=o.scroll-o.height),o.ac<0&&(o.ac=0),this.MS(o,h,l,o.ac,n),o.scroll>o.height&&this.RS(h+o.width,l,o.ac,o.scroll,o.height);else if(o.type===Q.ho){let t=0;for(let e=0;e<o.height;e++)for(let i=0;i<o.width;i++){if(!(o.Ga&&o.Ha&&o.Da&&o.Na))continue;let s=h+i*(o.Ba+32),n=l+e*(o.Wa+32);if(t<20&&(s+=o.Ga[t],n+=o.Ha[t]),o.Da[t]>0){let e=0,i=0;const r=o.Da[t]-1;if(s>=-32&&s<=512&&n>=-32&&n<=334||0!==this.gE&&this.IE===t){const h=Dt.pg(r,o.Na[t]);if(0!==this.gE&&this.IE===t&&this.AE===o.id?(e=this.Gn-this._E,i=this.Hn-this.CE,e<5&&e>-5&&(e=0),i<5&&i>-5&&(i=0),this.bE<5&&(e=0,i=0),h.Wl(128,s+e,n+i)):0!==this.kE&&this.RE===t&&this.xE===o.id?h.Wl(128,s,n):h.draw(s,n),33===h.Ee||1!==o.Na[t]){const r=o.Na[t];this.NC?.DS(s+e+1,n+10+i,this.NS(r),Ot.yA),this.NC?.DS(s+e,n+9+i,this.NS(r),Ot.fA)}}}else if(o.Ya&&t<20){const e=o.Ya[t];e?.draw(s,n)}t++}}else if(o.type===Q.lo)o.fill?m.fillRect(h,l,o.width,o.height,o.qa):m.Lt(h,l,o.width,o.height,o.qa);else if(o.type===Q.oo){const t=o.font;let e=o.qa,i=o.text;if(this.pE!==o.id&&this.mE!==o.id&&this.yE!==o.id||0===o.Ja||(e=o.Ja),this.OS(o)&&(e=o.Ka,o.Za&&o.Za.length>0&&(i=o.Za)),o.La===Q.po&&this.FE&&(i='Please wait...',e=o.qa),!t||!i)continue;for(let s=l+t.height;i.length>0;s+=t.height){if(-1!==i.indexOf('%')){for(;;){const t=i.indexOf('%1');if(-1===t)break;i=i.substring(0,t)+this.US(this.kS(o,0))+i.substring(t+2)}for(;;){const t=i.indexOf('%2');if(-1===t)break;i=i.substring(0,t)+this.US(this.kS(o,1))+i.substring(t+2)}for(;;){const t=i.indexOf('%3');if(-1===t)break;i=i.substring(0,t)+this.US(this.kS(o,2))+i.substring(t+2)}for(;;){const t=i.indexOf('%4');if(-1===t)break;i=i.substring(0,t)+this.US(this.kS(o,3))+i.substring(t+2)}for(;;){const t=i.indexOf('%5');if(-1===t)break;i=i.substring(0,t)+this.US(this.kS(o,4))+i.substring(t+2)}}const n=i.indexOf('\\n');let r;-1!==n?(r=i.substring(0,n),i=i.substring(n+2)):(r=i,i=''),o.ja?t.PS(h+(o.width/2|0),s,r,e,o.za):t.BS(h,s,r,e,o.za)}}else if(o.type===Q.ao){let t;t=this.OS(o)?o.Qa:o.$a,t?.draw(h,l)}else if(o.type===Q.co){const t=D.Be,e=D.We;D.Be=h+(o.width/2|0),D.We=l+(o.height/2|0);const i=D.sin[o.nc]*o.zoom>>16,s=D.cos[o.nc]*o.zoom>>16,n=this.OS(o);let r;r=n?o.sc:o.ic;let a=null;if(-1===r)a=o.tc(-1,-1,n);else{const t=St.Cr[r];t.frames&&t.rA&&(a=o.tc(t.frames[o.cc],t.rA[o.cc],n))}a&&a.Ol(0,o.rc,0,o.nc,0,i,s),D.Be=t,D.We=e}else if(o.type===Q.fo){const t=o.font;if(!t||!o.Da||!o.Na)continue;let e=0;for(let i=0;i<o.height;i++)for(let s=0;s<o.width;s++){if(o.Da[e]>0){const n=Dt.get(o.Da[e]-1);let r=n.name;if((n.Sg||1!==o.Na[e])&&(r=r+' x'+this.WS(o.Na[e])),!r)continue;const a=h+s*(o.Ba+115),c=l+i*(o.Wa+12);o.ja?t.PS(a+(o.width/2|0),c,r,o.qa,o.za):t.BS(a,c,r,o.qa,o.za)}e++}}}m.Et(r,h,l,o)};FS=t=>{let e=t.Sa;if(e>=Q.Ao&&e<=Q.Io)e--,e>=this.ZL?(t.text='',t.La=0):(t.text=this.rS[e],t.La=1);else if(e>=Q._o&&e<=Q.Co)e-=Q._o,e>=this.ZL?(t.text='',t.La=0):(0===this.lS[e]?t.text='@red@Offline':this.lS[e]===Bt.S_?t.text='@gre@World-'+(this.lS[e]-9):t.text='@yel@World-'+(this.lS[e]-9),t.La=1);else if(e===Q.Eo)t.scroll=15*this.ZL+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(e>=Q.ea&&e<=Q.ia)e-=Q.ea,e>=this.xT?(t.text='',t.La=0):(t.text=$.Ql($.ql(this.MT[e])),t.La=1);else if(e===Q.ra)t.scroll=15*this.xT+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(e===Q.ta){if(t.nc=150,t.rc=2047&(256*Math.sin(this.rC/40)|0),this.XL){this.XL=!1;const e=new S(7,null);let i=0;for(let t=0;t<7;t++){const s=this.jL[t];s>=0&&(e[i++]=Ft.Cr[s].tc())}const s=z.fl(e,i);for(let t=0;t<5;t++)0!==this.zL[t]&&(s.Tl(Nt.jg[t][0],Nt.jg[t][this.zL[t]]),1===t&&s.Tl(Nt.Xg[0],Nt.Xg[this.zL[t]]));if(this.DL){const e=St.Cr[this.DL.dI].frames;e&&(s.Al(),s._l(e[0]),s.vl(64,850,-30,-50,-30,!0),t.model=s)}}}else if(e===Q.Jo)this.rT||(this.rT=t.$a,this.hT=t.Qa),this.VL?t.$a=this.hT:t.$a=this.rT;else if(e===Q.$o)this.rT||(this.rT=t.$a,this.hT=t.Qa),this.VL?t.$a=this.rT:t.$a=this.hT;else if(e===Q.ha)t.text=this.qE,this.rC%20<10?t.text=t.text+'|':t.text=t.text+' ';else if(e===Q.Ia)this.YL?this.KE?(t.qa=Ot.RED,t.text='Moderator option: Mute player for 48 hours: <ON>'):(t.qa=Ot.wA,t.text='Moderator option: Mute player for 48 hours: <OFF>'):t.text='';else if(e===Q.ga||e===Q.Ea)if(0===this.$E)t.text='';else{let e;e=0===this.QE?'earlier today':1===this.QE?'yesterday':this.QE+' days ago',t.text='You last logged in '+e+' from: '+$.$l(this.$E)}else if(e===Q._a)0===this.ev&&(t.text='0 unread messages',t.qa=Ot.fA),1===this.ev&&(t.text='1 unread message',t.qa=Ot.GREEN),this.ev>1&&(t.text=this.ev+' unread messages',t.qa=Ot.GREEN);else if(e===Q.Ca)if(201===this.tv)t.text='';else if(200===this.tv)t.text='You have not yet set any password recovery questions.';else{let e;e=0===this.tv?'Earlier today':1===this.tv?'Yesterday':this.tv+' days ago',t.text=e+' you changed your recovery questions'}else e===Q.ba?201===this.tv?t.text='':200===this.tv?t.text='We strongly recommend you do so now to secure your account.':t.text='If you do not remember making this change then cancel it immediately':e===Q.Ta&&(201===this.tv?t.text='':(this.tv,t.text="Do this from the 'account management' area on our front webpage"))};kS=(t,e)=>{if(!t.scripts||e>=t.scripts.length)return-2;try{const i=t.scripts[e];if(!i)return-1;let s=0,n=0;for(;;){const t=i[n++];if(0===t)return s;if(1===t)s+=this.YT[i[n++]];else if(2===t)s+=this.VT[i[n++]];else if(3===t)s+=this.HT[i[n++]];else if(4===t){const t=Q.Cr[i[n++]],e=i[n++]+1;if(t.Da&&t.Na)for(let i=0;i<t.Da.length;i++)t.Da[i]===e&&(s+=t.Na[i]);else s+=0}else if(5===t)s+=this.DE[i[n++]];else if(6===t)s+=this.XT[this.VT[i[n++]]-1];else if(7===t)s+=100*this.DE[i[n++]]/46875|0;else if(8===t)s+=this.DL?.Jg||0;else if(9===t)for(let t=0;t<19;t++)18===t&&(t=20),s+=this.VT[t];else if(10===t){const t=Q.Cr[i[n++]],e=i[n++]+1;for(let i=0;i<t.Da.length;i++)if(t.Da[i]===e){s+=999999999;break}}else if(11===t)s+=this.NL;else if(12===t)s+=this.BL;else if(13===t){const t=this.DE[i[n++]];s+=0==(t&1<<i[n++])?0:1}}}catch(t){return-1}};US=t=>t<999999999?String(t):'*';WS=t=>{let e=String(t);for(let t=e.length-3;t>0;t-=3)e=e.substring(0,t)+','+e.substring(t);return e.length>8?e='@gre@'+e.substring(0,e.length-8)+' million @whi@('+e+')':e.length>4&&(e='@cya@'+e.substring(0,e.length-4)+'K @whi@('+e+')'),' '+e};NS=t=>t<1e5?String(t):t<1e7?(t/1e3|0)+'K':(t/1e6|0)+'M'}(new class extends Bt{eC=!1;iC=!1;sC=!1;nC=!1;GS=null;HS=null;YS=null;VS=null;XS=null;jS=null;Oy=0;ky=0;Ry=0;zS=0;ZS=0;qS=2;model={id:parseInt(B.getParameter('model'))||0,KS:null,x:0,y:0,z:420,wu:0};JS=null;constructor(){super(!0)}load=async()=>{if(this.eC)this.iC=!0;else{this.eC=!0;try{await async function(t){if(l||h)return;l=!0;const e=await r(t);h||(h=e)}(),await e.load(await(await fetch('bz2.wasm')).arrayBuffer()),this.db=new W(await W.openDatabase()),this.GS=document.getElementById('rightPanel');const t=document.getElementById('mainPanel');t&&(t.ondragover=t=>{t.preventDefault(),t.stopPropagation()},t.ondrop=async t=>{if(t.preventDefault(),t.stopPropagation(),!t.dataTransfer||!t.dataTransfer.files.length)return;const e=['main_file_cache.dat','main_file_cache.idx0','main_file_cache.idx1','main_file_cache.idx2','main_file_cache.idx3','main_file_cache.idx4'],i=[];for(let s=0;s<t.dataTransfer.files.length;s++){const n=t.dataTransfer.files[s];e.includes(n.name)&&i.push(n)}for(let t=0;t<i.length;t++){const e=i[t],s=await e.arrayBuffer();await(this.db?.nr(e.name,new Int8Array(s)))}await this.init()}),await this.init()}catch(t){this.sC=!0,console.error(t)}}};update=async()=>{this.iC||this.sC||this.nC||(this.$S(),this.QS())};draw=async()=>{this.iC||this.sC||this.nC?this.SS():(z.Eh=!0,z.Gn=this.Gn,z.Hn=this.Hn,this.kn?.bind(),m.clear(),m.fillRect(0,0,this.width,this.height,Ot.yA),null!==this.model.KS&&(this.model.KS.draw(this.model.wu,D.sin[this.zS],D.cos[this.zS],D.sin[this.ZS],D.cos[this.ZS],this.model.x-this.Oy,this.model.y-this.ky,this.model.z-this.Ry,0),-1!==this.model.KS.yl&&this.model.KS.Fl(this.model.KS.yl)),this.kn?.draw(0,0),this.JS?.draw(this.Gn,this.Hn))};init=async()=>{const t=await(this.db?.sr('main_file_cache.dat'));if(!t){return document.getElementById('helpme').style.display='block',void(p.style.display='none')}const e=await(this.db?.sr('main_file_cache.idx0')),i=await(this.db?.sr('main_file_cache.idx1')),s=await(this.db?.sr('main_file_cache.idx2')),n=await(this.db?.sr('main_file_cache.idx3')),r=await(this.db?.sr('main_file_cache.idx4'));if(!(e&&i&&s&&n&&r)){return document.getElementById('helpme').style.display='block',void(p.style.display='none')}document.getElementById('helpme').style.display='none',p.style.display='block',this.HS=new H(t,e,0),this.YS=new H(t,i,1),this.VS=new H(t,s,2),this.XS=new H(t,n,3),this.jS=new H(t,r,4),await this.Jn(10,'Unpacking textures');const h=this.HS.read(6);D.ii(h),D.ri(.8),D.li(20),await this.Jn(20,'Loading models...');for(let t=0;t<this.YS.lr;t++){const e=this.YS.read(t);null!==e&&z.Lh(e,t)}if(this.tO(0),null!==this.GS){const t=document.createElement('ul');t.id='modelList',t.className='list-group',this.GS.appendChild(t);for(let e=0;e<this.YS.lr;e++){const i=document.createElement('li');i.className='list-group-item',i.innerText=`Model ${e}`,i.onclick=()=>{this.model.id=e,this.tO(e)},t.appendChild(i)}}await this.Jn(80,'Finishing up...'),this.JS=new C(512,128),this.JS.bind();for(let t=0;t<512;t++)for(let e=0;e<128;e++){const i=t,s=127-e;m.Rt(i,s,D.palette[e+128*t])}this.JS.draw(0,0)};tO(t){if(null===this.YS)return;const e=this.YS.read(t);null!==e?(this.model.KS=z.ul(e,t),this.model.KS.vl(64,850,-30,-50,-30,!0),document.title=`Model ${t} | 2004Scape Tools`):document.title=`Missing model ${t} | 2004Scape Tools`}$S(){for(;;){const t=this.tr();if(-1===t)break;t==='r'.charCodeAt(0)?(this.qS=2,this.Oy=0,this.ky=0,this.Ry=0,this.zS=0,this.ZS=0,this.model.x=0,this.model.y=0,this.model.z=420,this.model.wu=0):t==='1'.charCodeAt(0)?(this.model.id--,z.metadata&&this.model.id<0&&(this.model.id=z.metadata.length-1),this.tO(this.model.id)):t==='2'.charCodeAt(0)&&(this.model.id++,z.metadata&&this.model.id>=z.metadata.length&&(this.model.id=0),this.tO(this.model.id))}}QS(){this.jn['['.charCodeAt(0)]?this.qS--:this.jn[']'.charCodeAt(0)]&&this.qS++,this.jn[1]?this.model.wu+=this.qS:this.jn[2]&&(this.model.wu-=this.qS),this.jn['w'.charCodeAt(0)]?this.model.z-=this.qS:this.jn['s'.charCodeAt(0)]&&(this.model.z+=this.qS),this.jn['a'.charCodeAt(0)]?this.model.x-=this.qS:this.jn['d'.charCodeAt(0)]&&(this.model.x+=this.qS),this.jn['q'.charCodeAt(0)]?this.model.y-=this.qS:this.jn['e'.charCodeAt(0)]&&(this.model.y+=this.qS),this.zS=2047&this.zS,this.ZS=2047&this.ZS,this.model.wu=2047&this.model.wu}}).Kn().then((()=>{}))})()})();