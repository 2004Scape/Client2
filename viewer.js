(()=>{"use strict";var t={7444:(t,i,e)=>{t.exports=e.p+"0c791968973e1f25c170.wasm"},8227:(t,i,e)=>{t.exports=e.p+"9f86b5397894e28b5ae2.wasm"}},i={};function e(s){var n=i[s];if(void 0!==n)return n.exports;var r=i[s]={exports:{}};return t[s](r,r.exports,e),r.exports}e.m=t,e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),e.p="/Client2/",e.b=document.baseURI||self.location.href,(()=>{async function t(t,i={}){const e={env:Object.assign(Object.create(globalThis),i.env||{},{abort(t,i,e,s){t=h(t>>>0),i=h(i>>>0),e>>>=0,s>>>=0,(()=>{throw Error(`${t} in ${i}:${e}:${s}`)})()}})},{exports:s}=await WebAssembly.instantiate(t,e),n=s.memory||i.env.memory,r=Object.setPrototypeOf({read:(t,i,e,r)=>(i=function(t,i,e,r,h){if(null==r)return 0;const o=r.length,l=s.__pin(s.__new(o<<e,i))>>>0;if(h)new h(n.buffer,l,o).set(r);else for(let i=0;i<o;i++)t(l+(i<<e>>>0),r[i]);return s.__unpin(l),l}(l,6,0,i,Int8Array)||function(){throw TypeError("value must not be null")}(),function(t,i,e){if(!e)return null;const s=function(t){try{return o.getUint32(t,!0)}catch{return o=new DataView(n.buffer),o.getUint32(t,!0)}}(e-4)>>>i,r=new Array(s);for(let n=0;n<s;++n)r[n]=t(e+(n<<i>>>0));return r}(a,0,s.read(t,i,e,r)>>>0))},s);function h(t){if(!t)return null;const i=t+new Uint32Array(n.buffer)[t-4>>>2]>>>1,e=new Uint16Array(n.buffer);let s=t>>>1,r="";for(;i-s>1024;)r+=String.fromCharCode(...e.subarray(s,s+=1024));return r+String.fromCharCode(...e.subarray(s,i))}let o=new DataView(n.buffer);function l(t,i){try{o.setUint8(t,i,!0)}catch{o=new DataView(n.buffer),o.setUint8(t,i,!0)}}function a(t){try{return o.getInt8(t,!0)}catch{return o=new DataView(n.buffer),o.getInt8(t,!0)}}return r}class i{static tt=null;static load=async i=>{this.tt=await t(new WebAssembly.Module(i),{env:void 0})};static read=(t,i,e,s)=>{if(!this.tt)throw new Error('bz2 not found!!');return Int8Array.from(this.tt.read(t,i,e,s))}}let s;function n(t,i){return s=t.exports,r.it=i,s}async function r(t){void 0===t&&(t=new URL(e(7444),e.b));const i={et:{}};('string'==typeof t||'function'==typeof Request&&t instanceof Request||'function'==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:s,module:r}=await async function(t,i){if('function'==typeof Response&&t instanceof Response){if('function'==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,i)}catch(i){if('application/wasm'==t.headers.get('Content-Type'))throw i;console.warn('`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n',i)}const e=await t.arrayBuffer();return await WebAssembly.instantiate(e,i)}{const e=await WebAssembly.instantiate(t,i);return e instanceof WebAssembly.Instance?{instance:e,module:t}:e}}(await t,i);return n(s,r)}let h=null,o=!1;class l extends Error{constructor(t){super(t),this.name='DecompressionError'}}let a=0,c=null,f=null;function u(t,i,e){let s;if(e){const n=i;s=t.st(n);const r=new Uint8Array(t.memory.buffer,s,n);try{e(r)}catch(i){throw t.nt(s,n),i}return a=n,s}if('string'==typeof i){const e=a=function(t){let i=0,e=0,s=0;const n=t.length;for(;i<n;)e=t.codePointAt(i),e<=127?(s+=1,i++):e<=2047?(s+=2,i++):e<=65535?(s+=3,i++):(s+=4,i+=2);return s}(i);s=t.st(e);const n=new Uint8Array(t.memory.buffer,s,e);return c||(c=new TextEncoder),c.encodeInto(i,n),s}const n=i;return s=t.st(a=n.length),f&&f.length||(f=new Uint8Array(t.memory.buffer)),f.set(n,s),s}function d(t){if(!t)throw new Error('WASM not initialized')}class w{key;next;rt;constructor(){this.key=0n,this.next=this,this.rt=this}ht(){this.rt&&this.next&&(this.rt.next=this.next,this.next.rt=this.rt,this.next=null,this.rt=null)}}class y extends w{ot;lt;constructor(){super(),this.ot=this,this.lt=this}ct(){this.lt&&this.ot&&(this.lt.ot=this.ot,this.ot.lt=this.lt,this.ot=null,this.lt=null)}}class m extends y{static ft=new Int32Array;static ut=0;static dt=0;static top=0;static bottom=0;static left=0;static right=0;static wt=0;static yt=0;static At=0;static bind=(t,i,e)=>{this.ft=t,this.ut=i,this.dt=e,this._t(0,0,i,e)};static gt=()=>{this.left=0,this.top=0,this.right=this.ut,this.bottom=this.dt,this.wt=this.right-1,this.yt=this.right/2|0};static _t=(t,i,e,s)=>{t<0&&(t=0),i<0&&(i=0),e>this.ut&&(e=this.ut),s>this.dt&&(s=this.dt),this.top=i,this.bottom=s,this.left=t,this.right=e,this.wt=this.right-1,this.yt=this.right/2|0,this.At=this.bottom/2|0};static clear=()=>{const t=this.ut*this.dt;for(let i=0;i<t;i++)this.ft[i]=0};static It=(t,i,e,s,n)=>{this.Ct(t,i,n,e),this.Ct(t,i+s-1,n,e),this.Et(t,i,n,s),this.Et(t+e-1,i,n,s)};static Ct=(t,i,e,s)=>{if(i<this.top||i>=this.bottom)return;t<this.left&&(s-=this.left-t,t=this.left),t+s>this.right&&(s=this.right-t);const n=t+i*this.ut;for(let t=0;t<s;t++)this.ft[n+t]=e};static Et=(t,i,e,s)=>{if(t<this.left||t>=this.right)return;i<this.top&&(s-=this.top-i,i=this.top),i+s>this.bottom&&(s=this.bottom-i);const n=t+i*this.ut;for(let t=0;t<s;t++)this.ft[n+t*this.ut]=e};static Tt=(t,i,e,s,n)=>{const r=Math.abs(e-t),h=Math.abs(s-i),o=t<e?1:-1,l=i<s?1:-1;let a=r-h;for(;t>=this.left&&t<this.right&&i>=this.top&&i<this.bottom&&(this.ft[t+i*this.ut]=n),t!==e||i!==s;){const e=2*a;e>-h&&(a-=h,t+=o),e<r&&(a+=r,i+=l)}};static fillRect=(t,i,e,s,n)=>{t<this.left&&(e-=this.left-t,t=this.left),i<this.top&&(s-=this.top-i,i=this.top),t+e>this.right&&(e=this.right-t),i+s>this.bottom&&(s=this.bottom-i);const r=this.ut-e;let h=t+i*this.ut;for(let t=-s;t<0;t++){for(let t=-e;t<0;t++)this.ft[h++]=n;h+=r}};static bt(t,i,e,s,n,r){t<this.left&&(e-=this.left-t,t=this.left),i<this.top&&(s-=this.top-i,i=this.top),t+e>this.right&&(e=this.right-t),i+s>this.bottom&&(s=this.bottom-i);const h=256-r,o=(n>>16&255)*r,l=(n>>8&255)*r,a=(255&n)*r,c=this.ut-e;let f=t+i*this.ut;for(let t=0;t<s;t++){for(let t=-e;t<0;t++){const t=(o+(this.ft[f]>>16&255)*h>>8<<16)+(l+(this.ft[f]>>8&255)*h>>8<<8)+(a+(255&this.ft[f])*h>>8);this.ft[f++]=t}f+=c}}static Ot(t,i,e,s,n){const r=256-n,h=(s>>16&255)*n,o=(s>>8&255)*n,l=(255&s)*n;let a=i-e;a<0&&(a=0);let c=i+e;c>=this.dt&&(c=this.dt-1);for(let s=a;s<=c;s++){const n=s-i,a=0|Math.sqrt(e*e-n*n);let c=t-a;c<0&&(c=0);let f=t+a;f>=this.ut&&(f=this.ut-1);let u=c+s*this.ut;for(let t=c;t<=f;t++){const t=(h+(this.ft[u]>>16&255)*r>>8<<16)+(o+(this.ft[u]>>8&255)*r>>8<<8)+(l+(255&this.ft[u])*r>>8);this.ft[u++]=t}}}static Rt=(t,i,e)=>{t<this.left||t>=this.right||i<this.top||i>=this.bottom||(this.ft[t+i*this.ut]=e)}}const p=document.getElementById('canvas'),A=p.getContext('2d',{willReadFrequently:!0}),_=document.createElement('canvas'),g=document.createElement('img'),I=_.getContext('2d',{willReadFrequently:!0});class C{vt;width;height;Lt;St;ft;constructor(t,i,e=A){this.Lt=e,this.vt=this.Lt.getImageData(0,0,t,i),this.St=new Uint32Array(this.vt.data.buffer),this.ft=new Int32Array(t*i),this.width=t,this.height=i,this.bind()}clear(){this.ft.fill(0)}bind(){m.bind(this.ft,this.width,this.height)}draw(t,i){this.#t(),this.Lt.putImageData(this.vt,t,i)}#t(){const t=this.ft.length,i=this.ft,e=this.St;for(let s=0;s<t;s++){const t=i[s];e[s]=t>>16&255|(t>>8&255)<<8|(255&t)<<16|4278190080}}}const E=async t=>new Promise((i=>setTimeout(i,t))),T=async t=>new Int8Array(await(await fetch(t)).arrayBuffer());class b{xt;cursor=null;constructor(){const t=new w;t.next=t,t.rt=t,this.xt=t}Mt(t){t.rt&&t.ht(),t.rt=this.xt.rt,t.next=this.xt,t.rt&&(t.rt.next=t),t.next.rt=t}kt(t){t.rt&&t.ht(),t.rt=this.xt,t.next=this.xt.next,t.rt.next=t,t.next&&(t.next.rt=t)}Dt(){const t=this.xt.next;return t===this.xt?null:(t?.ht(),t)}head(){const t=this.xt.next;return t===this.xt?(this.cursor=null,null):(this.cursor=t?.next||null,t)}Nt(){const t=this.xt.rt;return t===this.xt?(this.cursor=null,null):(this.cursor=t?.rt||null,t)}next(){const t=this.cursor;return t===this.xt?(this.cursor=null,null):(this.cursor=t?.next||null,t)}rt(){const t=this.cursor;return t===this.xt?(this.cursor=null,null):(this.cursor=t?.rt||null,t)}clear(){for(;;){const t=this.xt.next;if(t===this.xt)return;t?.ht()}}}class O extends y{static Ft=3988292384;static Bt=new Int32Array(256);static Pt=new Uint32Array(33);static Ut=new b;static Wt=new b;static Gt=new b;static Yt=0;static Ht=0;static Vt=0;static{for(let t=0;t<32;t++)O.Pt[t]=(1<<t)-1;O.Pt[32]=4294967295;for(let t=0;t<256;t++){let i=t;for(let t=0;t<8;t++)1&~i?i>>>=1:i=i>>>1^O.Ft;O.Bt[t]=i}}static Kt=t=>{let i=4294967295;for(let e=0;e<t.length;e++)i=i>>>8^O.Bt[255&(i^t[e])];return~i};view;data;Xt=0;jt=0;random=null;constructor(t){if(!t)throw new Error('Input src packet array was null!');super(),t instanceof Int8Array?this.data=new Uint8Array(t):this.data=t,this.view=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}get length(){return this.view.byteLength}get available(){return this.length-this.Xt}static zt=t=>{let i=null;return 0===t&&O.Yt>0?(O.Yt--,i=O.Ut.Dt()):1===t&&O.Ht>0?(O.Ht--,i=O.Wt.Dt()):2===t&&O.Vt>0&&(O.Vt--,i=O.Gt.Dt()),i?(i.Xt=0,i):new O(0===t?new Uint8Array(100):1===t?new Uint8Array(5e3):new Uint8Array(3e4))};release(){this.Xt=0,100===this.view.byteLength&&O.Yt<1e3?(O.Ut.Mt(this),O.Yt++):5e3===this.view.byteLength&&O.Ht<250?(O.Wt.Mt(this),O.Ht++):3e4===this.view.byteLength&&O.Vt<50&&(O.Gt.Mt(this),O.Vt++)}get Zt(){return this.view.getUint8(this.Xt++)}get qt(){return this.view.getInt8(this.Xt++)}get Jt(){const t=this.view.getUint16(this.Xt);return this.Xt+=2,t}get $t(){const t=this.view.getInt16(this.Xt);return this.Xt+=2,t}get Qt(){const t=this.view.getUint8(this.Xt++)<<16|this.view.getUint16(this.Xt);return this.Xt+=2,t}get ti(){const t=this.view.getInt32(this.Xt);return this.Xt+=4,t}get ii(){const t=this.view.getBigInt64(this.Xt);return this.Xt+=8,t}get ei(){return this.view.getUint8(this.Xt)<128?this.Zt-64:this.Jt-49152}get si(){return this.view.getUint8(this.Xt)<128?this.Zt:this.Jt-32768}get ni(){const t=this.view,i=t.byteLength;let e,s='';for(;10!==(e=t.getUint8(this.Xt++))&&this.Xt<i;)s+=String.fromCharCode(e);return s}ri(t,i,e){e.set(this.data.subarray(this.Xt,this.Xt+t),i),this.Xt+=t}hi(t){this.view.setUint8(this.Xt++,t+(this.random?.oi??0)&255)}p1(t){this.view.setUint8(this.Xt++,t)}p2(t){this.view.setUint16(this.Xt,t),this.Xt+=2}li(t){this.view.setUint16(this.Xt,t,!0),this.Xt+=2}p3(t){this.view.setUint8(this.Xt++,t>>16),this.view.setUint16(this.Xt,t),this.Xt+=2}p4(t){this.view.setInt32(this.Xt,t),this.Xt+=4}ai(t){this.view.setInt32(this.Xt,t,!0),this.Xt+=4}ci(t){this.view.setBigInt64(this.Xt,t),this.Xt+=8}fi(t){const i=this.view,e=t.length;for(let s=0;s<e;s++)i.setUint8(this.Xt++,t.charCodeAt(s));i.setUint8(this.Xt++,10)}ui(t,i,e){this.data.set(t.subarray(e,e+i),this.Xt),this.Xt+=i-e}di(t){this.view.setUint8(this.Xt-t-1,t)}wi(){this.jt=this.Xt<<3}yi(){this.Xt=this.jt+7>>>3}mi(t){let i=this.jt>>>3,e=8-(7&this.jt),s=0;for(this.jt+=t;t>e;e=8)s+=(this.view.getUint8(i++)&O.Pt[e])<<t-e,t-=e;return s+=t===e?this.view.getUint8(i)&O.Pt[e]:this.view.getUint8(i)>>>e-t&O.Pt[t],s}pi(t,i){const e=this.Xt;this.Xt=0;const s=new Uint8Array(e);this.ri(e,0,s);const n=function(t){const i=[];for(;t>0n;)i.unshift(Number(0xffn&t)),t>>=8n;return 128&i[0]&&i.unshift(0),new Uint8Array(i)}(function(t,i,e){let s=1n;for(;i>0n;)i%2n===1n&&(s=s*t%e),t=t*t%e,i>>=1n;return s}(function(t){let i=0n;for(let e=0;e<t.length;e++)i=i<<8n|BigInt(t[e]);return i}(s),i,t));this.Xt=0,this.p1(n.length),this.ui(n,n.length,0)}}class R extends y{ft;width;height;Ai;_i;gi;Ii;palette;constructor(t,i,e){super(),this.ft=new Int8Array(t*i),this.width=this.gi=t,this.height=this.Ii=i,this.Ai=this._i=0,this.palette=e}static Ci=(t,i,e=0)=>{const s=new O(t.read(i+'.dat')),n=new O(t.read('index.dat'));n.Xt=s.Jt;const r=n.Jt,h=n.Jt,o=n.Zt,l=new Int32Array(o);for(let t=1;t<o;t++)l[t]=n.Qt,0===l[t]&&(l[t]=1);for(let t=0;t<e;t++)n.Xt+=2,s.Xt+=n.Jt*n.Jt,n.Xt+=1;if(s.Xt>s.length||n.Xt>n.length)throw new Error;const a=n.Zt,c=n.Zt,f=n.Jt,u=n.Jt,d=new R(f,u,l);d.Ai=a,d._i=c,d.gi=r,d.Ii=h;const w=d.ft,y=n.Zt;if(0===y){const t=d.width*d.height;for(let i=0;i<t;i++)w[i]=s.qt}else if(1===y){const t=d.width,i=d.height;for(let e=0;e<t;e++)for(let n=0;n<i;n++)w[e+n*t]=s.qt}return d};draw(t,i){t|=0,i|=0;let e=(t+=this.Ai)+(i+=this._i)*m.ut,s=0,n=this.height,r=this.width,h=m.ut-r,o=0;if(i<m.top){const t=m.top-i;n-=t,i=m.top,s+=t*r,e+=t*m.ut}if(i+n>m.bottom&&(n-=i+n-m.bottom),t<m.left){const i=m.left-t;r-=i,t=m.left,s+=i,e+=i,o+=i,h+=i}if(t+r>m.right){const i=t+r-m.right;r-=i,o+=i,h+=i}r>0&&n>0&&this.Ei(r,n,this.ft,s,o,m.ft,e,h)}Ti(){const t=this.ft,i=this.width,e=this.height;for(let s=0;s<e;s++){const e=i/2|0;for(let n=0;n<e;n++){const e=n+s*i,r=i-n-1+s*i,h=t[e];t[e]=t[r],t[r]=h}}}bi(){const t=this.ft,i=this.width,e=this.height;for(let s=0;s<(e/2|0);s++)for(let n=0;n<i;n++){const r=n+s*i,h=n+(e-s-1)*i,o=t[r];t[r]=t[h],t[h]=o}}translate(t,i,e){for(let s=0;s<this.palette.length;s++){let n=this.palette[s]>>16&255;n+=t,n<0?n=0:n>255&&(n=255);let r=this.palette[s]>>8&255;r+=i,r<0?r=0:r>255&&(r=255);let h=255&this.palette[s];h+=e,h<0?h=0:h>255&&(h=255),this.palette[s]=(n<<16)+(r<<8)+h}}Oi(){this.gi|=0,this.Ii|=0,this.gi/=2,this.Ii/=2,this.gi|=0,this.Ii|=0;const t=new Int8Array(this.gi*this.Ii);let i=0;for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++)t[(s+this.Ai>>1)+(e+this._i>>1)*this.gi]=this.ft[i++];this.ft=t,this.width=this.gi,this.height=this.Ii,this.Ai=0,this._i=0}Ri(){if(this.width===this.gi&&this.height===this.Ii)return;const t=new Int8Array(this.gi*this.Ii);let i=0;for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++)t[s+this.Ai+(e+this._i)*this.gi]=this.ft[i++];this.ft=t,this.width=this.gi,this.height=this.Ii,this.Ai=0,this._i=0}Ei(t,i,e,s,n,r,h,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++){let t=e[s++];0===t?h++:r[h++]=this.palette[255&t],t=e[s++],0===t?h++:r[h++]=this.palette[255&t],t=e[s++],0===t?h++:r[h++]=this.palette[255&t],t=e[s++],0===t?h++:r[h++]=this.palette[255&t]}for(let i=t;i<0;i++){const t=e[s++];0===t?h++:r[h++]=this.palette[255&t]}h+=o,s+=n}}clip(t,i,e,s){try{const n=this.width;this.height;let r=0,h=0;const o=this.gi,l=this.Ii,a=(o<<16)/e|0,c=(l<<16)/s|0;t=t+(this.Ai*e+o-1)/o|0,i=i+(this._i*s+l-1)/l|0,this.Ai*e%o!=0&&(r=(o-this.Ai*e%o<<16)/e|0),this._i*s%l!=0&&(h=(l-this._i*s%l<<16)/s|0),e=e*(this.width-(r>>16))/o|0,s=s*(this.height-(h>>16))/l|0;let f,u=t+i*m.ut,d=m.ut-e;i<m.top&&(f=m.top-i,s-=f,i=0,u+=f*m.ut,h+=c*f),i+s>m.bottom&&(s-=i+s-m.bottom),t<m.left&&(f=m.left-t,e-=f,t=0,u+=f,r+=a*f,d+=f),t+e>m.right&&(f=t+e-m.right,e-=f,d+=f),this.vi(m.ft,this.ft,this.palette,r,h,u,d,e,s,a,c,n)}catch(t){console.log('error in sprite clipping routine')}}vi(t,i,e,s,n,r,h,o,l,a,c,f){try{const u=s;for(let d=-l;d<0;d++){const l=(n>>16)*f;for(let n=-o;n<0;n++){const n=i[(s>>16)+l];0==n?r++:t[r++]=e[255&n],s+=a}n+=c,s=u,r+=h}}catch(t){console.log('error in plot_scale')}}}class v extends Array{constructor(t,i){super(t);for(let e=0;e<t;e++)this[e]=i}}class L extends Array{constructor(t,i,e){super(t);for(let s=0;s<t;s++){this[s]=new Array(i);for(let t=0;t<i;t++)this[s][t]=e}}}class S extends Array{constructor(t,i,e,s){super(t);for(let n=0;n<t;n++){this[n]=new Array(i);for(let t=0;t<i;t++){this[n][t]=new Array(e);for(let i=0;i<e;i++)this[n][t][i]=s}}}}class x extends Array{constructor(t,i,e,s,n){super(t);for(let r=0;r<t;r++){this[r]=new Array(i);for(let t=0;t<i;t++){this[r][t]=new Array(e);for(let i=0;i<e;i++){this[r][t][i]=new Array(s);for(let e=0;e<s;e++)this[r][t][i][e]=n}}}}}class M extends Array{constructor(t,i,e){super(t);for(let s=0;s<t;s++){this[s]=new Array(i);for(let t=0;t<i;t++)this[s][t]=new Uint8Array(e)}}}class k extends Array{constructor(t,i){super(t);for(let e=0;e<t;e++)this[e]=new Int32Array(i)}}class D extends Array{constructor(t,i,e){super(t);for(let s=0;s<t;s++){this[s]=new Array(i);for(let t=0;t<i;t++)this[s][t]=new Int32Array(e)}}}class N extends m{static Li=!1;static Si=new Int32Array(512);static xi=new Int32Array(2048);static sin=new Int32Array(2048);static cos=new Int32Array(2048);static palette=new Int32Array(65536);static Mi=new v(50,null);static ki=0;static Di=new Int32Array;static Ni=0;static Fi=0;static Bi=!0;static Pi=!1;static alpha=0;static Ui=null;static Wi=new v(50,null);static Gi=0;static Yi=0;static Hi=new Int32Array(50);static Vi=new v(50,null);static Ki=!1;static Xi=new v(50,!1);static ji=new Int32Array(50);static{for(let t=1;t<512;t++)this.Si[t]=32768/t|0;for(let t=1;t<2048;t++)this.xi[t]=65536/t|0;for(let t=0;t<2048;t++)this.sin[t]=65536*Math.sin(.0030679615757712823*t)|0,this.cos[t]=65536*Math.cos(.0030679615757712823*t)|0}static zi=()=>{this.Si=null,this.Si=null,this.sin=null,this.cos=null,this.Di=null,this.Mi=null,this.Xi=null,this.ji=null,this.Ui=null,this.Wi=null,this.Hi=null,this.palette=null,this.Vi=null,console.log('Draw3D unloaded!')};static Zi=()=>{this.Di=new Int32Array(m.dt);for(let t=0;t<m.dt;t++)this.Di[t]=m.ut*t;this.Ni=m.ut/2|0,this.Fi=m.dt/2|0};static qi=(t,i)=>{this.Di=new Int32Array(i);for(let e=0;e<i;e++)this.Di[e]=t*e;this.Ni=t/2|0,this.Fi=i/2|0};static Ji=()=>{this.Ui=null,this.Wi.fill(null)};static $i=t=>{this.ki=0;for(let i=0;i<50;i++)try{this.Mi[i]=R.Ci(t,i.toString()),this.Li&&128===this.Mi[i]?.gi?this.Mi[i]?.Oi():this.Mi[i]?.Ri(),this.ki++}catch(t){}};static Qi=t=>{if(0!==this.ji[t])return this.ji[t];const i=this.Vi[t];if(!i)return 0;let e=0,s=0,n=0;const r=i.length;for(let t=0;t<r;t++)e+=i[t]>>16&255,s+=i[t]>>8&255,n+=255&i[t];let h=(e/r<<16)+(s/r<<8)+(n/r|0);return h=this.te(h,1.4),0===h&&(h=1),this.ji[t]=h,h};static ie=t=>{const i=t+.03*Math.random()-.015;let e=0;for(let t=0;t<512;t++){const s=(t/8|0)/64+.0078125,n=(7&t)/8+.0625;for(let t=0;t<128;t++){const r=t/128;let h=r,o=r,l=r;if(0!==n){let t;t=r<.5?r*(n+1):r+n-r*n;const i=2*r-t;let e=s+.3333333333333333;e>1&&e--;let a=s-.3333333333333333;a<0&&a++,h=6*e<1?i+6*(t-i)*e:2*e<1?t:3*e<2?i+(t-i)*(.6666666666666666-e)*6:i,o=6*s<1?i+6*(t-i)*s:2*s<1?t:3*s<2?i+(t-i)*(.6666666666666666-s)*6:i,l=6*a<1?i+6*(t-i)*a:2*a<1?t:3*a<2?i+(t-i)*(.6666666666666666-a)*6:i}const a=((256*h|0)<<16)+((256*o|0)<<8)+(256*l|0);this.palette[e++]=this.te(a,i)}}for(let t=0;t<50;t++){const e=this.Mi[t];if(!e)continue;const s=e.palette;this.Vi[t]=new Int32Array(s.length);for(let e=0;e<s.length;e++){const n=this.Vi[t];n&&(n[e]=this.te(s[e],i))}}for(let t=0;t<50;t++)this.ee(t)};static te=(t,i)=>{const e=(t>>16)/256,s=(t>>8&255)/256,n=(255&t)/256;return((256*Math.pow(e,i)|0)<<16)+((256*Math.pow(s,i)|0)<<8)+(256*Math.pow(n,i)|0)};static se=t=>{this.Ui||(this.Gi=t,this.Li?this.Ui=new k(t,16384):this.Ui=new k(t,65536),this.Wi.fill(null))};static ne=(t,i,e,s,n,r,h,o,l)=>{let a=0,c=0;n!==s&&(a=(i-t<<16)/(n-s)|0,c=(o-h<<15)/(n-s)|0);let f=0,u=0;r!==n&&(f=(e-i<<16)/(r-n)|0,u=(l-o<<15)/(r-n)|0);let d=0,w=0;if(r!==s&&(d=(t-e<<16)/(s-r)|0,w=(h-l<<15)/(s-r)|0),s<=n&&s<=r){if(s<m.bottom)if(n>m.bottom&&(n=m.bottom),r>m.bottom&&(r=m.bottom),n<r)if(e=t<<=16,l=h<<=15,s<0&&(e-=d*s,t-=a*s,l-=w*s,h-=c*s,s=0),i<<=16,o<<=15,n<0&&(i-=f*n,o-=u*n,n=0),s!==n&&d<a||s===n&&d>f)for(r-=n,n-=s,s=N.Di[s];;){if(--n<0)for(;;){if(--r<0)return;this.re(e>>16,i>>16,l>>7,o>>7,m.ft,s,0),e+=d,i+=f,l+=w,o+=u,s+=m.ut}this.re(e>>16,t>>16,l>>7,h>>7,m.ft,s,0),e+=d,t+=a,l+=w,h+=c,s+=m.ut}else for(r-=n,n-=s,s=N.Di[s];;){if(--n<0)for(;;){if(--r<0)return;this.re(i>>16,e>>16,o>>7,l>>7,m.ft,s,0),e+=d,i+=f,l+=w,o+=u,s+=m.ut}this.re(t>>16,e>>16,h>>7,l>>7,m.ft,s,0),e+=d,t+=a,l+=w,h+=c,s+=m.ut}else if(i=t<<=16,o=h<<=15,s<0&&(i-=d*s,t-=a*s,o-=w*s,h-=c*s,s=0),e<<=16,l<<=15,r<0&&(e-=f*r,l-=u*r,r=0),s!==r&&d<a||s===r&&f>a)for(n-=r,r-=s,s=N.Di[s];;){if(--r<0)for(;;){if(--n<0)return;this.re(e>>16,t>>16,l>>7,h>>7,m.ft,s,0),e+=f,t+=a,l+=u,h+=c,s+=m.ut}this.re(i>>16,t>>16,o>>7,h>>7,m.ft,s,0),i+=d,t+=a,o+=w,h+=c,s+=m.ut}else for(n-=r,r-=s,s=N.Di[s];;){if(--r<0)for(;;){if(--n<0)return;this.re(t>>16,e>>16,h>>7,l>>7,m.ft,s,0),e+=f,t+=a,l+=u,h+=c,s+=m.ut}this.re(t>>16,i>>16,h>>7,o>>7,m.ft,s,0),i+=d,t+=a,o+=w,h+=c,s+=m.ut}}else if(n<=r){if(n<m.bottom)if(r>m.bottom&&(r=m.bottom),s>m.bottom&&(s=m.bottom),r<s)if(t=i<<=16,h=o<<=15,n<0&&(t-=a*n,i-=f*n,h-=c*n,o-=u*n,n=0),e<<=16,l<<=15,r<0&&(e-=d*r,l-=w*r,r=0),n!==r&&a<f||n===r&&a>d)for(s-=r,r-=n,n=N.Di[n];;){if(--r<0)for(;;){if(--s<0)return;this.re(t>>16,e>>16,h>>7,l>>7,m.ft,n,0),t+=a,e+=d,h+=c,l+=w,n+=m.ut}this.re(t>>16,i>>16,h>>7,o>>7,m.ft,n,0),t+=a,i+=f,h+=c,o+=u,n+=m.ut}else for(s-=r,r-=n,n=N.Di[n];;){if(--r<0)for(;;){if(--s<0)return;this.re(e>>16,t>>16,l>>7,h>>7,m.ft,n,0),t+=a,e+=d,h+=c,l+=w,n+=m.ut}this.re(i>>16,t>>16,o>>7,h>>7,m.ft,n,0),t+=a,i+=f,h+=c,o+=u,n+=m.ut}else if(e=i<<=16,l=o<<=15,n<0&&(e-=a*n,i-=f*n,l-=c*n,o-=u*n,n=0),t<<=16,h<<=15,s<0&&(t-=d*s,h-=w*s,s=0),r-=s,s-=n,n=N.Di[n],a<f)for(;;){if(--s<0)for(;;){if(--r<0)return;this.re(t>>16,i>>16,h>>7,o>>7,m.ft,n,0),t+=d,i+=f,h+=w,o+=u,n+=m.ut}this.re(e>>16,i>>16,l>>7,o>>7,m.ft,n,0),e+=a,i+=f,l+=c,o+=u,n+=m.ut}else for(;;){if(--s<0)for(;;){if(--r<0)return;this.re(i>>16,t>>16,o>>7,h>>7,m.ft,n,0),t+=d,i+=f,h+=w,o+=u,n+=m.ut}this.re(i>>16,e>>16,o>>7,l>>7,m.ft,n,0),e+=a,i+=f,l+=c,o+=u,n+=m.ut}}else if(r<m.bottom)if(s>m.bottom&&(s=m.bottom),n>m.bottom&&(n=m.bottom),s<n)if(i=e<<=16,o=l<<=15,r<0&&(i-=f*r,e-=d*r,o-=u*r,l-=w*r,r=0),t<<=16,h<<=15,s<0&&(t-=a*s,h-=c*s,s=0),n-=s,s-=r,r=N.Di[r],f<d)for(;;){if(--s<0)for(;;){if(--n<0)return;this.re(i>>16,t>>16,o>>7,h>>7,m.ft,r,0),i+=f,t+=a,o+=u,h+=c,r+=m.ut}this.re(i>>16,e>>16,o>>7,l>>7,m.ft,r,0),i+=f,e+=d,o+=u,l+=w,r+=m.ut}else for(;;){if(--s<0)for(;;){if(--n<0)return;this.re(t>>16,i>>16,h>>7,o>>7,m.ft,r,0),i+=f,t+=a,o+=u,h+=c,r+=m.ut}this.re(e>>16,i>>16,l>>7,o>>7,m.ft,r,0),i+=f,e+=d,o+=u,l+=w,r+=m.ut}else if(t=e<<=16,h=l<<=15,r<0&&(t-=f*r,e-=d*r,h-=u*r,l-=w*r,r=0),i<<=16,o<<=15,n<0&&(i-=a*n,o-=c*n,n=0),s-=n,n-=r,r=N.Di[r],f<d)for(;;){if(--n<0)for(;;){if(--s<0)return;this.re(i>>16,e>>16,o>>7,l>>7,m.ft,r,0),i+=a,e+=d,o+=c,l+=w,r+=m.ut}this.re(t>>16,e>>16,h>>7,l>>7,m.ft,r,0),t+=f,e+=d,h+=u,l+=w,r+=m.ut}else for(;;){if(--n<0)for(;;){if(--s<0)return;this.re(e>>16,i>>16,l>>7,o>>7,m.ft,r,0),i+=a,e+=d,o+=c,l+=w,r+=m.ut}this.re(e>>16,t>>16,l>>7,h>>7,m.ft,r,0),t+=f,e+=d,h+=u,l+=w,r+=m.ut}};static re=(t,i,e,s,n,r,h)=>{let o;if(N.Bi){let l;if(N.Pi){if(l=i-t>3?(s-e)/(i-t)|0:0,i>m.wt&&(i=m.wt),t<0&&(e-=t*l,t=0),t>=i)return;r+=t,h=i-t>>2,l<<=2}else{if(!(t<i))return;r+=t,l=(h=i-t>>2)>0?(s-e)*N.Si[h]>>15:0}if(0===N.alpha)for(;;){if(--h<0){if((h=i-t&3)>0){o=N.palette[e>>8];do{n[r++]=o,h--}while(h>0);return}break}o=N.palette[e>>8],e+=l,n[r++]=o,n[r++]=o,n[r++]=o,n[r++]=o}else{const s=N.alpha,a=256-N.alpha;for(;;){if(--h<0){if((h=i-t&3)>0){o=N.palette[e>>8],o=((16711935&o)*a>>8&16711935)+((65280&o)*a>>8&65280);do{n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),h--}while(h>0)}break}o=N.palette[e>>8],e+=l,o=((16711935&o)*a>>8&16711935)+((65280&o)*a>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280),n[r++]=o+((16711935&n[r])*s>>8&16711935)+((65280&n[r])*s>>8&65280)}}}else if(t<i){const l=(s-e)/(i-t)|0;if(N.Pi&&(i>m.wt&&(i=m.wt),t<0&&(e-=t*l,t=0),t>=i))return;if(r+=t,h=i-t,0===N.alpha)do{n[r++]=N.palette[e>>8],e+=l,h--}while(h>0);else{const t=N.alpha,i=256-N.alpha;do{o=N.palette[e>>8],e+=l,o=((16711935&o)*i>>8&16711935)+((65280&o)*i>>8&65280),n[r++]=o+((16711935&n[r])*t>>8&16711935)+((65280&n[r])*t>>8&65280),h--}while(h>0)}}};static he=(t,i,e,s,n,r,h)=>{let o=0;n!==s&&(o=(i-t<<16)/(n-s)|0);let l=0;r!==n&&(l=(e-i<<16)/(r-n)|0);let a=0;if(r!==s&&(a=(t-e<<16)/(s-r)|0),s<=n&&s<=r){if(s<m.bottom)if(n>m.bottom&&(n=m.bottom),r>m.bottom&&(r=m.bottom),n<r)if(e=t<<=16,s<0&&(e-=a*s,t-=o*s,s=0),i<<=16,n<0&&(i-=l*n,n=0),s!==n&&a<o||s===n&&a>l)for(r-=n,n-=s,s=this.Di[s];;){if(--n<0)for(;;){if(--r<0)return;this.oe(e>>16,i>>16,m.ft,s,h),e+=a,i+=l,s+=m.ut}this.oe(e>>16,t>>16,m.ft,s,h),e+=a,t+=o,s+=m.ut}else for(r-=n,n-=s,s=this.Di[s];;){if(--n<0)for(;;){if(--r<0)return;this.oe(i>>16,e>>16,m.ft,s,h),e+=a,i+=l,s+=m.ut}this.oe(t>>16,e>>16,m.ft,s,h),e+=a,t+=o,s+=m.ut}else if(i=t<<=16,s<0&&(i-=a*s,t-=o*s,s=0),e<<=16,r<0&&(e-=l*r,r=0),s!==r&&a<o||s===r&&l>o)for(n-=r,r-=s,s=this.Di[s];;){if(--r<0)for(;;){if(--n<0)return;this.oe(e>>16,t>>16,m.ft,s,h),e+=l,t+=o,s+=m.ut}this.oe(i>>16,t>>16,m.ft,s,h),i+=a,t+=o,s+=m.ut}else for(n-=r,r-=s,s=this.Di[s];;){if(--r<0)for(;;){if(--n<0)return;this.oe(t>>16,e>>16,m.ft,s,h),e+=l,t+=o,s+=m.ut}this.oe(t>>16,i>>16,m.ft,s,h),i+=a,t+=o,s+=m.ut}}else if(n<=r){if(n<m.bottom)if(r>m.bottom&&(r=m.bottom),s>m.bottom&&(s=m.bottom),r<s)if(t=i<<=16,n<0&&(t-=o*n,i-=l*n,n=0),e<<=16,r<0&&(e-=a*r,r=0),n!==r&&o<l||n===r&&o>a)for(s-=r,r-=n,n=this.Di[n];;){if(--r<0)for(;;){if(--s<0)return;this.oe(t>>16,e>>16,m.ft,n,h),t+=o,e+=a,n+=m.ut}this.oe(t>>16,i>>16,m.ft,n,h),t+=o,i+=l,n+=m.ut}else for(s-=r,r-=n,n=this.Di[n];;){if(--r<0)for(;;){if(--s<0)return;this.oe(e>>16,t>>16,m.ft,n,h),t+=o,e+=a,n+=m.ut}this.oe(i>>16,t>>16,m.ft,n,h),t+=o,i+=l,n+=m.ut}else if(e=i<<=16,n<0&&(e-=o*n,i-=l*n,n=0),t<<=16,s<0&&(t-=a*s,s=0),o<l)for(r-=s,s-=n,n=this.Di[n];;){if(--s<0)for(;;){if(--r<0)return;this.oe(t>>16,i>>16,m.ft,n,h),t+=a,i+=l,n+=m.ut}this.oe(e>>16,i>>16,m.ft,n,h),e+=o,i+=l,n+=m.ut}else for(r-=s,s-=n,n=this.Di[n];;){if(--s<0)for(;;){if(--r<0)return;this.oe(i>>16,t>>16,m.ft,n,h),t+=a,i+=l,n+=m.ut}this.oe(i>>16,e>>16,m.ft,n,h),e+=o,i+=l,n+=m.ut}}else if(r<m.bottom)if(s>m.bottom&&(s=m.bottom),n>m.bottom&&(n=m.bottom),s<n)if(i=e<<=16,r<0&&(i-=l*r,e-=a*r,r=0),t<<=16,s<0&&(t-=o*s,s=0),l<a)for(n-=s,s-=r,r=this.Di[r];;){if(--s<0)for(;;){if(--n<0)return;this.oe(i>>16,t>>16,m.ft,r,h),i+=l,t+=o,r+=m.ut}this.oe(i>>16,e>>16,m.ft,r,h),i+=l,e+=a,r+=m.ut}else for(n-=s,s-=r,r=this.Di[r];;){if(--s<0)for(;;){if(--n<0)return;this.oe(t>>16,i>>16,m.ft,r,h),i+=l,t+=o,r+=m.ut}this.oe(e>>16,i>>16,m.ft,r,h),i+=l,e+=a,r+=m.ut}else if(t=e<<=16,r<0&&(t-=l*r,e-=a*r,r=0),i<<=16,n<0&&(i-=o*n,n=0),l<a)for(s-=n,n-=r,r=this.Di[r];;){if(--n<0)for(;;){if(--s<0)return;this.oe(i>>16,e>>16,m.ft,r,h),i+=o,e+=a,r+=m.ut}this.oe(t>>16,e>>16,m.ft,r,h),t+=l,e+=a,r+=m.ut}else for(s-=n,n-=r,r=this.Di[r];;){if(--n<0)for(;;){if(--s<0)return;this.oe(e>>16,i>>16,m.ft,r,h),i+=o,e+=a,r+=m.ut}this.oe(e>>16,t>>16,m.ft,r,h),t+=l,e+=a,r+=m.ut}};static le=(t,i,e,s,n,r,h,o,l,a,c,f,u,d,w,y,p,A,_)=>{const g=this.ae(_);this.Ki=!this.Xi[_];const I=a-u,C=c-w,E=f-p,T=d-a,b=y-c,O=A-f;let R=T*c-b*a<<14;const v=b*f-O*c<<8,L=O*a-T*f<<5;let S=I*c-C*a<<14;const x=C*f-E*c<<8,M=E*a-I*f<<5;let k=C*T-I*b<<14;const D=E*b-C*O<<8,N=I*O-E*T<<5;let F=0,B=0;n!==s&&(F=(i-t<<16)/(n-s)|0,B=(o-h<<16)/(n-s)|0);let P=0,U=0;r!==n&&(P=(e-i<<16)/(r-n)|0,U=(l-o<<16)/(r-n)|0);let W=0,G=0;if(r!==s&&(W=(t-e<<16)/(s-r)|0,G=(h-l<<16)/(s-r)|0),s<=n&&s<=r){if(s<m.bottom)if(n>m.bottom&&(n=m.bottom),r>m.bottom&&(r=m.bottom),n<r){e=t<<=16,l=h<<=16,s<0&&(e-=W*s,t-=F*s,l-=G*s,h-=B*s,s=0),i<<=16,o<<=16,n<0&&(i-=P*n,o-=U*n,n=0);const a=s-this.Fi;if(R+=L*a,S+=M*a,k+=N*a,R|=0,S|=0,k|=0,s!==n&&W<F||s===n&&W>P)for(r-=n,n-=s,s=this.Di[s];;){if(--n<0)for(;;){if(--r<0)return;this.ce(e>>16,i>>16,m.ft,s,g,0,0,R,S,k,v,x,D,l>>8,o>>8),e+=W,i+=P,l+=G,o+=U,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(e>>16,t>>16,m.ft,s,g,0,0,R,S,k,v,x,D,l>>8,h>>8),e+=W,t+=F,l+=G,h+=B,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}else for(r-=n,n-=s,s=this.Di[s];;){if(--n<0)for(;;){if(--r<0)return;this.ce(i>>16,e>>16,m.ft,s,g,0,0,R,S,k,v,x,D,o>>8,l>>8),e+=W,i+=P,l+=G,o+=U,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(t>>16,e>>16,m.ft,s,g,0,0,R,S,k,v,x,D,h>>8,l>>8),e+=W,t+=F,l+=G,h+=B,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}}else{i=t<<=16,o=h<<=16,s<0&&(i-=W*s,t-=F*s,o-=G*s,h-=B*s,s=0),e<<=16,l<<=16,r<0&&(e-=P*r,l-=U*r,r=0);const a=s-this.Fi;if(R+=L*a,S+=M*a,k+=N*a,R|=0,S|=0,k|=0,(s===r||W>=F)&&(s!==r||P<=F))for(n-=r,r-=s,s=this.Di[s];;){if(--r<0)for(;;){if(--n<0)return;this.ce(t>>16,e>>16,m.ft,s,g,0,0,R,S,k,v,x,D,h>>8,l>>8),e+=P,t+=F,l+=U,h+=B,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(t>>16,i>>16,m.ft,s,g,0,0,R,S,k,v,x,D,h>>8,o>>8),i+=W,t+=F,o+=G,h+=B,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}else for(n-=r,r-=s,s=this.Di[s];;){if(--r<0)for(;;){if(--n<0)return;this.ce(e>>16,t>>16,m.ft,s,g,0,0,R,S,k,v,x,D,l>>8,h>>8),e+=P,t+=F,l+=U,h+=B,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(i>>16,t>>16,m.ft,s,g,0,0,R,S,k,v,x,D,o>>8,h>>8),i+=W,t+=F,o+=G,h+=B,s+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}}}else if(n<=r){if(n<m.bottom)if(r>m.bottom&&(r=m.bottom),s>m.bottom&&(s=m.bottom),r<s){t=i<<=16,h=o<<=16,n<0&&(t-=F*n,i-=P*n,h-=B*n,o-=U*n,n=0),e<<=16,l<<=16,r<0&&(e-=W*r,l-=G*r,r=0);const a=n-this.Fi;if(R+=L*a,S+=M*a,k+=N*a,R|=0,S|=0,k|=0,n!==r&&F<P||n===r&&F>W)for(s-=r,r-=n,n=this.Di[n];;){if(--r<0)for(;;){if(--s<0)return;this.ce(t>>16,e>>16,m.ft,n,g,0,0,R,S,k,v,x,D,h>>8,l>>8),t+=F,e+=W,h+=B,l+=G,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(t>>16,i>>16,m.ft,n,g,0,0,R,S,k,v,x,D,h>>8,o>>8),t+=F,i+=P,h+=B,o+=U,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}else for(s-=r,r-=n,n=this.Di[n];;){if(--r<0)for(;;){if(--s<0)return;this.ce(e>>16,t>>16,m.ft,n,g,0,0,R,S,k,v,x,D,l>>8,h>>8),t+=F,e+=W,h+=B,l+=G,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(i>>16,t>>16,m.ft,n,g,0,0,R,S,k,v,x,D,o>>8,h>>8),t+=F,i+=P,h+=B,o+=U,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}}else{e=i<<=16,l=o<<=16,n<0&&(e-=F*n,i-=P*n,l-=B*n,o-=U*n,n=0),t<<=16,h<<=16,s<0&&(t-=W*s,h-=G*s,s=0);const a=n-this.Fi;if(R+=L*a,S+=M*a,k+=N*a,R|=0,S|=0,k|=0,r-=s,s-=n,n=this.Di[n],F<P)for(;;){if(--s<0)for(;;){if(--r<0)return;this.ce(t>>16,i>>16,m.ft,n,g,0,0,R,S,k,v,x,D,h>>8,o>>8),t+=W,i+=P,h+=G,o+=U,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(e>>16,i>>16,m.ft,n,g,0,0,R,S,k,v,x,D,l>>8,o>>8),e+=F,i+=P,l+=B,o+=U,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}else for(;;){if(--s<0)for(;;){if(--r<0)return;this.ce(i>>16,t>>16,m.ft,n,g,0,0,R,S,k,v,x,D,o>>8,h>>8),t+=W,i+=P,h+=G,o+=U,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(i>>16,e>>16,m.ft,n,g,0,0,R,S,k,v,x,D,o>>8,l>>8),e+=F,i+=P,l+=B,o+=U,n+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}}}else if(r<m.bottom)if(s>m.bottom&&(s=m.bottom),n>m.bottom&&(n=m.bottom),s<n){i=e<<=16,o=l<<=16,r<0&&(i-=P*r,e-=W*r,o-=U*r,l-=G*r,r=0),t<<=16,h<<=16,s<0&&(t-=F*s,h-=B*s,s=0);const a=r-this.Fi;if(R+=L*a,S+=M*a,k+=N*a,R|=0,S|=0,k|=0,n-=s,s-=r,r=this.Di[r],P<W)for(;;){if(--s<0)for(;;){if(--n<0)return;this.ce(i>>16,t>>16,m.ft,r,g,0,0,R,S,k,v,x,D,o>>8,h>>8),i+=P,t+=F,o+=U,h+=B,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(i>>16,e>>16,m.ft,r,g,0,0,R,S,k,v,x,D,o>>8,l>>8),i+=P,e+=W,o+=U,l+=G,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}else for(;;){if(--s<0)for(;;){if(--n<0)return;this.ce(t>>16,i>>16,m.ft,r,g,0,0,R,S,k,v,x,D,h>>8,o>>8),i+=P,t+=F,o+=U,h+=B,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(e>>16,i>>16,m.ft,r,g,0,0,R,S,k,v,x,D,l>>8,o>>8),i+=P,e+=W,o+=U,l+=G,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}}else{t=e<<=16,h=l<<=16,r<0&&(t-=P*r,e-=W*r,h-=U*r,l-=G*r,r=0),i<<=16,o<<=16,n<0&&(i-=F*n,o-=B*n,n=0);const a=r-this.Fi;if(R+=L*a,S+=M*a,k+=N*a,R|=0,S|=0,k|=0,s-=n,n-=r,r=this.Di[r],P<W)for(;;){if(--n<0)for(;;){if(--s<0)return;this.ce(i>>16,e>>16,m.ft,r,g,0,0,R,S,k,v,x,D,o>>8,l>>8),i+=F,e+=W,o+=B,l+=G,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(t>>16,e>>16,m.ft,r,g,0,0,R,S,k,v,x,D,h>>8,l>>8),t+=P,e+=W,h+=U,l+=G,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}else for(;;){if(--n<0)for(;;){if(--s<0)return;this.ce(e>>16,i>>16,m.ft,r,g,0,0,R,S,k,v,x,D,l>>8,o>>8),i+=F,e+=W,o+=B,l+=G,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}this.ce(e>>16,t>>16,m.ft,r,g,0,0,R,S,k,v,x,D,l>>8,h>>8),t+=P,e+=W,h+=U,l+=G,r+=m.ut,R+=L,S+=M,k+=N,R|=0,S|=0,k|=0}}};static ce=(t,i,e,s,n,r,h,o,l,a,c,f,u,d,w)=>{if(t>=i)return;let y,p,A,_,g,I,C,E,T;if(this.Pi){if(y=(w-d)/(i-t)|0,i>m.wt&&(i=m.wt),t<0&&(d-=t*y,t=0),t>=i)return;p=i-t>>3,y<<=12}else i-t>7?(p=i-t>>3,y=(w-d)*this.Si[p]>>6):(p=0,y=0);if(d<<=9,s+=t,this.Li&&n)if(A=0,_=0,I=t-this.Ni,o+=(c>>3)*I,l+=(f>>3)*I,a+=(u>>3)*I,o|=0,l|=0,g=(a|=0)>>12,0!==g&&(h=l/g|0,(r=o/g|0)<0?r=0:r>4032&&(r=4032)),o+=c,l+=f,a+=u,o|=0,l|=0,g=(a|=0)>>12,0!==g&&(A=o/g|0,_=l/g|0,A<7?A=7:A>4032&&(A=4032)),C=A-r>>3,E=_-h>>3,r+=d>>3&786432,T=d>>23,this.Ki){for(;p-- >0;)e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E,e[s++]=n[(4032&h)+(r>>6)]>>>T,r=A,h=_,o+=c,l+=f,g=(a+=u)>>12,0!==g&&(A=o/g|0,_=l/g|0,A<7?A=7:A>4032&&(A=4032)),C=A-r>>3,E=_-h>>3,r+=(d+=y)>>3&786432,T=d>>23;for(p=i-t&7;p-- >0;)e[s++]=n[(4032&h)+(r>>6)]>>>T,r+=C,h+=E}else{for(;p-- >0;){let t;0!=(t=n[(4032&h)+(r>>6)]>>>T)&&(e[s]=t),s+=1,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s++,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s++,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s++,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s++,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s++,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s++,0!=(t=n[(4032&(h+=E))+((r+=C)>>6)]>>>T)&&(e[s]=t),s+=1,r=A,h=_,o+=c,l+=f,a+=u,o|=0,l|=0,g=(a|=0)>>12,0!==g&&(A=o/g|0,_=l/g|0,A<7?A=7:A>4032&&(A=4032)),C=A-r>>3,E=_-h>>3,r+=(d+=y)>>3&786432,T=d>>23}for(p=i-t&7;p-- >0;){let t;0!=(t=n[(4032&h)+(r>>6)]>>>T)&&(e[s]=t),s++,r+=C,h+=E}}else if(A=0,_=0,I=t-this.Ni,o+=(c>>3)*I,l+=(f>>3)*I,a+=(u>>3)*I,o|=0,l|=0,g=(a|=0)>>14,0!==g&&(h=l/g|0,(r=o/g|0)<0?r=0:r>16256&&(r=16256)),o+=c,l+=f,a+=u,o|=0,l|=0,g=(a|=0)>>14,0!==g&&(A=o/g|0,_=l/g|0,A<7?A=7:A>16256&&(A=16256)),C=A-r>>3,E=_-h>>3,r+=6291456&d,T=d>>23,this.Ki&&n){for(;p-- >0;)e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E,e[s++]=n[(16256&h)+(r>>7)]>>>T,r=A,h=_,o+=c,l+=f,a+=u,o|=0,l|=0,g=(a|=0)>>14,0!==g&&(A=o/g|0,_=l/g|0,A<7?A=7:A>16256&&(A=16256)),C=A-r>>3,E=_-h>>3,r+=6291456&(d+=y),T=d>>23;for(p=i-t&7;p-- >0;)e[s++]=n[(16256&h)+(r>>7)]>>>T,r+=C,h+=E}else{for(;p-- >0&&n;){let t;0!=(t=n[(16256&h)+(r>>7)]>>>T)&&(e[s]=t),s+=1,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,0!=(t=n[(16256&(h+=E))+((r+=C)>>7)]>>>T)&&(e[s]=t),s++,r=A,h=_,o+=c,l+=f,a+=u,o|=0,l|=0,g=(a|=0)>>14,0!==g&&(A=o/g|0,_=l/g|0,A<7?A=7:A>16256&&(A=16256)),C=A-r>>3,E=_-h>>3,r+=6291456&(d+=y),T=d>>23}for(p=i-t&7;p-- >0&&n;){let t;0!=(t=n[(16256&h)+(r>>7)]>>>T)&&(e[s]=t),s++,r+=C,h+=E}}};static oe=(t,i,e,s,n)=>{if(this.Pi&&(i>m.wt&&(i=m.wt),t<0&&(t=0)),t>=i)return;s+=t;let r=i-t>>2;if(0===this.alpha)for(;;){if(r--,r<0)for(r=i-t&3;;){if(r--,r<0)return;e[s++]=n}e[s++]=n,e[s++]=n,e[s++]=n,e[s++]=n}const h=this.alpha,o=256-this.alpha;for(n=((16711935&n)*o>>8&16711935)+((65280&n)*o>>8&65280);;){if(r--,r<0)for(r=i-t&3;;){if(r--,r<0)return;e[s++]=n+((16711935&e[s])*h>>8&16711935)+((65280&e[s])*h>>8&65280)}e[s++]=n+((16711935&e[s])*h>>8&16711935)+((65280&e[s])*h>>8&65280),e[s++]=n+((16711935&e[s])*h>>8&16711935)+((65280&e[s])*h>>8&65280),e[s++]=n+((16711935&e[s])*h>>8&16711935)+((65280&e[s])*h>>8&65280),e[s++]=n+((16711935&e[s])*h>>8&16711935)+((65280&e[s])*h>>8&65280)}};static ee=t=>{this.Wi[t]&&this.Ui&&(this.Ui[this.Gi++]=this.Wi[t],this.Wi[t]=null)};static ae=t=>{if(this.Hi[t]=this.Yi++,this.Wi[t])return this.Wi[t];let i;if(this.Gi>0&&this.Ui)i=this.Ui[--this.Gi],this.Ui[this.Gi]=null;else{let t=0,e=-1;for(let i=0;i<this.ki;i++)this.Wi[i]&&(this.Hi[i]<t||-1===e)&&(t=this.Hi[i],e=i);i=this.Wi[e],this.Wi[e]=null}this.Wi[t]=i;const e=this.Mi[t],s=this.Vi[t];if(!i||!e||!s)return null;if(this.Li){this.Xi[t]=!1;for(let n=0;n<4096;n++){const r=i[n]=16316671&s[e.ft[n]];0===r&&(this.Xi[t]=!0),i[n+4096]=r-(r>>>3)&16316671,i[n+8192]=r-(r>>>2)&16316671,i[n+12288]=r-(r>>>2)-(r>>>3)&16316671}}else{if(64===e.width)for(let t=0;t<128;t++)for(let n=0;n<128;n++)i[n+(t<<7)]=s[e.ft[(n>>1)+(t>>1<<6)]];else for(let t=0;t<16384;t++)i[t]=s[e.ft[t]];this.Xi[t]=!1;for(let e=0;e<16384;e++){i[e]&=16316671;const s=i[e];0===s&&(this.Xi[t]=!0),i[e+16384]=s-(s>>>3)&16316671,i[e+32768]=s-(s>>>2)&16316671,i[e+49152]=s-(s>>>2)-(s>>>3)&16316671}}return i}}const F=['F11','F12'],B={'Backspace':{code:8,ch:8},'Enter':{code:10,ch:10},'Shift':{code:16,ch:65535},'Escape':{code:27,ch:27},'Tab':{code:9,ch:9},'CapsLock':{code:20,ch:65535},' ':{code:32,ch:32},'Control':{code:17,ch:65535},'Alt':{code:18,ch:65535},'Meta':{code:524,ch:65535},'ArrowLeft':{code:37,ch:65535},'ArrowRight':{code:39,ch:65535},'ArrowUp':{code:38,ch:65535},'ArrowDown':{code:40,ch:65535},'Insert':{code:155,ch:65535},'Home':{code:36,ch:65535},'PageUp':{code:33,ch:65535},'Delete':{code:127,ch:127},'End':{code:35,ch:65535},'PageDown':{code:34,ch:65535},'`':{code:192,ch:96},'~':{code:192,ch:126},'!':{code:49,ch:33},'@':{code:50,ch:64},'#':{code:51,ch:35},'$':{code:52,ch:36},'%':{code:53,ch:37},'^':{code:54,ch:94},'&':{code:55,ch:38},'*':{code:56,ch:42},'(':{code:57,ch:40},')':{code:48,ch:41},'-':{code:45,ch:45},'_':{code:45,ch:95},'=':{code:61,ch:61},'+':{code:61,ch:43},'[':{code:91,ch:91},'{':{code:91,ch:123},']':{code:93,ch:93},'}':{code:93,ch:125},'\\':{code:92,ch:92},'|':{code:92,ch:124},';':{code:59,ch:59},':':{code:59,ch:58},"'":{code:222,ch:39},'"':{code:222,ch:34},',':{code:44,ch:44},'<':{code:44,ch:60},'.':{code:46,ch:46},'>':{code:46,ch:62},'/':{code:47,ch:47},'?':{code:47,ch:63},'F1':{code:112,ch:65535},'F2':{code:113,ch:65535},'F3':{code:114,ch:65535},'F4':{code:115,ch:65535},'F5':{code:116,ch:65535},'F6':{code:117,ch:65535},'F7':{code:118,ch:65535},'F8':{code:119,ch:65535},'F9':{code:120,ch:65535},'F10':{code:121,ch:65535},'F11':{code:122,ch:65535},'F12':{code:123,ch:65535},0:{code:48,ch:48},1:{code:49,ch:49},2:{code:50,ch:50},3:{code:51,ch:51},4:{code:52,ch:52},5:{code:53,ch:53},6:{code:54,ch:54},7:{code:55,ch:55},8:{code:56,ch:56},9:{code:57,ch:57},'a':{code:65,ch:97},'b':{code:66,ch:98},'c':{code:67,ch:99},'d':{code:68,ch:100},'e':{code:69,ch:101},'f':{code:70,ch:102},'g':{code:71,ch:103},'h':{code:72,ch:104},'i':{code:73,ch:105},'j':{code:74,ch:106},'k':{code:75,ch:107},'l':{code:76,ch:108},'m':{code:77,ch:109},'n':{code:78,ch:110},'o':{code:79,ch:111},'p':{code:80,ch:112},'q':{code:81,ch:113},'r':{code:82,ch:114},'s':{code:83,ch:115},'t':{code:84,ch:116},'u':{code:85,ch:117},'v':{code:86,ch:118},'w':{code:87,ch:119},'x':{code:88,ch:120},'y':{code:89,ch:121},'z':{code:90,ch:122},'A':{code:65,ch:65},'B':{code:66,ch:66},'C':{code:67,ch:67},'D':{code:68,ch:68},'E':{code:69,ch:69},'F':{code:70,ch:70},'G':{code:71,ch:71},'H':{code:72,ch:72},'I':{code:73,ch:73},'J':{code:74,ch:74},'K':{code:75,ch:75},'L':{code:76,ch:76},'M':{code:77,ch:77},'N':{code:78,ch:78},'O':{code:79,ch:79},'P':{code:80,ch:80},'Q':{code:81,ch:81},'R':{code:82,ch:82},'S':{code:83,ch:83},'T':{code:84,ch:84},'U':{code:85,ch:85},'V':{code:86,ch:86},'W':{code:87,ch:87},'X':{code:88,ch:88},'Y':{code:89,ch:89},'Z':{code:90,ch:90}};class P{static enabled=!1;static fe=null;static ue=null;static de=0;static we=0;static ye=0;static me=0;static pe=0;static Ae=()=>{this.fe=O.zt(1),this.ue=null,this.de=performance.now(),this.enabled=!0};static _e=()=>{this.enabled=!1,this.fe=null};static flush=()=>{let t=null;return this.ue&&this.enabled&&(t=this.ue),this.ue=null,t};static stop=()=>{let t=null;return this.fe&&this.fe.Xt>0&&this.enabled&&(t=this.fe),this._e(),t};static ge=(t,i,e)=>{if(!(this.enabled&&t>=0&&t<789&&i>=0&&i<532))return;this.we++;const s=performance.now();let n=(s-this.de)/10|0;n>250&&(n=250),this.de=s,this.Ie(5),1===e?this.fe?.p1(1):this.fe?.p1(2),this.fe?.p1(n),this.fe?.p3(t+(i<<10))};static Ce=t=>{if(!this.enabled)return;this.we++;const i=performance.now();let e=(i-this.de)/10|0;e>250&&(e=250),this.de=i,this.Ie(2),1===t?this.fe?.p1(3):this.fe?.p1(4),this.fe?.p1(e)};static Ee=(t,i)=>{if(!(this.enabled&&t>=0&&t<789&&i>=0&&i<532))return;const e=performance.now();if(e-this.ye>=50){this.ye=e,this.we++;let s=(e-this.de)/10|0;s>250&&(s=250),this.de=e,t-this.me<8&&t-this.me>=-8&&i-this.pe<8&&i-this.pe>=-8?(this.Ie(3),this.fe?.p1(5),this.fe?.p1(s),this.fe?.p1(t+(i-this.pe+8<<4)+8-this.me)):t-this.me<128&&t-this.me>=-128&&i-this.pe<128&&i-this.pe>=-128?(this.Ie(4),this.fe?.p1(6),this.fe?.p1(s),this.fe?.p1(t+128-this.me),this.fe?.p1(i+128-this.pe)):(this.Ie(5),this.fe?.p1(7),this.fe?.p1(s),this.fe?.p3(t+(i<<10))),this.me=t,this.pe=i}};static Te=t=>{if(!this.enabled)return;this.we++;const i=performance.now();let e=(i-this.de)/10|0;e>250&&(e=250),this.de=i,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.Ie(3),this.fe?.p1(8),this.fe?.p1(e),this.fe?.p1(t)};static be=t=>{if(!this.enabled)return;this.we++;const i=performance.now();let e=(i-this.de)/10|0;e>250&&(e=250),this.de=i,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.Ie(3),this.fe?.p1(9),this.fe?.p1(e),this.fe?.p1(t)};static Oe=()=>{if(!this.enabled)return;this.we++;const t=performance.now();let i=(t-this.de)/10|0;i>250&&(i=250),this.de=t,this.Ie(2),this.fe?.p1(10),this.fe?.p1(i)};static Re=()=>{if(!this.enabled)return;this.we++;const t=performance.now();let i=(t-this.de)/10|0;i>250&&(i=250),this.de=t,this.Ie(2),this.fe?.p1(11),this.fe?.p1(i)};static ve=()=>{if(!this.enabled)return;this.we++;const t=performance.now();let i=(t-this.de)/10|0;i>250&&(i=250),this.de=t,this.Ie(2),this.fe?.p1(12),this.fe?.p1(i)};static Le=()=>{if(!this.enabled)return;this.we++;const t=performance.now();let i=(t-this.de)/10|0;i>250&&(i=250),this.de=t,this.Ie(2),this.fe?.p1(13),this.fe?.p1(i)};static Ie=t=>{if(this.fe&&this.fe.Xt+t>=500){const t=this.fe;this.fe=O.zt(1),this.ue=t}}}class U{static getParameter(t){return new URLSearchParams(window.location.search).get(t)??''}static setParameter(t,i){const e=new URL(window.location.toString());e.searchParams.set(t,i),window.history.pushState(null,'',e.toString())}Se=0;xe=[];Me=0;ke=null;state=0;De=20;Ne=1;Fe=[];Be=0;Pe=0;Ue=[];We=!0;Ge=!1;Ye=50;hasFocus=!0;He=!1;Ve=0;Ke=0;Xe=0;je=0;ze=0;Ze=0;qe=0;Je=[];$e=[];Qe=0;ts=0;input=null;es=!1;ss=!1;ns=!1;time=-1;rs=0;hs=0;os=0;ls=0;cs=0;fs=0;constructor(t=!1){p.tabIndex=-1,A.fillStyle='black',A.fillRect(0,0,p.width,p.height),this.Ge=t,this.Ge?this.resize(window.innerWidth,window.innerHeight):this.resize(p.width,p.height)}get width(){return p.width}get height(){return p.height}resize=(t,i)=>{p.width=t,p.height=i,this.ke=new C(t,i),N.Zi()};run=async()=>{p.addEventListener('resize',(()=>{this.Ge&&this.resize(window.innerWidth,window.innerHeight)}),!1),p.onmousedown=this.onmousedown,p.onmouseup=this.onmouseup,p.onmouseenter=this.onmouseenter,p.onmouseleave=this.onmouseleave,p.onmousemove=this.onmousemove,window.onbeforeunload=this.zi,p.onfocus=this.onfocus,p.onblur=this.onblur,this.us?(p.ontouchstart=this.ontouchstart,p.ontouchend=this.ontouchend,p.ontouchmove=this.ontouchmove):(p.onkeydown=this.onkeydown,p.onkeyup=this.onkeyup),p.oncontextmenu=t=>{t.preventDefault()},window.oncontextmenu=t=>{t.preventDefault()},this.us&&'low'===U.getParameter('detail')&&(this.Ye=30),await this.ds(0,'Loading...'),await this.load();for(let t=0;t<10;t++)this.Fe[t]=performance.now();let t,i=0,e=256,s=1,n=0;for(;this.state>=0;){if(this.state>0&&(this.state--,0===this.state))return void this.ws();const r=e,h=s;e=300,s=1,t=performance.now();const o=this.Fe[i];if(0===o?(e=r,s=h):t>o&&(e=2560*this.De/(t-o)|0),e<25?e=25:e>256&&(e=256,s=this.De-(t-o)/10|0),this.Fe[i]=t,i=(i+1)%10,s>1)for(let t=0;t<10;t++)0!==this.Fe[t]&&(this.Fe[t]+=s);for(s<this.Ne&&(s=this.Ne),await E(s);n<256;)await this.update(),this.ze=0,this.Qe=this.ts,n+=e;n&=255,this.De>0&&(this.Be=1e3*e/(256*this.De)|0);const l=performance.now();if(this.We&&this.refresh(),await this.draw(),this.Ue[this.Pe]=(performance.now()-l)/1e3,this.Pe=(this.Pe+1)%this.Ue.length,this.Ye<50){const i=1e3/this.Ye-(performance.now()-t);i>0&&await E(i)}}-1===this.state&&this.ws()};ws=()=>{this.state=-2,this.zi()};ys=t=>{this.De=1e3/t|0};ps=t=>{this.Ye=Math.max(Math.min(50,0|t),0)};start=()=>{this.state>=0&&(this.state=0)};stop=()=>{this.state>=0&&(this.state=4e3/this.De|0)};destroy=()=>{this.state=-1};load=async()=>{};update=async()=>{};zi=()=>{};draw=async()=>{};refresh=()=>{};async ds(t,i){const e=this.width,s=this.height;this.We&&(A.fillStyle='black',A.fillRect(0,0,e,s),this.We=!1);const n=s/2-18;A.fillStyle='rgb(140, 17, 17)',A.rect((e/2|0)-152,n,304,34),A.fillRect((e/2|0)-150,n+2,3*t,30),A.fillStyle='black',A.fillRect((e/2|0)-150+3*t,n+2,300-3*t,30),A.font='bold 13px helvetica, sans-serif',A.textAlign='center',A.fillStyle='white',A.fillText(i,e/2|0,n+22),await E(5)}As=()=>{let t=-1;return this.ts!==this.Qe&&(t=this.$e[this.Qe],this.Qe=this.Qe+1&127),t};get ms(){const t=this.Ue.length;let i=0;for(let e=0;e<t;e++)i+=this.Ue[e];const e=i/t*1e3;return e>this.Se&&(this.Se=e),this.xe[this.Me]=e,this.Me=(this.Me+1)%250,e}get _s(){return this.xe.reduce(((t,i)=>t+i),0)/250}onkeydown=t=>{const i=t.key;this.Ve=0;const e=B[i];if(!e||0===t.code.length&&!t.isTrusted)return void console.warn(`Unhandled key: ${i}`);const s=e.code;let n=e.ch;t.ctrlKey&&(n>='A'.charCodeAt(0)&&n<=']'.charCodeAt(0)||n=='_'.charCodeAt(0)?n-='A'.charCodeAt(0)-1:n>='a'.charCodeAt(0)&&n<='z'.charCodeAt(0)&&(n-='a'.charCodeAt(0)-1)),n<30&&(n=0),s===B.ArrowLeft.code?n=1:s===B.ArrowRight.code?n=2:s===B.ArrowUp.code?n=3:s===B.ArrowDown.code?n=4:s===B.Control.code?n=5:s===B.Shift.code?n=6:s===B.Alt.code?n=7:s===B.Backspace.code||s===B.Delete.code?n=8:s===B.Tab.code?n=9:s===B.Enter.code?n=10:s>=B.F1.code&&s<=B.F12.code?n=s+1008-B.F1.code:s===B.Home.code?n=1e3:s===B.End.code?n=1001:s===B.PageUp.code?n=1002:s===B.PageDown.code&&(n=1003),n>0&&n<128&&(this.Je[n]=1),n>4&&(this.$e[this.ts]=n,this.ts=this.ts+1&127),P.enabled&&P.Te(n),F.includes(i)||t.preventDefault()};onkeyup=t=>{const i=t.key;this.Ve=0;const e=B[i];if(!e||0===t.code.length&&!t.isTrusted)return void console.warn(`Unhandled key: ${i}`);const s=e.code;let n=e.ch;n<30&&(n=0),s===B.ArrowLeft.code?n=1:s===B.ArrowRight.code?n=2:s===B.ArrowUp.code?n=3:s===B.ArrowDown.code?n=4:s===B.Control.code?n=5:s===B.Shift.code?n=6:s===B.Alt.code?n=7:s===B.Backspace.code||s===B.Delete.code?n=8:s===B.Tab.code?n=9:s===B.Enter.code?n=10:s>=B.F1.code&&s<=B.F12.code?n=s+1008-B.F1.code:s===B.Home.code?n=1e3:s===B.End.code?n=1001:s===B.PageUp.code?n=1002:s===B.PageDown.code&&(n=1003),n>0&&n<128&&(this.Je[n]=0),P.enabled&&P.be(n),F.includes(i)||t.preventDefault()};onmousedown=t=>{if(this.es=!1,(t.clientX>0||t.clientY>0)&&this.gs(t),this.Ve=0,this.Ze=this.Xe,this.qe=this.je,this.us&&!this.Is){if(this.Cs()||this.Es()||this.Ts())return this.ze=1,void(this.Ke=1);t.timeStamp>=this.time+500?(this.ze=2,this.Ke=2):(this.ze=1,this.Ke=1)}else 2===t.button?(this.ze=2,this.Ke=2):(this.ze=1,this.Ke=1);P.enabled&&P.ge(this.Ze,this.qe,t.buttons)};onmouseup=t=>{this.gs(t),this.Ve=0,this.Ke=0,P.enabled&&P.Ce(t.buttons)};onmouseenter=t=>{this.gs(t),P.enabled&&P.ve()};onmouseleave=t=>{this.gs(t),this.Ve=0,this.Xe=-1,this.je=-1,this.Ke=0,this.Ze=-1,this.qe=-1,P.enabled&&P.Le()};onmousemove=t=>{this.gs(t),this.Ve=0,P.enabled&&P.Ee(this.Xe,this.je)};onfocus=t=>{this.hasFocus=!0,this.We=!0,this.refresh(),P.enabled&&P.Oe()};onblur=t=>{this.hasFocus=!1,P.enabled&&P.Re()};ontouchstart=t=>{if(!this.us)return;null!==this.input&&(this.input.parentNode?.removeChild(this.input),this.input=null),this.es=!0;const i=t.changedTouches[0],e=0|i.clientX,s=0|i.clientY;this.onmousemove(new MouseEvent('mousemove',{clientX:e,clientY:s})),this.rs=this.cs=this.os=0|i.screenX,this.hs=this.fs=this.ls=0|i.screenY,this.time=t.timeStamp,this.ss=this.bs(),this.ns=this.Os()};ontouchend=t=>{if(!this.us||!this.es)return;const i=t.changedTouches[0],e=0|i.clientX,s=0|i.clientY;if(this.onmousemove(new MouseEvent('mousemove',{clientX:e,clientY:s})),this.cs=0|i.screenX,this.fs=0|i.screenY,this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowLeft',code:'ArrowLeft'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowUp',code:'ArrowUp'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowRight',code:'ArrowRight'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowDown',code:'ArrowDown'})),this.ss&&!this.bs())return void(this.es=!1);if(this.ns&&!this.Os())return void(this.es=!1);if(this.Cs()||this.Rs()||this.Es()||this.Ts()){null!==this.input&&(this.input.parentNode?.contains(this.input)&&this.input.parentNode?.removeChild(this.input),this.input=null);const t=document.createElement('input');return this.Es()?(t.setAttribute('id','username'),t.setAttribute('placeholder','Username')):this.Ts()?(t.setAttribute('id','password'),t.setAttribute('placeholder','Password')):this.Cs()?(t.setAttribute('id','chatinput'),t.setAttribute('placeholder','Chatinput')):this.Rs()&&(t.setAttribute('id','chatpopup'),t.setAttribute('placeholder','Chatpopup')),this.vs?t.setAttribute('type','password'):t.setAttribute('type',this.Ts()?'password':'text'),t.setAttribute('autofocus','autofocus'),t.setAttribute('spellcheck','false'),t.setAttribute('autocomplete','off'),t.setAttribute('style',`position: fixed; left: ${e}px; top: ${s}px; width: 1px; height: 1px; opacity: 0;`),document.body.appendChild(t),t.focus(),t.click(),this.vs&&(t.oninput=t=>{if(!(t instanceof InputEvent))return;const i=t,e=i.data;null!==e&&'insertText'===i.inputType&&this.onkeydown(new KeyboardEvent('keydown',{key:e,code:e}))}),t.onkeydown=t=>{this.vs&&'Enter'!==t.key&&'Backspace'!==t.key||this.onkeydown(new KeyboardEvent('keydown',{key:t.key,code:t.key}))},t.onkeyup=t=>{this.vs&&'Enter'!==t.key&&'Backspace'!==t.key||this.onkeyup(new KeyboardEvent('keyup',{key:t.key,code:t.key}))},t.onfocus=t=>{this.input?.parentNode?.removeChild(this.input),this.input=null,this.onfocus(t)},this.input=t,void(this.es=!1)}const n=t.timeStamp>=this.time+500,r=Math.abs(this.rs-this.cs)>16||Math.abs(this.hs-this.fs)>16;n&&!r?(this.es=!0,this.onmousedown(new MouseEvent('mousedown',{buttons:2}))):(this.Ke=0,this.es=!1)};ontouchmove=t=>{if(!this.us||!this.es)return;const i=t.changedTouches[0],e=0|i.clientX,s=0|i.clientY;this.onmousemove(new MouseEvent('mousemove',{clientX:e,clientY:s})),this.cs=0|i.screenX,this.fs=0|i.screenY,this.ss&&-1===this.Ls()?(this.os-this.cs>0?this.rotate(2):this.os-this.cs<0&&this.rotate(0),this.ls-this.fs>0?this.rotate(3):this.ls-this.fs<0&&this.rotate(1)):(this.ns||-1!==this.Ls())&&this.onmousedown(new MouseEvent('mousedown',{buttons:1})),this.os=this.cs,this.ls=this.fs};get us(){return['Android','webOS','iPhone','iPad','iPod','BlackBerry','Windows Phone'].some((t=>navigator.userAgent.includes(t)))}get vs(){return['Android'].some((t=>navigator.userAgent.includes(t)))}get Is(){return['Capacitor'].some((t=>navigator.userAgent.includes(t)))}bs=()=>this.He&&this.Xe>=8&&this.Xe<=520&&this.je>=11&&this.je<=345;Cs=()=>this.He&&-1===this.Ss()&&!this.xs()&&!this.Ms()&&this.Xe>=11&&this.Xe<=506&&this.je>=449&&this.je<=482;Rs=()=>this.He&&(this.xs()||this.Ms())&&this.Xe>=11&&this.Xe<=506&&this.je>=383&&this.je<=482;Os=()=>this.He&&this.Xe>=562&&this.Xe<=752&&this.je>=231&&this.je<=492;Es=()=>!this.He&&2===this.ks()&&this.Xe>=301&&this.Xe<=562&&this.je>=262&&this.je<=279;Ts=()=>!this.He&&2===this.ks()&&this.Xe>=301&&this.Xe<=562&&this.je>=279&&this.je<=296;rotate=t=>{0===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowRight',code:'ArrowRight'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowLeft',code:'ArrowLeft'}))):1===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowDown',code:'ArrowDown'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowUp',code:'ArrowUp'}))):2===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowLeft',code:'ArrowLeft'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowRight',code:'ArrowRight'}))):3===t&&(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowUp',code:'ArrowUp'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowDown',code:'ArrowDown'})))};Ds=()=>null!==document.fullscreenElement;gs=t=>{if(this.Ds()){const i=t.target.getBoundingClientRect(),e=window.innerHeight/p.height,s=(window.innerWidth-p.width*e)/2;this.Xe=0|this.Ns(t.clientX-i.left-s,0,p.width*e,0,789),this.je=0|this.Ns(t.clientY-i.top,0,p.height*e,0,532)}else{const i=p.getBoundingClientRect(),e=p.width/i.width,s=p.height/i.height;this.Xe=(t.clientX-i.left)*e|0,this.je=(t.clientY-i.top)*s|0}this.Xe<0&&(this.Xe=0),this.je<0&&(this.je=0),this.Xe>789&&(this.Xe=789),this.je>532&&(this.je=532)};Ns=(t,i,e,s,n)=>(t-i)*(n-s)/(e-i)+s}class W{db;constructor(t){t.onerror=this.onerror,t.onclose=this.onclose,this.db=t}static openDatabase=async()=>await new Promise(((t,i)=>{const e=indexedDB.open('lostcity',1);e.onsuccess=i=>{const e=i.target;console.log('database success!'),t(e.result)},e.onupgradeneeded=t=>{t.target.result.createObjectStore('cache')},e.onerror=t=>{const e=t.target;console.error('database error!: ',e.error),i(e.result)}}));Fs=async t=>await new Promise((i=>{const e=this.db.transaction('cache','readonly').objectStore('cache').get(t);e.onsuccess=()=>{i(e.result)},e.onerror=t=>{i(void 0)}}));Bs=async(t,i)=>await new Promise(((e,s)=>{const n=this.db.transaction('cache','readwrite').objectStore('cache').put(i,t);n.onsuccess=()=>{e()},n.onerror=t=>{s()}}));onclose=t=>{console.log('database close!')};onerror=t=>{console.log('database error!')};Ps=t=>{const i=t.trim();let e=0;for(let t=0;t<i.length&&t<12;t++){const s=i.charAt(t);e*=37,s>='A'&&s<='Z'?e+=s.charCodeAt(0)+1-65:s>='a'&&s<='z'?e+=s.charCodeAt(0)+1-97:s>='0'&&s<='9'&&(e+=s.charCodeAt(0)+27-48)}return e}}class G{static Ps=t=>{let i=0;t=t.toUpperCase();for(let e=0;e<t.length;e++)i=61*i+t.charCodeAt(e)-32|0;return i};buffer;Us;Ws;Gs;Ys;Hs;Vs;Ks=[];constructor(t){t instanceof Uint8Array&&(t=new Int8Array(t));let e=new O(new Uint8Array(t));const s=e.Qt,n=e.Qt;s===n?(this.buffer=t,this.Us=!1):(this.buffer=i.read(s,t,n,6),e=new O(new Uint8Array(this.buffer)),this.Us=!0),this.Ws=e.Jt,this.Gs=[],this.Ys=[],this.Hs=[],this.Vs=[];let r=e.Xt+10*this.Ws;for(let t=0;t<this.Ws;t++)this.Gs.push(e.ti),this.Ys.push(e.Qt),this.Hs.push(e.Qt),this.Vs.push(r),r+=this.Hs[t]}read(t){const i=G.Ps(t),e=this.Gs.indexOf(i);return-1===e?null:this.Xs(e)}Xs(t){if(t<0||t>=this.Ws)return null;if(this.Ks[t])return this.Ks[t];const e=this.Vs[t],s=e+this.Hs[t];if(this.Us){const i=Uint8Array.from(this.buffer.subarray(e,e+s));return this.Ks[t]=i,i}{const e=Uint8Array.from(i.read(this.Ys[t],this.buffer,this.Hs[t],this.Vs[t]));return this.Ks[t]=e,e}}}class Y{static js=new Uint8Array(520);zs;Zs;store;constructor(t,i,e){this.zs=new O(t),this.Zs=new O(i),this.store=e+1}get Ws(){return this.Zs.length/6}read(t,i=!1){this.Zs.Xt=6*t;const e=this.Zs.Qt;let s=this.Zs.Qt;if(s<=0||s>this.zs.length/520)return null;const n=new Uint8Array(e);let r=0;for(let i=0;r<e;i++){if(0===s)return null;this.zs.Xt=520*s;let h=e-r;h>512&&(h=512),this.zs.ri(h+8,0,Y.js);const o=(255&Y.js[0])<<8|255&Y.js[1],l=(255&Y.js[2])<<8|255&Y.js[3],a=(255&Y.js[4])<<16|(255&Y.js[5])<<8|255&Y.js[6],c=255&Y.js[7];if(o!==t||l!==i||c!==this.store)return null;if(a<0||a>this.zs.length/520)return null;for(let t=0;t<h;t++)n[r++]=Y.js[t+8];s=a}return i?n:1===this.store?new G(n):function(t,i){d(h);const e=u(h,t,i),s=h.qs(e,a)>>>0;if(h.nt(e,a),4294967295===s){const t=h.Js(),i=h.$s(),e=new Uint8Array(h.memory.buffer,t,i),s=(new TextDecoder).decode(e);throw new l(s)}const n=h.buffer()>>>0;return new Uint8Array(h.memory.buffer,n,s)}(n)}}class H{static Qs=[];static tn=t=>{const i=new O(t.read('base_head.dat')),e=new O(t.read('base_type.dat')),s=new O(t.read('base_label.dat')),n=i.Jt;i.Xt+=2;for(let t=0;t<n;t++){const t=i.Jt,n=i.Zt,r=new Uint8Array(n),h=new v(n,null);for(let t=0;t<n;t++){r[t]=e.Zt;const i=s.Zt,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=s.Zt;h[t]=n}this.Qs[t]=new H,this.Qs[t].length=n,this.Qs[t].types=r,this.Qs[t].labels=h}};length=0;types=null;labels=null}class V{static Qs=[];static tn=t=>{const i=new O(t.read('frame_head.dat')),e=new O(t.read('frame_tran1.dat')),s=new O(t.read('frame_tran2.dat')),n=new O(t.read('frame_del.dat')),r=i.Jt;i.Xt+=2;const h=new Int32Array(500),o=new Int32Array(500),l=new Int32Array(500),a=new Int32Array(500);for(let t=0;t<r;t++){const t=i.Jt,r=this.Qs[t]=new V;r.delay=n.Zt;const c=i.Jt,f=H.Qs[c];r.en=f;const u=i.Zt;let d=-1,w=0;for(let t=0;t<u;t++){if(!f.types)throw new Error('SeqBase not loaded!!!');const i=e.Zt;if(i>0){if(0!==f.types[t])for(let i=t-1;i>d;i--)if(0===f.types[i]){h[w]=i,o[w]=0,l[w]=0,a[w]=0,w++;break}h[w]=t;let e=0;3===f.types[h[w]]&&(e=128),o[w]=1&i?s.ei:e,l[w]=2&i?s.ei:e,a[w]=4&i?s.ei:e,d=t,w++}}r.length=w,r.sn=new Int32Array(w),r.x=new Int32Array(w),r.y=new Int32Array(w),r.z=new Int32Array(w);for(let t=0;t<w;t++)r.sn[t]=h[t],r.x[t]=o[t],r.y[t]=l[t],r.z[t]=a[t]}};delay=0;en=null;length=0;sn=null;x=null;y=null;z=null}class K{nn=0;rn=0;hn=0;ln=-1;an=-1;cn=-1;fn=-1;un=-1;dn=-1;wn=-1;yn=-1;mn=-1;pn=0;An=-1;_n=-1;gn=-1;data=null}class X{x=0;y=0;z=0;w=0}class j extends y{static metadata=null;static head=null;static In=null;static Cn=null;static En=null;static Tn=null;static bn=null;static On=null;static Rn=null;static vn=null;static Ln=null;static Sn=null;static xn=null;static Mn=null;static axis=null;static kn=new v(4096,!1);static Dn=new v(4096,!1);static Nn=new Int32Array(4096);static Fn=new Int32Array(4096);static Bn=new Int32Array(4096);static Pn=new Int32Array(4096);static Un=new Int32Array(4096);static Wn=new Int32Array(4096);static Gn=new Int32Array(1500);static Yn=new k(1500,512);static Hn=new Int32Array(12);static Vn=new k(12,2e3);static Kn=new Int32Array(2e3);static Xn=new Int32Array(2e3);static jn=new Int32Array(12);static zn=new Int32Array(10);static Zn=new Int32Array(10);static qn=new Int32Array(10);static Jn=0;static $n=0;static Qn=0;static tr=!1;static Xe=0;static je=0;static ir=0;static er=new Int32Array(1e3);static sr=!1;static tn(t){try{j.head=new O(t.read('ob_head.dat')),j.In=new O(t.read('ob_face1.dat')),j.Cn=new O(t.read('ob_face2.dat')),j.En=new O(t.read('ob_face3.dat')),j.Tn=new O(t.read('ob_face4.dat')),j.bn=new O(t.read('ob_face5.dat')),j.On=new O(t.read('ob_point1.dat')),j.Rn=new O(t.read('ob_point2.dat')),j.vn=new O(t.read('ob_point3.dat')),j.Ln=new O(t.read('ob_point4.dat')),j.Sn=new O(t.read('ob_point5.dat')),j.xn=new O(t.read('ob_vertex1.dat')),j.Mn=new O(t.read('ob_vertex2.dat')),j.axis=new O(t.read('ob_axis.dat')),j.head.Xt=0,j.On.Xt=0,j.Rn.Xt=0,j.vn.Xt=0,j.Ln.Xt=0,j.xn.Xt=0,j.Mn.Xt=0;const i=j.head.Jt;j.metadata=new v(i+100,null);let e=0,s=0,n=0,r=0,h=0,o=0,l=0;for(let t=0;t<i;t++){const t=j.head.Jt,i=new K;i.nn=j.head.Jt,i.rn=j.head.Jt,i.hn=j.head.Zt,i.ln=j.On.Xt,i.an=j.Rn.Xt,i.cn=j.vn.Xt,i.fn=j.Ln.Xt,i.dn=j.xn.Xt,i.wn=j.Mn.Xt;const a=j.head.Zt,c=j.head.Zt,f=j.head.Zt,u=j.head.Zt,d=j.head.Zt;for(let t=0;t<i.nn;t++){const t=j.On.Zt;1&t&&j.Rn.ei,2&t&&j.vn.ei,4&t&&j.Ln.ei}for(let t=0;t<i.rn;t++){1===j.Mn.Zt&&(j.xn.ei,j.xn.ei),j.xn.ei}i.yn=n,n+=2*i.rn,1===a&&(i.mn=r,r+=i.rn),255===c?(i.pn=h,h+=i.rn):i.pn=-c-1,1===f&&(i.An=o,o+=i.rn),1===u&&(i._n=l,l+=i.rn),1===d&&(i.un=s,s+=i.nn),i.gn=e,e+=i.hn,j.metadata[t]=i}}catch(t){console.log('Error loading model index'),console.error(t)}}static nr(t,i){if(null===j.metadata&&(j.metadata=[]),null===t){const t=new K;return t.nn=0,t.rn=0,t.hn=0,void(j.metadata[i]=t)}const e=new O(t);e.Xt=e.length-18;const s=new K;s.data=t,s.nn=e.Jt,s.rn=e.Jt,s.hn=e.Zt,j.metadata[i]=s;const n=e.Zt,r=e.Zt,h=e.Zt,o=e.Zt,l=e.Zt,a=e.Jt,c=e.Jt,f=e.Jt,u=e.Jt;let d=0;s.ln=d,d+=s.nn,s.wn=d,d+=s.rn,s.pn=d,255===r?d+=s.rn:s.pn=-r-1,s._n=d,1===o?d+=s.rn:s._n=-1,s.mn=d,1===n?d+=s.rn:s.mn=-1,s.un=d,1===l?d+=s.nn:s.un=-1,s.An=d,1===h?d+=s.rn:s.An=-1,s.dn=d,d+=u,s.yn=d,d+=2*s.rn,s.gn=d,d+=6*s.hn,s.an=d,d+=a,s.cn=d,d+=c,s.fn=d,d+=f}static zi(){j.metadata=null,j.head=null,j.In=null,j.Cn=null,j.En=null,j.Tn=null,j.bn=null,j.On=null,j.Rn=null,j.vn=null,j.Ln=null,j.Sn=null,j.xn=null,j.Mn=null,j.axis=null,j.kn=null,j.Dn=null,j.Nn=null,j.Fn=null,j.Bn=null,j.Pn=null,j.Un=null,j.Wn=null,j.Gn=null,j.Yn=null,j.Hn=null,j.Vn=null,j.Kn=null,j.Xn=null,j.jn=null}static rr(t,i,e){return 2&~e?((i=i*(127&t)>>7)<2?i=2:i>126&&(i=126),(65408&t)+i):(i<0?i=0:i>127&&(i=127),127-i)}static hr=(t,i,e)=>{const s=t.nn,n=t.rn,r=t.hn;let h,o,l,a,c;if(i){h=new Int32Array(s);for(let i=0;i<s;i++)h[i]=t.lr[i]}else h=t.lr;let f=null,u=null;if(e){o=new Int32Array(n),l=new Int32Array(n),a=new Int32Array(n);for(let i=0;i<n;i++)t.ar&&(o[i]=t.ar[i]),t.cr&&(l[i]=t.cr[i]),t.ur&&(a[i]=t.ur[i]);if(c=new Int32Array(n),t.dr)for(let i=0;i<n;i++)c[i]=t.dr[i];else for(let t=0;t<n;t++)c[t]=0;f=new v(s,null);for(let i=0;i<s;i++){const e=f[i]=new X;if(t.wr){const s=t.wr[i];s&&(e.x=s.x,e.y=s.y,e.z=s.z,e.w=s.w)}}u=t.yr}else o=t.ar,l=t.cr,a=t.ur,c=t.dr;return new j({nn:s,mr:t.mr,lr:h,pr:t.pr,rn:n,Ar:t.Ar,_r:t._r,gr:t.gr,ar:o,cr:l,ur:a,dr:c,Ir:t.Ir,Cr:t.Cr,Er:t.Er,priority:t.priority,hn:r,Tr:t.Tr,br:t.br,Or:t.Or,Rr:t.Rr,vr:t.vr,Lr:t.Lr,Sr:t.Sr,Mr:t.Mr,kr:t.kr,Dr:t.Dr,Nr:t.Nr,Fr:t.Fr,wr:f,yr:u})};static Br=(t,i,e,s)=>{const n=t.nn,r=t.rn,h=t.hn;let o,l,a,c,f;if(s)o=t.mr,l=t.lr,a=t.pr;else{o=new Int32Array(n),l=new Int32Array(n),a=new Int32Array(n);for(let i=0;i<n;i++)o[i]=t.mr[i],l[i]=t.lr[i],a[i]=t.pr[i]}if(i)c=t.Er;else{c=new Int32Array(r);for(let i=0;i<r;i++)t.Er&&(c[i]=t.Er[i])}if(e)f=t.Cr;else if(f=new Int32Array(r),t.Cr)for(let i=0;i<r;i++)f[i]=t.Cr[i];else for(let t=0;t<r;t++)f[t]=0;return new j({nn:n,mr:o,lr:l,pr:a,rn:r,Ar:t.Ar,_r:t._r,gr:t.gr,ar:null,cr:null,ur:null,dr:t.dr,Ir:t.Ir,Cr:f,Er:c,priority:t.priority,hn:h,Tr:t.Tr,br:t.br,Or:t.Or,Pr:t.Pr,Ur:t.Ur})};static Wr=(t,i)=>{const e=t.nn,s=t.rn,n=t.hn,r=new Int32Array(e),h=new Int32Array(e),o=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.mr[i],h[i]=t.lr[i],o[i]=t.pr[i];let l;if(i)l=t.Cr;else if(l=new Int32Array(s),t.Cr)for(let i=0;i<s;i++)l[i]=t.Cr[i];else for(let t=0;t<s;t++)l[t]=0;return new j({nn:e,mr:r,lr:h,pr:o,rn:s,Ar:t.Ar,_r:t._r,gr:t.gr,ar:t.ar,cr:t.cr,ur:t.ur,dr:t.dr,Ir:t.Ir,Cr:l,Er:t.Er,priority:t.priority,hn:n,Tr:t.Tr,br:t.br,Or:t.Or,Gr:t.Gr,Yr:t.Yr})};static Hr=(t,i)=>{let e=!1,s=!1,n=!1,r=!1,h=0,o=0,l=0,a=-1;for(let c=0;c<i;c++){const i=t[c];i&&(h+=i.nn,o+=i.rn,l+=i.hn,e||=null!==i.dr,i.Ir?s=!0:(-1===a&&(a=i.priority),a!==i.priority&&(s=!0)),n||=null!==i.Cr,r||=null!==i.Er)}const c=new Int32Array(h),f=new Int32Array(h),u=new Int32Array(h),d=new Int32Array(o),w=new Int32Array(o),y=new Int32Array(o),m=new Int32Array(o),p=new Int32Array(o),A=new Int32Array(o),_=new Int32Array(l),g=new Int32Array(l),I=new Int32Array(l);let C=null;e&&(C=new Int32Array(o));let E=null;s&&(E=new Int32Array(o));let T=null;n&&(T=new Int32Array(o));let b=null;r&&(b=new Int32Array(o)),h=0,o=0,l=0;for(let a=0;a<i;a++){const i=t[a];if(i){const t=h;for(let t=0;t<i.nn;t++)c[h]=i.mr[t],f[h]=i.lr[t],u[h]=i.pr[t],h++;for(let h=0;h<i.rn;h++)d[o]=i.Ar[h]+t,w[o]=i._r[h]+t,y[o]=i.gr[h]+t,i.ar&&(m[o]=i.ar[h]),i.cr&&(p[o]=i.cr[h]),i.ur&&(A[o]=i.ur[h]),e&&(i.dr?C&&(C[o]=i.dr[h]):C&&(C[o]=0)),s&&(i.Ir?E&&(E[o]=i.Ir[h]):E&&(E[o]=i.priority)),n&&(i.Cr?T&&(T[o]=i.Cr[h]):T&&(T[o]=0)),r&&i.Er&&b&&(b[o]=i.Er[h]),o++;for(let e=0;e<i.hn;e++)_[l]=i.Tr[e]+t,g[l]=i.br[e]+t,I[l]=i.Or[e]+t,l++}}const O=new j({nn:h,mr:c,lr:f,pr:u,rn:o,Ar:d,_r:w,gr:y,ar:m,cr:p,ur:A,dr:C,Ir:E,Cr:T,Er:b,priority:a,hn:l,Tr:_,br:g,Or:I});return O.Vr(),O};static Kr=(t,i)=>{let e=!1,s=!1,n=!1,r=!1,h=0,o=0,l=0,a=-1;for(let c=0;c<i;c++){const i=t[c];i&&(h+=i.nn,o+=i.rn,l+=i.hn,e||=null!==i.dr,i.Ir?s=!0:(-1===a&&(a=i.priority),a!==i.priority&&(s=!0)),n||=null!==i.Cr,r||=null!==i.Ur)}const c=new Int32Array(h),f=new Int32Array(h),u=new Int32Array(h),d=new Int32Array(h),w=new Int32Array(o),y=new Int32Array(o),m=new Int32Array(o),p=new Int32Array(l),A=new Int32Array(l),_=new Int32Array(l);let g=null;e&&(g=new Int32Array(o));let I=null;s&&(I=new Int32Array(o));let C=null;n&&(C=new Int32Array(o));let E=null;r&&(E=new Int32Array(o));const T=new Int32Array(o);h=0,o=0,l=0;const b=(t,i,e,s,n,r,h)=>{let o=-1;const l=t.mr[i],a=t.lr[i],c=t.pr[i];for(let t=0;t<h;t++)if(l===e[t]&&a===s[t]&&c===n[t]){o=t;break}return-1===o&&(e[h]=l,s[h]=a,n[h]=c,r&&t.Pr&&(r[h]=t.Pr[i]),o=h++),{vertex:o,nn:h}};for(let a=0;a<i;a++){const i=t[a];if(i){for(let t=0;t<i.rn;t++){e&&(i.dr?g&&(g[o]=i.dr[t]):g&&(g[o]=0)),s&&(i.Ir?I&&(I[o]=i.Ir[t]):I&&(I[o]=i.priority)),n&&(i.Cr?C&&(C[o]=i.Cr[t]):C&&(C[o]=0)),r&&i.Ur&&E&&(E[o]=i.Ur[t]),i.Er&&(T[o]=i.Er[t]);const l=b(i,i.Ar[t],c,f,u,d,h);h=l.nn;const a=b(i,i._r[t],c,f,u,d,h);h=a.nn;const p=b(i,i.gr[t],c,f,u,d,h);h=p.nn,w[o]=l.vertex,y[o]=a.vertex,m[o]=p.vertex,o++}for(let t=0;t<i.hn;t++){const e=b(i,i.Tr[t],c,f,u,d,h);h=e.nn;const s=b(i,i.br[t],c,f,u,d,h);h=s.nn;const n=b(i,i.Or[t],c,f,u,d,h);h=n.nn,p[l]=e.vertex,A[l]=s.vertex,_[l]=n.vertex,l++}}}return new j({nn:h,mr:c,lr:f,pr:u,rn:o,Ar:w,_r:y,gr:m,ar:null,cr:null,ur:null,dr:g,Ir:I,Cr:C,Er:T,priority:a,hn:l,Tr:p,br:A,Or:_,Pr:d,Ur:E})};static model=t=>{if(!j.metadata)throw new Error('cant loading model metadata!!!!!');const i=j.metadata[t];if(!i)throw console.log(`Error model:${t} not found!`),new Error('cant loading model metadata!!!!!');if(!(j.head&&j.In&&j.Cn&&j.En&&j.Tn&&j.bn&&j.On&&j.Rn&&j.vn&&j.Ln&&j.Sn&&j.xn&&j.Mn&&j.axis))throw new Error('cant loading model!!!!!');const e=i.nn,s=i.rn,n=i.hn,r=new Int32Array(e),h=new Int32Array(e),o=new Int32Array(e),l=new Int32Array(s),a=new Int32Array(s),c=new Int32Array(s),f=new Int32Array(n),u=new Int32Array(n),d=new Int32Array(n);let w=null;i.un>=0&&(w=new Int32Array(e));let y=null;i.mn>=0&&(y=new Int32Array(s));let m=null,p=0;i.pn>=0?m=new Int32Array(s):p=-i.pn-1;let A=null;i.An>=0&&(A=new Int32Array(s));let _=null;i._n>=0&&(_=new Int32Array(s));const g=new Int32Array(s);j.On.Xt=i.ln,j.Rn.Xt=i.an,j.vn.Xt=i.cn,j.Ln.Xt=i.fn,j.Sn.Xt=i.un;let I,C,E,T=0,b=0,O=0;for(let t=0;t<e;t++){const i=j.On.Zt;I=0,1&i&&(I=j.Rn.ei),C=0,2&i&&(C=j.vn.ei),E=0,4&i&&(E=j.Ln.ei),r[t]=T+I,h[t]=b+C,o[t]=O+E,T=r[t],b=h[t],O=o[t],w&&(w[t]=j.Sn.Zt)}j.In.Xt=i.yn,j.Cn.Xt=i.mn,j.En.Xt=i.pn,j.Tn.Xt=i.An,j.bn.Xt=i._n;for(let t=0;t<s;t++)g[t]=j.In.Jt,y&&(y[t]=j.Cn.Zt),m&&(m[t]=j.En.Zt),A&&(A[t]=j.Tn.Zt),_&&(_[t]=j.bn.Zt);j.xn.Xt=i.dn,j.Mn.Xt=i.wn,I=0,C=0,E=0;let R=0;for(let t=0;t<s;t++){const i=j.Mn.Zt;if(1===i)I=j.xn.ei+R,R=I,C=j.xn.ei+R,R=C,E=j.xn.ei+R,R=E;else if(2===i)C=E,E=j.xn.ei+R,R=E;else if(3===i)I=E,E=j.xn.ei+R,R=E;else if(4===i){const t=I;I=C,C=t,E=j.xn.ei+R,R=E}l[t]=I,a[t]=C,c[t]=E}j.axis.Xt=6*i.gn;for(let t=0;t<n;t++)f[t]=j.axis.Jt,u[t]=j.axis.Jt,d[t]=j.axis.Jt;return new j({nn:e,mr:r,lr:h,pr:o,rn:s,Ar:l,_r:a,gr:c,ar:null,cr:null,ur:null,dr:y,Ir:m,Cr:A,Er:g,priority:p,hn:n,Tr:f,br:u,Or:d,Pr:w,Ur:_})};static Xr=(t,i)=>{if(!j.metadata||!j.metadata[i])throw new Error('No model metadata');const e=j.metadata[i];if(e.data=t,!e.data.length)throw new Error('No model data');const s=e.nn,n=e.rn,r=e.hn,h=new Int32Array(s),o=new Int32Array(s),l=new Int32Array(s),a=new Int32Array(n),c=new Int32Array(n),f=new Int32Array(n),u=new Int32Array(r),d=new Int32Array(r),w=new Int32Array(r);let y=null;e.un>=0&&(y=new Int32Array(s));let m=null;e.mn>=0&&(m=new Int32Array(n));let p=null,A=0;e.pn>=0?p=new Int32Array(n):A=-e.pn-1;let _=null;e.An>=0&&(_=new Int32Array(n));let g=null;e._n>=0&&(g=new Int32Array(n));const I=new Int32Array(n),C=new O(e.data);C.Xt=e.ln;const E=new O(e.data);E.Xt=e.an;const T=new O(e.data);T.Xt=e.cn;const b=new O(e.data);b.Xt=e.fn;const R=new O(e.data);R.Xt=e.un;let v,L,S,x=0,M=0,k=0;for(let t=0;t<s;t++){const i=C.Zt;v=0,1&i&&(v=E.ei),L=0,2&i&&(L=T.ei),S=0,4&i&&(S=b.ei),h[t]=x+v,o[t]=M+L,l[t]=k+S,x=h[t],M=o[t],k=l[t],y&&(y[t]=R.Zt)}const D=new O(e.data);D.Xt=e.yn;const N=new O(e.data);N.Xt=e.mn;const F=new O(e.data);F.Xt=e.pn;const B=new O(e.data);B.Xt=e.An;const P=new O(e.data);P.Xt=e._n;for(let t=0;t<n;t++)I[t]=D.Jt,m&&(m[t]=N.Zt),p&&(p[t]=F.Zt),_&&(_[t]=B.Zt),g&&(g[t]=P.Zt);const U=new O(e.data);U.Xt=e.dn;const W=new O(e.data);W.Xt=e.wn,v=0,L=0,S=0;let G=0;for(let t=0;t<n;t++){const i=W.Zt;if(1===i)v=U.ei+G,G=v,L=U.ei+G,G=L,S=U.ei+G,G=S;else if(2===i)L=S,S=U.ei+G,G=S;else if(3===i)v=S,S=U.ei+G,G=S;else if(4===i){const t=v;v=L,L=t,S=U.ei+G,G=S}a[t]=v,c[t]=L,f[t]=S}const Y=new O(e.data);Y.Xt=e.gn;for(let t=0;t<r;t++)u[t]=Y.Jt,d[t]=Y.Jt,w[t]=Y.Jt;return new j({nn:s,mr:h,lr:o,pr:l,rn:n,Ar:a,_r:c,gr:f,ar:null,cr:null,ur:null,dr:m,Ir:p,Cr:_,Er:I,priority:A,hn:r,Tr:u,br:d,Or:w,Pr:y,Ur:g})};nn;mr;lr;pr;rn;Ar;_r;gr;ar;cr;ur;dr;Ir;Cr;Er;priority;hn;Tr;br;Or;Rr;vr;Lr;Sr;Mr;kr;Dr;Nr;Fr;Pr;Ur;Gr;Yr;wr;yr;jr=0;zr=!1;Zr=-1;qr=-1;constructor(t){super(),this.nn=t.nn,this.mr=t.mr,this.lr=t.lr,this.pr=t.pr,this.rn=t.rn,this.Ar=t.Ar,this._r=t._r,this.gr=t.gr,this.ar=t.ar,this.cr=t.cr,this.ur=t.ur,this.dr=t.dr,this.Ir=t.Ir,this.Cr=t.Cr,this.Er=t.Er,this.priority=t.priority,this.hn=t.hn,this.Tr=t.Tr,this.br=t.br,this.Or=t.Or,this.Rr=t.Rr??0,this.vr=t.vr??0,this.Lr=t.Lr??0,this.Sr=t.Sr??0,this.Mr=t.Mr??0,this.kr=t.kr??0,this.Dr=t.Dr??0,this.Nr=t.Nr??0,this.Fr=t.Fr??0,this.Pr=t.Pr??null,this.Ur=t.Ur??null,this.Gr=t.Gr??null,this.Yr=t.Yr??null,this.wr=t.wr??null,this.yr=t.yr??null}Vr(){this.Dr=0,this.Mr=0,this.kr=0;for(let t=0;t<this.nn;t++){const i=this.mr[t],e=this.lr[t],s=this.pr[t];-e>this.Dr&&(this.Dr=-e),e>this.kr&&(this.kr=e);const n=i*i+s*s;n>this.Mr&&(this.Mr=n)}this.Mr=Math.sqrt(this.Mr)+.99|0,this.Fr=Math.sqrt(this.Mr*this.Mr+this.Dr*this.Dr)+.99|0,this.Nr=this.Fr+(Math.sqrt(this.Mr*this.Mr+this.kr*this.kr)+.99|0)}Jr(){this.Dr=0,this.kr=0;for(let t=0;t<this.nn;t++){const i=this.lr[t];-i>this.Dr&&(this.Dr=-i),i>this.kr&&(this.kr=i)}this.Fr=Math.sqrt(this.Mr*this.Mr+this.Dr*this.Dr)+.99|0,this.Nr=this.Fr+(Math.sqrt(this.Mr*this.Mr+this.kr*this.kr)+.99|0)}$r(){if(this.Pr){const t=new Int32Array(256);let i=0;for(let e=0;e<this.nn;e++){const s=this.Pr[e];t[s]++,s>i&&(i=s)}this.Gr=new v(i+1,null);for(let e=0;e<=i;e++)this.Gr[e]=new Int32Array(t[e]),t[e]=0;let e=0;for(;e<this.nn;){const i=this.Pr[e],s=this.Gr[i];s&&(s[t[i]++]=e++)}this.Pr=null}if(this.Ur){const t=new Int32Array(256);let i=0;for(let e=0;e<this.rn;e++){const s=this.Ur[e];t[s]++,s>i&&(i=s)}this.Yr=new v(i+1,null);for(let e=0;e<=i;e++)this.Yr[e]=new Int32Array(t[e]),t[e]=0;let e=0;for(;e<this.rn;){const i=this.Ur[e],s=this.Yr[i];s&&(s[t[i]++]=e++)}this.Ur=null}}Qr(t,i,e){if(-1!==t)if(e&&-1!==i){const s=V.Qs[t],n=V.Qs[i],r=s.en;j.Jn=0,j.$n=0,j.Qn=0;let h=0,o=e[h++];for(let t=0;t<s.length;t++){if(!s.sn)continue;const i=s.sn[t];for(;i>o;)o=e[h++];r&&r.types&&s.x&&s.y&&s.z&&r.labels&&(i!==o||0===r.types[i])&&this.th(s.x[t],s.y[t],s.z[t],r.labels[i],r.types[i])}j.Jn=0,j.$n=0,j.Qn=0,h=0,o=e[h++];for(let t=0;t<n.length;t++){if(!n.sn)continue;const i=n.sn[t];for(;i>o;)o=e[h++];r&&r.types&&n.x&&n.y&&n.z&&r.labels&&(i===o||0===r.types[i])&&this.th(n.x[t],n.y[t],n.z[t],r.labels[i],r.types[i])}}else this.ih(t)}ih(t){if(!this.Gr||-1===t||!V.Qs[t])return;const i=V.Qs[t],e=i.en;j.Jn=0,j.$n=0,j.Qn=0;for(let t=0;t<i.length;t++){if(!(i.sn&&i.x&&i.y&&i.z&&e&&e.labels&&e.types))continue;const s=i.sn[t];this.th(i.x[t],i.y[t],i.z[t],e.labels[s],e.types[s])}}eh(){for(let t=0;t<this.nn;t++){const i=this.mr[t];this.mr[t]=this.pr[t],this.pr[t]=-i}}sh(t){const i=N.sin[t],e=N.cos[t];for(let t=0;t<this.nn;t++){const s=this.lr[t]*e-this.pr[t]*i>>16;this.pr[t]=this.lr[t]*i+this.pr[t]*e>>16,this.lr[t]=s}}translate(t,i,e){for(let s=0;s<this.nn;s++)this.mr[s]+=i,this.lr[s]+=t,this.pr[s]+=e}nh(t,i){if(this.Er)for(let e=0;e<this.rn;e++)this.Er[e]===t&&(this.Er[e]=i)}rh(){for(let t=0;t<this.nn;t++)this.pr[t]=-this.pr[t];for(let t=0;t<this.rn;t++){const i=this.Ar[t];this.Ar[t]=this.gr[t],this.gr[t]=i}}scale(t,i,e){for(let s=0;s<this.nn;s++)this.mr[s]=this.mr[s]*t/128|0,this.lr[s]=this.lr[s]*i/128|0,this.pr[s]=this.pr[s]*e/128|0}hh(t,i,e,s,n,r){const h=i*(0|Math.sqrt(e*e+s*s+n*n))>>8;if(this.ar&&this.cr&&this.ur||(this.ar=new Int32Array(this.rn),this.cr=new Int32Array(this.rn),this.ur=new Int32Array(this.rn)),!this.wr){this.wr=new v(this.nn,null);for(let t=0;t<this.nn;t++)this.wr[t]=new X}for(let i=0;i<this.rn;i++){const r=this.Ar[i],o=this._r[i],l=this.gr[i],a=this.mr[o]-this.mr[r],c=this.lr[o]-this.lr[r],f=this.pr[o]-this.pr[r],u=this.mr[l]-this.mr[r],d=this.lr[l]-this.lr[r],w=this.pr[l]-this.pr[r];let y=c*w-d*f,m=f*u-w*a,p=a*d-u*c;for(;y>8192||m>8192||p>8192||y<-8192||m<-8192||p<-8192;)y>>=1,m>>=1,p>>=1;let A=0|Math.sqrt(y*y+m*m+p*p);if(A<=0&&(A=1),y=256*y/A|0,m=256*m/A|0,p=256*p/A|0,this.dr&&1&this.dr[i]){const r=t+((e*y+s*m+n*p)/(h+(h/2|0))|0);this.Er&&(this.ar[i]=j.rr(this.Er[i],r,this.dr[i]))}else{let t=this.wr[r];t&&(t.x+=y,t.y+=m,t.z+=p,t.w++),t=this.wr[o],t&&(t.x+=y,t.y+=m,t.z+=p,t.w++),t=this.wr[l],t&&(t.x+=y,t.y+=m,t.z+=p,t.w++)}}if(r)this.oh(t,h,e,s,n);else{this.yr=new v(this.nn,null);for(let t=0;t<this.nn;t++){const i=this.wr[t],e=new X;i&&(e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w),this.yr[t]=e}}r?this.Vr():this.lh()}oh(t,i,e,s,n){for(let r=0;r<this.rn;r++){const h=this.Ar[r],o=this._r[r],l=this.gr[r];if(!this.dr&&this.Er&&this.wr&&this.ar&&this.cr&&this.ur){const a=this.Er[r],c=this.wr[h];c&&(this.ar[r]=j.rr(a,t+((e*c.x+s*c.y+n*c.z)/(i*c.w)|0),0));const f=this.wr[o];f&&(this.cr[r]=j.rr(a,t+((e*f.x+s*f.y+n*f.z)/(i*f.w)|0),0));const u=this.wr[l];u&&(this.ur[r]=j.rr(a,t+((e*u.x+s*u.y+n*u.z)/(i*u.w)|0),0))}else if(this.dr&&!(1&this.dr[r])&&this.Er&&this.wr&&this.ar&&this.cr&&this.ur){const a=this.Er[r],c=this.dr[r],f=this.wr[h];f&&(this.ar[r]=j.rr(a,t+((e*f.x+s*f.y+n*f.z)/(i*f.w)|0),c));const u=this.wr[o];u&&(this.cr[r]=j.rr(a,t+((e*u.x+s*u.y+n*u.z)/(i*u.w)|0),c));const d=this.wr[l];d&&(this.ur[r]=j.rr(a,t+((e*d.x+s*d.y+n*d.z)/(i*d.w)|0),c))}}if(this.wr=null,this.yr=null,this.Pr=null,this.Ur=null,this.dr)for(let t=0;t<this.rn;t++)if(!(2&~this.dr[t]))return;this.Er=null}ah(t,i,e,s,n,r,h){const o=N.sin[t],l=N.cos[t],a=N.sin[i],c=N.cos[i],f=N.sin[e],u=N.cos[e],d=N.sin[s],w=N.cos[s],y=r*d+h*w>>16;for(let s=0;s<this.nn;s++){let m,p=this.mr[s],A=this.lr[s],_=this.pr[s];0!==e&&(m=A*f+p*u>>16,A=A*u-p*f>>16,p=m),0!==t&&(m=A*l-_*o>>16,_=A*o+_*l>>16,A=m),0!==i&&(m=_*a+p*c>>16,_=_*c-p*a>>16,p=m),p+=n,A+=r,_+=h,m=A*w-_*d>>16,_=A*d+_*w>>16,A=m,j.Nn&&j.Fn&&j.Bn&&(j.Bn[s]=_-y,j.Nn[s]=N.Ni+((p<<9)/_|0),j.Fn[s]=N.Fi+((A<<9)/_|0)),this.hn>0&&j.Pn&&j.Un&&j.Wn&&(j.Pn[s]=p,j.Un[s]=A,j.Wn[s]=_)}try{this.fh(!1,!1,0)}catch(t){}}draw(t,i,e,s,n,r,h,o,l){const a=o*n-r*s>>16,c=h*i+a*e>>16,f=this.Mr*e>>16,u=c+f;if(u<=50||c>=3500)return;const d=o*s+r*n>>16;let w=d-this.Mr<<9;if((w/u|0)>=m.yt)return;let y=d+this.Mr<<9;if((y/u|0)<=-m.yt)return;const p=h*e-a*i>>16,A=this.Mr*i>>16;let _=p+A<<9;if((_/u|0)<=-m.At)return;let g=p-(A+(this.Dr*e>>16))<<9;if((g/u|0)>=m.At)return;let I=c-(f+(this.Dr*i>>16))<=50,C=!1;if(l>0&&j.tr){let t=c-f;t<=50&&(t=50),d>0?(w=w/u|0,y=y/t|0):(y=y/u|0,w=w/t|0),p>0?(g=g/u|0,_=_/t|0):(_=_/u|0,g=g/t|0);const i=j.Xe-N.Ni,e=j.je-N.Fi;i>w&&i<y&&e>g&&e<_&&(this.zr?j.er[j.ir++]=l:C=!0)}const E=N.Ni,T=N.Fi;let b=0,O=0;0!==t&&(b=N.sin[t],O=N.cos[t]);for(let l=0;l<this.nn;l++){let a,f=this.mr[l],u=this.lr[l],d=this.pr[l];0!==t&&(a=d*b+f*O>>16,d=d*O-f*b>>16,f=a),f+=r,u+=h,d+=o,a=d*s+f*n>>16,d=d*n-f*s>>16,f=a,a=u*e-d*i>>16,d=u*i+d*e>>16,u=a,j.Bn&&(j.Bn[l]=d-c),d>=50&&j.Nn&&j.Fn?(j.Nn[l]=E+((f<<9)/d|0),j.Fn[l]=T+((u<<9)/d|0)):j.Nn&&(j.Nn[l]=-5e3,I=!0),(I||this.hn>0)&&j.Pn&&j.Un&&j.Wn&&(j.Pn[l]=f,j.Un[l]=u,j.Wn[l]=d)}try{this.fh(I,C,l)}catch(t){}}fh(t,i,e,s=!1){j.sr&&(this.Zr=-1,this.qr=-1);for(let t=0;t<this.Nr;t++)j.Gn&&(j.Gn[t]=0);for(let s=0;s<this.rn;s++)if((!this.dr||-1!==this.dr[s])&&j.Nn&&j.Fn&&j.Bn&&j.Yn&&j.Gn){const n=this.Ar[s],r=this._r[s],h=this.gr[s],o=j.Nn[n],l=j.Nn[r],a=j.Nn[h],c=j.Fn[n],f=j.Fn[r],u=j.Fn[h],d=j.Bn[n],w=j.Bn[r],y=j.Bn[h];if(!t||-5e3!==o&&-5e3!==l&&-5e3!==a){i&&this.uh(j.Xe,j.je,c,f,u,o,l,a)&&(j.er[j.ir++]=e,i=!1);if((o-l)*(u-f)-(c-f)*(a-l)<=0)continue;if(j.Dn&&(j.Dn[s]=!1),j.kn&&(j.kn[s]=o<0||l<0||a<0||o>m.wt||l>m.wt||a>m.wt),j.Yn&&j.Gn){const t=((d+w+y)/3|0)+this.Fr;j.Yn[t][j.Gn[t]++]=s,j.sr&&this.uh(j.Xe,j.je,c,f,u,o,l,a)&&this.qr<t&&(this.Zr=s,this.qr=t)}}else if(j.Dn&&(j.Dn[s]=!0),j.Yn&&j.Gn){const t=((d+w+y)/3|0)+this.Fr;j.Yn[t][j.Gn[t]++]=s}}if(!this.Ir&&j.Gn){for(let t=this.Nr-1;t>=0;t--){const i=j.Gn[t];if(!(i<=0)&&j.Yn){const e=j.Yn[t];for(let t=0;t<i;t++)this.dh(e[t],s)}}return}for(let t=0;t<12;t++)j.Hn&&j.jn&&(j.Hn[t]=0,j.jn[t]=0);if(j.Gn)for(let t=this.Nr-1;t>=0;t--){const i=j.Gn[t];if(i>0&&j.Yn){const e=j.Yn[t];for(let s=0;s<i;s++)if(this.Ir&&j.Hn&&j.Vn){const i=e[s],n=this.Ir[i],r=j.Hn[n]++;j.Vn[n][r]=i,n<10&&j.jn?j.jn[n]+=t:10===n&&j.Kn?j.Kn[r]=t:j.Xn&&(j.Xn[r]=t)}}}let n=0;j.Hn&&j.jn&&(j.Hn[1]>0||j.Hn[2]>0)&&(n=(j.jn[1]+j.jn[2])/(j.Hn[1]+j.Hn[2])|0);let r=0;j.Hn&&j.jn&&(j.Hn[3]>0||j.Hn[4]>0)&&(r=(j.jn[3]+j.jn[4])/(j.Hn[3]+j.Hn[4])|0);let h=0;if(j.Hn&&j.jn&&(j.Hn[6]>0||j.Hn[8]>0)&&(h=(j.jn[6]+j.jn[8])/(j.Hn[6]+j.Hn[8])|0),j.Hn&&j.Vn){let t,i=0,e=j.Hn[10],o=j.Vn[10],l=j.Kn;i===e&&(i=0,e=j.Hn[11],o=j.Vn[11],l=j.Xn),t=i<e&&l?l[i]:-1e3;for(let a=0;a<10;a++){for(;0===a&&t>n;)try{this.dh(o[i++],s),i===e&&o!==j.Vn[11]&&(i=0,e=j.Hn[11],o=j.Vn[11],l=j.Xn),t=i<e&&l?l[i]:-1e3}catch(t){}for(;3===a&&t>r;)try{this.dh(o[i++],s),i===e&&o!==j.Vn[11]&&(i=0,e=j.Hn[11],o=j.Vn[11],l=j.Xn),t=i<e&&l?l[i]:-1e3}catch(t){}for(;5===a&&t>h;)try{this.dh(o[i++],s),i===e&&o!==j.Vn[11]&&(i=0,e=j.Hn[11],o=j.Vn[11],l=j.Xn),t=i<e&&l?l[i]:-1e3}catch(t){}const c=j.Hn[a],f=j.Vn[a];for(let t=0;t<c;t++)this.dh(f[t],s)}for(;-1e3!==t;)try{this.dh(o[i++],s),i===e&&o!==j.Vn[11]&&(i=0,o=j.Vn[11],e=j.Hn[11],l=j.Xn),t=i<e&&l?l[i]:-1e3}catch(t){}}}dh(t,i=!1){if(j.Dn&&j.Dn[t])return void this.wh(t,i);const e=this.Ar[t],s=this._r[t],n=this.gr[t];let r;if(j.kn&&(N.Pi=j.kn[t]),this.Cr?N.alpha=this.Cr[t]:N.alpha=0,r=this.dr?3&this.dr[t]:0,i&&j.Nn&&j.Fn&&this.ar&&this.cr&&this.ur)N.Tt(j.Nn[e],j.Fn[e],j.Nn[s],j.Fn[s],N.palette[this.ar[t]]),N.Tt(j.Nn[s],j.Fn[s],j.Nn[n],j.Fn[n],N.palette[this.cr[t]]),N.Tt(j.Nn[n],j.Fn[n],j.Nn[e],j.Fn[e],N.palette[this.ur[t]]);else if(0===r&&this.ar&&this.cr&&this.ur&&j.Nn&&j.Fn)N.ne(j.Nn[e],j.Nn[s],j.Nn[n],j.Fn[e],j.Fn[s],j.Fn[n],this.ar[t],this.cr[t],this.ur[t]);else if(1===r&&this.ar&&j.Nn&&j.Fn)N.he(j.Nn[e],j.Nn[s],j.Nn[n],j.Fn[e],j.Fn[s],j.Fn[n],N.palette[this.ar[t]]);else if(2===r&&this.dr&&this.Er&&this.ar&&this.cr&&this.ur&&j.Nn&&j.Fn&&j.Pn&&j.Un&&j.Wn){const i=this.dr[t]>>2,r=this.Tr[i],h=this.br[i],o=this.Or[i];N.le(j.Nn[e],j.Nn[s],j.Nn[n],j.Fn[e],j.Fn[s],j.Fn[n],this.ar[t],this.cr[t],this.ur[t],j.Pn[r],j.Un[r],j.Wn[r],j.Pn[h],j.Pn[o],j.Un[h],j.Un[o],j.Wn[h],j.Wn[o],this.Er[t])}else if(3===r&&this.dr&&this.Er&&this.ar&&j.Nn&&j.Fn&&j.Pn&&j.Un&&j.Wn){const i=this.dr[t]>>2,r=this.Tr[i],h=this.br[i],o=this.Or[i];N.le(j.Nn[e],j.Nn[s],j.Nn[n],j.Fn[e],j.Fn[s],j.Fn[n],this.ar[t],this.ar[t],this.ar[t],j.Pn[r],j.Un[r],j.Wn[r],j.Pn[h],j.Pn[o],j.Un[h],j.Un[o],j.Wn[h],j.Wn[o],this.Er[t])}}wh(t,i=!1){let e=0;if(j.Wn){const i=N.Ni,s=N.Fi,n=this.Ar[t],r=this._r[t],h=this.gr[t],o=j.Wn[n],l=j.Wn[r],a=j.Wn[h];if(o>=50&&j.Nn&&j.Fn&&this.ar)j.zn[e]=j.Nn[n],j.Zn[e]=j.Fn[n],j.qn[e++]=this.ar[t];else if(j.Pn&&j.Un&&this.ar){const c=j.Pn[n],f=j.Un[n],u=this.ar[t];if(a>=50&&this.ur){const n=(50-o)*N.xi[a-o];j.zn[e]=i+((c+((j.Pn[h]-c)*n>>16)<<9)/50|0),j.Zn[e]=s+((f+((j.Un[h]-f)*n>>16)<<9)/50|0),j.qn[e++]=u+((this.ur[t]-u)*n>>16)}if(l>=50&&this.cr){const n=(50-o)*N.xi[l-o];j.zn[e]=i+((c+((j.Pn[r]-c)*n>>16)<<9)/50|0),j.Zn[e]=s+((f+((j.Un[r]-f)*n>>16)<<9)/50|0),j.qn[e++]=u+((this.cr[t]-u)*n>>16)}}if(l>=50&&j.Nn&&j.Fn&&this.cr)j.zn[e]=j.Nn[r],j.Zn[e]=j.Fn[r],j.qn[e++]=this.cr[t];else if(j.Pn&&j.Un&&this.cr){const c=j.Pn[r],f=j.Un[r],u=this.cr[t];if(o>=50&&this.ar){const r=(50-l)*N.xi[o-l];j.zn[e]=i+((c+((j.Pn[n]-c)*r>>16)<<9)/50|0),j.Zn[e]=s+((f+((j.Un[n]-f)*r>>16)<<9)/50|0),j.qn[e++]=u+((this.ar[t]-u)*r>>16)}if(a>=50&&this.ur){const n=(50-l)*N.xi[a-l];j.zn[e]=i+((c+((j.Pn[h]-c)*n>>16)<<9)/50|0),j.Zn[e]=s+((f+((j.Un[h]-f)*n>>16)<<9)/50|0),j.qn[e++]=u+((this.ur[t]-u)*n>>16)}}if(a>=50&&j.Nn&&j.Fn&&this.ur)j.zn[e]=j.Nn[h],j.Zn[e]=j.Fn[h],j.qn[e++]=this.ur[t];else if(j.Pn&&j.Un&&this.ur){const c=j.Pn[h],f=j.Un[h],u=this.ur[t];if(l>=50&&this.cr){const n=(50-a)*N.xi[l-a];j.zn[e]=i+((c+((j.Pn[r]-c)*n>>16)<<9)/50|0),j.Zn[e]=s+((f+((j.Un[r]-f)*n>>16)<<9)/50|0),j.qn[e++]=u+((this.cr[t]-u)*n>>16)}if(o>=50&&this.ar){const r=(50-a)*N.xi[o-a];j.zn[e]=i+((c+((j.Pn[n]-c)*r>>16)<<9)/50|0),j.Zn[e]=s+((f+((j.Un[n]-f)*r>>16)<<9)/50|0),j.qn[e++]=u+((this.ar[t]-u)*r>>16)}}}const s=j.zn[0],n=j.zn[1],r=j.zn[2],h=j.Zn[0],o=j.Zn[1],l=j.Zn[2];if(!((s-n)*(l-o)-(h-o)*(r-n)<=0))if(N.Pi=!1,3===e){let e;if((s<0||n<0||r<0||s>m.wt||n>m.wt||r>m.wt)&&(N.Pi=!0),e=this.dr?3&this.dr[t]:0,i)N.Tt(s,n,h,o,j.qn[0]),N.Tt(n,r,o,l,j.qn[1]),N.Tt(r,s,l,h,j.qn[2]);else if(0===e)N.ne(s,n,r,h,o,l,j.qn[0],j.qn[1],j.qn[2]);else if(1===e&&this.ar)N.he(s,n,r,h,o,l,N.palette[this.ar[t]]);else if(2===e&&this.dr&&this.Er&&j.Pn&&j.Un&&j.Wn){const i=this.dr[t]>>2,e=this.Tr[i],a=this.br[i],c=this.Or[i];N.le(s,n,r,h,o,l,j.qn[0],j.qn[1],j.qn[2],j.Pn[e],j.Un[e],j.Wn[e],j.Pn[a],j.Pn[c],j.Un[a],j.Un[c],j.Wn[a],j.Wn[c],this.Er[t])}else if(3===e&&this.dr&&this.Er&&this.ar&&j.Pn&&j.Un&&j.Wn){const i=this.dr[t]>>2,e=this.Tr[i],a=this.br[i],c=this.Or[i];N.le(s,n,r,h,o,l,this.ar[t],this.ar[t],this.ar[t],j.Pn[e],j.Un[e],j.Wn[e],j.Pn[a],j.Pn[c],j.Un[a],j.Un[c],j.Wn[a],j.Wn[c],this.Er[t])}}else if(4===e){let e;if((s<0||n<0||r<0||s>m.wt||n>m.wt||r>m.wt||j.zn[3]<0||j.zn[3]>m.wt)&&(N.Pi=!0),e=this.dr?3&this.dr[t]:0,i)N.Tt(s,n,h,o,j.qn[0]),N.Tt(n,r,o,l,j.qn[1]),N.Tt(r,j.zn[3],l,j.Zn[3],j.qn[2]),N.Tt(j.zn[3],s,j.Zn[3],h,j.qn[3]);else if(0===e)N.ne(s,n,r,h,o,l,j.qn[0],j.qn[1],j.qn[2]),N.ne(s,r,j.zn[3],h,l,j.Zn[3],j.qn[0],j.qn[2],j.qn[3]);else if(1===e){if(this.ar){const i=N.palette[this.ar[t]];N.he(s,n,r,h,o,l,i),N.he(s,r,j.zn[3],h,l,j.Zn[3],i)}}else if(2===e&&this.dr&&this.Er&&j.Pn&&j.Un&&j.Wn){const i=this.dr[t]>>2,e=this.Tr[i],a=this.br[i],c=this.Or[i];N.le(s,n,r,h,o,l,j.qn[0],j.qn[1],j.qn[2],j.Pn[e],j.Un[e],j.Wn[e],j.Pn[a],j.Pn[c],j.Un[a],j.Un[c],j.Wn[a],j.Wn[c],this.Er[t]),N.le(s,r,j.zn[3],h,l,j.Zn[3],j.qn[0],j.qn[2],j.qn[3],j.Pn[e],j.Un[e],j.Wn[e],j.Pn[a],j.Pn[c],j.Un[a],j.Un[c],j.Wn[a],j.Wn[c],this.Er[t])}else if(3===e&&this.dr&&this.Er&&this.ar&&j.Pn&&j.Un&&j.Wn){const i=this.dr[t]>>2,e=this.Tr[i],a=this.br[i],c=this.Or[i];N.le(s,n,r,h,o,l,this.ar[t],this.ar[t],this.ar[t],j.Pn[e],j.Un[e],j.Wn[e],j.Pn[a],j.Pn[c],j.Un[a],j.Un[c],j.Wn[a],j.Wn[c],this.Er[t]),N.le(s,r,j.zn[3],h,l,j.Zn[3],this.ar[t],this.ar[t],this.ar[t],j.Pn[e],j.Un[e],j.Wn[e],j.Pn[a],j.Pn[c],j.Un[a],j.Un[c],j.Wn[a],j.Wn[c],this.Er[t])}}}th(t,i,e,s,n){if(!s)return;const r=s.length;if(0===n){let n=0;j.Jn=0,j.$n=0,j.Qn=0;for(let t=0;t<r;t++){if(!this.Gr)continue;const i=s[t];if(i<this.Gr.length){const t=this.Gr[i];if(t)for(let i=0;i<t.length;i++){const e=t[i];j.Jn+=this.mr[e],j.$n+=this.lr[e],j.Qn+=this.pr[e],n++}}}n>0?(j.Jn=(j.Jn/n|0)+t,j.$n=(j.$n/n|0)+i,j.Qn=(j.Qn/n|0)+e):(j.Jn=t,j.$n=i,j.Qn=e)}else if(1===n)for(let n=0;n<r;n++){const r=s[n];if(!this.Gr||r>=this.Gr.length)continue;const h=this.Gr[r];if(h)for(let s=0;s<h.length;s++){const n=h[s];this.mr[n]+=t,this.lr[n]+=i,this.pr[n]+=e}}else if(2===n)for(let n=0;n<r;n++){const r=s[n];if(!this.Gr||r>=this.Gr.length)continue;const h=this.Gr[r];if(h)for(let s=0;s<h.length;s++){const n=h[s];this.mr[n]-=j.Jn,this.lr[n]-=j.$n,this.pr[n]-=j.Qn;const r=8*(255&t),o=8*(255&i),l=8*(255&e);let a,c;if(0!==l){a=N.sin[l],c=N.cos[l];const t=this.lr[n]*a+this.mr[n]*c>>16;this.lr[n]=this.lr[n]*c-this.mr[n]*a>>16,this.mr[n]=t}if(0!==r){a=N.sin[r],c=N.cos[r];const t=this.lr[n]*c-this.pr[n]*a>>16;this.pr[n]=this.lr[n]*a+this.pr[n]*c>>16,this.lr[n]=t}if(0!==o){a=N.sin[o],c=N.cos[o];const t=this.pr[n]*a+this.mr[n]*c>>16;this.pr[n]=this.pr[n]*c-this.mr[n]*a>>16,this.mr[n]=t}this.mr[n]+=j.Jn,this.lr[n]+=j.$n,this.pr[n]+=j.Qn}}else if(3===n)for(let n=0;n<r;n++){const r=s[n];if(!this.Gr||r>=this.Gr.length)continue;const h=this.Gr[r];if(h)for(let s=0;s<h.length;s++){const n=h[s];this.mr[n]-=j.Jn,this.lr[n]-=j.$n,this.pr[n]-=j.Qn,this.mr[n]=this.mr[n]*t/128|0,this.lr[n]=this.lr[n]*i/128|0,this.pr[n]=this.pr[n]*e/128|0,this.mr[n]+=j.Jn,this.lr[n]+=j.$n,this.pr[n]+=j.Qn}}else if(5===n&&this.Yr&&this.Cr)for(let i=0;i<r;i++){const e=s[i];if(e>=this.Yr.length)continue;const n=this.Yr[e];if(n)for(let i=0;i<n.length;i++){const e=n[i];this.Cr[e]+=8*t,this.Cr[e]<0&&(this.Cr[e]=0),this.Cr[e]>255&&(this.Cr[e]=255)}}}lh(){this.Dr=0,this.Mr=0,this.kr=0,this.Rr=999999,this.vr=-999999,this.Sr=-99999,this.Lr=99999;for(let t=0;t<this.nn;t++){const i=this.mr[t],e=this.lr[t],s=this.pr[t];i<this.Rr&&(this.Rr=i),i>this.vr&&(this.vr=i),s<this.Lr&&(this.Lr=s),s>this.Sr&&(this.Sr=s),-e>this.Dr&&(this.Dr=-e),e>this.kr&&(this.kr=e);const n=i*i+s*s;n>this.Mr&&(this.Mr=n)}this.Mr=0|Math.sqrt(this.Mr),this.Fr=0|Math.sqrt(this.Mr*this.Mr+this.Dr*this.Dr),this.Nr=this.Fr+(0|Math.sqrt(this.Mr*this.Mr+this.kr*this.kr))}uh(t,i,e,s,n,r,h,o){return!(i<e&&i<s&&i<n)&&(!(i>e&&i>s&&i>n)&&(!(t<r&&t<h&&t<o)&&(t<=r||t<=h||t<=o)))}yh(t){if(!(j.Nn&&j.Fn&&this.ar&&this.cr&&this.ur))return;const i=this.Ar[t],e=this._r[t],s=this.gr[t];N.Tt(j.Nn[i],j.Fn[i],j.Nn[e],j.Fn[e],N.palette[1e3]),N.Tt(j.Nn[e],j.Fn[e],j.Nn[s],j.Fn[s],N.palette[1e3]),N.Tt(j.Nn[s],j.Fn[s],j.Nn[i],j.Fn[i],N.palette[1e3])}}class z{head;constructor(){this.head=new y}push(t){t.lt&&t.ct(),t.lt=this.head.lt,t.ot=this.head,t.lt&&(t.lt.ot=t),t.ot.lt=t}pop(){const t=this.head.ot;return t===this.head?null:(t?.ct(),t)}}class Z{mh;ph;constructor(t){this.ph=[],this.mh=t;for(let i=0;i<t;i++)this.ph[i]=new w}get(t){const i=this.ph[Number(t&BigInt(this.mh-1))];if(!i.next)return null;for(let e=i.next;e!==i;e=e.next)if(e&&e.key===t)return e;return null}put(t,i){i.rt&&i.ht();const e=this.ph[Number(t&BigInt(this.mh-1))];i.rt=e.rt,i.next=e,i.rt&&(i.rt.next=i),i.next.rt=i,i.key=t}}class q{Ah;_h;history;available;constructor(t){this.Ah=t,this.available=t,this._h=new Z(1024),this.history=new z}get(t){const i=this._h.get(t);return i&&this.history.push(i),i}put(t,i){if(0===this.available){const t=this.history.pop();t?.ht(),t?.ct()}else this.available--;this._h.put(t,i),this.history.push(i)}clear(){const t=this.history.pop();t?(t.ht(),t.ct()):this.available=this.Ah}}class J extends y{ft;width;height;Ai;_i;gi;Ii;constructor(t,i){super(),this.ft=new Int32Array(t*i),this.width=this.gi=t,this.height=this.Ii=i,this.Ai=this._i=0}static gh=async(t,i)=>{const e=t.read(i+'.dat');if(!e)throw new Error(`${i} jpeg not found!`);const s=await(async t=>{255!==t[0]&&(t[0]=255),URL.revokeObjectURL(g.src),g.src=URL.createObjectURL(new Blob([t],{type:'image/jpeg'})),await new Promise((t=>g.onload=()=>t())),I.clearRect(0,0,_.width,_.height);const i=g.naturalWidth,e=g.naturalHeight;return _.width=i,_.height=e,I.drawImage(g,0,0),I.getImageData(0,0,i,e)})(e),n=new J(s.width,s.height),r=new Uint32Array(s.data.buffer),h=n.ft;for(let t=0;t<h.length;t++){const i=r[t];h[t]=(i>>24&255)<<24|(255&i)<<16|(i>>8&255)<<8|i>>16&255}return n};static Ci=(t,i,e=0)=>{const s=new O(t.read(i+'.dat')),n=new O(t.read('index.dat'));n.Xt=s.Jt;const r=n.Jt,h=n.Jt,o=[],l=n.Zt-1;for(let t=0;t<l;t++)o[t+1]=n.Qt,0===o[t+1]&&(o[t+1]=1);for(let t=0;t<e;t++)n.Xt+=2,s.Xt+=n.Jt*n.Jt,n.Xt+=1;if(s.Xt>s.length||n.Xt>n.length)throw new Error;const a=n.Zt,c=n.Zt,f=n.Jt,u=n.Jt,d=new J(f,u);d.Ai=a,d._i=c,d.gi=r,d.Ii=h;const w=n.Zt;if(0===w){const t=d.width*d.height;for(let i=0;i<t;i++)d.ft[i]=o[s.Zt]}else if(1===w){const t=d.width;for(let i=0;i<t;i++){const e=d.height;for(let n=0;n<e;n++)d.ft[i+n*t]=o[s.Zt]}}return d};bind(){m.bind(this.ft,this.width,this.height)}draw(t,i){t|=0,i|=0;let e=(t+=this.Ai)+(i+=this._i)*m.ut,s=0,n=this.height,r=this.width,h=m.ut-r,o=0;if(i<m.top){const t=m.top-i;n-=t,i=m.top,s+=t*r,e+=t*m.ut}if(i+n>m.bottom&&(n-=i+n-m.bottom),t<m.left){const i=m.left-t;r-=i,t=m.left,s+=i,e+=i,o+=i,h+=i}if(t+r>m.right){const i=t+r-m.right;r-=i,o+=i,h+=i}r>0&&n>0&&this.Ih(r,n,this.ft,s,o,m.ft,e,h)}Ch(t,i,e){i|=0,e|=0;let s=(i+=this.Ai)+(e+=this._i)*m.ut,n=0,r=this.height,h=this.width,o=m.ut-h,l=0;if(e<m.top){const t=m.top-e;r-=t,e=m.top,n+=t*h,s+=t*m.ut}if(e+r>m.bottom&&(r-=e+r-m.bottom),i<m.left){const t=m.left-i;h-=t,i=m.left,n+=t,s+=t,l+=t,o+=t}if(i+h>m.right){const t=i+h-m.right;h-=t,l+=t,o+=t}h>0&&r>0&&this.Eh(h,r,this.ft,n,l,m.ft,s,o,t)}Th(t,i){t|=0,i|=0;let e=(t+=this.Ai)+(i+=this._i)*m.ut,s=0,n=this.height,r=this.width,h=m.ut-r,o=0;if(i<m.top){const t=m.top-i;n-=t,i=m.top,s+=t*r,e+=t*m.ut}if(i+n>m.bottom&&(n-=i+n-m.bottom),t<m.left){const i=m.left-t;r-=i,t=m.left,s+=i,e+=i,o+=i,h+=i}if(t+r>m.right){const i=t+r-m.right;r-=i,o+=i,h+=i}r>0&&n>0&&this.bh(r,n,this.ft,s,o,m.ft,e,h)}Ti(){const t=this.ft,i=this.width,e=this.height;for(let s=0;s<e;s++){const e=i/2|0;for(let n=0;n<e;n++){const e=n+s*i,r=i-n-1+s*i,h=t[e];t[e]=t[r],t[r]=h}}}bi(){const t=this.ft,i=this.width,e=this.height;for(let s=0;s<(e/2|0);s++)for(let n=0;n<i;n++){const r=n+s*i,h=n+(e-s-1)*i,o=t[r];t[r]=t[h],t[h]=o}}translate(t,i,e){for(let s=0;s<this.ft.length;s++){const n=this.ft[s];if(0!==n){let r=n>>16&255;r+=t,r<1?r=1:r>255&&(r=255);let h=n>>8&255;h+=i,h<1?h=1:h>255&&(h=255);let o=255&n;o+=e,o<1?o=1:o>255&&(o=255),this.ft[s]=(r<<16)+(h<<8)+o}}}Ri(t,i,e,s){t|=0,i|=0,e|=0,s|=0;try{const n=this.width;let r=0,h=0;const o=this.gi,l=this.Ii,a=(o<<16)/e|0,c=(l<<16)/s|0;t+=(this.Ai*e+o-1)/o|0,i+=(this._i*s+l-1)/l|0,this.Ai*e%o!=0&&(r=(o-this.Ai*e%o<<16)/e|0),this._i*s%l!=0&&(h=(l-this._i*s%l<<16)/s|0),e=e*(this.width-(r>>16))/o|0,s=s*(this.height-(h>>16))/l|0;let f=t+i*m.ut,u=m.ut-e;if(i<m.top){const t=m.top-i;s-=t,i=0,f+=t*m.ut,h+=c*t}if(i+s>m.bottom&&(s-=i+s-m.bottom),t<m.left){const i=m.left-t;e-=i,t=0,f+=i,r+=a*i,u+=i}if(t+e>m.right){const i=t+e-m.right;e-=i,u+=i}this.scale(e,s,this.ft,r,h,m.ft,u,f,n,a,c)}catch(t){console.error('error in sprite clipping routine')}}Oh(t,i,e,s,n,r,h,o,l,a){t|=0,i|=0,e|=0,s|=0;try{const c=-e/2|0,f=-s/2|0,u=65536*Math.sin(l/326.11)|0,d=65536*Math.cos(l/326.11)|0,w=u*a>>8,y=d*a>>8;let p=(h<<16)+f*w+c*y,A=f*y-c*w+(o<<16),_=t+i*m.ut;for(let t=0;t<s;t++){const i=n[t];let e=_+i,s=p+y*i,h=A-w*i;for(let i=-r[t];i<0;i++)m.ft[e++]=this.ft[(s>>16)+(h>>16)*this.width],s+=y,h-=w;p+=w,A+=y,_+=m.ut}}catch(t){}}Rh(t,i,e){t|=0,i|=0;let s=(t+=this.Ai)+(i+=this._i)*m.ut,n=0,r=this.height,h=this.width,o=m.ut-h,l=0;if(i<m.top){const t=m.top-i;r-=t,i=m.top,n+=t*h,s+=t*m.ut}if(i+r>m.bottom&&(r-=i+r-m.bottom),t<m.left){const i=m.left-t;h-=i,t=m.left,n+=i,s+=i,l+=i,o+=i}if(t+h>m.right){const i=t+h-m.right;h-=i,l+=i,o+=i}h>0&&r>0&&this.Lh(h,r,this.ft,l,n,m.ft,s,o,e.ft)}scale(t,i,e,s,n,r,h,o,l,a,c){try{const f=s;for(let u=-i;u<0;u++){const i=(n>>16)*l;for(let n=-t;n<0;n++){const t=e[(s>>16)+i];0===t?o++:r[o++]=t,s+=a}n+=c,s=f,o+=h}}catch(t){console.error('error in plot_scale')}}bh(t,i,e,s,n,r,h,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++)r[h++]=e[s++],r[h++]=e[s++],r[h++]=e[s++],r[h++]=e[s++];for(let i=t;i<0;i++)r[h++]=e[s++];h+=o,s+=n}}Eh(t,i,e,s,n,r,h,o,l){const a=256-l;for(let c=-i;c<0;c++){for(let i=-t;i<0;i++){const t=e[s++];if(0===t)h++;else{const i=r[h];r[h++]=((16711935&t)*l+(16711935&i)*a&4278255360)+((65280&t)*l+(65280&i)*a&16711680)>>8}}h+=o,s+=n}}Ih(t,i,e,s,n,r,h,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++){let t=e[s++];0===t?h++:r[h++]=t,t=e[s++],0===t?h++:r[h++]=t,t=e[s++],0===t?h++:r[h++]=t,t=e[s++],0===t?h++:r[h++]=t}for(let i=t;i<0;i++){const t=e[s++];0===t?h++:r[h++]=t}h+=o,s+=n}}Lh(t,i,e,s,n,r,h,o,l){const a=-(t>>2);t=-(3&t);for(let c=-i;c<0;c++){for(let t=a;t<0;t++){let t=e[n++];0!==t&&0===l[h]?r[h++]=t:h++,t=e[n++],0!==t&&0===l[h]?r[h++]=t:h++,t=e[n++],0!==t&&0===l[h]?r[h++]=t:h++,t=e[n++],0!==t&&0===l[h]?r[h++]=t:h++}for(let i=t;i<0;i++){const t=e[n++];0!==t&&0===l[h]?r[h++]=t:h++}h+=o,n+=s}}}class ${static Sh=['_','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','0','1','2','3','4','5','6','7','8','9'];static xh=t=>{t=t.trim();let i=0n;for(let e=0;e<t.length&&e<12;e++){const s=t.charCodeAt(e);i*=37n,s>=65&&s<=90?i+=BigInt(s+1-65):s>=97&&s<=122?i+=BigInt(s+1-97):s>=48&&s<=57&&(i+=BigInt(s+27-48))}return i};static Mh=t=>{if(t<0n||t>=6582952005840035281n)return'invalid_name';if(t%37n===0n)return'invalid_name';let i=0;const e=Array(12);for(;0n!==t;){const s=t;t/=37n,e[11-i++]=this.Sh[Number(s-37n*t)]}return e.slice(12-i).join('')};static kh=t=>{const i=[...t.toLowerCase()];let e=!0;for(let t=0;t<i.length;t++){const s=i[t];e&&s>='a'&&s<='z'&&(i[t]=s.toUpperCase(),e=!1),'.'!==s&&'!'!==s||(e=!0)}return i.join('')};static Dh=t=>{let i='';for(let e=0;e<t.length;e++)i+='*';return i};static Nh=t=>(t>>24&255)+'.'+(t>>16&255)+'.'+(t>>8&255)+'.'+(255&t);static Fh=t=>{if(0===t.length)return t;const i=[...t];for(let t=0;t<i.length;t++)'_'===i[t]&&(i[t]=' ',t+1<i.length&&i[t+1]>='a'&&i[t+1]<='z'&&(i[t+1]=String.fromCharCode(i[t+1].charCodeAt(0)+'A'.charCodeAt(0)-97)));return i[0]>='a'&&i[0]<='z'&&(i[0]=String.fromCharCode(i[0].charCodeAt(0)+'A'.charCodeAt(0)-97)),i.join('')};static Bh=t=>{const i=t.toUpperCase();let e=0n;for(let t=0;t<i.length;t++)e=61n*e+BigInt(i.charCodeAt(t))-32n,e=e+(e>>56n)&0xffffffffffffffn;return e}}class Q{static Qs=[];static Ph=null;static Uh=null;static Wh=0;static Gh=1;static Yh=2;static Hh=3;static Vh=4;static Kh=5;static Xh=6;static jh=7;static zh=1;static Zh=2;static qh=3;static Jh=4;static $h=5;static Qh=6;static io=1;static eo=100;static so=101;static no=200;static ro=201;static ho=202;static oo=203;static lo=205;static ao=300;static co=301;static fo=302;static uo=303;static do=304;static wo=305;static yo=306;static mo=307;static po=308;static Ao=309;static _o=310;static Io=311;static Co=312;static Eo=313;static To=314;static bo=315;static Oo=316;static Ro=317;static vo=318;static Lo=319;static So=320;static xo=321;static Mo=322;static ko=323;static Do=324;static No=325;static Fo=326;static Bo=327;static Po=401;static Uo=500;static Wo=501;static Go=502;static Yo=503;static Ho=600;static Vo=601;static Ko=602;static Xo=603;static jo=604;static zo=605;static Zo=606;static qo=607;static Jo=608;static $o=609;static Qo=610;static tl=611;static il=612;static el=613;static sl=650;static nl=651;static rl=652;static hl=653;static ol=654;static ll=655;static tn=(t,i,e)=>{this.Ph=new q(5e4),this.Uh=new q(5e4);const s=new O(t.read('data'));let n=-1;for(s.Xt+=2;s.Xt<s.length;){let t=s.Jt;65535===t&&(n=s.Jt,t=s.Jt);const r=this.Qs[t]=new Q;r.id=t,r.al=n,r.type=s.Zt,r.cl=s.Zt,r.fl=s.Jt,r.width=s.Jt,r.height=s.Jt,r.ul=s.Zt,0===r.ul?r.ul=-1:r.ul=(r.ul-1<<8)+s.Zt;const h=s.Zt;if(h>0){r.dl=new Uint8Array(h),r.wl=new Uint16Array(h);for(let t=0;t<h;t++)r.dl[t]=s.Zt,r.wl[t]=s.Jt}const o=s.Zt;if(o>0){r.scripts=new v(o,null);for(let t=0;t<o;t++){const i=s.Jt,e=new Uint16Array(i);r.scripts[t]=e;for(let t=0;t<i;t++)e[t]=s.Jt}}if(r.type===Q.Wh){r.scroll=s.Jt,r.hide=1===s.Zt;const t=s.Zt;r.yl=new Array(t),r.ml=new Array(t),r.pl=new Array(t);for(let i=0;i<t;i++)r.yl[i]=s.Jt,r.ml[i]=s.$t,r.pl[i]=s.$t}if(r.type===Q.Gh&&(s.Xt+=3),r.type===Q.Yh){r.Al=new Int32Array(r.width*r.height),r._l=new Int32Array(r.width*r.height),r.draggable=1===s.Zt,r.gl=1===s.Zt,r.Il=1===s.Zt,r.Cl=s.Zt,r.El=s.Zt,r.Tl=new Int16Array(20),r.bl=new Int16Array(20),r.Ol=new v(20,null);for(let t=0;t<20;t++)if(1===s.Zt){r.Tl[t]=s.$t,r.bl[t]=s.$t;const e=s.ni;if(e.length>0){const s=e.lastIndexOf(',');r.Ol[t]=this.Rl(i,e.substring(0,s),parseInt(e.substring(s+1),10))}}r.vl=new v(5,null);for(let t=0;t<5;t++){const i=s.ni;r.vl[t]=i,0===i.length&&(r.vl[t]=null)}}if(r.type===Q.Hh&&(r.fill=1===s.Zt),r.type===Q.Vh||r.type===Q.Gh){r.Ll=1===s.Zt;const t=s.Zt;e&&(r.font=e[t]),r.Sl=1===s.Zt}if(r.type===Q.Vh&&(r.text=s.ni,r.xl=s.ni),r.type!==Q.Gh&&r.type!==Q.Hh&&r.type!==Q.Vh||(r.Ml=s.ti),r.type!==Q.Hh&&r.type!==Q.Vh||(r.kl=s.ti,r.Dl=s.ti),r.type===Q.Kh){const t=s.ni;if(t.length>0){const e=t.lastIndexOf(',');r.Nl=this.Rl(i,t.substring(0,e),parseInt(t.substring(e+1),10))}const e=s.ni;if(e.length>0){const t=e.lastIndexOf(',');r.Fl=this.Rl(i,e.substring(0,t),parseInt(e.substring(t+1),10))}}if(r.type===Q.Xh){const t=s.Zt;0!==t&&(r.model=this.Bl((t-1<<8)+s.Zt));const i=s.Zt;0!==i&&(r.Pl=this.Bl((i-1<<8)+s.Zt)),r.Ul=s.Zt,0===r.Ul?r.Ul=-1:r.Ul=(r.Ul-1<<8)+s.Zt,r.Wl=s.Zt,0===r.Wl?r.Wl=-1:r.Wl=(r.Wl-1<<8)+s.Zt,r.zoom=s.Jt,r.Gl=s.Jt,r.Yl=s.Jt}if(r.type===Q.jh){r.Al=new Int32Array(r.width*r.height),r._l=new Int32Array(r.width*r.height),r.Ll=1===s.Zt;const t=s.Zt;e&&(r.font=e[t]),r.Sl=1===s.Zt,r.Ml=s.ti,r.Cl=s.$t,r.El=s.$t,r.gl=1===s.Zt,r.vl=new v(5,null);for(let t=0;t<5;t++){const i=s.ni;r.vl[t]=i,0===i.length&&(r.vl[t]=null)}}r.cl!==Q.Zh&&r.type!==Q.Yh||(r.Hl=s.ni,r.action=s.ni,r.Vl=s.Jt),r.cl!==Q.zh&&r.cl!==Q.Jh&&r.cl!==Q.$h&&r.cl!==Q.Qh||(r.Kl=s.ni,0===r.Kl.length&&(r.cl===Q.zh?r.Kl='Ok':r.cl===Q.Jh||r.cl===Q.$h?r.Kl='Select':r.cl===Q.Qh&&(r.Kl='Continue')))}this.Ph=null,this.Uh=null};static Rl=(t,i,e)=>{const s=$.Bh(i)<<8n|BigInt(e);if(this.Ph){const t=this.Ph.get(s);if(t)return t}let n;try{n=J.Ci(t,i,e),this.Ph?.put(s,n)}catch(t){return null}return n};static Bl=t=>{if(this.Uh){const i=this.Uh.get(BigInt(t));if(i)return i}const i=j.model(t);return this.Uh?.put(BigInt(t),i),i};id=-1;al=-1;type=-1;cl=-1;fl=0;width=0;height=0;ul=-1;dl=null;wl=null;scripts=null;scroll=0;hide=!1;draggable=!1;gl=!1;Il=!1;Cl=0;El=0;Tl=null;bl=null;Ol=null;vl=null;fill=!1;Ll=!1;font=null;Sl=!1;text=null;xl=null;Ml=0;kl=0;Dl=0;Nl=null;Fl=null;model=null;Pl=null;Ul=-1;Wl=-1;zoom=0;Gl=0;Yl=0;Hl=null;action=null;Vl=-1;Kl=null;yl=null;ml=null;pl=null;x=0;y=0;Xl=0;Al=null;_l=null;jl=0;zl=0;Bl(t,i,e){let s=this.model;if(e&&(s=this.Pl),!s)return null;if(-1===t&&-1===i&&!s.Er)return s;const n=j.Br(s,!0,!0,!1);return-1===t&&-1===i||n.$r(),-1!==t&&n.ih(t),-1!==i&&n.ih(i),n.hh(64,768,-50,-10,-50,!0),n}Zl(){if(this.al===this.id)return this.x;let t=Q.Qs[this.al];if(!t.yl||!t.ml||!t.pl)return this.x;let i=t.yl.indexOf(this.id);if(-1===i)return this.x;let e=t.ml[i];for(;t.al!==t.id;){const s=Q.Qs[t.al];s.yl&&s.ml&&s.pl&&(i=s.yl.indexOf(t.id),-1!==i&&(e+=s.ml[i])),t=s}return e}ql(){if(this.al===this.id)return this.y;let t=Q.Qs[this.al];if(!t.yl||!t.ml||!t.pl)return this.y;let i=t.yl.indexOf(this.id);if(-1===i)return this.y;let e=t.pl[i];for(;t.al!==t.id;){const s=Q.Qs[t.al];s.yl&&s.ml&&s.pl&&(i=s.yl.indexOf(t.id),-1!==i&&(e+=s.pl[i])),t=s}return e}outline(t){const i=this.Zl(),e=this.ql();m.It(i,e,this.width,this.height,t)}move(t,i){if(this.al===this.id)return;this.x=0,this.y=0;const e=Q.Qs[this.al];if(e.yl&&e.ml&&e.pl){const s=e.yl.indexOf(this.id);-1!==s&&(e.ml[s]=t,e.pl[s]=i)}}delete(){if(this.al===this.id)return;const t=Q.Qs[this.al];if(t.yl&&t.ml&&t.pl){const i=t.yl.indexOf(this.id);-1!==i&&(t.yl.splice(i,1),t.ml.splice(i,1),t.pl.splice(i,1))}}}var tt,it=(tt="file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/tinymidipcm.mjs",function(t){var i,s,n=void 0!==(t=t||{})?t:{};n.ready=new Promise((function(t,e){i=t,s=e})),["_tsf_load_memory","_tsf_set_output","_tsf_channel_set_bank_preset","_tsf_set_max_voices","_tsf_channel_set_presetnumber","_tsf_reset","_tsf_close","_tml_load_memory","_midi_render","_malloc","_realloc","_free","_fflush","onRuntimeInitialized"].forEach((t=>{Object.getOwnPropertyDescriptor(n.ready,t)||Object.defineProperty(n.ready,t,{get:()=>X('You are getting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js'),set:()=>X('You are setting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js')})}));var r=Object.assign({},n),h=[],o='object'==typeof window,l='function'==typeof importScripts,a='object'==typeof process&&'object'==typeof process.versions&&'string'==typeof process.versions.node,c=!o&&!a&&!l;if(n.ENVIRONMENT)throw new Error('Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)');var f,u,d,w='';if(a){if('undefined'==typeof process||!process.release||'node'!==process.release.name)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');var y,m;w=l?require('path').Jl(w)+'/':__dirname+'/';var p=()=>{m||(y=require('fs'),m=require('path'))};f=(t,i)=>(p(),t=m.normalize(t),y.$l(t,i?void 0:'utf8')),d=t=>{var i=f(t,!0);return i.buffer||(i=new Uint8Array(i)),k(i.buffer),i},u=(t,i,e)=>{p(),t=m.normalize(t),y.Ql(t,(function(t,s){t?e(t):i(s.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,'/'),h=process.argv.slice(2),process.on('uncaughtException',(function(t){if(!(t instanceof nt))throw t})),process.on('unhandledRejection',(function(t){throw t})),n.inspect=function(){return'[Emscripten Module object]'}}else if(c){if('object'==typeof process&&'function'==typeof require||'object'==typeof window||'function'==typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');'undefined'!=typeof read&&(f=function(t){return read(t)}),d=function(t){let i;return'function'==typeof readbuffer?new Uint8Array(readbuffer(t)):(i=read(t,'binary'),k('object'==typeof i),i)},u=function(t,i,e){setTimeout((()=>i(d(t))),0)},'undefined'!=typeof scriptArgs?h=scriptArgs:void 0!==arguments&&(h=arguments),'undefined'!=typeof print&&('undefined'==typeof console&&(console={}),console.log=print,console.warn=console.error='undefined'!=typeof printErr?printErr:print)}else{if(!o&&!l)throw new Error('environment detection error');if(l?w=self.location.href:'undefined'!=typeof document&&document.currentScript&&(w=document.currentScript.src),tt&&(w=tt),w=0!==w.indexOf('blob:')?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf('/')+1):'','object'!=typeof window&&'function'!=typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');f=t=>{var i=new XMLHttpRequest;return i.open('GET',t,!1),i.send(null),i.responseText},l&&(d=t=>{var i=new XMLHttpRequest;return i.open('GET',t,!1),i.responseType='arraybuffer',i.send(null),new Uint8Array(i.response)}),u=(t,i,e)=>{var s=new XMLHttpRequest;s.open('GET',t,!0),s.responseType='arraybuffer',s.onload=()=>{200==s.status||0==s.status&&s.response?i(s.response):e()},s.onerror=e,s.send(null)}}n.print||console.log.bind(console);var A,_,g=n.printErr||console.warn.bind(console);function I(t,i){Object.getOwnPropertyDescriptor(n,t)||Object.defineProperty(n,t,{configurable:!0,get:function(){X('Module.'+t+' has been replaced with plain '+i+' (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)')}})}function C(t){return'FS_createPath'===t||'FS_createDataFile'===t||'FS_createPreloadedFile'===t||'FS_unlink'===t||'addRunDependency'===t||'FS_createLazyFile'===t||'FS_createDevice'===t||'removeRunDependency'===t}Object.assign(n,r),r=null,A='fetchSettings',Object.getOwnPropertyDescriptor(n,A)&&X('`Module.'+A+'` was supplied but `'+A+'` not included in INCOMING_MODULE_JS_API'),n.arguments&&(h=n.arguments),I('arguments','arguments_'),n.thisProgram&&n.thisProgram,I('thisProgram','thisProgram'),n.quit&&n.quit,I('quit','quit_'),k(void 0===n.memoryInitializerPrefixURL,'Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead'),k(void 0===n.pthreadMainPrefixURL,'Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead'),k(void 0===n.cdInitializerPrefixURL,'Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead'),k(void 0===n.filePackagePrefixURL,'Module.filePackagePrefixURL option was removed, use Module.locateFile instead'),k(void 0===n.read,'Module.read option was removed (modify read_ in JS)'),k(void 0===n.readAsync,'Module.readAsync option was removed (modify readAsync in JS)'),k(void 0===n.readBinary,'Module.readBinary option was removed (modify readBinary in JS)'),k(void 0===n.setWindowTitle,'Module.setWindowTitle option was removed (modify setWindowTitle in JS)'),k(void 0===n.TOTAL_MEMORY,'Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY'),I('read','read_'),I('readAsync','readAsync'),I('readBinary','readBinary'),I('setWindowTitle','setWindowTitle'),k(!c,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable."),n.wasmBinary&&(_=n.wasmBinary),I('wasmBinary','wasmBinary');var E;n.noExitRuntime;I('noExitRuntime','noExitRuntime'),'object'!=typeof WebAssembly&&X('no native wasm support detected');var T,b,O,R,v,L,S,x,M=!1;function k(t,i){t||X('Assertion failed'+(i?': '+i:''))}function D(t){T=t,n.HEAP8=b=new Int8Array(t),n.HEAP16=R=new Int16Array(t),n.HEAP32=v=new Int32Array(t),n.HEAPU8=O=new Uint8Array(t),n.HEAPU16=new Uint16Array(t),n.HEAPU32=L=new Uint32Array(t),n.HEAPF32=S=new Float32Array(t),n.HEAPF64=x=new Float64Array(t)}'undefined'!=typeof TextDecoder&&new TextDecoder('utf8');var N=5242880;n.TOTAL_STACK&&k(N===n.TOTAL_STACK,'the stack size can no longer be determined at runtime');var F=n.INITIAL_MEMORY||16777216;function B(){if(!M){var t=ft(),i=L[t>>2],e=L[t+4>>2];34821223==i&&2310721022==e||X('Stack overflow! Stack cookie has been overwritten at 0x'+t.toString(16)+', expected hex dwords 0x89BACDFE and 0x2135467, but received 0x'+e.toString(16)+' 0x'+i.toString(16)),1668509029!==L[0]&&X('Runtime error: The application has corrupted its heap memory area (address zero)!')}}I('INITIAL_MEMORY','INITIAL_MEMORY'),k(F>=N,'INITIAL_MEMORY should be larger than TOTAL_STACK, was '+F+'! (TOTAL_STACK='+N+')'),k('undefined'!=typeof Int32Array&&'undefined'!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,'JS engine does not provide full typed array support'),k(!n.wasmMemory,'Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally'),k(16777216==F,'Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically'),function(){var t=new Int16Array(1),i=new Int8Array(t.buffer);if(t[0]=25459,115!==i[0]||99!==i[1])throw'Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)'}();var P=[],U=[],W=[],G=!1;k(Math.imul,'This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),k(Math.fround,'This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),k(Math.clz32,'This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),k(Math.trunc,'This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill');var Y=0,H=null,V=null,K={};function X(t){n.onAbort&&n.onAbort(t),g(t='Aborted('+t+')'),M=!0;var i=new WebAssembly.RuntimeError(t);throw s(i),i}var j={error:function(){X('Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM')},init:function(){j.error()},ta:function(){j.error()},ia:function(){j.error()},ea:function(){j.error()},open:function(){j.error()},sa:function(){j.error()},na:function(){j.error()},ra:function(){j.error()},ha:function(){j.error()},oa:function(){j.error()}};n.FS_createDataFile=j.ta,n.FS_createPreloadedFile=j.ia;var z,Z,q,J,$='data:application/octet-stream;base64,';function Q(t){return t.startsWith($)}function it(t){return t.startsWith('file://')}function et(t,i){return function(){var e=t,s=i;return i||(s=n.asm),k(G,'native function `'+e+'` called before runtime initialization'),s[t]||k(s[t],'exported native function `'+e+'` not found'),s[t].apply(null,arguments)}}function st(t){try{if(t==z&&_)return new Uint8Array(_);if(d)return d(t);throw"both async and sync fetching of the wasm failed"}catch(t){X(t)}}function nt(t){this.name='ExitStatus',this.message='Program terminated with exit('+t+')',this.status=t}function rt(t){for(;t.length>0;)t.shift()(n)}function ht(t){ht.la||(ht.la={}),ht.la[t]||(ht.la[t]=1,a&&(t='warning: '+t),g(t))}function ot(t){try{return E.grow(t-T.byteLength+65535>>>16),D(E.buffer),1}catch(i){g('emscripten_realloc_buffer: Attempted to grow heap from '+T.byteLength+' bytes to '+t+' bytes, but got error: '+i)}}n.locateFile?Q(z='tinymidipcm.wasm')||(Z=z,z=n.locateFile?n.locateFile(Z,w):w+Z):z=new URL(e(8227),e.b).toString();var lt,at={"emscripten_memcpy_big":function(t,i,e){O.copyWithin(t,i,i+e)},"emscripten_resize_heap":function(t){var i=O.length;k((t>>>=0)>i);var e,s,n=2147483648;if(t>n)return g('Cannot enlarge memory, asked to go up to '+t+' bytes, but the limit is '+n+' bytes!'),!1;for(var r=1;r<=4;r*=2){var h=i*(1+.2/r);h=Math.min(h,t+100663296);var o=Math.min(n,(e=Math.max(t,h))+((s=65536)-e%s)%s);if(ot(o))return!0}return g('Failed to grow the heap from '+i+' bytes to '+o+' bytes, not enough memory!'),!1}},ct=(function(){var t,i={'env':at,'wasi_snapshot_preview1':at};function e(t,i){var e,s=t.exports;n.asm=s,k(E=n.asm.memory,"memory not found in wasm exports"),D(E.buffer),k(n.asm.__indirect_function_table,"table not found in wasm exports"),e=n.asm.__wasm_call_ctors,U.unshift(e),function(t){if(Y--,n.monitorRunDependencies&&n.monitorRunDependencies(Y),t?(k(K[t]),delete K[t]):g('warning: run dependency removed without ID'),0==Y&&(null!==H&&(clearInterval(H),H=null),V)){var i=V;V=null,i()}}('wasm-instantiate')}t='wasm-instantiate',Y++,n.monitorRunDependencies&&n.monitorRunDependencies(Y),t?(k(!K[t]),K[t]=1,null===H&&'undefined'!=typeof setInterval&&(H=setInterval((function(){if(M)return clearInterval(H),void(H=null);var t=!1;for(var i in K)t||(t=!0,g('still waiting on run dependencies:')),g('dependency: '+i);t&&g('(end of list)')}),1e4))):g('warning: run dependency added without ID');var r=n;function h(t){k(n===r,'the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?'),r=null,e(t.instance)}function c(t){return function(){if(!_&&(o||l)){if('function'==typeof fetch&&!it(z))return fetch(z,{credentials:'same-origin'}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+z+"'";return t.arrayBuffer()})).catch((function(){return st(z)}));if(u)return new Promise((function(t,i){u(z,(function(i){t(new Uint8Array(i))}),i)}))}return Promise.resolve().then((function(){return st(z)}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){g('failed to asynchronously prepare wasm: '+t),it(z)&&g('warning: Loading from a file URI ('+z+') is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing'),X(t)}))}if(n.instantiateWasm)try{return n.instantiateWasm(i,e)}catch(t){g('Module.instantiateWasm callback failed with error: '+t),s(t)}(_||'function'!=typeof WebAssembly.instantiateStreaming||Q(z)||it(z)||a||'function'!=typeof fetch?c(h):fetch(z,{credentials:'same-origin'}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(h,(function(t){return g('wasm streaming compile failed: '+t),g('falling back to ArrayBuffer instantiation'),c(h)}))}))).catch(s)}(),n.___wasm_call_ctors=et("__wasm_call_ctors"),n._malloc=et("malloc"),n._free=et("free"),n._tsf_load_memory=et("tsf_load_memory"),n._tsf_close=et("tsf_close"),n._tsf_reset=et("tsf_reset"),n._tsf_set_output=et("tsf_set_output"),n._tsf_set_max_voices=et("tsf_set_max_voices"),n._realloc=et("realloc"),n._tsf_channel_set_presetnumber=et("tsf_channel_set_presetnumber"),n._tsf_channel_set_bank_preset=et("tsf_channel_set_bank_preset"),n._tml_load_memory=et("tml_load_memory"),n._midi_render=et("midi_render"),n.___errno_location=et("__errno_location"),n._fflush=et("fflush"),n._emscripten_stack_init=function(){return(ct=n._emscripten_stack_init=n.asm.emscripten_stack_init).apply(null,arguments)}),ft=(n._emscripten_stack_get_free=function(){return(n._emscripten_stack_get_free=n.asm.emscripten_stack_get_free).apply(null,arguments)},n._emscripten_stack_get_base=function(){return(n._emscripten_stack_get_base=n.asm.emscripten_stack_get_base).apply(null,arguments)},n._emscripten_stack_get_end=function(){return(ft=n._emscripten_stack_get_end=n.asm.emscripten_stack_get_end).apply(null,arguments)});function ut(){var t;ct(),k(!(3&(t=ft()))),L[t>>2]=34821223,L[t+4>>2]=2310721022,L[0]=1668509029}function dt(t){function e(){lt||(lt=!0,n.calledRun=!0,M||(k(!G),G=!0,B(),rt(U),i(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),k(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(B(),n.postRun)for('function'==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)t=n.postRun.shift(),W.unshift(t);var t;rt(W)}()))}t=t||h,Y>0||(ut(),function(){if(n.preRun)for('function'==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)t=n.preRun.shift(),P.unshift(t);var t;rt(P)}(),Y>0||(n.setStatus?(n.setStatus('Running...'),setTimeout((function(){setTimeout((function(){n.setStatus('')}),1),e()}),1)):e(),B()))}if(n.stackSave=et("stackSave"),n.stackRestore=et("stackRestore"),n.stackAlloc=et("stackAlloc"),n.setValue=function(t,i,e="i8"){switch(e.endsWith('*')&&(e='*'),e){case'i1':case'i8':b[0|t]=i;break;case'i16':R[t>>1]=i;break;case'i32':v[t>>2]=i;break;case'i64':J=[i>>>0,(q=i,+Math.abs(q)>=1?q>0?(0|Math.min(+Math.floor(q/4294967296),4294967295))>>>0:~~+Math.ceil((q-+(~~q>>>0))/4294967296)>>>0:0)],v[t>>2]=J[0],v[t+4>>2]=J[1];break;case'float':S[t>>2]=i;break;case'double':x[t>>3]=i;break;case'*':L[t>>2]=i;break;default:X('invalid type for setValue: '+e)}},n.getValue=function(t,i="i8"){switch(i.endsWith('*')&&(i='*'),i){case'i1':case'i8':return b[0|t];case'i16':return R[t>>1];case'i32':case'i64':return v[t>>2];case'float':return S[t>>2];case'double':return x[t>>3];case'*':return L[t>>2];default:X('invalid type for getValue: '+i)}return null},['run','UTF8ArrayToString','UTF8ToString','stringToUTF8Array','stringToUTF8','lengthBytesUTF8','addOnPreRun','addOnInit','addOnPreMain','addOnExit','addOnPostRun','addRunDependency','removeRunDependency','FS_createFolder','FS_createPath','FS_createDataFile','FS_createPreloadedFile','FS_createLazyFile','FS_createLink','FS_createDevice','FS_unlink','getLEB','getFunctionTables','alignFunctionTables','registerFunctions','prettyPrint','getCompilerSetting','print','printErr','callMain','abort','keepRuntimeAlive','wasmMemory','stackAlloc','stackSave','stackRestore','getTempRet0','setTempRet0','writeStackCookie','checkStackCookie','ptrToString','zeroMemory','stringToNewUTF8','exitJS','getHeapMax','emscripten_realloc_buffer','ENV','ERRNO_CODES','ERRNO_MESSAGES','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','DNS','getHostByName','Protocols','Sockets','getRandomDevice','warnOnce','traverseStack','UNWIND_CACHE','convertPCtoSourceLocation','readAsmConstArgsArray','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','handleException','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','freeTableIndexes','functionsInTableMap','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','PATH','PATH_FS','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16Decoder','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeArrayToMemory','writeAsciiToMemory','SYSCALLS','getSocketFromFD','getSocketAddress','JSEvents','registerKeyEventCallback','specialHTMLTargets','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','currentFullscreenStrategy','restoreOldWindowedStyle','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','demangle','demangleAll','jsStackTrace','stackTrace','ExitStatus','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','dlopenMissingError','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','uncaughtExceptionCount','exceptionLast','exceptionCaught','ExceptionInfo','exception_addRef','exception_decRef','Browser','setMainLoop','wget','FS','MEMFS','TTY','PIPEFS','SOCKFS','_setNetworkCallback','tempFixedLengthArray','miniTempWebGLFloatBuffers','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','GL','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','AL','SDL_unicode','SDL_ttfContext','SDL_audio','SDL','SDL_gfx','GLUT','EGL','GLFW_Window','GLFW','GLEW','IDBStore','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){Object.getOwnPropertyDescriptor(n,t)||Object.defineProperty(n,t,{configurable:!0,get:function(){var i="'"+t+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";C(t)&&(i+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),X(i)}})})),['ptrToString','zeroMemory','stringToNewUTF8','exitJS','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','getHostByName','getRandomDevice','traverseStack','convertPCtoSourceLocation','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeAsciiToMemory','getSocketFromFD','getSocketAddress','registerKeyEventCallback','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','ExceptionInfo','exception_addRef','exception_decRef','setMainLoop','_setNetworkCallback','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','SDL_unicode','SDL_ttfContext','SDL_audio','GLFW_Window','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){'undefined'==typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,t)||Object.defineProperty(globalThis,t,{configurable:!0,get:function(){var i='`'+t+'` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line';C(t)&&(i+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),ht(i)}})})),V=function t(){lt||dt(),lt||(V=t)},n.preInit)for('function'==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return dt(),t.ready});const et=it;const st=class{constructor(t={}){this.aa=void 0,this.ca=0,this.fa=0,this.ua=0,this.da=t.da||100,this.sampleRate=t.sampleRate||44100,this.wa=t.wa||2,this.gain=t.gain||0,t.bufferSize?this.bufferSize=t.bufferSize:this.ya(1),this.ma=t.ma||(()=>{}),this.pa=t.pa||(()=>{}),this.Aa=void 0,this.test=0}async init(){if(!this.aa){if('undefined'!=typeof process){const{Jl:t}=await import('path'),{_a:i}=await import('module');globalThis.__dirname=t("file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/index.js"),globalThis.require=i("file:///home/runner/work/Client2/Client2/src/js/vendor/tinymidipcm/index.js")}this.aa=await et(),this.ga=this.aa._malloc(this.bufferSize),this.Ia=this.aa._malloc(8)}}ya(t){this.bufferSize=4*this.sampleRate*this.wa*t}Ca(){if(!this.aa)throw new Error(`${this.constructor.name} not initalized. call .init()`)}Ea(t){this.Ca();const{_malloc:i,_free:e,_tsf_load_memory:s,_tsf_set_output:n,_tsf_channel_set_bank_preset:r,_tsf_set_max_voices:h,_tsf_channel_set_presetnumber:o}=this.aa;e(this.ca),this.ca=i(t.length),this.aa.HEAPU8.set(t,this.ca),this.fa=s(this.ca,t.length),n(this.fa,2===this.wa?0:2,this.sampleRate,this.gain)}Ta(){this.Ca();const t=new Uint8Array(this.bufferSize);return t.set(this.aa.HEAPU8.subarray(this.ga,this.ga+this.bufferSize)),t}ba(t){const{_malloc:i,_free:e,_tml_load_memory:s}=this.aa;return e(this.ua),this.ua=i(t.length),this.aa.HEAPU8.set(t,this.ua),s(this.ua,t.length)}Oa(t){const{_midi_render:i}=this.aa;return i(this.fa,t,this.wa,this.sampleRate,this.ga,this.bufferSize,this.Ia)}Ra(t){if(this.Ca(),!this.fa)throw new Error('no soundfont buffer set. call .setSoundfont');window.clearTimeout(this.Aa);const{setValue:i,getValue:e}=this.aa;i(this.Ia,0,'double'),this.aa._tsf_reset(this.fa),this.aa._tsf_channel_set_bank_preset(this.fa,9,128,0),t[0]==='R'.charCodeAt(0)&&(t=t.slice(20));let s=this.ba(t);const n=()=>{s=this.Oa(s);const t=this.Ta();this.ma(t),s?this.Aa=setTimeout(n,this.da):this.pa(e(this.Ia,'double'))};this.Aa=setTimeout(n,16)}};!function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.audioContext=new window.AudioContext);var t=function(i){if(window.audioContext){var e=window.audioContext.createBuffer(1,1,22050),s=window.audioContext.createBufferSource();s.buffer=e,s.connect(window.audioContext.destination),s.start?s.start(0):s.play?s.play(0):s.noteOn&&s.noteOn(0)}document.removeEventListener('touchstart',t),document.removeEventListener('touchend',t),document.removeEventListener('click',t)};document.addEventListener('touchstart',t),document.addEventListener('touchend',t),document.addEventListener('click',t)}(),(async()=>{const t=2,i=44100;let e=new Float32Array,s=window.audioContext.createGain();s.gain.value=.1,s.connect(window.audioContext.destination);let n=window.audioContext.currentTime,r=[];const h=new st({da:30,ma:t=>{let i=new Float32Array(t.buffer),s=new Float32Array(e.length+i.length);s.set(e,0),s.set(i,e.length),e=s},pa:t=>{},bufferSize:102400});await h.init();const o=await fetch('./SCC1_Florestan.sf2'),l=new Uint8Array(await o.arrayBuffer());function a(){if(!window.audioContext||!e.length)return;let h=window.audioContext.createBufferSource();const o=e.length/t,l=window.audioContext.createBuffer(t,o,i);for(let i=0;i<t;i++){const s=l.getChannelData(i);let n=i;for(let i=0;i<o;i++)s[i]=e[n],n+=t}n<window.audioContext.currentTime&&(n=window.audioContext.currentTime),h.buffer=l,h.connect(s),h.start(n),r.push(h),n+=l.duration,e=new Float32Array}let c;function f(){if(c&&clearInterval(c),e=new Float32Array,r.length){let t=s.gain.value;s.gain.value=0,r.forEach((t=>{t.stop(window.audioContext.currentTime)})),r=[],s.gain.value=t}}function u(t,i){-1!==t&&window._tinyMidiVolume(t),n=window.audioContext.currentTime,c=setInterval(a,250),h.Ra(i)}h.Ea(l),window._tinyMidiStop=async t=>{t?function(t,i){const e=window.audioContext.currentTime;s.gain.cancelScheduledValues(e),s.gain.setValueAtTime(s.gain.value,e),s.gain.linearRampToValueAtTime(t,e+2),setTimeout(i,2e3)}(0,(()=>{f()})):f()},window._tinyMidiVolume=(t=1)=>{s.gain.value=t},window._tinyMidiPlay=async(t,i,e)=>{t&&(await window._tinyMidiStop(e),e?setTimeout((()=>{u(i,t)}),2e3):u(i,t))}})();class nt{level;y;x;z;model;va;La;Sa;xa;Ma;ka;Da;info;Na=0;Yi=0;constructor(t,i,e,s,n,r,h,o,l,a,c,f,u){this.level=t,this.y=i,this.x=e,this.z=s,this.model=n,this.va=r,this.La=h,this.Sa=o,this.xa=l,this.Ma=a,this.ka=c,this.Da=f,this.info=u}}class rt extends w{level;x;z;Fa;Ba;Pa;Ua=null;Wa=null;Ga=null;Ya=null;Ha=null;Va=null;Ka=null;Xa=0;ja=0;za=0;visible=!1;update=!1;Za=!1;qa=0;Ja=0;$a=0;Qa=0;constructor(t,i,e){super(),this.Fa=this.level=t,this.x=i,this.z=e,this.Ba=new v(5,null),this.Pa=new Int32Array(5)}}class ht{tc;ic;ec;sc;type;Rr;vr;Lr;Sr;kr;Dr;mode=0;nc=0;rc=0;hc=0;oc=0;lc=0;ac=0;constructor(t,i,e,s,n,r,h,o,l,a,c){this.tc=t,this.ic=i,this.ec=e,this.sc=s,this.type=n,this.Rr=r,this.vr=h,this.Lr=o,this.Sr=l,this.kr=a,this.Dr=c}}class ot{static OPEN=0;static cc=1;static fc=2;static uc=4;static dc=8;static wc=ot.cc<<4;static yc=ot.fc<<4;static mc=ot.uc<<4;static Ac=ot.dc<<4;static _c=256;static gc=512;static Ic=1024;static Cc=2048;static Ec=4096;static Tc=ot.gc<<4;static bc=ot.Ic<<4;static Oc=ot.Cc<<4;static Rc=ot.Ec<<4;static vc=ot._c<<9;static Lc=524288;static Sc=2097152;static xc=ot.Sc|ot.Lc;static Mc=ot._c|ot.xc;static kc=ot.fc|ot.Mc;static Dc=ot.dc|ot.Mc;static Nc=ot.fc|ot.uc|ot.Dc;static Fc=ot.yc|ot.Mc;static Bc=ot.dc|ot.wc|ot.Fc;static Pc=ot.Ac|ot.Mc;static Uc=ot.cc|ot.fc|ot.Pc;static Wc=ot.yc|ot.mc|ot.Pc;static Gc=16777215}class lt{static Yc=0;static Hc=1;static Vc=2;static Kc=3}class at{static Xc=0;static jc=1;static zc=2;static Zc=3}class ct{static qc=new ct(0,at.Xc);static Jc=new ct(1,at.Xc);static $c=new ct(2,at.Xc);static Qc=new ct(3,at.Xc);static tf=new ct(4,at.jc);static if=new ct(5,at.jc);static ef=new ct(6,at.jc);static sf=new ct(7,at.jc);static nf=new ct(8,at.jc);static rf=new ct(9,at.zc);static hf=new ct(10,at.zc);static lf=new ct(11,at.zc);static af=new ct(12,at.zc);static cf=new ct(13,at.zc);static ff=new ct(14,at.zc);static uf=new ct(15,at.zc);static df=new ct(16,at.zc);static wf=new ct(17,at.zc);static yf=new ct(18,at.zc);static mf=new ct(19,at.zc);static pf=new ct(20,at.zc);static Af=new ct(21,at.zc);static Zc=new ct(22,at.Zc);static values(){return[this.qc,this.Jc,this.wf,this.uf,this.$c,this.ff,this.rf,this.Qc,this.Zc,this.af,this.lf,this.ef,this.pf,this.hf,this.if,this.cf,this.sf,this.tf,this.df,this.nf,this.mf,this.Af,this.yf]}static of(t){const i=this.values();for(let e=0;e<i.length;e++){const s=i[e];if(s.id===t)return s}throw Error('shape not found')}id;al;constructor(t,i){this.id=t,this.al=i}}class ft{static Hc=1;static Vc=2;static Kc=4;static Yc=8}class ut{static _f=4;static gf=104;static index=(t,i)=>t*ut.gf+i;offsetX;If;sizeX;sizeZ;flags;constructor(){this.offsetX=0,this.If=0,this.sizeX=ut.gf,this.sizeZ=ut.gf,this.flags=new Int32Array(this.sizeX*this.sizeZ),this.reset()}reset=()=>{for(let t=0;t<this.sizeX;t++)for(let i=0;i<this.sizeZ;i++){const e=ut.index(t,i);0===t||0===i||t===this.sizeX-1||i===this.sizeZ-1?this.flags[e]=ot.Gc:this.flags[e]=ot.OPEN}};Cf=(t,i)=>{this.flags[ut.index(t-this.offsetX,i-this.If)]|=ot.Sc};Ef=(t,i)=>{this.flags[ut.index(t-this.offsetX,i-this.If)]&=~ot.Sc};Tf=(t,i,e,s,n,r)=>{let h=ot._c;r&&(h|=ot.vc);const o=t-this.offsetX,l=i-this.If;if(n===lt.Hc||n===lt.Kc){const t=e;e=s,s=t}for(let t=o;t<o+e;t++)if(t>=0&&t<this.sizeX)for(let i=l;i<l+s;i++)i>=0&&i<this.sizeZ&&this.add(t,i,h)};bf=(t,i,e,s,n,r)=>{let h=ot._c;r&&(h|=ot.vc);const o=t-this.offsetX,l=i-this.If;if(n===lt.Hc||n===lt.Kc){const t=e;e=s,s=t}for(let t=o;t<o+e;t++)if(t>=0&&t<this.sizeX)for(let i=l;i<l+s;i++)i>=0&&i<this.sizeZ&&this.remove(t,i,h)};Of=(t,i,e,s,n)=>{const r=t-this.offsetX,h=i-this.If,o=n?ot.Rc:ot.Ac,l=n?ot.Ec:ot.dc,a=n?ot.Ic:ot.fc,c=n?ot.bc:ot.yc,f=n?ot.gc:ot.cc,u=n?ot.Tc:ot.wc,d=n?ot.Cc:ot.uc,w=n?ot.Oc:ot.mc;e===ct.qc.id?s===lt.Yc?(this.add(r,h,o),this.add(r-1,h,l)):s===lt.Hc?(this.add(r,h,a),this.add(r,h+1,c)):s===lt.Vc?(this.add(r,h,l),this.add(r+1,h,o)):s===lt.Kc&&(this.add(r,h,c),this.add(r,h-1,a)):e===ct.Jc.id||e===ct.Qc.id?s===lt.Yc?(this.add(r,h,f),this.add(r-1,h+1,u)):s===lt.Hc?(this.add(r,h,d),this.add(r+1,h+1,w)):s===lt.Vc?(this.add(r,h,u),this.add(r+1,h-1,f)):s===lt.Kc&&(this.add(r,h,w),this.add(r-1,h-1,d)):e===ct.$c.id&&(s===lt.Yc?(this.add(r,h,a|o),this.add(r-1,h,l),this.add(r,h+1,c)):s===lt.Hc?(this.add(r,h,a|l),this.add(r,h+1,c),this.add(r+1,h,o)):s===lt.Vc?(this.add(r,h,c|l),this.add(r+1,h,o),this.add(r,h-1,a)):s===lt.Kc&&(this.add(r,h,c|o),this.add(r,h-1,a),this.add(r-1,h,l))),n&&this.Of(t,i,e,s,!1)};Rf=(t,i,e,s,n)=>{const r=t-this.offsetX,h=i-this.If,o=n?ot.Rc:ot.Ac,l=n?ot.Ec:ot.dc,a=n?ot.Ic:ot.fc,c=n?ot.bc:ot.yc,f=n?ot.gc:ot.cc,u=n?ot.Tc:ot.wc,d=n?ot.Cc:ot.uc,w=n?ot.Oc:ot.mc;e===ct.qc.id?s===lt.Yc?(this.remove(r,h,o),this.remove(r-1,h,l)):s===lt.Hc?(this.remove(r,h,a),this.remove(r,h+1,c)):s===lt.Vc?(this.remove(r,h,l),this.remove(r+1,h,o)):s===lt.Kc&&(this.remove(r,h,c),this.remove(r,h-1,a)):e===ct.Jc.id||e===ct.Qc.id?s===lt.Yc?(this.remove(r,h,f),this.remove(r-1,h+1,u)):s===lt.Hc?(this.remove(r,h,d),this.remove(r+1,h+1,w)):s===lt.Vc?(this.remove(r,h,u),this.remove(r+1,h-1,f)):s===lt.Kc&&(this.remove(r,h,w),this.remove(r-1,h-1,d)):e===ct.$c.id&&(s===lt.Yc?(this.remove(r,h,a|o),this.remove(r-1,h,l),this.remove(r,h+1,c)):s===lt.Hc?(this.remove(r,h,a|l),this.remove(r,h+1,c),this.remove(r+1,h,o)):s===lt.Vc?(this.remove(r,h,c|l),this.remove(r+1,h,o),this.remove(r,h-1,a)):s===lt.Kc&&(this.remove(r,h,c|o),this.remove(r,h-1,a),this.remove(r-1,h,l))),n&&this.Rf(t,i,e,s,!1)};vf=(t,i,e,s,n,r)=>{if(t===e&&i===s)return!0;const h=t-this.offsetX,o=i-this.If,l=e-this.offsetX,a=s-this.If,c=ut.index(h,o);if(n===ct.qc.id){if(r===lt.Yc){if(h===l-1&&o===a)return!0;if(h===l&&o===a+1&&(this.flags[c]&ot.Fc)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.kc)===ot.OPEN)return!0}else if(r===lt.Hc){if(h===l&&o===a+1)return!0;if(h===l-1&&o===a&&(this.flags[c]&ot.Dc)===ot.OPEN)return!0;if(h===l+1&&o===a&&(this.flags[c]&ot.Pc)===ot.OPEN)return!0}else if(r===lt.Vc){if(h===l+1&&o===a)return!0;if(h===l&&o===a+1&&(this.flags[c]&ot.Fc)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.kc)===ot.OPEN)return!0}else if(r===lt.Kc){if(h===l&&o===a-1)return!0;if(h===l-1&&o===a&&(this.flags[c]&ot.Dc)===ot.OPEN)return!0;if(h===l+1&&o===a&&(this.flags[c]&ot.Pc)===ot.OPEN)return!0}}else if(n===ct.$c.id){if(r===lt.Yc){if(h===l-1&&o===a)return!0;if(h===l&&o===a+1)return!0;if(h===l+1&&o===a&&(this.flags[c]&ot.Pc)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.kc)===ot.OPEN)return!0}else if(r===lt.Hc){if(h===l-1&&o===a&&(this.flags[c]&ot.Dc)===ot.OPEN)return!0;if(h===l&&o===a+1)return!0;if(h===l+1&&o===a)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.kc)===ot.OPEN)return!0}else if(r===lt.Vc){if(h===l-1&&o===a&&(this.flags[c]&ot.Dc)===ot.OPEN)return!0;if(h===l&&o===a+1&&(this.flags[c]&ot.Fc)===ot.OPEN)return!0;if(h===l+1&&o===a)return!0;if(h===l&&o===a-1)return!0}else if(r===lt.Kc){if(h===l-1&&o===a)return!0;if(h===l&&o===a+1&&(this.flags[c]&ot.Fc)===ot.OPEN)return!0;if(h===l+1&&o===a&&(this.flags[c]&ot.Pc)===ot.OPEN)return!0;if(h===l&&o===a-1)return!0}}else if(n===ct.rf.id){if(h===l&&o===a+1&&(this.flags[c]&ot.yc)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.fc)===ot.OPEN)return!0;if(h===l-1&&o===a&&(this.flags[c]&ot.dc)===ot.OPEN)return!0;if(h===l+1&&o===a&&(this.flags[c]&ot.Ac)===ot.OPEN)return!0}return!1};Lf=(t,i,e,s,n,r)=>{if(t===e&&i===s)return!0;const h=t-this.offsetX,o=i-this.If,l=e-this.offsetX,a=s-this.If,c=ut.index(h,o);if(n===ct.ef.id||n===ct.sf.id){if(n===ct.sf.id&&(r=r+2&3),r===lt.Yc){if(h===l+1&&o===a&&(this.flags[c]&ot.Ac)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.fc)===ot.OPEN)return!0}else if(r===lt.Hc){if(h===l-1&&o===a&&(this.flags[c]&ot.dc)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.fc)===ot.OPEN)return!0}else if(r===lt.Vc){if(h===l-1&&o===a&&(this.flags[c]&ot.dc)===ot.OPEN)return!0;if(h===l&&o===a+1&&(this.flags[c]&ot.yc)===ot.OPEN)return!0}else if(r===lt.Kc){if(h===l+1&&o===a&&(this.flags[c]&ot.Ac)===ot.OPEN)return!0;if(h===l&&o===a+1&&(this.flags[c]&ot.yc)===ot.OPEN)return!0}}else if(n===ct.nf.id){if(h===l&&o===a+1&&(this.flags[c]&ot.yc)===ot.OPEN)return!0;if(h===l&&o===a-1&&(this.flags[c]&ot.fc)===ot.OPEN)return!0;if(h===l-1&&o===a&&(this.flags[c]&ot.dc)===ot.OPEN)return!0;if(h===l+1&&o===a&&(this.flags[c]&ot.Ac)===ot.OPEN)return!0}return!1};Sf=(t,i,e,s,n,r,h)=>{const o=e+n-1,l=s+r-1,a=ut.index(t-this.offsetX,i-this.If);return t>=e&&t<=o&&i>=s&&i<=l||(t===e-1&&i>=s&&i<=l&&(this.flags[a]&ot.dc)===ot.OPEN&&(h&ft.Yc)===ot.OPEN||(t===o+1&&i>=s&&i<=l&&(this.flags[a]&ot.Ac)===ot.OPEN&&(h&ft.Vc)===ot.OPEN||(i===s-1&&t>=e&&t<=o&&(this.flags[a]&ot.fc)===ot.OPEN&&(h&ft.Kc)===ot.OPEN||i===l+1&&t>=e&&t<=o&&(this.flags[a]&ot.yc)===ot.OPEN&&(h&ft.Hc)===ot.OPEN)))};add=(t,i,e)=>{this.flags[ut.index(t,i)]|=e};remove=(t,i,e)=>{this.flags[ut.index(t,i)]&=ot.Gc-e}}class dt{y;x;z;model;Da;info;constructor(t,i,e,s,n,r){this.y=t,this.x=i,this.z=e,this.model=s,this.Da=n,this.info=r}}class wt{y;x;z;xf;Mf;kf;Df;Da;info;constructor(t,i,e,s,n,r,h,o,l){this.y=t,this.x=i,this.z=e,this.xf=s,this.Mf=n,this.kf=r,this.Df=h,this.Da=o,this.info=l}}class yt{y;x;z;type;angle;model;Da;info;constructor(t,i,e,s,n,r,h,o){this.y=t,this.x=i,this.z=e,this.type=s,this.angle=n,this.model=r,this.Da=h,this.info=o}}class mt{y;x;z;Nf;Ff;Bf;Da;offset;constructor(t,i,e,s,n,r,h,o){this.y=t,this.x=i,this.z=e,this.Nf=s,this.Ff=n,this.Bf=r,this.Da=h,this.offset=o}}class pt{Pf;Uf;Wf;Gf;Yf;color;flat;constructor(t,i,e,s,n,r,h){this.Pf=t,this.Uf=i,this.Wf=e,this.Gf=s,this.Yf=n,this.color=r,this.flat=h}}class At{static Hf=new Int32Array(6);static Vf=new Int32Array(6);static Kf=new Int32Array(6);static Xf=new Int32Array(6);static jf=new Int32Array(6);static zf=[Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,2,6),Int8Array.of(1,3,5,7,2,8),Int8Array.of(1,3,5,7,2,8),Int8Array.of(1,3,5,7,11,12),Int8Array.of(1,3,5,7,11,12),Int8Array.of(1,3,5,7,13,14)];static Zf=[Int8Array.of(0,1,2,3,0,0,1,3),Int8Array.of(1,1,2,3,1,0,1,3),Int8Array.of(0,1,2,3,1,0,1,3),Int8Array.of(0,0,1,2,0,0,2,4,1,0,4,3),Int8Array.of(0,0,1,4,0,0,4,3,1,1,2,4),Int8Array.of(0,0,4,3,1,0,1,2,1,0,2,4),Int8Array.of(0,1,2,4,1,0,1,4,1,0,4,3),Int8Array.of(0,4,1,2,0,4,2,5,1,0,4,5,1,0,5,3),Int8Array.of(0,4,1,2,0,4,2,3,0,4,3,5,1,0,4,5),Int8Array.of(0,0,4,5,1,4,1,2,1,4,2,3,1,4,3,5),Int8Array.of(0,0,1,5,0,1,4,5,0,1,2,4,1,0,5,3,1,5,4,3,1,4,2,3),Int8Array.of(1,0,1,5,1,1,4,5,1,1,2,4,0,0,5,3,0,5,4,3,0,4,2,3),Int8Array.of(1,0,5,4,1,0,1,5,0,0,4,3,0,4,5,3,0,5,2,3,0,1,2,5)];static qf=128;static Jf=this.qf/2|0;static $f=this.qf/4|0;static Qf=3*this.qf/4|0;mr;lr;pr;tu;iu;eu;su;nu;ru;hu;flat;shape;angle;ou;lu;constructor(t,i,e,s,n,r,h,o,l,a,c,f,u,d,w,y,m,p,A){this.flat=!(m!==s||m!==d||m!==o),this.shape=i,this.angle=r,this.ou=u,this.lu=l;const _=At.zf[i],g=_.length;this.mr=new Int32Array(g),this.lr=new Int32Array(g),this.pr=new Int32Array(g);const I=new Int32Array(g),C=new Int32Array(g),E=t*At.qf,T=p*At.qf;for(let t=0;t<g;t++){let i,l,c,u,p,g=_[t];!(1&g)&&g<=8&&(g=1+(g-r-r-1&7)),g>8&&g<=12&&(g=9+(g-r-9&3)),g>12&&g<=16&&(g=13+(g-r-13&3)),1===g?(i=E,l=T,c=m,u=h,p=a):2===g?(i=E+At.Jf,l=T,c=m+s>>1,u=h+A>>1,p=a+e>>1):3===g?(i=E+At.qf,l=T,c=s,u=A,p=e):4===g?(i=E+At.qf,l=T+At.Jf,c=s+d>>1,u=A+n>>1,p=e+w>>1):5===g?(i=E+At.qf,l=T+At.qf,c=d,u=n,p=w):6===g?(i=E+At.Jf,l=T+At.qf,c=d+o>>1,u=n+y>>1,p=w+f>>1):7===g?(i=E,l=T+At.qf,c=o,u=y,p=f):8===g?(i=E,l=T+At.Jf,c=o+m>>1,u=y+h>>1,p=f+a>>1):9===g?(i=E+At.Jf,l=T+At.$f,c=m+s>>1,u=h+A>>1,p=a+e>>1):10===g?(i=E+At.Qf,l=T+At.Jf,c=s+d>>1,u=A+n>>1,p=e+w>>1):11===g?(i=E+At.Jf,l=T+At.Qf,c=d+o>>1,u=n+y>>1,p=w+f>>1):12===g?(i=E+At.$f,l=T+At.Jf,c=o+m>>1,u=y+h>>1,p=f+a>>1):13===g?(i=E+At.$f,l=T+At.$f,c=m,u=h,p=a):14===g?(i=E+At.Qf,l=T+At.$f,c=s,u=A,p=e):15===g?(i=E+At.Qf,l=T+At.Qf,c=d,u=n,p=w):(i=E+At.$f,l=T+At.Qf,c=o,u=y,p=f),this.mr[t]=i,this.lr[t]=c,this.pr[t]=l,I[t]=u,C[t]=p}const b=At.Zf[i],O=b.length/4|0;this.su=new Int32Array(O),this.nu=new Int32Array(O),this.ru=new Int32Array(O),this.tu=new Int32Array(O),this.iu=new Int32Array(O),this.eu=new Int32Array(O),this.hu=-1!==c?new Int32Array(O):null;let R=0;for(let t=0;t<O;t++){const i=b[R];let e=b[R+1],s=b[R+2],n=b[R+3];R+=4,e<4&&(e=e-r&3),s<4&&(s=s-r&3),n<4&&(n=n-r&3),this.su[t]=e,this.nu[t]=s,this.ru[t]=n,0===i?(this.tu[t]=I[e],this.iu[t]=I[s],this.eu[t]=I[n],this.hu&&(this.hu[t]=-1)):(this.tu[t]=C[e],this.iu[t]=C[s],this.eu[t]=C[n],this.hu&&(this.hu[t]=c))}}}class _t{static au=0;static cu=1;static fu=2;static uu=3;static du=4;static wu=5;static Jf=6;static $f=7;static Qf=8;static yu=9;static mu=10;static pu=11}class gt{static Au=new x(8,32,51,51,!1);static _u=new v(100,null);static gu=new Int32Array(ut._f);static Iu=new L(ut._f,500,null);static Cu=new v(500,null);static Eu=new b;static Yi=0;static Tu=0;static bu=0;static Ou=0;static Ru=0;static vu=0;static Lu=0;static Su=0;static xu=0;static Mu=0;static ku=0;static Du=0;static Nu=0;static Fu=0;static Bu=0;static Pu=0;static Uu=0;static Wu=0;static Gu=0;static Yu=0;static Hu=0;static Vu=0;static Ku=!1;static Xu=null;static ju=Uint8Array.of(19,55,38,155,255,110,137,205,76);static zu=Uint8Array.of(160,192,80,96,0,144,80,48,160);static Zu=Uint8Array.of(76,8,137,4,0,1,38,2,19);static qu=Int8Array.of(0,0,2,0,0,2,1,1,0);static Ju=Int8Array.of(2,0,0,2,0,0,0,4,4);static $u=Int8Array.of(0,4,4,8,0,0,8,0,0);static Qu=Int8Array.of(1,1,0,0,0,8,0,0,8);static td=Int8Array.of(53,-53,-53,53);static ed=Int8Array.of(-53,-53,53,53);static sd=Int8Array.of(-45,45,45,-45);static nd=Int8Array.of(45,45,-45,-45);static rd=[new Int8Array(16),Int8Array.of(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Int8Array.of(1,0,0,0,1,1,0,0,1,1,1,0,1,1,1,1),Int8Array.of(1,1,0,0,1,1,0,0,1,0,0,0,1,0,0,0),Int8Array.of(0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,1),Int8Array.of(0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1),Int8Array.of(1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1),Int8Array.of(1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0),Int8Array.of(0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0),Int8Array.of(1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1),Int8Array.of(1,1,1,1,1,1,0,0,1,0,0,0,1,0,0,0),Int8Array.of(0,0,0,0,0,0,1,1,0,1,1,1,0,1,1,1),Int8Array.of(0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1)];static hd=[Int8Array.of(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15),Int8Array.of(12,8,4,0,13,9,5,1,14,10,6,2,15,11,7,3),Int8Array.of(15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0),Int8Array.of(3,7,11,15,2,6,10,14,1,5,9,13,0,4,8,12)];static od=Int32Array.of(41,39248,41,4643,41,41,41,41,41,41,41,41,41,41,41,43086,41,41,41,41,41,41,41,8602,41,28992,41,41,41,41,41,5056,41,41,41,41,41,41,41,41,41,41,41,41,41,41,3131,41,41,41);static ld=0;static Xe=0;static je=0;static ad=-1;static fd=-1;static Li=!0;static init=(t,i,e,s,n)=>{this.Tu=0,this.bu=0,this.Ou=t,this.Ru=i,this.vu=t/2|0,this.Lu=i/2|0;const r=new x(9,32,53,53,!1);for(let t=128;t<=384;t+=32)for(let i=0;i<2048;i+=64){this.Su=N.sin[t],this.xu=N.cos[t],this.Mu=N.sin[i],this.ku=N.cos[i];const h=(t-128)/32|0,o=i/64|0;for(let t=-26;t<=26;t++)for(let i=-26;i<=26;i++){const l=128*t,a=128*i;let c=!1;for(let t=-e;t<=s;t+=128)if(this.ud(l,a,n[h]+t)){c=!0;break}r[h][o][t+25+1][i+25+1]=c}}for(let t=0;t<8;t++)for(let i=0;i<32;i++)for(let e=-25;e<25;e++)for(let s=-25;s<25;s++){let n=!1;t:for(let h=-1;h<=1;h++)for(let o=-1;o<=1;o++){if(r[t][i][e+h+25+1][s+o+25+1]){n=!0;break t}if(r[t][(i+1)%31][e+h+25+1][s+o+25+1]){n=!0;break t}if(r[t+1][i][e+h+25+1][s+o+25+1]){n=!0;break t}if(r[t+1][(i+1)%31][e+h+25+1][s+o+25+1]){n=!0;break t}}this.Au[t][i][e+25][s+25]=n}};static zi=()=>{this._u=null,this.gu=null,this.Iu=null,this.Eu=null,this.Au=null,this.Cu=null,this.Xu=null,console.log('World3D unloaded!')};static dd=(t,i,e,s,n,r,h,o)=>{gt.Iu[t][gt.gu[t]++]=new ht(e/128|0,r/128|0,n/128|0,o/128|0,i,e,r,n,o,s,h)};static ud=(t,i,e)=>{const s=i*this.Mu+t*this.ku>>16,n=i*this.ku-t*this.Mu>>16,r=e*this.Su+n*this.xu>>16,h=e*this.xu-n*this.Su>>16;if(r<50||r>3500)return!1;const o=this.vu+((s<<9)/r|0),l=this.Lu+((h<<9)/r|0);return o>=this.Tu&&o<=this.Ou&&l>=this.bu&&l<=this.Ru};wd;ic;sc;yd;md;pd;Ad;_d;gd;Id=0;Cd=0;Ed=0;constructor(t,i,e,s){this.wd=e,this.ic=s,this.sc=i,this.md=new S(e,s,i,null),this.Ad=new D(e,s+1,i+1),this.yd=t,this.pd=new v(5e3,null),this._d=new Int32Array(1e4),this.gd=new Int32Array(1e4),this.reset()}reset=()=>{for(let t=0;t<this.wd;t++)for(let i=0;i<this.ic;i++)for(let e=0;e<this.sc;e++)this.md[t][i][e]=null;for(let t=0;t<ut._f;t++){for(let i=0;i<gt.gu[t];i++)gt.Iu[t][i]=null;gt.gu[t]=0}for(let t=0;t<this.Id;t++)this.pd[t]=null;this.Id=0,gt._u.fill(null)};Td=t=>{this.Cd=t;for(let i=0;i<this.ic;i++)for(let e=0;e<this.sc;e++)this.md[t][i][e]=new rt(t,i,e)};bd=(t,i)=>{const e=this.md[0][t][i];for(let e=0;e<3;e++){this.md[e][t][i]=this.md[e+1][t][i];const s=this.md[e][t][i];s&&s.level--}this.md[0][t][i]||(this.md[0][t][i]=new rt(0,t,i));const s=this.md[0][t][i];s&&(s.Ka=e),this.md[3][t][i]=null};Od=(t,i,e,s)=>{const n=this.md[t][i][e];n&&(n.za=s)};Rd=(t,i,e,s,n,r,h,o,l,a,c,f,u,d,w,y,m,p,A,_)=>{if(s===_t.au){for(let s=t;s>=0;s--)this.md[s][i][e]||(this.md[s][i][e]=new rt(s,i,e));const s=this.md[t][i][e];s&&(s.Ua=new pt(c,f,u,d,-1,A,!1))}else if(s===_t.cu){for(let s=t;s>=0;s--)this.md[s][i][e]||(this.md[s][i][e]=new rt(s,i,e));const s=this.md[t][i][e];s&&(s.Ua=new pt(w,y,m,p,r,_,h===o&&h===l&&h===a))}else{for(let s=t;s>=0;s--)this.md[s][i][e]||(this.md[s][i][e]=new rt(s,i,e));const g=this.md[t][i][e];g&&(g.Wa=new At(i,s,y,o,u,n,c,a,_,w,r,p,A,l,m,d,h,e,f))}};vd=(t,i,e,s,n,r,h)=>{this.md[i][e][s]||(this.md[i][e][s]=new rt(i,e,s));const o=this.md[i][e][s];o&&(o.Ha=new dt(n,128*e+64,128*s+64,t,r,h))};Ld=(t,i,e)=>{const s=this.md[t][i][e];s&&(s.Ha=null)};Sd=(t,i,e,s,n,r,h,o)=>{let l=0;const a=this.md[s][t][i];if(a)for(let t=0;t<a.Xa;t++){const i=a.Ba[t];if(!i||!i.model)continue;const e=i.model.jr;e>l&&(l=e)}else this.md[s][t][i]=new rt(s,t,i);const c=this.md[s][t][i];c&&(c.Va=new mt(e,128*t+64,128*i+64,r,h,o,n,l))};xd=(t,i,e)=>{const s=this.md[t][i][e];s&&(s.Va=null)};Of=(t,i,e,s,n,r,h,o,l,a)=>{if(!h&&!o)return;for(let s=t;s>=0;s--)this.md[s][i][e]||(this.md[s][i][e]=new rt(s,i,e));const c=this.md[t][i][e];c&&(c.Ga=new wt(s,128*i+64,128*e+64,n,r,h,o,l,a))};Rf=(t,i,e,s)=>{const n=this.md[t][i][e];1===s&&n&&(n.Ga=null)};Md=(t,i,e,s,n,r,h,o,l,a,c)=>{if(!o)return;for(let s=t;s>=0;s--)this.md[s][i][e]||(this.md[s][i][e]=new rt(s,i,e));const f=this.md[t][i][e];f&&(f.Ya=new yt(s,128*i+n+64,128*e+r+64,c,a,o,h,l))};kd=(t,i,e)=>{const s=this.md[t][i][e];s&&(s.Ya=null)};Dd=(t,i,e,s)=>{const n=this.md[t][i][e];if(!n)return;const r=n.Ya;if(!r)return;const h=128*i+64,o=128*e+64;r.x=h+((r.x-h)*s/16|0),r.z=o+((r.z-o)*s/16|0)};Nd=(t,i,e,s)=>{if(!s)return;const n=this.md[t][i][e];if(!n)return;const r=n.Ya;r&&(r.model=s)};Fd=(t,i,e,s)=>{if(!s)return;const n=this.md[t][i][e];if(!n)return;const r=n.Ha;r&&(r.model=s)};Bd=(t,i,e,s)=>{if(!s)return;const n=this.md[t][i][e];if(!n)return;const r=n.Ga;r&&(r.kf=s)};Pd=(t,i,e,s,n)=>{if(!s)return;const r=this.md[e][t][i];if(!r)return;const h=r.Ga;h&&(h.kf=s,h.Df=n)};Tf=(t,i,e,s,n,r,h,o,l,a,c)=>{if(!n&&!r)return!0;const f=128*i+64*l,u=128*e+64*a;return this.Ud(f,u,s,t,i,e,l,a,n,r,h,o,c,!1)};Wd=(t,i,e,s,n,r,h,o,l,a)=>{if(!n&&!r)return!0;let c=i-l,f=s-l,u=i+l,d=s+l;return a&&(o>640&&o<1408&&(d+=128),o>1152&&o<1920&&(u+=128),(o>1664||o<384)&&(f-=128),o>128&&o<896&&(c-=128)),c=c/128|0,f=f/128|0,u=u/128|0,d=d/128|0,this.Ud(i,s,e,t,c,f,u+1-c,d-f+1,n,r,h,0,o,!0)};Gd=(t,i,e,s,n,r,h,o,l,a,c,f)=>!l&&!a||this.Ud(i,s,e,t,n,r,h+1-n,o-r+1,l,a,c,0,f,!0);bf=(t,i,e)=>{const s=this.md[t][i][e];if(s)for(let t=0;t<s.Xa;t++){const n=s.Ba[t];if(n&&2==(n.Da>>29&3)&&n.Sa===i&&n.Ma===e)return void this.Yd(n)}};Hd=(t,i,e,s)=>{if(!s)return;const n=this.md[t][i][e];if(n)for(let t=0;t<n.Xa;t++){const i=n.Ba[t];if(i&&2==(i.Da>>29&3))return void(i.model=s)}};Vd=()=>{for(let t=0;t<this.Id;t++){const i=this.pd[t];i&&this.Yd(i),this.pd[t]=null}this.Id=0};Kd=(t,i,e)=>{const s=this.md[t][i][e];return s&&s.Ga?s.Ga.Da:0};Xd=(t,i,e)=>{const s=this.md[t][e][i];return s&&s.Ya?s.Ya.Da:0};jd=(t,i,e)=>{const s=this.md[t][i][e];if(!s)return 0;for(let t=0;t<s.Xa;t++){const n=s.Ba[t];if(n&&2==(n.Da>>29&3)&&n.Sa===i&&n.Ma===e)return n.Da}return 0};zd=(t,i,e)=>{const s=this.md[t][i][e];return s&&s.Ha?s.Ha.Da:0};Zd=(t,i,e,s)=>{const n=this.md[t][i][e];if(n){if(n.Ga&&n.Ga.Da===s)return 255&n.Ga.info;if(n.Ya&&n.Ya.Da===s)return 255&n.Ya.info;if(n.Ha&&n.Ha.Da===s)return 255&n.Ha.info;for(let t=0;t<n.Xa;t++){const i=n.Ba[t];if(i&&i.Da===s)return 255&i.info}return-1}return-1};qd=(t,i,e,s,n)=>{const r=i*(0|Math.sqrt(e*e+s*s+n*n))>>8;for(let i=0;i<this.wd;i++)for(let h=0;h<this.ic;h++)for(let o=0;o<this.sc;o++){const l=this.md[i][h][o];if(!l)continue;const a=l.Ga;a&&a.kf&&a.kf.wr&&(this.Jd(i,h,o,1,1,a.kf),a.Df&&a.Df.wr&&(this.Jd(i,h,o,1,1,a.Df),this.$d(a.kf,a.Df,0,0,0,!1),a.Df.oh(t,r,e,s,n)),a.kf.oh(t,r,e,s,n));for(let a=0;a<l.Xa;a++){const c=l.Ba[a];c&&c.model&&c.model.wr&&(this.Jd(i,h,o,c.xa+1-c.Sa,c.ka-c.Ma+1,c.model),c.model.oh(t,r,e,s,n))}const c=l.Ha;c&&c.model&&c.model.wr&&(this.Qd(i,h,o,c.model),c.model.oh(t,r,e,s,n))}};Qd=(t,i,e,s)=>{if(i<this.ic){const n=this.md[t][i+1][e];n&&n.Ha&&n.Ha.model&&n.Ha.model.wr&&this.$d(s,n.Ha.model,128,0,0,!0)}if(e<this.ic){const n=this.md[t][i][e+1];n&&n.Ha&&n.Ha.model&&n.Ha.model.wr&&this.$d(s,n.Ha.model,0,0,128,!0)}if(i<this.ic&&e<this.sc){const n=this.md[t][i+1][e+1];n&&n.Ha&&n.Ha.model&&n.Ha.model.wr&&this.$d(s,n.Ha.model,128,0,128,!0)}if(i<this.ic&&e>0){const n=this.md[t][i+1][e-1];n&&n.Ha&&n.Ha.model&&n.Ha.model.wr&&this.$d(s,n.Ha.model,128,0,-128,!0)}};Jd=(t,i,e,s,n,r)=>{let h=!0,o=i;const l=i+s,a=e-1,c=e+n;for(let f=t;f<=t+1;f++)if(f!==this.wd){for(let u=o;u<=l;u++)if(!(u<0||u>=this.ic))for(let o=a;o<=c;o++){if(o<0||o>=this.sc||h&&u<l&&o<c&&(o>=e||u===i))continue;const a=this.md[f][u][o];if(!a)continue;const d=128*(u-i)+64*(1-s),w=128*(o-e)+64*(1-n),y=((this.yd[f][u][o]+this.yd[f][u+1][o]+this.yd[f][u][o+1]+this.yd[f][u+1][o+1])/4|0)-((this.yd[t][i][e]+this.yd[t][i+1][e]+this.yd[t][i][e+1]+this.yd[t][i+1][e+1])/4|0),m=a.Ga;m&&m.kf&&m.kf.wr&&this.$d(r,m.kf,d,y,w,h),m&&m.Df&&m.Df.wr&&this.$d(r,m.Df,d,y,w,h);for(let t=0;t<a.Xa;t++){const o=a.Ba[t];if(!o||!o.model||!o.model.wr)continue;const l=o.xa+1-o.Sa,c=o.ka+1-o.Ma;this.$d(r,o.model,128*(o.Sa-i)+64*(l-s),y,128*(o.Ma-e)+64*(c-n),h)}}o--,h=!1}};$d=(t,i,e,s,n,r)=>{this.Ed++;let h=0;const o=i.mr,l=i.nn;if(t.wr&&t.yr)for(let r=0;r<t.nn;r++){const a=t.wr[r],c=t.yr[r];if(c&&0!==c.w){const f=t.lr[r]-s;if(f>i.kr)continue;const u=t.mr[r]-e;if(u<i.Rr||u>i.vr)continue;const d=t.pr[r]-n;if(d<i.Lr||d>i.Sr)continue;if(i.wr&&i.yr)for(let t=0;t<l;t++){const e=i.wr[t],s=i.yr[t];u!==o[t]||d!==i.pr[t]||f!==i.lr[t]||s&&0===s.w||(a&&e&&s&&(a.x+=s.x,a.y+=s.y,a.z+=s.z,a.w+=s.w,e.x+=c.x,e.y+=c.y,e.z+=c.z,e.w+=c.w,h++),this._d[r]=this.Ed,this.gd[t]=this.Ed)}}}if(!(h<3)&&r){if(t.dr)for(let i=0;i<t.rn;i++)this._d[t.Ar[i]]===this.Ed&&this._d[t._r[i]]===this.Ed&&this._d[t.gr[i]]===this.Ed&&(t.dr[i]=-1);if(i.dr)for(let t=0;t<i.rn;t++)this.gd[i.Ar[t]]===this.Ed&&this.gd[i._r[t]]===this.Ed&&this.gd[i.gr[t]]===this.Ed&&(i.dr[t]=-1)}};tw=(t,i,e,s,n,r)=>{const h=this.md[t][i][e];if(!h)return;const o=h.Ua;if(o){const t=o.color;if(0!==t)for(let i=0;i<4;i++)s[n]=t,s[n+1]=t,s[n+2]=t,s[n+3]=t,n+=r;return}const l=h.Wa;if(!l)return;const a=l.shape,c=l.angle,f=l.ou,u=l.lu,d=gt.rd[a],w=gt.hd[c];let y=0;if(0===f)for(let t=0;t<4;t++)0!==d[w[y++]]&&(s[n]=u),0!==d[w[y++]]&&(s[n+1]=u),0!==d[w[y++]]&&(s[n+2]=u),0!==d[w[y++]]&&(s[n+3]=u),n+=r;else for(let t=0;t<4;t++)s[n]=0===d[w[y++]]?f:u,s[n+1]=0===d[w[y++]]?f:u,s[n+2]=0===d[w[y++]]?f:u,s[n+3]=0===d[w[y++]]?f:u,n+=r};click=(t,i)=>{gt.Ku=!0,gt.Xe=t,gt.je=i,gt.ad=-1,gt.fd=-1};draw=(t,i,e,s,n,r,h)=>{t<0?t=0:t>=128*this.ic&&(t=128*this.ic-1),e<0?e=0:e>=128*this.sc&&(e=128*this.sc-1),gt.Yi++,gt.Su=N.sin[r],gt.xu=N.cos[r],gt.Mu=N.sin[n],gt.ku=N.cos[n],gt.Xu=gt.Au[(r-128)/32|0][n/64|0],gt.Du=t,gt.Nu=i,gt.Fu=e,gt.Bu=t/128|0,gt.Pu=e/128|0,gt.Hu=s,gt.Uu=gt.Bu-25,gt.Uu<0&&(gt.Uu=0),gt.Gu=gt.Pu-25,gt.Gu<0&&(gt.Gu=0),gt.Wu=gt.Bu+25,gt.Wu>this.ic&&(gt.Wu=this.ic),gt.Yu=gt.Pu+25,gt.Yu>this.sc&&(gt.Yu=this.sc),this.iw(),gt.Vu=0;for(let t=this.Cd;t<this.wd;t++){const e=this.md[t];for(let n=gt.Uu;n<gt.Wu;n++)for(let r=gt.Gu;r<gt.Yu;r++){const h=e[n][r];h&&(h.za<=s&&(gt.Xu[n+25-gt.Bu][r+25-gt.Pu]||this.yd[t][n][r]-i>=2e3)?(h.visible=!0,h.update=!0,h.Za=h.Xa>0,gt.Vu++):(h.visible=!1,h.update=!1,h.qa=0))}}for(let t=this.Cd;t<this.wd;t++){const i=this.md[t];for(let t=-25;t<=0;t++){const e=gt.Bu+t,s=gt.Bu-t;if(!(e<gt.Uu&&s>=gt.Wu))for(let t=-25;t<=0;t++){const n=gt.Pu+t,r=gt.Pu-t;let o;if(e>=gt.Uu&&(n>=gt.Gu&&(o=i[e][n],o&&o.visible&&this.ew(o,!0,h)),r<gt.Yu&&(o=i[e][r],o&&o.visible&&this.ew(o,!0,h))),s<gt.Wu&&(n>=gt.Gu&&(o=i[s][n],o&&o.visible&&this.ew(o,!0,h)),r<gt.Yu&&(o=i[s][r],o&&o.visible&&this.ew(o,!0,h))),0===gt.Vu)return void(gt.Ku=!1)}}}for(let t=this.Cd;t<this.wd;t++){const i=this.md[t];for(let t=-25;t<=0;t++){const e=gt.Bu+t,s=gt.Bu-t;if(!(e<gt.Uu&&s>=gt.Wu))for(let t=-25;t<=0;t++){const n=gt.Pu+t,r=gt.Pu-t;let o;if(e>=gt.Uu&&(n>=gt.Gu&&(o=i[e][n],o&&o.visible&&this.ew(o,!1,h)),r<gt.Yu&&(o=i[e][r],o&&o.visible&&this.ew(o,!1,h))),s<gt.Wu&&(n>=gt.Gu&&(o=i[s][n],o&&o.visible&&this.ew(o,!1,h)),r<gt.Yu&&(o=i[s][r],o&&o.visible&&this.ew(o,!1,h))),0===gt.Vu)return void(gt.Ku=!1)}}}};Ud=(t,i,e,s,n,r,h,o,l,a,c,f,u,d)=>{if(!l&&!a)return!1;for(let t=n;t<n+h;t++)for(let i=r;i<r+o;i++){if(t<0||i<0||t>=this.ic||i>=this.sc)return!1;const e=this.md[s][t][i];if(e&&e.Xa>=5)return!1}const w=new nt(s,e,t,i,l,a,u,n,n+h-1,r,r+o-1,c,f);for(let t=n;t<n+h;t++)for(let i=r;i<r+o;i++){let e=0;t>n&&(e|=1),t<n+h-1&&(e+=4),i>r&&(e+=8),i<r+o-1&&(e+=2);for(let e=s;e>=0;e--)this.md[e][t][i]||(this.md[e][t][i]=new rt(e,t,i));const l=this.md[s][t][i];l&&(l.Ba[l.Xa]=w,l.Pa[l.Xa]=e,l.ja|=e,l.Xa++)}return d&&(this.pd[this.Id++]=w),!0};Yd=t=>{for(let i=t.Sa;i<=t.xa;i++)for(let e=t.Ma;e<=t.ka;e++){const s=this.md[t.level][i][e];if(s){for(let i=0;i<s.Xa;i++)if(s.Ba[i]===t){s.Xa--;for(let t=i;t<s.Xa;t++)s.Ba[t]=s.Ba[t+1],s.Pa[t]=s.Pa[t+1];s.Ba[s.Xa]=null;break}s.ja=0;for(let t=0;t<s.Xa;t++)s.ja|=s.Pa[t]}}};iw=()=>{const t=gt.gu[gt.Hu],i=gt.Iu[gt.Hu];gt.ld=0;for(let e=0;e<t;e++){const t=i[e];if(!t)continue;let s,n,r,h;if(1===t.type){if(s=t.tc+25-gt.Bu,s>=0&&s<=50){n=t.ec+25-gt.Pu,n<0&&(n=0),r=t.sc+25-gt.Pu,r>50&&(r=50);let i=!1;for(;n<=r;)if(gt.Xu&&gt.Xu[s][n++]){i=!0;break}if(i){if(h=gt.Du-t.Rr,h>32)t.mode=1;else{if(h>=-32)continue;t.mode=2,h=-h}t.hc=(t.Lr-gt.Fu<<8)/h|0,t.oc=(t.Sr-gt.Fu<<8)/h|0,t.lc=(t.kr-gt.Nu<<8)/h|0,t.ac=(t.Dr-gt.Nu<<8)/h|0,gt.Cu[gt.ld++]=t}}}else if(2===t.type){if(s=t.ec+25-gt.Pu,s>=0&&s<=50){n=t.tc+25-gt.Bu,n<0&&(n=0),r=t.ic+25-gt.Bu,r>50&&(r=50);let i=!1;for(;n<=r;)if(gt.Xu&&gt.Xu[n++][s]){i=!0;break}if(i){if(h=gt.Fu-t.Lr,h>32)t.mode=3;else{if(h>=-32)continue;t.mode=4,h=-h}t.nc=(t.Rr-gt.Du<<8)/h|0,t.rc=(t.vr-gt.Du<<8)/h|0,t.lc=(t.kr-gt.Nu<<8)/h|0,t.ac=(t.Dr-gt.Nu<<8)/h|0,gt.Cu[gt.ld++]=t}}}else if(4===t.type&&(s=t.kr-gt.Nu,s>128&&(n=t.ec+25-gt.Pu,n<0&&(n=0),r=t.sc+25-gt.Pu,r>50&&(r=50),n<=r))){let i=t.tc+25-gt.Bu;i<0&&(i=0),h=t.ic+25-gt.Bu,h>50&&(h=50);let e=!1;t:for(let t=i;t<=h;t++)for(let i=n;i<=r;i++)if(gt.Xu&&gt.Xu[t][i]){e=!0;break t}e&&(t.mode=5,t.nc=(t.Rr-gt.Du<<8)/s|0,t.rc=(t.vr-gt.Du<<8)/s|0,t.hc=(t.Lr-gt.Fu<<8)/s|0,t.oc=(t.Sr-gt.Fu<<8)/s|0,gt.Cu[gt.ld++]=t)}}};ew=(t,i,e)=>{for(gt.Eu.Mt(t);;){let t;do{if(t=gt.Eu.Dt(),!t)return}while(!t.update);const s=t.x,n=t.z,r=t.level,h=t.Fa,o=this.md[r];if(t.visible){if(i){if(r>0){const t=this.md[r-1][s][n];if(t&&t.update)continue}if(s<=gt.Bu&&s>gt.Uu){const i=o[s-1][n];if(i&&i.update&&(i.visible||!(1&t.ja)))continue}if(s>=gt.Bu&&s<gt.Wu-1){const i=o[s+1][n];if(i&&i.update&&(i.visible||!(4&t.ja)))continue}if(n<=gt.Pu&&n>gt.Gu){const i=o[s][n-1];if(i&&i.update&&(i.visible||!(8&t.ja)))continue}if(n>=gt.Pu&&n<gt.Yu-1){const i=o[s][n+1];if(i&&i.update&&(i.visible||!(2&t.ja)))continue}}else i=!0;if(t.visible=!1,t.Ka){const i=t.Ka;i.Ua?this.sw(0,s,n)||this.nw(i.Ua,0,s,n,gt.Su,gt.xu,gt.Mu,gt.ku):i.Wa&&!this.sw(0,s,n)&&this.rw(s,n,i.Wa,gt.Su,gt.xu,gt.Mu,gt.ku);const r=i.Ga;r&&r.kf?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,r.x-gt.Du,r.y-gt.Nu,r.z-gt.Fu,r.Da);for(let t=0;t<i.Xa;t++){const s=i.Ba[t];if(s){let t=s.model;t||(t=s.va?.draw(e)??null),t?.draw(s.La,gt.Su,gt.xu,gt.Mu,gt.ku,s.x-gt.Du,s.y-gt.Nu,s.z-gt.Fu,s.Da)}}}let l=!1;t.Ua?this.sw(h,s,n)||(l=!0,this.nw(t.Ua,h,s,n,gt.Su,gt.xu,gt.Mu,gt.ku)):t.Wa&&!this.sw(h,s,n)&&(l=!0,this.rw(s,n,t.Wa,gt.Su,gt.xu,gt.Mu,gt.ku));let a=0,c=0;const f=t.Ga,u=t.Ya;if((f||u)&&(gt.Bu===s?a+=1:gt.Bu<s&&(a+=2),gt.Pu===n?a+=3:gt.Pu>n&&(a+=6),c=gt.ju[a],t.Qa=gt.Zu[a]),f&&(f.xf&gt.zu[a]?16===f.xf?(t.qa=3,t.Ja=gt.qu[a],t.$a=3-t.Ja):32===f.xf?(t.qa=6,t.Ja=gt.Ju[a],t.$a=6-t.Ja):64===f.xf?(t.qa=12,t.Ja=gt.$u[a],t.$a=12-t.Ja):(t.qa=9,t.Ja=gt.Qu[a],t.$a=9-t.Ja):t.qa=0,f.xf&c&&!this.hw(h,s,n,f.xf)&&f.kf?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,f.x-gt.Du,f.y-gt.Nu,f.z-gt.Fu,f.Da),f.Mf&c&&!this.hw(h,s,n,f.Mf)&&f.Df?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,f.x-gt.Du,f.y-gt.Nu,f.z-gt.Fu,f.Da)),u&&!this.visible(h,s,n,u.model.Dr))if(u.type&c)u.model.draw(u.angle,gt.Su,gt.xu,gt.Mu,gt.ku,u.x-gt.Du,u.y-gt.Nu,u.z-gt.Fu,u.Da);else if(768&u.type){const t=u.x-gt.Du,i=u.y-gt.Nu,e=u.z-gt.Fu,s=u.angle;let n,r;if(n=s===lt.Hc||s===lt.Vc?-t:t,r=s===lt.Vc||s===lt.Kc?-e:e,256&u.type&&r<n){const n=t+gt.td[s],r=e+gt.ed[s];u.model.draw(512*s+256,gt.Su,gt.xu,gt.Mu,gt.ku,n,i,r,u.Da)}if(512&u.type&&r>n){const n=t+gt.sd[s],r=e+gt.nd[s];u.model.draw(512*s+1280&2047,gt.Su,gt.xu,gt.Mu,gt.ku,n,i,r,u.Da)}}if(l){const i=t.Ha;i&&i.model?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,i.x-gt.Du,i.y-gt.Nu,i.z-gt.Fu,i.Da);const e=t.Va;e&&0===e.offset&&(e.Bf&&e.Bf.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,e.x-gt.Du,e.y-gt.Nu,e.z-gt.Fu,e.Da),e.Ff&&e.Ff.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,e.x-gt.Du,e.y-gt.Nu,e.z-gt.Fu,e.Da),e.Nf&&e.Nf.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,e.x-gt.Du,e.y-gt.Nu,e.z-gt.Fu,e.Da))}const d=t.ja;if(0!==d){if(s<gt.Bu&&4&d){const t=o[s+1][n];t&&t.update&&gt.Eu.Mt(t)}if(n<gt.Pu&&2&d){const t=o[s][n+1];t&&t.update&&gt.Eu.Mt(t)}if(s>gt.Bu&&1&d){const t=o[s-1][n];t&&t.update&&gt.Eu.Mt(t)}if(n>gt.Pu&&8&d){const t=o[s][n-1];t&&t.update&&gt.Eu.Mt(t)}}}if(0!==t.qa){let i=!0;for(let e=0;e<t.Xa;e++){const s=t.Ba[e];if(s&&(s.Yi!==gt.Yi&&(t.Pa[e]&t.qa)===t.Ja)){i=!1;break}}if(i){const i=t.Ga;i&&!this.hw(h,s,n,i.xf)&&i.kf?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,i.x-gt.Du,i.y-gt.Nu,i.z-gt.Fu,i.Da),t.qa=0}}if(t.Za){const i=t.Xa;t.Za=!1;let r=0;t:for(let e=0;e<i;e++){const i=t.Ba[e];if(!i||i.Yi===gt.Yi)continue;for(let e=i.Sa;e<=i.xa;e++)for(let s=i.Ma;s<=i.ka;s++){const n=o[e][s];if(n){if(!n.visible){if(0===n.qa)continue;let r=0;if(e>i.Sa&&(r+=1),e<i.xa&&(r+=4),s>i.Ma&&(r+=8),s<i.ka&&(r+=2),(r&n.qa)!==t.$a)continue}t.Za=!0;continue t}}gt._u[r++]=i;let s=gt.Bu-i.Sa;const n=i.xa-gt.Bu;n>s&&(s=n);const h=gt.Pu-i.Ma,l=i.ka-gt.Pu;i.Na=l>h?s+l:s+h}for(;;){let t=-50,i=-1;for(let e=0;e<r;e++){const s=gt._u[e];s&&(s.Yi!==gt.Yi&&s.Na>t&&(t=s.Na,i=e))}if(-1===i)break;const l=gt._u[i];if(l){l.Yi=gt.Yi;let t=l.model;t||(t=l.va?.draw(e)??null),t&&!this.ow(h,l.Sa,l.xa,l.Ma,l.ka,t.Dr)&&t.draw(l.La,gt.Su,gt.xu,gt.Mu,gt.ku,l.x-gt.Du,l.y-gt.Nu,l.z-gt.Fu,l.Da);for(let t=l.Sa;t<=l.xa;t++)for(let i=l.Ma;i<=l.ka;i++){const e=o[t][i];e&&(0!==e.qa?gt.Eu.Mt(e):t===s&&i===n||!e.update||gt.Eu.Mt(e))}}}if(t.Za)continue}if(!t.update||0!==t.qa)continue;if(s<=gt.Bu&&s>gt.Uu){const t=o[s-1][n];if(t&&t.update)continue}if(s>=gt.Bu&&s<gt.Wu-1){const t=o[s+1][n];if(t&&t.update)continue}if(n<=gt.Pu&&n>gt.Gu){const t=o[s][n-1];if(t&&t.update)continue}if(n>=gt.Pu&&n<gt.Yu-1){const t=o[s][n+1];if(t&&t.update)continue}t.update=!1,gt.Vu--;const l=t.Va;if(l&&0!==l.offset&&(l.Bf&&l.Bf.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,l.x-gt.Du,l.y-gt.Nu-l.offset,l.z-gt.Fu,l.Da),l.Ff&&l.Ff.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,l.x-gt.Du,l.y-gt.Nu-l.offset,l.z-gt.Fu,l.Da),l.Nf&&l.Nf.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,l.x-gt.Du,l.y-gt.Nu-l.offset,l.z-gt.Fu,l.Da)),0!==t.Qa){const i=t.Ya;if(i&&!this.visible(h,s,n,i.model.Dr))if(i.type&t.Qa)i.model.draw(i.angle,gt.Su,gt.xu,gt.Mu,gt.ku,i.x-gt.Du,i.y-gt.Nu,i.z-gt.Fu,i.Da);else if(768&i.type){const t=i.x-gt.Du,e=i.y-gt.Nu,s=i.z-gt.Fu,n=i.angle;let r,h;if(r=n===lt.Hc||n===lt.Vc?-t:t,h=n===lt.Vc||n===lt.Kc?-s:s,256&i.type&&h>=r){const r=t+gt.td[n],h=s+gt.ed[n];i.model.draw(512*n+256,gt.Su,gt.xu,gt.Mu,gt.ku,r,e,h,i.Da)}if(512&i.type&&h<=r){const r=t+gt.sd[n],h=s+gt.nd[n];i.model.draw(512*n+1280&2047,gt.Su,gt.xu,gt.Mu,gt.ku,r,e,h,i.Da)}}const e=t.Ga;e&&(e.Mf&t.Qa&&!this.hw(h,s,n,e.Mf)&&e.Df?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,e.x-gt.Du,e.y-gt.Nu,e.z-gt.Fu,e.Da),e.xf&t.Qa&&!this.hw(h,s,n,e.xf)&&e.kf?.draw(0,gt.Su,gt.xu,gt.Mu,gt.ku,e.x-gt.Du,e.y-gt.Nu,e.z-gt.Fu,e.Da))}if(r<this.wd-1){const t=this.md[r+1][s][n];t&&t.update&&gt.Eu.Mt(t)}if(s<gt.Bu){const t=o[s+1][n];t&&t.update&&gt.Eu.Mt(t)}if(n<gt.Pu){const t=o[s][n+1];t&&t.update&&gt.Eu.Mt(t)}if(s>gt.Bu){const t=o[s-1][n];t&&t.update&&gt.Eu.Mt(t)}if(n>gt.Pu){const t=o[s][n-1];t&&t.update&&gt.Eu.Mt(t)}}};nw=(t,i,e,s,n,r,h,o)=>{let l,a,c,f,u=l=(e<<7)-gt.Du,d=a=(s<<7)-gt.Fu,w=c=u+128,y=f=d+128,p=this.yd[i][e][s]-gt.Nu,A=this.yd[i][e+1][s]-gt.Nu,_=this.yd[i][e+1][s+1]-gt.Nu,g=this.yd[i][e][s+1]-gt.Nu,I=d*h+u*o>>16;if(d=d*o-u*h>>16,u=I,I=p*r-d*n>>16,d=p*n+d*r>>16,p=I,d<50)return;if(I=a*h+w*o>>16,a=a*o-w*h>>16,w=I,I=A*r-a*n>>16,a=A*n+a*r>>16,A=I,a<50)return;if(I=y*h+c*o>>16,y=y*o-c*h>>16,c=I,I=_*r-y*n>>16,y=_*n+y*r>>16,_=I,y<50)return;if(I=f*h+l*o>>16,f=f*o-l*h>>16,l=I,I=g*r-f*n>>16,f=g*n+f*r>>16,g=I,f<50)return;const C=N.Ni+((u<<9)/d|0),E=N.Fi+((p<<9)/d|0),T=N.Ni+((w<<9)/a|0),b=N.Fi+((A<<9)/a|0),O=N.Ni+((c<<9)/y|0),R=N.Fi+((_<<9)/y|0),v=N.Ni+((l<<9)/f|0),L=N.Fi+((g<<9)/f|0);if(N.alpha=0,(O-v)*(b-L)-(R-L)*(T-v)>0)if(N.Pi=O<0||v<0||T<0||O>m.wt||v>m.wt||T>m.wt,gt.Ku&&this.lw(gt.Xe,gt.je,R,L,b,O,v,T)&&(gt.ad=e,gt.fd=s),-1===t.Yf)12345678!==t.Wf&&N.ne(O,v,T,R,L,b,t.Wf,t.Gf,t.Uf);else if(gt.Li){const i=gt.od[t.Yf];N.ne(O,v,T,R,L,b,this.aw(i,t.Wf),this.aw(i,t.Gf),this.aw(i,t.Uf))}else t.flat?N.le(O,v,T,R,L,b,t.Wf,t.Gf,t.Uf,u,p,d,w,l,A,g,a,f,t.Yf):N.le(O,v,T,R,L,b,t.Wf,t.Gf,t.Uf,c,_,y,l,w,g,A,f,a,t.Yf);if(!((C-T)*(L-b)-(E-b)*(v-T)<=0))if(N.Pi=C<0||T<0||v<0||C>m.wt||T>m.wt||v>m.wt,gt.Ku&&this.lw(gt.Xe,gt.je,E,b,L,C,T,v)&&(gt.ad=e,gt.fd=s),-1!==t.Yf){if(!gt.Li)return void N.le(C,T,v,E,b,L,t.Pf,t.Uf,t.Gf,u,p,d,w,l,A,g,a,f,t.Yf);const i=gt.od[t.Yf];N.ne(C,T,v,E,b,L,this.aw(i,t.Pf),this.aw(i,t.Uf),this.aw(i,t.Gf))}else 12345678!==t.Pf&&N.ne(C,T,v,E,b,L,t.Pf,t.Uf,t.Gf)};rw=(t,i,e,s,n,r,h)=>{let o=e.mr.length;for(let t=0;t<o;t++){let i=e.mr[t]-gt.Du,o=e.lr[t]-gt.Nu,l=e.pr[t]-gt.Fu,a=l*r+i*h>>16;if(l=l*h-i*r>>16,i=a,a=o*n-l*s>>16,l=o*s+l*n>>16,o=a,l<50)return;e.hu&&(At.Kf[t]=i,At.Xf[t]=o,At.jf[t]=l),At.Hf[t]=N.Ni+((i<<9)/l|0),At.Vf[t]=N.Fi+((o<<9)/l|0)}N.alpha=0,o=e.su.length;for(let s=0;s<o;s++){const n=e.su[s],r=e.nu[s],h=e.ru[s],o=At.Hf[n],l=At.Hf[r],a=At.Hf[h],c=At.Vf[n],f=At.Vf[r],u=At.Vf[h];if((o-l)*(u-f)-(c-f)*(a-l)>0)if(N.Pi=o<0||l<0||a<0||o>m.wt||l>m.wt||a>m.wt,gt.Ku&&this.lw(gt.Xe,gt.je,c,f,u,o,l,a)&&(gt.ad=t,gt.fd=i),e.hu&&-1!==e.hu[s])if(gt.Li){const t=gt.od[e.hu[s]];N.ne(o,l,a,c,f,u,this.aw(t,e.tu[s]),this.aw(t,e.iu[s]),this.aw(t,e.eu[s]))}else e.flat?N.le(o,l,a,c,f,u,e.tu[s],e.iu[s],e.eu[s],At.Kf[0],At.Xf[0],At.jf[0],At.Kf[1],At.Kf[3],At.Xf[1],At.Xf[3],At.jf[1],At.jf[3],e.hu[s]):N.le(o,l,a,c,f,u,e.tu[s],e.iu[s],e.eu[s],At.Kf[n],At.Xf[n],At.jf[n],At.Kf[r],At.Kf[h],At.Xf[r],At.Xf[h],At.jf[r],At.jf[h],e.hu[s]);else 12345678!==e.tu[s]&&N.ne(o,l,a,c,f,u,e.tu[s],e.iu[s],e.eu[s])}};sw=(t,i,e)=>{const s=this.Ad[t][i][e];if(s===-gt.Yi)return!1;if(s===gt.Yi)return!0;{const s=i<<7,n=e<<7;return this.cw(s+1,this.yd[t][i][e],n+1)&&this.cw(s+128-1,this.yd[t][i+1][e],n+1)&&this.cw(s+128-1,this.yd[t][i+1][e+1],n+128-1)&&this.cw(s+1,this.yd[t][i][e+1],n+128-1)?(this.Ad[t][i][e]=gt.Yi,!0):(this.Ad[t][i][e]=-gt.Yi,!1)}};hw=(t,i,e,s)=>{if(!this.sw(t,i,e))return!1;const n=i<<7,r=e<<7,h=this.yd[t][i][e]-1,o=h-120,l=h-230,a=h-238;if(s<16){if(1===s){if(n>gt.Du){if(!this.cw(n,h,r))return!1;if(!this.cw(n,h,r+128))return!1}if(t>0){if(!this.cw(n,o,r))return!1;if(!this.cw(n,o,r+128))return!1}return!!this.cw(n,l,r)&&this.cw(n,l,r+128)}if(2===s){if(r<gt.Fu){if(!this.cw(n,h,r+128))return!1;if(!this.cw(n+128,h,r+128))return!1}if(t>0){if(!this.cw(n,o,r+128))return!1;if(!this.cw(n+128,o,r+128))return!1}return!!this.cw(n,l,r+128)&&this.cw(n+128,l,r+128)}if(4===s){if(n<gt.Du){if(!this.cw(n+128,h,r))return!1;if(!this.cw(n+128,h,r+128))return!1}if(t>0){if(!this.cw(n+128,o,r))return!1;if(!this.cw(n+128,o,r+128))return!1}return!!this.cw(n+128,l,r)&&this.cw(n+128,l,r+128)}if(8===s){if(r>gt.Fu){if(!this.cw(n,h,r))return!1;if(!this.cw(n+128,h,r))return!1}if(t>0){if(!this.cw(n,o,r))return!1;if(!this.cw(n+128,o,r))return!1}return!!this.cw(n,l,r)&&this.cw(n+128,l,r)}}return!!this.cw(n+64,a,r+64)&&(16===s?this.cw(n,l,r+128):32===s?this.cw(n+128,l,r+128):64===s?this.cw(n+128,l,r):128===s?this.cw(n,l,r):(console.warn('Warning unsupported wall type!'),!0))};visible=(t,i,e,s)=>{if(this.sw(t,i,e)){const n=i<<7,r=e<<7;return this.cw(n+1,this.yd[t][i][e]-s,r+1)&&this.cw(n+128-1,this.yd[t][i+1][e]-s,r+1)&&this.cw(n+128-1,this.yd[t][i+1][e+1]-s,r+128-1)&&this.cw(n+1,this.yd[t][i][e+1]-s,r+128-1)}return!1};ow=(t,i,e,s,n,r)=>{let h,o;if(i!==e||s!==n){for(h=i;h<=e;h++)for(o=s;o<=n;o++)if(this.Ad[t][h][o]===-gt.Yi)return!1;o=1+(i<<7);const l=2+(s<<7),a=this.yd[t][i][s]-r;if(!this.cw(o,a,l))return!1;const c=(e<<7)-1;if(!this.cw(c,a,l))return!1;const f=(n<<7)-1;return!!this.cw(o,a,f)&&this.cw(c,a,f)}return!!this.sw(t,i,s)&&(h=i<<7,o=s<<7,this.cw(h+1,this.yd[t][i][s]-r,o+1)&&this.cw(h+128-1,this.yd[t][i+1][s]-r,o+1)&&this.cw(h+128-1,this.yd[t][i+1][s+1]-r,o+128-1)&&this.cw(h+1,this.yd[t][i][s+1]-r,o+128-1))};cw=(t,i,e)=>{for(let s=0;s<gt.ld;s++){const n=gt.Cu[s];if(n)if(1===n.mode){const s=n.Rr-t;if(s>0){const t=n.Lr+(n.hc*s>>8),r=n.Sr+(n.oc*s>>8),h=n.kr+(n.lc*s>>8),o=n.Dr+(n.ac*s>>8);if(e>=t&&e<=r&&i>=h&&i<=o)return!0}}else if(2===n.mode){const s=t-n.Rr;if(s>0){const t=n.Lr+(n.hc*s>>8),r=n.Sr+(n.oc*s>>8),h=n.kr+(n.lc*s>>8),o=n.Dr+(n.ac*s>>8);if(e>=t&&e<=r&&i>=h&&i<=o)return!0}}else if(3===n.mode){const s=n.Lr-e;if(s>0){const e=n.Rr+(n.nc*s>>8),r=n.vr+(n.rc*s>>8),h=n.kr+(n.lc*s>>8),o=n.Dr+(n.ac*s>>8);if(t>=e&&t<=r&&i>=h&&i<=o)return!0}}else if(4===n.mode){const s=e-n.Lr;if(s>0){const e=n.Rr+(n.nc*s>>8),r=n.vr+(n.rc*s>>8),h=n.kr+(n.lc*s>>8),o=n.Dr+(n.ac*s>>8);if(t>=e&&t<=r&&i>=h&&i<=o)return!0}}else if(5===n.mode){const s=i-n.kr;if(s>0){const i=n.Rr+(n.nc*s>>8),r=n.vr+(n.rc*s>>8),h=n.Lr+(n.hc*s>>8),o=n.Sr+(n.oc*s>>8);if(t>=i&&t<=r&&e>=h&&e<=o)return!0}}}return!1};lw=(t,i,e,s,n,r,h,o)=>{if(i<e&&i<s&&i<n)return!1;if(i>e&&i>s&&i>n)return!1;if(t<r&&t<h&&t<o)return!1;if(t>r&&t>h&&t>o)return!1;const l=(i-s)*(o-h)-(t-h)*(n-s);return((i-e)*(h-r)-(t-r)*(s-e))*l>0&&l*((i-n)*(r-o)-(t-o)*(e-n))>0};aw=(t,i)=>((i=(127-i)*(127&t)/160|0)<2?i=2:i>126&&(i=126),(65408&t)+i)}class It{id;fw=null;constructor(t){this.id=t}uw(t){for(;;){const i=t.Zt;if(0===i)break;this.decode(i,t)}return this}}class Ct extends It{static count=0;static Qs=[];static tn=t=>{const i=new O(t.read('flo.dat'));this.count=i.Jt;for(let t=0;t<this.count;t++)this.Qs[t]=new Ct(t).uw(i)};static dw=(t,i,e)=>(e>179&&(i=i/2|0),e>192&&(i=i/2|0),e>217&&(i=i/2|0),e>243&&(i=i/2|0),(t/4<<10)+(i/32<<7)+(e/2|0));static ww=(t,i)=>-1===t?12345678:((i=i*(127&t)/128|0)<2?i=2:i>126&&(i=126),(65408&t)+i);static yw=(t,i)=>-2===t?12345678:-1===t?(i<0?i=0:i>127&&(i=127),127-i):((i=i*(127&t)/128|0)<2?i=2:i>126&&(i=126),(65408&t)+i);mw=0;texture=-1;pw=!1;Aw=!0;_w=0;gw=0;Iw=0;Cw=0;Ew=0;Tw=0;decode(t,i){1===t?(this.mw=i.Qt,this.setColor(this.mw)):2===t?this.texture=i.Zt:3===t?this.pw=!0:5===t?this.Aw=!1:6===t?this.fw=i.ni:console.log('Error unrecognised config code: ',t)}setColor(t){const i=(t>>16&255)/256,e=(t>>8&255)/256,s=(255&t)/256;let n=i;e<i&&(n=e),s<n&&(n=s);let r=i;e>i&&(r=e),s>r&&(r=s);let h=0,o=0;const l=(n+r)/2;n!==r&&(l<.5&&(o=(r-n)/(r+n)),l>=.5&&(o=(r-n)/(2-r-n)),i===r?h=(e-s)/(r-n):e===r?h=(s-i)/(r-n)+2:s===r&&(h=(i-e)/(r-n)+4)),h/=6,this._w=256*h|0,this.gw=256*o|0,this.Iw=256*l|0,this.gw<0?this.gw=0:this.gw>255&&(this.gw=255),this.Iw<0?this.Iw=0:this.Iw>255&&(this.Iw=255),this.Cw=l>.5?(1-l)*o*512|0:l*o*512|0,this.Cw<1&&(this.Cw=1),this.Ew=h*this.Cw|0;let a=this._w+(16*Math.random()|0)-8;a<0?a=0:a>255&&(a=255);let c=this.gw+(48*Math.random()|0)-24;c<0?c=0:c>255&&(c=255);let f=this.Iw+(48*Math.random()|0)-24;f<0?f=0:f>255&&(f=255),this.Tw=Ct.dw(a,c,f)}}class Et extends It{static count=0;static cache=null;static zs=null;static bw=null;static Ow=0;static Rw=new q(500);static Lw=new q(30);static tn=t=>{this.zs=new O(t.read('loc.dat'));const i=new O(t.read('loc.idx'));this.count=i.Jt,this.bw=new Int32Array(this.count);let e=2;for(let t=0;t<this.count;t++)this.bw[t]=e,e+=i.Jt;this.cache=new v(10,null);for(let t=0;t<10;t++)this.cache[t]=new Et(-1)};static get=t=>{if(!this.cache||!this.bw||!this.zs)throw new Error('LocType not loaded!!!');for(let i=0;i<10;i++){const e=this.cache[i];if(e&&e.id===t)return e}this.Ow=(this.Ow+1)%10;const i=this.cache[this.Ow];return this.zs.Xt=this.bw[t],i.id=t,i.reset(),i.uw(this.zs),i.Sw||(i.Sw=new Int32Array(1)),-1===i.xw&&i.Sw&&(i.active=i.Sw.length>0&&i.Sw[0]===ct.hf.id,i.Mw&&(i.active=!0)),i};static zi=()=>{this.Rw=null,this.Lw=null,this.bw=null,this.cache=null,this.zs=null};kw=null;Sw=null;name=null;Dw=null;Nw=null;Fw=null;width=1;length=1;Bw=!0;Pw=!0;active=!1;xw=-1;Uw=!1;Ww=!1;Aw=!1;Ul=-1;Gw=!1;Yw=16;Hw=0;Vw=0;Mw=null;Kw=-1;Xw=-1;jw=!1;zw=!0;Zw=128;qw=128;Jw=128;$w=0;Qw=0;ty=0;iy=0;ey=!1;decode(t,i){if(1===t){const t=i.Zt;this.kw=new Int32Array(t),this.Sw=new Int32Array(t);for(let e=0;e<t;e++)this.kw[e]=i.Jt,this.Sw[e]=i.Zt}else if(2===t)this.name=i.ni;else if(3===t)this.Dw=i.ni;else if(14===t)this.width=i.Zt;else if(15===t)this.length=i.Zt;else if(17===t)this.Bw=!1;else if(18===t)this.Pw=!1;else if(19===t)this.xw=i.Zt,1===this.xw&&(this.active=!0);else if(21===t)this.Uw=!0;else if(22===t)this.Ww=!0;else if(23===t)this.Aw=!0;else if(24===t)this.Ul=i.Jt,65535===this.Ul&&(this.Ul=-1);else if(25===t)this.Gw=!0;else if(28===t)this.Yw=i.Zt;else if(29===t)this.Hw=i.qt;else if(39===t)this.Vw=i.qt;else if(t>=30&&t<39)this.Mw||(this.Mw=new v(5,null)),this.Mw[t-30]=i.ni,'hidden'===this.Mw[t-30]?.toLowerCase()&&(this.Mw[t-30]=null);else if(40===t){const t=i.Zt;this.Nw=new Uint16Array(t),this.Fw=new Uint16Array(t);for(let e=0;e<t;e++)this.Nw[e]=i.Jt,this.Fw[e]=i.Jt}else 60===t?this.Kw=i.Jt:62===t?this.jw=!0:64===t?this.zw=!1:65===t?this.Zw=i.Jt:66===t?this.qw=i.Jt:67===t?this.Jw=i.Jt:68===t?this.Xw=i.Jt:69===t?this.$w=i.Zt:70===t?this.Qw=i.$t:71===t?this.ty=i.$t:72===t?this.iy=i.$t:73===t&&(this.ey=!0)}Bl(t,i,e,s,n,r,h){if(!this.Sw)return null;let o=-1;for(let i=0;i<this.Sw.length;i++)if(this.Sw[i]===t){o=i;break}if(-1===o)return null;const l=BigInt(BigInt(this.id)<<6n)+BigInt(BigInt(o)<<3n)+BigInt(i)+BigInt(BigInt(h)+1n<<32n);let a=Et.Lw?.get(l);if(a){if((this.Uw||this.Ww)&&(a=j.hr(a,this.Uw,this.Ww)),this.Uw){const t=(e+s+n+r)/4|0;for(let i=0;i<a.nn;i++){const h=a.mr[i],o=e+((s-e)*(h+64)/128|0),l=o+((r+((n-r)*(h+64)/128|0)-o)*(a.pr[i]+64)/128|0);a.lr[i]+=l-t}a.Jr()}return a}if(!this.kw)return null;if(o>=this.kw.length)return null;let c=this.kw[o];if(-1===c)return null;const f=this.jw!==i>3;f&&(c+=65536);let u=Et.Rw?.get(BigInt(c));u||(u=j.model(65535&c),f&&u.rh(),Et.Rw?.put(BigInt(c),u));const d=128!==this.Zw||128!==this.qw||128!==this.Jw,w=0!==this.Qw||0!==this.ty||0!==this.iy;let y=j.Br(u,!this.Nw,!this.Gw,i===lt.Yc&&-1===h&&!d&&!w);for(-1!==h&&(y.$r(),y.ih(h),y.Yr=null,y.Gr=null);i-- >0;)y.eh();if(this.Nw&&this.Fw)for(let t=0;t<this.Nw.length;t++)y.nh(this.Nw[t],this.Fw[t]);if(d&&y.scale(this.Zw,this.qw,this.Jw),w&&y.translate(this.ty,this.Qw,this.iy),y.hh(64+(255&this.Hw),5*(255&this.Vw)+768,-50,-10,-50,!this.Ww),this.Bw&&(y.jr=y.Dr),Et.Lw?.put(l,y),(this.Uw||this.Ww)&&(y=j.hr(y,this.Uw,this.Ww)),this.Uw){const t=(e+s+n+r)/4|0;for(let i=0;i<y.nn;i++){const h=y.mr[i],o=e+((s-e)*(h+64)/128|0),l=o+((r+((n-r)*(h+64)/128|0)-o)*(y.pr[i]+64)/128|0);y.lr[i]+=l-t}y.Jr()}return y}reset(){this.kw=null,this.Sw=null,this.name=null,this.Dw=null,this.Nw=null,this.Fw=null,this.width=1,this.length=1,this.Bw=!0,this.Pw=!0,this.active=!1,this.xw=-1,this.Uw=!1,this.Ww=!1,this.Aw=!1,this.Ul=-1,this.Yw=16,this.Hw=0,this.Vw=0,this.Mw=null,this.Gw=!1,this.Kw=-1,this.Xw=-1,this.jw=!1,this.zw=!0,this.Zw=128,this.qw=128,this.Jw=128,this.$w=0,this.Qw=0,this.ty=0,this.iy=0,this.ey=!1}}class Tt extends w{sy;ny;hy;oy;index;ly;jl;zl;constructor(t,i,e,s,n,r,h){super(),this.sy=i,this.ny=e,this.hy=s,this.oy=n,this.index=t,this.ly=r,h&&-1!==r.uy&&this.ly.delay?(this.jl=Math.random()*this.ly.wy|0,this.zl=Math.random()*this.ly.delay[this.jl]|0):(this.jl=-1,this.zl=0)}}class bt extends It{static count=0;static Qs=[];static tn=t=>{const i=new O(t.read('seq.dat'));this.count=i.Jt;for(let t=0;t<this.count;t++){const e=new bt(t).uw(i);0===e.wy&&(e.wy=1,e.frames=new Int16Array(1),e.frames[0]=-1,e.yy=new Int16Array(1),e.yy[0]=-1,e.delay=new Int16Array(1),e.delay[0]=-1),this.Qs[t]=e}};wy=0;frames=null;yy=null;delay=null;uy=-1;my=null;py=!1;priority=5;Ay=-1;_y=-1;gy=99;duration=0;decode(t,i){if(1===t){this.wy=i.Zt,this.frames=new Int16Array(this.wy),this.yy=new Int16Array(this.wy),this.delay=new Int16Array(this.wy);for(let t=0;t<this.wy;t++)this.frames[t]=i.Jt,this.yy[t]=i.Jt,65535===this.yy[t]&&(this.yy[t]=-1),this.delay[t]=i.Jt,0===this.delay[t]&&(this.delay[t]=V.Qs[this.frames[t]].delay),0===this.delay[t]&&(this.delay[t]=1),this.duration+=this.delay[t]}else if(2===t)this.uy=i.Jt;else if(3===t){const t=i.Zt;this.my=new Int32Array(t+1);for(let e=0;e<t;e++)this.my[e]=i.Zt;this.my[t]=9999999}else if(4===t)this.py=!0;else if(5===t)this.priority=i.Zt;else if(6===t)this.Ay=i.Jt;else if(7===t)this._y=i.Jt;else{if(8!==t)throw new Error(`Unrecognized seq config code: ${t}`);this.gy=i.Zt}}}class Ot{static RED=16711680;static GREEN=65280;static BLUE=255;static Iy=16776960;static Cy=65535;static Ey=16711935;static Ty=16777215;static by=0;static Oy=16748608;static Ry=8388608;static vy=128;static Ly=16756736;static Sy=16740352;static xy=16723968;static My=12648192;static ky=8453888;static Dy=4259584;static Ny=9179409;static Fy=6116423;static By=2301979;static Py=5063219;static Uy=7759444;static Wy=3353893;static Gy=8388736;static Yy=13350793;static Hy=Int32Array.of(Ot.Iy,Ot.RED,Ot.GREEN,Ot.Cy,Ot.Ey,Ot.Ty);static Vy=6798;static Ky=107;static Xy=10283;static jy=16;static zy=4797;static Zy=7744;static qy=5799;static Jy=4634;static $y=33697;static Qy=22433;static tm=2983;static im=54193;static sm=8741;static nm=12;static rm=64030;static hm=43162;static om=7735;static lm=8404;static am=1701;static fm=38430;static um=24094;static dm=10153;static wm=56621;static ym=4783;static pm=1341;static Am=16578;static _m=35003;static gm=25239;static Im=9104;static Cm=10275;static Em=7595;static Tm=3610;static bm=7975;static Om=8526;static Rm=918;static vm=38802;static Lm=24466;static Sm=10145;static xm=58654;static Mm=5027;static km=1457;static Dm=16565;static Nm=34991;static Fm=25486;static Bm=4626;static Pm=11146;static Um=6439;static Wm=12;static Gm=4758;static Ym=10270;static Hm=4574;static Vm=4550;static Km=4537;static Xm=5681;static jm=5673;static zm=5790;static Zm=6806;static qm=8076}class Rt{static Jm=Int8Array.of(1,2,4,8);static $m=Uint8Array.of(16,32,64,128);static Qm=Int8Array.of(1,0,-1,0);static tp=Int8Array.of(0,-1,0,1);static ip=(17*Math.random()|0)-8;static ep=(33*Math.random()|0)-16;static Li=!0;static sp=0;static np=!1;static rp=(t,i)=>{let e=this.hp(t+45365,i+91923,4)+(this.hp(t+10294,i+37821,2)-128>>1)+(this.hp(t,i,1)-128>>2)-128;return e=35+(.3*e|0),e<10?e=10:e>60&&(e=60),e};static hp=(t,i,e)=>{const s=t/e|0,n=t&e-1,r=i/e|0,h=i&e-1,o=this.op(s,r),l=this.op(s+1,r),a=this.op(s,r+1),c=this.op(s+1,r+1),f=this.lp(o,l,n,e),u=this.lp(a,c,n,e);return this.lp(f,u,h,e)};static lp=(t,i,e,s)=>{const n=65536-N.cos[1024*e/s|0]>>1;return(t*(65536-n)>>16)+(i*n>>16)};static op=(t,i)=>((this.ap(t-1,i-1)+this.ap(t+1,i-1)+this.ap(t-1,i+1)+this.ap(t+1,i+1))/16|0)+((this.ap(t-1,i)+this.ap(t+1,i)+this.ap(t,i-1)+this.ap(t,i+1))/8|0)+(this.ap(t,i)/4|0);static ap=(t,i)=>{const e=t+57*i,s=BigInt(e<<13^e);return 255&Number((s*(s*s*15731n+789221n)+1376312589n&0x7fffffffn)>>19n)};static Tf=(t,i,e,s,n,r,h,o,l,a,c)=>{const f=n[c][i][e],u=n[c][i+1][e],d=n[c][i+1][e+1],w=n[c][i][e+1],y=f+u+d+w>>2,m=Et.get(o);let p=i+(e<<7)+(o<<14)+1073741824|0;m.active||(p+=-2147483648),p|=0;const A=(a<<6)+l<<24>>24;if(l===ct.Zc.id)s?.vd(m.Bl(ct.Zc.id,a,f,u,d,w,-1),t,i,e,y,p,A),m.Bw&&m.active&&h?.Cf(i,e),-1!==m.Ul&&r.Mt(new Tt(o,t,3,i,e,bt.Qs[m.Ul],!0));else if(l===ct.hf.id||l===ct.lf.id){const n=m.Bl(ct.hf.id,a,f,u,d,w,-1);if(n){let r,h,o=0;l===ct.lf.id&&(o+=256),a===lt.Hc||a===lt.Kc?(r=m.length,h=m.width):(r=m.width,h=m.length),s?.Tf(t,i,e,y,n,null,p,A,r,h,o)}m.Bw&&h?.Tf(i,e,m.width,m.length,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,2,i,e,bt.Qs[m.Ul],!0))}else if(l>=ct.af.id)s?.Tf(t,i,e,y,m.Bl(l,a,f,u,d,w,-1),null,p,A,1,1,0),m.Bw&&h?.Tf(i,e,m.width,m.length,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,2,i,e,bt.Qs[m.Ul],!0));else if(l===ct.qc.id)s?.Of(t,i,e,y,Rt.Jm[a],0,m.Bl(ct.qc.id,a,f,u,d,w,-1),null,p,A),m.Bw&&h?.Of(i,e,l,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,0,i,e,bt.Qs[m.Ul],!0));else if(l===ct.Jc.id)s?.Of(t,i,e,y,Rt.$m[a],0,m.Bl(ct.Jc.id,a,f,u,d,w,-1),null,p,A),m.Bw&&h?.Of(i,e,l,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,0,i,e,bt.Qs[m.Ul],!0));else if(l===ct.$c.id){const n=a+1&3;s?.Of(t,i,e,y,Rt.Jm[a],Rt.Jm[n],m.Bl(ct.$c.id,a+4,f,u,d,w,-1),m.Bl(ct.$c.id,n,f,u,d,w,-1),p,A),m.Bw&&h?.Of(i,e,l,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,0,i,e,bt.Qs[m.Ul],!0))}else if(l===ct.Qc.id)s?.Of(t,i,e,y,Rt.$m[a],0,m.Bl(ct.Qc.id,a,f,u,d,w,-1),null,p,A),m.Bw&&h?.Of(i,e,l,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,0,i,e,bt.Qs[m.Ul],!0));else if(l===ct.rf.id)s?.Tf(t,i,e,y,m.Bl(l,a,f,u,d,w,-1),null,p,A,1,1,0),m.Bw&&h?.Tf(i,e,m.width,m.length,a,m.Pw),-1!==m.Ul&&r.Mt(new Tt(o,t,2,i,e,bt.Qs[m.Ul],!0));else if(l===ct.tf.id)s?.Md(t,i,e,y,0,0,p,m.Bl(ct.tf.id,lt.Yc,f,u,d,w,-1),A,512*a,Rt.Jm[a]),-1!==m.Ul&&r.Mt(new Tt(o,t,1,i,e,bt.Qs[m.Ul],!0));else if(l===ct.if.id){let n=16;if(s){const r=s.Kd(t,i,e);r>0&&(n=Et.get(r>>14&32767).Yw)}s?.Md(t,i,e,y,Rt.Qm[a]*n,Rt.tp[a]*n,p,m.Bl(ct.tf.id,lt.Yc,f,u,d,w,-1),A,512*a,Rt.Jm[a]),-1!==m.Ul&&r.Mt(new Tt(o,t,1,i,e,bt.Qs[m.Ul],!0))}else l===ct.ef.id?(s?.Md(t,i,e,y,0,0,p,m.Bl(ct.tf.id,lt.Yc,f,u,d,w,-1),A,a,256),-1!==m.Ul&&r.Mt(new Tt(o,t,1,i,e,bt.Qs[m.Ul],!0))):l===ct.sf.id?(s?.Md(t,i,e,y,0,0,p,m.Bl(ct.tf.id,lt.Yc,f,u,d,w,-1),A,a,512),-1!==m.Ul&&r.Mt(new Tt(o,t,1,i,e,bt.Qs[m.Ul],!0))):l===ct.nf.id&&(s?.Md(t,i,e,y,0,0,p,m.Bl(ct.tf.id,lt.Yc,f,u,d,w,-1),A,a,768),-1!==m.Ul&&r.Mt(new Tt(o,t,1,i,e,bt.Qs[m.Ul],!0)))};ic;sc;cp;fp;up;dp;wp;yp;mp;pp;Ap;_p;gp;Ip;Cp;Ep;constructor(t,i,e,s){this.ic=t,this.sc=i,this.cp=e,this.fp=s,this.up=new M(ut._f,t,i),this.dp=new M(ut._f,t,i),this.wp=new M(ut._f,t,i),this.yp=new M(ut._f,t,i),this.Ep=new D(ut._f,t+1,i+1),this.mp=new M(ut._f,t+1,i+1),this.pp=new k(t+1,i+1),this.Ap=new Int32Array(i),this._p=new Int32Array(i),this.gp=new Int32Array(i),this.Ip=new Int32Array(i),this.Cp=new Int32Array(i)}Tp=(t,i)=>{for(let t=0;t<ut._f;t++)for(let e=0;e<ut.gf;e++)for(let s=0;s<ut.gf;s++)if(!(1&~this.fp[t][e][s])){let n=t;2&~this.fp[1][e][s]||n--,n>=0&&i[n]?.Cf(e,s)}Rt.ip+=(5*Math.random()|0)-2,Rt.ip<-8?Rt.ip=-8:Rt.ip>8&&(Rt.ip=8),Rt.ep+=(5*Math.random()|0)-2,Rt.ep<-16?Rt.ep=-16:Rt.ep>16&&(Rt.ep=16);for(let i=0;i<ut._f;i++){const e=this.mp[i],s=96,n=-50,r=-10,h=-50,o=768*(0|Math.sqrt(n*n+r*r+h*h))>>8;for(let t=1;t<this.sc-1;t++)for(let l=1;l<this.ic-1;l++){const a=this.cp[i][l+1][t]-this.cp[i][l-1][t],c=this.cp[i][l][t+1]-this.cp[i][l][t-1],f=0|Math.sqrt(a*a+c*c+65536),u=s+((n*((a<<8)/f|0)+r*(65536/f|0)+h*((c<<8)/f|0))/o|0),d=(e[l-1][t]>>2)+(e[l+1][t]>>3)+(e[l][t-1]>>2)+(e[l][t+1]>>3)+(e[l][t]>>1);this.pp[l][t]=u-d}for(let t=0;t<this.sc;t++)this.Ap[t]=0,this._p[t]=0,this.gp[t]=0,this.Ip[t]=0,this.Cp[t]=0;for(let e=-5;e<this.ic+5;e++){for(let t=0;t<this.sc;t++){const s=e+5;let n;if(s>=0&&s<this.ic){const e=255&this.up[i][s][t];if(e>0){const i=Ct.Qs[e-1];this.Ap[t]+=i.Ew,this._p[t]+=i.gw,this.gp[t]+=i.Iw,this.Ip[t]+=i.Cw,n=this.Cp[t]++}}const r=e-5;if(r>=0&&r<this.ic){const e=255&this.up[i][r][t];if(e>0){const i=Ct.Qs[e-1];this.Ap[t]-=i.Ew,this._p[t]-=i.gw,this.gp[t]-=i.Iw,this.Ip[t]-=i.Cw,n=this.Cp[t]--}}}if(e>=1&&e<this.ic-1){let s=0,n=0,r=0,h=0,o=0;for(let l=-5;l<this.sc+5;l++){const a=l+5;a>=0&&a<this.sc&&(s+=this.Ap[a],n+=this._p[a],r+=this.gp[a],h+=this.Ip[a],o+=this.Cp[a]);const c=l-5;if(c>=0&&c<this.sc&&(s-=this.Ap[c],n-=this._p[c],r-=this.gp[c],h-=this.Ip[c],o-=this.Cp[c]),l>=1&&l<this.sc-1&&(!Rt.Li||!(16&this.fp[i][e][l])&&this.bp(i,e,l)===Rt.sp)){const a=255&this.up[i][e][l],c=255&this.dp[i][e][l];if(a>0||c>0){const f=this.cp[i][e][l],u=this.cp[i][e+1][l],d=this.cp[i][e+1][l+1],w=this.cp[i][e][l+1],y=this.pp[e][l],m=this.pp[e+1][l],p=this.pp[e+1][l+1],A=this.pp[e][l+1];let _=-1,g=-1;if(a>0){const t=256*s/h|0,i=n/o|0;let e=r/o|0;_=Ct.dw(t,i,e);const l=t+Rt.ip&255;e+=Rt.ep,e<0?e=0:e>255&&(e=255),g=Ct.dw(l,i,e)}if(i>0){let t=0!==a||this.wp[i][e][l]===_t.au;c>0&&!Ct.Qs[c-1].Aw&&(t=!1),t&&f===u&&f===d&&f===w&&(this.Ep[i][e][l]|=2340)}let I=0;if(-1!==_&&(I=N.palette[Ct.ww(g,96)]),0===c)t?.Rd(i,e,l,_t.au,lt.Yc,-1,f,u,d,w,Ct.ww(_,y),Ct.ww(_,m),Ct.ww(_,p),Ct.ww(_,A),Ot.by,Ot.by,Ot.by,Ot.by,I,Ot.by);else{const s=this.wp[i][e][l]+1,n=this.yp[i][e][l],r=Ct.Qs[c-1];let h,o,a=r.texture;a>=0?(o=N.Qi(a),h=-1):r.mw===Ot.Ey?(o=0,h=-2,a=-1):(h=Ct.dw(r._w,r.gw,r.Iw),o=N.palette[Ct.yw(r.Tw,96)]),t?.Rd(i,e,l,s,n,a,f,u,d,w,Ct.ww(_,y),Ct.ww(_,m),Ct.ww(_,p),Ct.ww(_,A),Ct.yw(h,y),Ct.yw(h,m),Ct.yw(h,p),Ct.yw(h,A),I,o)}}}}}}for(let e=1;e<this.sc-1;e++)for(let s=1;s<this.ic-1;s++)t?.Od(i,s,e,this.bp(i,s,e))}Rt.np||t?.qd(64,768,-50,-10,-50);for(let i=0;i<this.ic;i++)for(let e=0;e<this.sc;e++)2&~this.fp[1][i][e]||t?.bd(i,e);if(!Rt.np){let t=1,i=2,e=4;for(let s=0;s<ut._f;s++){s>0&&(t<<=3,i<<=3,e<<=3);for(let n=0;n<=s;n++)for(let r=0;r<=this.sc;r++)for(let h=0;h<=this.ic;h++){if(this.Ep[n][h][r]&t){let i=r,e=r,o=n,l=n;for(;i>0&&this.Ep[n][h][i-1]&t;)i--;for(;e<this.sc&&this.Ep[n][h][e+1]&t;)e++;t:for(;o>0;){for(let s=i;s<=e;s++)if(!(this.Ep[o-1][h][s]&t))break t;o--}t:for(;l<s;){for(let s=i;s<=e;s++)if(!(this.Ep[l+1][h][s]&t))break t;l++}if((l+1-o)*(e+1-i)>=8){const n=this.cp[l][h][i]-240,r=this.cp[o][h][i];gt.dd(s,1,128*h,n,128*i,128*h,r,128*e+128);for(let s=o;s<=l;s++)for(let n=i;n<=e;n++)this.Ep[s][h][n]&=~t}}if(this.Ep[n][h][r]&i){let t=h,e=h,o=n,l=n;for(;t>0&&this.Ep[n][t-1][r]&i;)t--;for(;e<this.ic&&this.Ep[n][e+1][r]&i;)e++;t:for(;o>0;){for(let s=t;s<=e;s++)if(!(this.Ep[o-1][s][r]&i))break t;o--}t:for(;l<s;){for(let s=t;s<=e;s++)if(!(this.Ep[l+1][s][r]&i))break t;l++}if((l+1-o)*(e+1-t)>=8){const n=this.cp[l][t][r]-240,h=this.cp[o][t][r];gt.dd(s,2,128*t,n,128*r,128*e+128,h,128*r);for(let s=o;s<=l;s++)for(let n=t;n<=e;n++)this.Ep[s][n][r]&=~i}}if(this.Ep[n][h][r]&e){let t=h,i=h,o=r,l=r;for(;o>0&&this.Ep[n][h][o-1]&e;)o--;for(;l<this.sc&&this.Ep[n][h][l+1]&e;)l++;t:for(;t>0;){for(let i=o;i<=l;i++)if(!(this.Ep[n][t-1][i]&e))break t;t--}t:for(;i<this.ic;){for(let t=o;t<=l;t++)if(!(this.Ep[n][i+1][t]&e))break t;i++}if((i+1-t)*(l+1-o)>=4){const r=this.cp[n][t][o];gt.dd(s,4,128*t,r,128*o,128*i+128,r,128*l+128);for(let s=t;s<=i;s++)for(let t=o;t<=l;t++)this.Ep[n][s][t]&=~e}}}}}};Op=(t,i,e,s)=>{let n=0;for(let t=0;t<Ct.count;t++)if('water'===Ct.Qs[t].fw?.toLowerCase()){n=t+1<<24>>24;break}for(let r=t;r<t+e;r++)for(let t=i;t<i+s;t++)if(t>=0&&t<this.ic&&r>=0&&r<this.sc){this.dp[0][t][r]=n;for(let i=0;i<ut._f;i++)this.cp[i][t][r]=0,this.fp[i][t][r]=0}};Rp=(t,i,e,s,n)=>{const r=new O(new Uint8Array(n));for(let n=0;n<ut._f;n++)for(let h=0;h<64;h++)for(let o=0;o<64;o++){const l=h+e,a=o+s;let c;if(l>=0&&l<ut.gf&&a>=0&&a<ut.gf)for(this.fp[n][l][a]=0;;){if(c=r.Zt,0===c){0===n?this.cp[0][l][a]=8*-Rt.rp(l+t+932731,a+556238+i):this.cp[n][l][a]=this.cp[n-1][l][a]-240;break}if(1===c){let t=r.Zt;1===t&&(t=0),0===n?this.cp[0][l][a]=8*-t:this.cp[n][l][a]=this.cp[n-1][l][a]-8*t;break}c<=49?(this.dp[n][l][a]=r.qt,this.wp[n][l][a]=(c-2)/4<<24>>24,this.yp[n][l][a]=(c-2&3)<<24>>24):c<=81?this.fp[n][l][a]=c-49<<24>>24:this.up[n][l][a]=c-81<<24>>24}else for(;c=r.Zt,0!==c;){if(1===c){r.Zt;break}c<=49&&r.Zt}}};vp=(t,i,e,s,n,r)=>{const h=new O(new Uint8Array(s));let o=-1;for(;;){const s=h.si;if(0===s)return;o+=s;let l=0;for(;;){const s=h.si;if(0===s)break;l+=s-1;const a=63&l,c=l>>6&63,f=l>>12,u=h.Zt,d=u>>2,w=3&u,y=c+n,m=a+r;if(y>0&&m>0&&y<ut.gf-1&&m<ut.gf-1){let s=f;2&~this.fp[1][y][m]||(s=f-1);let n=null;s>=0&&(n=e[s]),this.Tf(f,y,m,t,i,n,o,d,w)}}}};Tf=(t,i,e,s,n,r,h,o,l)=>{if(Rt.Li){if(16&this.fp[t][i][e])return;if(this.bp(t,i,e)!==Rt.sp)return}const a=this.cp[t][i][e],c=this.cp[t][i+1][e],f=this.cp[t][i+1][e+1],u=this.cp[t][i][e+1],d=a+c+f+u>>2,w=Et.get(h);let y=i+(e<<7)+(h<<14)+1073741824|0;w.active||(y+=-2147483648),y|=0;const m=(l<<6)+o<<24>>24;if(o===ct.Zc.id)(!Rt.Li||w.active||w.ey)&&(s?.vd(w.Bl(ct.Zc.id,l,a,c,f,u,-1),t,i,e,d,y,m),w.Bw&&w.active&&r?.Cf(i,e),-1!==w.Ul&&n.Mt(new Tt(h,t,3,i,e,bt.Qs[w.Ul],!0)));else if(o===ct.hf.id||o===ct.lf.id){const p=w.Bl(ct.hf.id,l,a,c,f,u,-1);if(p){let n,r,h=0;if(o===ct.lf.id&&(h+=256),l===lt.Hc||l===lt.Kc?(n=w.length,r=w.width):(n=w.width,r=w.length),s?.Tf(t,i,e,d,p,null,y,m,n,r,h)&&w.zw)for(let s=0;s<=n;s++)for(let n=0;n<=r;n++){let r=p.Mr/4|0;r>30&&(r=30),r>this.mp[t][i+s][e+n]&&(this.mp[t][i+s][e+n]=r<<24>>24)}}w.Bw&&r?.Tf(i,e,w.width,w.length,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,2,i,e,bt.Qs[w.Ul],!0))}else if(o>=ct.af.id)s?.Tf(t,i,e,d,w.Bl(o,l,a,c,f,u,-1),null,y,m,1,1,0),o>=ct.af.id&&o<=ct.wf.id&&o!==ct.cf.id&&t>0&&(this.Ep[t][i][e]|=2340),w.Bw&&r?.Tf(i,e,w.width,w.length,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,2,i,e,bt.Qs[w.Ul],!0));else if(o===ct.qc.id)s?.Of(t,i,e,d,Rt.Jm[l],0,w.Bl(ct.qc.id,l,a,c,f,u,-1),null,y,m),l===lt.Yc?(w.zw&&(this.mp[t][i][e]=50,this.mp[t][i][e+1]=50),w.Aw&&(this.Ep[t][i][e]|=585)):l===lt.Hc?(w.zw&&(this.mp[t][i][e+1]=50,this.mp[t][i+1][e+1]=50),w.Aw&&(this.Ep[t][i][e+1]|=1170)):l===lt.Vc?(w.zw&&(this.mp[t][i+1][e]=50,this.mp[t][i+1][e+1]=50),w.Aw&&(this.Ep[t][i+1][e]|=585)):l===lt.Kc&&(w.zw&&(this.mp[t][i][e]=50,this.mp[t][i+1][e]=50),w.Aw&&(this.Ep[t][i][e]|=1170)),w.Bw&&r?.Of(i,e,o,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,0,i,e,bt.Qs[w.Ul],!0)),16!==w.Yw&&s?.Dd(t,i,e,w.Yw);else if(o===ct.Jc.id)s?.Of(t,i,e,d,Rt.$m[l],0,w.Bl(ct.Jc.id,l,a,c,f,u,-1),null,y,m),w.zw&&(l===lt.Yc?this.mp[t][i][e+1]=50:l===lt.Hc?this.mp[t][i+1][e+1]=50:l===lt.Vc?this.mp[t][i+1][e]=50:l===lt.Kc&&(this.mp[t][i][e]=50)),w.Bw&&r?.Of(i,e,o,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,0,i,e,bt.Qs[w.Ul],!0));else if(o===ct.$c.id){const p=l+1&3;s?.Of(t,i,e,d,Rt.Jm[l],Rt.Jm[p],w.Bl(ct.$c.id,l+4,a,c,f,u,-1),w.Bl(ct.$c.id,p,a,c,f,u,-1),y,m),w.Aw&&(l===lt.Yc?(this.Ep[t][i][e]|=265,this.Ep[t][i][e+1]|=1170):l===lt.Hc?(this.Ep[t][i][e+1]|=1170,this.Ep[t][i+1][e]|=585):l===lt.Vc?(this.Ep[t][i+1][e]|=585,this.Ep[t][i][e]|=1170):l===lt.Kc&&(this.Ep[t][i][e]|=1170,this.Ep[t][i][e]|=585)),w.Bw&&r?.Of(i,e,o,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,0,i,e,bt.Qs[w.Ul],!0)),16!==w.Yw&&s?.Dd(t,i,e,w.Yw)}else if(o===ct.Qc.id)s?.Of(t,i,e,d,Rt.$m[l],0,w.Bl(ct.Qc.id,l,a,c,f,u,-1),null,y,m),w.zw&&(l===lt.Yc?this.mp[t][i][e+1]=50:l===lt.Hc?this.mp[t][i+1][e+1]=50:l===lt.Vc?this.mp[t][i+1][e]=50:l===lt.Kc&&(this.mp[t][i][e]=50)),w.Bw&&r?.Of(i,e,o,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,0,i,e,bt.Qs[w.Ul],!0));else if(o===ct.rf.id)s?.Tf(t,i,e,d,w.Bl(o,l,a,c,f,u,-1),null,y,m,1,1,0),w.Bw&&r?.Tf(i,e,w.width,w.length,l,w.Pw),-1!==w.Ul&&n.Mt(new Tt(h,t,2,i,e,bt.Qs[w.Ul],!0));else if(o===ct.tf.id)s?.Md(t,i,e,d,0,0,y,w.Bl(ct.tf.id,lt.Yc,a,c,f,u,-1),m,512*l,Rt.Jm[l]),-1!==w.Ul&&n.Mt(new Tt(h,t,1,i,e,bt.Qs[w.Ul],!0));else if(o===ct.if.id){let r=16;if(s){const n=s.Kd(t,i,e);n>0&&(r=Et.get(n>>14&32767).Yw)}s?.Md(t,i,e,d,Rt.Qm[l]*r,Rt.tp[l]*r,y,w.Bl(ct.tf.id,lt.Yc,a,c,f,u,-1),m,512*l,Rt.Jm[l]),-1!==w.Ul&&n.Mt(new Tt(h,t,1,i,e,bt.Qs[w.Ul],!0))}else o===ct.ef.id?(s?.Md(t,i,e,d,0,0,y,w.Bl(ct.tf.id,lt.Yc,a,c,f,u,-1),m,l,256),-1!==w.Ul&&n.Mt(new Tt(h,t,1,i,e,bt.Qs[w.Ul],!0))):o===ct.sf.id?(s?.Md(t,i,e,d,0,0,y,w.Bl(ct.tf.id,lt.Yc,a,c,f,u,-1),m,l,512),-1!==w.Ul&&n.Mt(new Tt(h,t,1,i,e,bt.Qs[w.Ul],!0))):o===ct.nf.id&&(s?.Md(t,i,e,d,0,0,y,w.Bl(ct.tf.id,lt.Yc,a,c,f,u,-1),m,l,768),-1!==w.Ul&&n.Mt(new Tt(h,t,1,i,e,bt.Qs[w.Ul],!0)))};bp=(t,i,e)=>8&this.fp[t][i][e]?0:t<=0||!(2&this.fp[1][i][e])?t:t-1}class vt extends w{}class Lt extends vt{x=0;z=0;La=0;Lp=!1;size=1;Sp=-1;xp=-1;Mp=-1;kp=-1;Dp=-1;Np=-1;Fp=-1;Bp=null;Pp=100;Up=0;Wp=0;Gp=0;Yp=0;Hp=-1e3;Vp=0;Kp=0;Xp=-1;jp=0;zp=0;Zp=-1;qp=0;Jp=0;$p=-1;Qp=0;tA=0;iA=0;eA=0;sA=-1;nA=0;rA=0;hA=0;oA=0;lA=0;aA=0;cA=0;fA=0;uA=0;dA=0;wA=0;Yi=0;height=0;yA=0;pathLength=0;mA=new Int32Array(10);pA=new Int32Array(10);AA=new v(10,!1);_A=0;gA=-1;IA=-1;CA=-1;EA=-1;move(t,i,e){if(-1!==this.$p&&bt.Qs[this.$p].priority<=1&&(this.$p=-1),!t){const t=i-this.mA[0],s=e-this.pA[0];if(t>=-8&&t<=8&&s>=-8&&s<=8){this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.mA[t]=this.mA[t-1],this.pA[t]=this.pA[t-1],this.AA[t]=this.AA[t-1];return this.mA[0]=i,this.pA[0]=e,void(this.AA[0]=!1)}}this.pathLength=0,this._A=0,this.mA[0]=i,this.pA[0]=e,this.x=128*this.mA[0]+64*this.size,this.z=128*this.pA[0]+64*this.size}step(t,i){let e=this.mA[0],s=this.pA[0];0===i?(e--,s++):1===i?s++:2===i?(e++,s++):3===i?e--:4===i?e++:5===i?(e--,s--):6===i?s--:7===i&&(e++,s--),-1!==this.$p&&bt.Qs[this.$p].priority<=1&&(this.$p=-1),this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.mA[t]=this.mA[t-1],this.pA[t]=this.pA[t-1],this.AA[t]=this.AA[t-1];this.mA[0]=e,this.pA[0]=s,this.AA[0]=t}}class St extends It{static count=0;static Qs=[];static Uh=new q(30);static tn=t=>{const i=new O(t.read('spotanim.dat'));this.count=i.Jt;for(let t=0;t<this.count;t++)this.Qs[t]=new St(t).uw(i)};model=0;Ul=-1;ly=null;Gw=!1;Nw=new Uint16Array(6);Fw=new Uint16Array(6);TA=128;bA=128;orientation=0;Hw=0;Vw=0;decode(t,i){if(1===t)this.model=i.Jt;else if(2===t)this.Ul=i.Jt,bt.Qs&&(this.ly=bt.Qs[this.Ul]);else if(3===t)this.Gw=!0;else if(4===t)this.TA=i.Jt;else if(5===t)this.bA=i.Jt;else if(6===t)this.orientation=i.Jt;else if(7===t)this.Hw=i.Zt;else if(8===t)this.Vw=i.Zt;else if(t>=40&&t<50)this.Nw[t-40]=i.Jt;else{if(!(t>=50&&t<60))throw new Error(`Unrecognized spotanim config code: ${t}`);this.Fw[t-50]=i.Jt}}Bl(){let t=St.Uh?.get(BigInt(this.id));if(t)return t;t=j.model(this.model);for(let i=0;i<6;i++)0!==this.Nw[0]&&t.nh(this.Nw[i],this.Fw[i]);return St.Uh?.put(BigInt(this.id),t),t}}class xt extends It{static count=0;static Qs=[];static tn=t=>{const i=new O(t.read('idk.dat'));this.count=i.Jt;for(let t=0;t<this.count;t++)this.Qs[t]=new xt(t).uw(i)};type=-1;kw=null;OA=new Int32Array(5).fill(-1);Nw=new Int32Array(6);Fw=new Int32Array(6);disable=!1;decode(t,i){if(1===t)this.type=i.Zt;else if(2===t){const t=i.Zt;this.kw=new Int32Array(t);for(let e=0;e<t;e++)this.kw[e]=i.Jt}else if(3===t)this.disable=!0;else if(t>=40&&t<50)this.Nw[t-40]=i.Jt;else if(t>=50&&t<60)this.Fw[t-50]=i.Jt;else{if(!(t>=60&&t<70))throw new Error(`Unrecognized idk config code: ${t}`);this.OA[t-60]=i.Jt}}Bl(){if(!this.kw)return null;const t=new v(this.kw.length,null);for(let i=0;i<this.kw.length;i++)t[i]=j.model(this.kw[i]);let i;i=1===t.length?t[0]:j.Kr(t,t.length);for(let t=0;t<6&&0!==this.Nw[t];t++)i?.nh(this.Nw[t],this.Fw[t]);return i}RA(){let t=0;const i=new v(5,null);for(let e=0;e<5;e++)-1!==this.OA[e]&&(i[t++]=j.model(this.OA[e]));const e=j.Kr(i,t);for(let t=0;t<6&&0!==this.Nw[t];t++)e.nh(this.Nw[t],this.Fw[t]);return e}}class Mt extends It{static count=0;static cache=null;static zs=null;static bw=null;static Ow=0;static vA=!0;static Uh=new q(50);static LA=new q(200);static tn=(t,i)=>{this.vA=i,this.zs=new O(t.read('obj.dat'));const e=new O(t.read('obj.idx'));this.count=e.Jt,this.bw=new Int32Array(this.count);let s=2;for(let t=0;t<this.count;t++)this.bw[t]=s,s+=e.Jt;this.cache=new v(10,null);for(let t=0;t<10;t++)this.cache[t]=new Mt(-1)};static get=t=>{if(!this.cache||!this.bw||!this.zs)throw new Error('ObjType not loaded!!!');for(let i=0;i<10;i++){const e=this.cache[i];if(e&&e.id===t)return e}this.Ow=(this.Ow+1)%10;const i=this.cache[this.Ow];return this.zs.Xt=this.bw[t],i.id=t,i.reset(),i.uw(this.zs),-1!==i.SA&&i.xA(),!this.vA&&i.members&&(i.name='Members Object',i.Dw="Login to a members' server to use this object.",i.Mw=null,i.MA=null),i};static zi=()=>{this.Uh=null,this.LA=null,this.bw=null,this.cache=null,this.zs=null};static kA=(t,i)=>{if(Mt.LA){let e=Mt.LA.get(BigInt(t));if(e&&e.Ii!==i&&-1!==e.Ii&&(e.ht(),e=null),e)return e}let e=Mt.get(t);if(e.DA||(i=-1),e.DA&&e.NA&&i>1){let t=-1;for(let s=0;s<10;s++)i>=e.NA[s]&&0!==e.NA[s]&&(t=e.DA[s]);-1!==t&&(e=Mt.get(t))}const s=new J(32,32),n=N.Ni,r=N.Fi,h=N.Di,o=m.ft,l=m.ut,a=m.dt,c=m.left,f=m.right,u=m.top,d=m.bottom;N.Bi=!1,m.bind(s.ft,32,32),m.fillRect(0,0,32,32,Ot.by),N.Zi();const w=e.FA(1),y=N.sin[e.BA]*e.PA>>16,p=N.cos[e.BA]*e.PA>>16;w.ah(0,e.UA,e.WA,e.BA,e.GA,y+(w.Dr/2|0)+e.YA,p+e.YA);for(let t=31;t>=0;t--)for(let i=31;i>=0;i--)0===s.ft[t+32*i]&&(t>0&&s.ft[t+32*i-1]>1||i>0&&s.ft[t+32*(i-1)]>1||t<31&&s.ft[t+32*i+1]>1||i<31&&s.ft[t+32*(i+1)]>1)&&(s.ft[t+32*i]=1);for(let t=31;t>=0;t--)for(let i=31;i>=0;i--)0===s.ft[t+32*i]&&t>0&&i>0&&s.ft[t+32*(i-1)-1]>0&&(s.ft[t+32*i]=3153952);if(-1!==e.SA){const t=this.kA(e.HA,10),i=t.gi,s=t.Ii;t.gi=32,t.Ii=32,t.Ri(5,5,22,22),t.gi=i,t.Ii=s}return Mt.LA?.put(BigInt(t),s),m.bind(o,l,a),m._t(c,u,f,d),N.Ni=n,N.Fi=r,N.Di=h,N.Bi=!0,e.VA?s.gi=33:s.gi=32,s.Ii=i,s};model=0;name=null;Dw=null;Nw=null;Fw=null;PA=2e3;BA=0;UA=0;WA=0;GA=0;YA=0;KA=!1;XA=-1;VA=!1;jA=1;members=!1;Mw=null;MA=null;zA=-1;ZA=-1;qA=0;JA=-1;$A=-1;QA=0;t_=-1;i_=-1;e_=-1;s_=-1;n_=-1;r_=-1;DA=null;NA=null;HA=-1;SA=-1;decode(t,i){if(1===t)this.model=i.Jt;else if(2===t)this.name=i.ni;else if(3===t)this.Dw=i.ni;else if(4===t)this.PA=i.Jt;else if(5===t)this.BA=i.Jt;else if(6===t)this.UA=i.Jt;else if(7===t)this.GA=i.$t,this.GA>32767&&(this.GA-=65536);else if(8===t)this.YA=i.$t,this.YA>32767&&(this.YA-=65536);else if(9===t)this.KA=!0;else if(10===t)this.XA=i.Jt;else if(11===t)this.VA=!0;else if(12===t)this.jA=i.ti;else if(16===t)this.members=!0;else if(23===t)this.zA=i.Jt,this.qA=i.qt;else if(24===t)this.ZA=i.Jt;else if(25===t)this.JA=i.Jt,this.QA=i.qt;else if(26===t)this.$A=i.Jt;else if(t>=30&&t<35)this.Mw||(this.Mw=new v(5,null)),this.Mw[t-30]=i.ni,'hidden'===this.Mw[t-30]?.toLowerCase()&&(this.Mw[t-30]=null);else if(t>=35&&t<40)this.MA||(this.MA=new v(5,null)),this.MA[t-35]=i.ni;else if(40===t){const t=i.Zt;this.Nw=new Uint16Array(t),this.Fw=new Uint16Array(t);for(let e=0;e<t;e++)this.Nw[e]=i.Jt,this.Fw[e]=i.Jt}else 78===t?this.t_=i.Jt:79===t?this.i_=i.Jt:90===t?this.e_=i.Jt:91===t?this.n_=i.Jt:92===t?this.s_=i.Jt:93===t?this.r_=i.Jt:95===t?this.WA=i.Jt:97===t?this.HA=i.Jt:98===t?this.SA=i.Jt:t>=100&&t<110&&(this.DA&&this.NA||(this.DA=new Uint16Array(10),this.NA=new Uint16Array(10)),this.DA[t-100]=i.Jt,this.NA[t-100]=i.Jt)}h_(t){let i=this.zA;if(1===t&&(i=this.JA),-1===i)return null;let e=this.ZA,s=this.t_;1===t&&(e=this.$A,s=this.i_);let n=j.model(i);if(-1!==e){const t=j.model(e);if(-1===s){const i=[n,t];n=j.Kr(i,2)}else{const i=[n,t,j.model(s)];n=j.Kr(i,3)}}if(0===t&&0!==this.qA&&n.translate(this.qA,0,0),1===t&&0!==this.QA&&n.translate(this.QA,0,0),this.Nw&&this.Fw)for(let t=0;t<this.Nw.length;t++)n.nh(this.Nw[t],this.Fw[t]);return n}RA(t){let i=this.e_;if(1===t&&(i=this.n_),-1===i)return null;let e=this.s_;1===t&&(e=this.r_);let s=j.model(i);if(-1!==e){const t=[s,j.model(e)];s=j.Kr(t,2)}if(this.Nw&&this.Fw)for(let t=0;t<this.Nw.length;t++)s.nh(this.Nw[t],this.Fw[t]);return s}FA(t){if(this.DA&&this.NA&&t>1){let i=-1;for(let e=0;e<10;e++)t>=this.NA[e]&&0!==this.NA[e]&&(i=this.DA[e]);if(-1!==i)return Mt.get(i).FA(1)}if(Mt.Uh){const t=Mt.Uh.get(BigInt(this.id));if(t)return t}const i=j.model(this.model);if(this.Nw&&this.Fw)for(let t=0;t<this.Nw.length;t++)i.nh(this.Nw[t],this.Fw[t]);return i.hh(64,768,-50,-10,-50,!0),i.zr=!0,Mt.Uh?.put(BigInt(this.id),i),i}xA(){const t=Mt.get(this.SA);this.model=t.model,this.PA=t.PA,this.BA=t.BA,this.UA=t.UA,this.WA=t.WA,this.GA=t.GA,this.YA=t.YA,this.Nw=t.Nw,this.Fw=t.Fw;const i=Mt.get(this.HA);this.name=i.name,this.members=i.members,this.jA=i.jA;let e='a';const s=(i.name||'').toLowerCase().charAt(0);'a'!==s&&'e'!==s&&'i'!==s&&'o'!==s&&'u'!==s||(e='an'),this.Dw=`Swap this note at any bank for ${e} ${i.name}.`,this.VA=!0}reset(){this.model=0,this.name=null,this.Dw=null,this.Nw=null,this.Fw=null,this.PA=2e3,this.BA=0,this.UA=0,this.WA=0,this.GA=0,this.YA=0,this.KA=!1,this.XA=-1,this.VA=!1,this.jA=1,this.members=!1,this.Mw=null,this.MA=null,this.zA=-1,this.ZA=-1,this.qA=0,this.JA=-1,this.$A=-1,this.QA=0,this.t_=-1,this.i_=-1,this.e_=-1,this.s_=-1,this.n_=-1,this.r_=-1,this.DA=null,this.NA=null,this.HA=-1,this.SA=-1}}class kt extends Lt{static o_=1;static l_=2;static a_=4;static c_=8;static f_=16;static u_=32;static d_=64;static w_=128;static y_=256;static m_=512;static p_=[Ot.Im,Ot.Cm,Ot.Em,Ot.Tm,Ot.bm,Ot.Om,Ot.Rm,Ot.vm,Ot.Lm,Ot.Sm,Ot.xm,Ot.Mm,Ot.km,Ot.Dm,Ot.Nm,Ot.Fm];static A_=[[Ot.Vy,Ot.Ky,Ot.Xy,Ot.jy,Ot.zy,Ot.Zy,Ot.qy,Ot.Jy,Ot.$y,Ot.Qy,Ot.tm,Ot.im],[Ot.sm,Ot.nm,Ot.rm,Ot.hm,Ot.om,Ot.lm,Ot.am,Ot.fm,Ot.um,Ot.dm,Ot.wm,Ot.ym,Ot.pm,Ot.Am,Ot._m,Ot.gm],[Ot.gm-1,Ot.sm+1,Ot.nm,Ot.rm,Ot.hm,Ot.om,Ot.lm,Ot.am,Ot.fm,Ot.um,Ot.dm,Ot.wm,Ot.ym,Ot.pm,Ot.Am,Ot._m],[Ot.Bm,Ot.Pm,Ot.Um,Ot.Wm,Ot.Gm,Ot.Ym],[Ot.Vm,Ot.Km,Ot.Xm,Ot.jm,Ot.zm,Ot.Zm,Ot.qm,Ot.Hm]];static Uh=new q(200);name=null;visible=!1;__=0;g_=0;I_=new Uint16Array(12);C_=new Uint16Array(5);E_=0;T_=0n;y=0;b_=0;O_=0;R_=0;v_=0;L_=0;S_=null;tc=0;ec=0;ic=0;sc=0;Li=!1;draw(t){if(!this.visible)return null;let i=this.x_();if(this.height=i.Dr,i.zr=!0,this.Li)return i;if(-1!==this.sA&&-1!==this.nA){const t=St.Qs[this.sA],e=j.Br(t.Bl(),!0,!t.Gw,!1);e.translate(-this.oA,0,0),e.$r(),t.ly&&t.ly.frames&&e.ih(t.ly.frames[this.nA]),e.Yr=null,e.Gr=null,128===t.TA&&128===t.bA||e.scale(t.TA,t.bA,t.TA),e.hh(t.Hw+64,t.Vw+850,-30,-50,-30,!0);const s=[i,e];i=j.Hr(s,2)}if(this.S_&&(t>=this.O_&&(this.S_=null),t>=this.b_&&t<this.O_)){const t=this.S_;if(t){t.translate(this.v_-this.y,this.R_-this.x,this.L_-this.z),512===this.yA?(t.eh(),t.eh(),t.eh()):1024===this.yA?(t.eh(),t.eh()):1536===this.yA&&t.eh();const e=[i,t];i=j.Hr(e,2),512===this.yA?t.eh():1024===this.yA?(t.eh(),t.eh()):1536===this.yA&&(t.eh(),t.eh(),t.eh()),t.translate(this.y-this.v_,this.x-this.R_,this.z-this.L_)}}return i.zr=!0,i}isVisible(){return this.visible}read(t){t.Xt=0,this.__=t.Zt,this.g_=t.Zt;for(let i=0;i<12;i++){const e=t.Zt;this.I_[i]=0===e?0:(e<<8)+t.Zt}for(let i=0;i<5;i++){let e=t.Zt;(e<0||e>=kt.A_[i].length)&&(e=0),this.C_[i]=e}this.Sp=t.Jt,65535===this.Sp&&(this.Sp=-1),this.xp=t.Jt,65535===this.xp&&(this.xp=-1),this.Mp=t.Jt,65535===this.Mp&&(this.Mp=-1),this.kp=t.Jt,65535===this.kp&&(this.kp=-1),this.Dp=t.Jt,65535===this.Dp&&(this.Dp=-1),this.Np=t.Jt,65535===this.Np&&(this.Np=-1),this.Fp=t.Jt,65535===this.Fp&&(this.Fp=-1),this.name=$.Fh($.Mh(t.ii)),this.E_=t.Zt,this.visible=!0,this.T_=0n;for(let t=0;t<12;t++)this.T_<<=0x4n,this.I_[t]>=256&&(this.T_+=BigInt(this.I_[t])-256n);this.I_[0]>=256&&(this.T_+=BigInt(this.I_[0])-256n>>4n),this.I_[1]>=256&&(this.T_+=BigInt(this.I_[1])-256n>>8n);for(let t=0;t<5;t++)this.T_<<=0x3n,this.T_+=BigInt(this.C_[t]);this.T_<<=0x1n,this.T_+=BigInt(this.__)}RA(){if(!this.visible)return null;const t=new v(12,null);let i=0;for(let e=0;e<12;e++){const s=this.I_[e];if(s>=256&&s<512&&(t[i++]=xt.Qs[s-256].RA()),s>=512){const e=Mt.get(s-512).RA(this.__);e&&(t[i++]=e)}}const e=j.Kr(t,i);for(let t=0;t<5;t++)0!==this.C_[t]&&(e.nh(kt.A_[t][0],kt.A_[t][this.C_[t]]),1===t&&e.nh(kt.p_[0],kt.p_[this.C_[t]]));return e}x_(){let t=this.T_,i=-1,e=-1,s=-1,n=-1;if(this.$p>=0&&0===this.iA){const r=bt.Qs[this.$p];if(r.frames&&(i=r.frames[this.Qp]),this.Zp>=0&&this.Zp!==this.Sp){const t=bt.Qs[this.Zp].frames;t&&(e=t[this.qp])}r.Ay>=0&&(s=r.Ay,t+=BigInt(s-this.I_[5])<<8n),r._y>=0&&(n=r._y,t+=BigInt(n-this.I_[3])<<16n)}else if(this.Zp>=0){const t=bt.Qs[this.Zp].frames;t&&(i=t[this.qp])}let r=kt.Uh?.get(t);if(!r){const i=new v(12,null);let e=0;for(let t=0;t<12;t++){let r=this.I_[t];if(n>=0&&3===t&&(r=n),s>=0&&5===t&&(r=s),r>=256&&r<512){const t=xt.Qs[r-256].Bl();t&&(i[e++]=t)}if(r>=512){const t=Mt.get(r-512).h_(this.__);t&&(i[e++]=t)}}r=j.Kr(i,e);for(let t=0;t<5;t++)0!==this.C_[t]&&(r.nh(kt.A_[t][0],kt.A_[t][this.C_[t]]),1===t&&r.nh(kt.p_[0],kt.p_[this.C_[t]]));r.$r(),r.hh(64,850,-30,-50,-30,!0),kt.Uh?.put(t,r)}if(this.Li)return r;const h=j.Wr(r,!0);return-1!==i&&-1!==e?h.Qr(i,e,bt.Qs[this.$p].my):-1!==i&&h.ih(i),h.Vr(),h.Yr=null,h.Gr=null,h}}class Dt extends It{static count=0;static cache=null;static zs=null;static bw=null;static Ow=0;static Uh=new q(30);static tn=t=>{this.zs=new O(t.read('npc.dat'));const i=new O(t.read('npc.idx'));this.count=i.Jt,this.bw=new Int32Array(this.count);let e=2;for(let t=0;t<this.count;t++)this.bw[t]=e,e+=i.Jt;this.cache=new v(20,null);for(let t=0;t<20;t++)this.cache[t]=new Dt(-1)};static get=t=>{if(!this.cache||!this.bw||!this.zs)throw new Error('NpcType not loaded!!!');for(let i=0;i<20;i++){const e=this.cache[i];if(e&&e.id===t)return e}this.Ow=(this.Ow+1)%20;const i=this.cache[this.Ow]=new Dt(t);return this.zs.Xt=this.bw[t],i.uw(this.zs),i};static zi=()=>{this.Uh=null,this.bw=null,this.cache=null,this.zs=null};name=null;Dw=null;size=1;kw=null;OA=null;Gw=!1;M_=-1;k_=-1;D_=-1;N_=-1;F_=-1;Nw=null;Fw=null;Mw=null;Zw=-1;qw=-1;Jw=-1;B_=!0;P_=-1;TA=128;bA=128;decode(t,i){if(1===t){const t=i.Zt;this.kw=new Uint16Array(t);for(let e=0;e<t;e++)this.kw[e]=i.Jt}else if(2===t)this.name=i.ni;else if(3===t)this.Dw=i.ni;else if(12===t)this.size=i.qt;else if(13===t)this.M_=i.Jt;else if(14===t)this.k_=i.Jt;else if(16===t)this.Gw=!0;else if(17===t)this.k_=i.Jt,this.D_=i.Jt,this.N_=i.Jt,this.F_=i.Jt;else if(t>=30&&t<40)this.Mw||(this.Mw=new v(5,null)),this.Mw[t-30]=i.ni,'hidden'===this.Mw[t-30]?.toLowerCase()&&(this.Mw[t-30]=null);else if(40===t){const t=i.Zt;this.Nw=new Uint16Array(t),this.Fw=new Uint16Array(t);for(let e=0;e<t;e++)this.Nw[e]=i.Jt,this.Fw[e]=i.Jt}else if(60===t){const t=i.Zt;this.OA=new Uint16Array(t);for(let e=0;e<t;e++)this.OA[e]=i.Jt}else 90===t?this.Zw=i.Jt:91===t?this.qw=i.Jt:92===t?this.Jw=i.Jt:93===t?this.B_=!1:95===t?this.P_=i.Jt:97===t?this.TA=i.Jt:98===t&&(this.bA=i.Jt)}x_(t,i,e){let s=null,n=null;if(Dt.Uh&&(n=Dt.Uh.get(BigInt(this.id)),!n&&this.kw)){const t=new v(this.kw.length,null);for(let i=0;i<this.kw.length;i++)t[i]=j.model(this.kw[i]);if(n=1===t.length?t[0]:j.Kr(t,t.length),this.Nw&&this.Fw)for(let t=0;t<this.Nw.length;t++)n?.nh(this.Nw[t],this.Fw[t]);n?.$r(),n?.hh(64,850,-30,-50,-30,!0),n&&Dt.Uh.put(BigInt(this.id),n)}return n?(s=j.Wr(n,!this.Gw),-1!==t&&-1!==i?s.Qr(t,i,e):-1!==t&&s.ih(t),128===this.TA&&128===this.bA||s.scale(this.TA,this.bA,this.TA),s.Vr(),s.Yr=null,s.Gr=null,1===this.size&&(s.zr=!0),s):null}RA(){if(!this.OA)return null;const t=new v(this.OA.length,null);for(let i=0;i<this.OA.length;i++)t[i]=j.model(this.OA[i]);let i;if(i=1===t.length?t[0]:j.Kr(t,t.length),this.Nw&&this.Fw)for(let t=0;t<this.Nw.length;t++)i?.nh(this.Nw[t],this.Fw[t]);return i}}class Nt extends It{static count=0;static Qs=[];static U_=[];static W_=0;static tn=t=>{const i=new O(t.read('varp.dat'));this.count=i.Jt;for(let t=0;t<this.count;t++)this.Qs[t]=new Nt(t).uw(i)};scope=0;type=0;U_=!1;G_=!0;Y_=0;H_=0;V_=!1;K_=!1;decode(t,i){if(1===t)this.scope=i.Zt;else if(2===t)this.type=i.Zt;else if(3===t)this.U_=!0,Nt.U_[Nt.W_++]=this.id;else if(4===t)this.G_=!1;else if(5===t)this.Y_=i.Jt;else if(6===t)this.V_=!0;else if(7===t)this.H_=i.ti;else if(8===t)this.K_=!0;else{if(10!==t)throw new Error(`Error unrecognised config code: ${t}`);this.fw=i.ni}}}function Ft(t,i){var e;(e=document.createElement('a')).href=t,e.download=i,document.body.appendChild(e),e.style='display: none',e.click(),e.remove()}class Bt{X_=new Map;j_;z_=self.isSecureContext?self.crypto.randomUUID():'0';constructor(t){this.j_=t}async Z_(){const t=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]}),i=t.createDataChannel('channel'),e=crypto.randomUUID();this.X_.set(e,i),await t.setLocalDescription(await t.createOffer()),t.onicegatheringstatechange=async()=>{if('complete'===t.iceGatheringState){let i;self.isSecureContext?await navigator.clipboard.writeText(JSON.stringify(t.localDescription)):console.log(JSON.stringify(t.localDescription));try{for(;null===(i=prompt('Offer copied to clipboard, paste answer here')););t.setRemoteDescription(new RTCSessionDescription(JSON.parse(i)))}catch(t){console.error(t)}}},i.onopen=()=>{i.send(JSON.stringify({type:'id',id:e})),console.log('Connected to peer!')},i.onerror=t=>{console.error(t)},i.onmessage=t=>{const i=JSON.parse(t.data);i.data&&(i.data=Object.values(i.data)),this.j_&&this.j_.postMessage(i)}}postMessage(t){const i=this.X_.get(t.data.id),e=t.data;e.data&&(e.data=Array.from(t.data.data)),i&&'open'===i.readyState&&i.send(JSON.stringify(e))}}class Pt{pc;q_=void 0;z_;constructor(t){this.pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]}),this.pc.ondatachannel=i=>{this.q_=i.channel,this.q_.onopen=()=>{console.log('Connected to host!')},this.q_.onerror=t=>{console.error(t)},this.q_.onmessage=i=>{if(!this.z_){const t=JSON.parse(i.data);if('id'===t.type)return void(this.z_=t.id)}t.onmessage&&t.onmessage(i)}},this.pc.onicegatheringstatechange=async()=>{'complete'===this.pc.iceGatheringState&&(self.isSecureContext?await navigator.clipboard.writeText(JSON.stringify(this.pc.localDescription)):console.log(JSON.stringify(this.pc.localDescription)))}}async J_(t){await this.pc.setRemoteDescription(new RTCSessionDescription(JSON.parse(t))),await this.pc.setLocalDescription(await this.pc.createAnswer())}}class Ut extends U{static Q_=225;static tg=10;static portOffset=0;static members=!0;static Li=!1;static ig='';static eg='';static sg=!1;static ng=2;static rg=!1;static hg='https://raw.githubusercontent.com/2004scape/Server/main';static exponent=58778699976184461502525193738213253649000149147835990136706041084440742975821n;static og=7162900525229798032761816791230527296329313291232324290237849263501208207972894053929065636522363163621000728841182238772712427862772219676577293600221789n;static lg=0;static ag=0;static cg=0;static fg=0;static ug=0;static dg=0;static wg=0;static yg=0;static mg=0;static pg=0;static Ag=0;static _g=0;static gg=0;static Ig=0;static Cg=0;static Eg=()=>{gt.Li=!1,N.Li=!1,Ut.Li=!1,Rt.Li=!1};static Tg=()=>{gt.Li=!0,N.Li=!0,Ut.Li=!0,Rt.Li=!0};bg=2048;Og=2047;Rg=!1;vg=!1;Lg=!1;Sg=!1;db=null;xg=0;Mg=[];stream=null;in=O.zt(1);kg=O.zt(1);Dg=O.zt(1);Ng=0n;Fg=0;Bg=0;Pg=0;Ug=null;Wg=0;packetSize=0;Gg=0;Yg=0;Hg=0;Vg=null;Kg=!0;Xg=0;jg=0;zg=null;Zg=null;qg=null;Jg=null;$g=null;Qg=null;tI=null;iI=null;eI=null;sI=null;nI=null;rI='';hI='';username='';password='';oI=null;lI=null;aI=null;cI=null;fI=[];uI=!1;dI=null;wI=null;yI=null;mI=null;pI=null;AI=null;_I=null;gI=null;II=null;CI=null;EI=new Int32Array(256);TI=0;bI=0;OI=0;RI=null;vI=null;LI=null;SI=null;xI=null;MI=null;kI=null;DI=null;NI=null;FI=null;BI=null;UI=null;WI=null;GI=null;YI=null;HI=null;VI=null;KI=null;XI=null;jI=null;zI=null;ZI=new Int32Array(33);qI=new Int32Array(33);JI=new Int32Array(151);$I=new Int32Array(151);QI=null;tC=null;iC=null;eC=null;sC=null;nC=null;rC=new v(13,null);hC=null;oC=null;lC=new v(50,null);aC=new v(50,null);cC=new v(20,null);fC=new v(20,null);uC=null;dC=new v(8,null);wC=null;yC=null;mC=null;pC=null;AC=null;_C=null;gC=null;IC=null;CC=null;EC=null;TC=null;bC=null;OC=null;RC=null;vC=null;LC=null;SC=null;xC=null;MC=new v(1e3,null);kC=!1;DC=!1;NC=!1;FC=!1;BC=-1;PC=0;UC=0;WC=0;GC=0;YC=0;HC=0;VC=!1;KC=0;XC=0;jC=0;zC=0;ZC=0;qC=0;JC=[];$C=-1;QC=-1;tE=new Q;iE=78;eE=0;sE=0;nE=[];rE=0;hE=0;oE=0;lE=0;aE=0;cE=0;fE=0;uE=0;dE=[];wE=[];yE=[];mE=[];pE=null;AE=-1;_E=3;gE=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];IE=0;CE=0;EE=0;TE=!1;bE=0;OE=!1;RE='';vE='';LE=0;SE='';xE=!1;ME=-1;kE=new v(100,null);DE=new v(100,null);messageType=new Int32Array(100);NE=new Int32Array(100);FE=0;BE=0;PE=0;UE='';WE=0;GE=0;YE=0;HE=0;VE=0;KE=0;XE=0;jE=0;zE=0;ZE=!1;qE=0;JE=0;$E=0;QE=0;tT=null;iT=0;eT=0;sT=0;nT=0;rT=!1;hT=[];oT=[];lT=0;aT=0;cT=0;fT=null;uT=0;dT=new Int32Array(500);wT=new Int32Array(500);yT=new Int32Array(500);mT=new Int32Array(500);pT=0;AT=0;_T=0;gT='';IT=!1;CT=-1;ET=0;TT=0;bT=0;OT=0;RT=0;vT=new Int32Array(1e3);LT=new Int32Array(1e3);ST=null;xT=0;MT=0;kT=0;DT=0;NT=0;FT=!1;BT=0;PT=0;UT=0;WT=0;GT=2;YT=2;HT=1;VT=new Int32Array(5);KT=new v(5,!1);XT=new Int32Array(5);jT=new Int32Array(5);zT=new Int32Array(5);ZT=0;qT=0;JT=0;$T=0;QT=0;tb=0;ib=0;eb=0;sb=0;nb=1;rb=2;hb=-1;Jn=0;Qn=0;ob=0;lb=0;ab=0;cb=0;fb=null;ub=null;wb=null;yb=0;mb=0;pb=new Int8Array(16384);Ab=new v(ut._f,null);_b=0;gb=0;Ib=128;Cb=0;Eb=0;Tb=0;bb=0;Ob=0;cp=null;fp=null;Rb=new k(ut.gf,ut.gf);vb=0;Lb=0;Sb=0;xb=0;Mb=0;kb=0;Db=0;Nb=0;Fb=0;Bb=0;Pb=0;Ub=0;Wb=new v(this.bg,null);Gb=0;Yb=new Int32Array(this.bg);Hb=0;Vb=0;Kb=new Int32Array(this.bg);Xb=new Int32Array(1e3);jb=new v(this.bg,null);zb=new v(8192,null);Zb=0;qb=new Int32Array(8192);Jb=new b;$b=new b;Qb=new b;pd=new b;tO=new S(ut._f,ut.gf,ut.gf,null);iO=new b;eO=new Int32Array(4e3);sO=new Int32Array(4e3);nO=new Int32Array(ut.gf*ut.gf);rO=new Int32Array(ut.gf*ut.gf);hO=0;oO=null;lO=0;aO=0;cO=-1;fO=0;uO=0;dO=0;wO=0;yO=!1;mO=!0;pO=!1;AO=new Int32Array(7);_O=new Int32Array(5);gO=0;IO=0;static CO=50;EO=new Int32Array(Ut.CO);TO=new Int32Array(Ut.CO);bO=new Int32Array(Ut.CO);OO=new Int32Array(Ut.CO);RO=new Int32Array(Ut.CO);vO=new Int32Array(Ut.CO);LO=new Int32Array(Ut.CO);SO=new v(Ut.CO,null);xO=new v(100,null);MO=new BigInt64Array(100);kO=new Int32Array(100);DO=null;NO=0;FO=!0;BO=new Int32Array(50);PO=new Int32Array(50);UO=new Int32Array(50);WO=192;GO=-1;YO=-1;HO=0;VO=0;KO=0;XO=!0;jO=null;zO=0;ZO=0;qO=192;j_=void 0;JO=!1;host=null;$O=null;QO=new v(16,null);tR=0;iR=!1;zi=()=>{try{this.stream&&this.stream.close()}catch(t){}var t;this.$O&&'998'===Ut.getParameter('world')&&this.$O.q_?.send(JSON.stringify({type:'close',id:this.$O.z_})),this.stream=null,t=!1,window._tinyMidiStop&&window._tinyMidiStop(t),this.kg=null,this.Dg=null,this.in=null,this.wb=null,this.fb=null,this.ub=null,this.cp=null,this.fp=null,this.ST=null,this.Ab=null,this.nO=null,this.rO=null,this.eO=null,this.sO=null,this.pb=null,this.vI=null,this.LI=null,this.SI=null,this.xI=null,this.MI=null,this.kI=null,this.DI=null,this.NI=null,this.FI=null,this.BI=null,this.UI=null,this.WI=null,this.GI=null,this.YI=null,this.HI=null,this.VI=null,this.KI=null,this.QI=null,this.iC=null,this.tC=null,this.eC=null,this.sC=null,this.nC=null,this.rC=null,this.gC=null,this.IC=null,this.CC=null,this.EC=null,this.TC=null,this.bC=null,this.OC=null,this.RC=null,this.vC=null,this.LC=null,this.oC=null,this.cC=null,this.fC=null,this.dC=null,this.wC=null,this.yC=null,this.mC=null,this.pC=null,this.lC=null,this.aC=null,this.Rb=null,this.Wb=null,this.Yb=null,this.Kb=null,this.jb=null,this.Xb=null,this.zb=null,this.qb=null,this.tO=null,this.iO=null,this.pd=null,this.Jb=null,this.$b=null,this.Qb=null,this.yT=null,this.mT=null,this.dT=null,this.wT=null,this.JC=null,this.hT=null,this.vT=null,this.LT=null,this.MC=null,this.hC=null,this.xO=null,this.MO=null,this.kO=null,this.Jg=null,this.$g=null,this.zg=null,this.Zg=null,this.qg=null,this.Qg=null,this.tI=null,this.iI=null,this.eI=null,this.eR(),Et.zi(),Dt.zi(),Mt.zi(),Ct.Qs=null,xt.Qs=null,Q.Qs=null,bt.Qs=null,St.Qs=null,St.Uh=null,Nt.Qs=null,this.ke=null,kt.Uh=null,N.zi(),gt.zi(),j.zi(),H.Qs=[],V.Qs=[]};ks(){return this.Xg}xs(){return this.xE}Ms(){return this.OE}Ss(){return this.QC}Ls(){return this.BC}eR=()=>{this.uI=!1,this.RI&&(clearInterval(this.RI),this.RI=null),this.sI=null,this.nI=null,this.fI=[],this._I=null,this.gI=null,this.II=null,this.CI=null,this.mI=null,this.yI=null,this.pI=null,this.AI=null,this.dI=null,this.wI=null};sR=()=>{'999'===Ut.getParameter('world')?(this.j_=new Worker('worker.js',{type:'module'}),this.j_.onmessage=this.onmessage,this.host=new Bt(this.j_)):'998'===Ut.getParameter('world')&&(this.j_={onmessage:t=>{this.stream.nR.onmessage(t)},postMessage:t=>{this.$O&&this.$O.q_&&'open'===this.$O.q_.readyState&&this.$O.q_.send(JSON.stringify(t))},onerror:null,onmessageerror:null,terminate:()=>{throw new Error},addEventListener:()=>{throw new Error},removeEventListener:()=>{throw new Error},dispatchEvent:()=>{throw new Error}},this.$O=new Pt(this.j_))};onmessage=t=>{switch(t.data.type){case'ready':return void(this.JO=!0);case'save':return Ft(t.data.value,t.data.path.split('/').pop().split('\\').pop()),void URL.revokeObjectURL(t.data.value);case'close':return void this.j_?.postMessage({type:'close',id:t.data.id})}this.host?.z_===t.data.id?this.stream.nR.onmessage(t.data):this.host?.postMessage(t)};rR=async()=>{if(999==+Ut.getParameter('world'))this.host&&await this.host.Z_();else if(998==+Ut.getParameter('world')&&this.$O){if(this.$O.q_)return void console.log('You are already connected.');let t;try{for(;null===(t=prompt('Paste offer here, answer will be copied to clipboard')););await this.$O.J_(t)}catch(t){console.error(t)}}};hR=async(t,i,e,s)=>{let n=5,r=await(this.db?.Fs(t));if(r&&O.Kt(r)!==e&&(r=void 0),r)return new G(r);for(;!r;){await this.ds(s,`Requesting ${i}`);try{r=+Ut.getParameter('world')<998?await T(`${Ut.eg}/${t}${e}`):await T(`${Ut.eg}/${t}`)}catch(t){r=void 0;for(let t=n;t>0;t--)await this.ds(s,`Error loading - Will retry in ${t} secs.`),await E(1e3);n*=2,n>60&&(n=60)}}return await(this.db?.Bs(t,r)),new G(r)};oR=async(t,e,s,n)=>{let r=await(this.db?.Fs(t+'.mid'));if(r&&12345678!==e&&O.Kt(r)!==e&&(r=void 0),!r)try{r=+Ut.getParameter('world')<998?await T(`${Ut.eg}/${t}_${e}.mid`):await T(`${Ut.eg}/songs/${t}.mid`),s!==r.length&&(r=r.slice(0,s))}catch(t){}if(!r)return;await(this.db?.Bs(t+'.mid',r));const h=new O(Uint8Array.from(r)).ti;!function(t,i,e){window._tinyMidiPlay&&window._tinyMidiPlay(t,i/256,e)}(i.read(h,r,s,4),this.qO,n)};lR=()=>{if(A.fillStyle='black',A.fillRect(0,0,this.width,this.height),this.ys(1),this.Lg){this.uI=!1,A.font='bold 16px helvetica, sans-serif',A.textAlign='left',A.fillStyle='yellow';let t=35;A.fillText('Sorry, an error has occured whilst loading RuneScape',30,t),t+=50,A.fillStyle='white',A.fillText('To fix this try the following (in order):',30,t),t+=50,A.font='bold 12px helvetica, sans-serif',A.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,A.fillText('2: Try clearing your web-browsers cache from tools->internet options',30,t),t+=30,A.fillText('3: Try using a different game-world',30,t),t+=30,A.fillText('4: Try rebooting your computer',30,t),t+=30,A.fillText('5: Try selecting a different version of Java from the play-game menu',30,t)}if(this.Sg&&(this.uI=!1,A.font='bold 20px helvetica, sans-serif',A.textAlign='left',A.fillStyle='white',A.fillText('Error - unable to load game!',50,50),A.fillText('To play RuneScape make sure you play from',50,100),A.fillText('https://2004scape.org',50,150)),this.vg){this.uI=!1,A.font='bold 13px helvetica, sans-serif',A.textAlign='left',A.fillStyle='yellow';let t=35;A.fillText('Error a copy of RuneScape already appears to be loaded',30,t),t+=50,A.fillStyle='white',A.fillText('To fix this try the following (in order):',30,t),t+=50,A.font='bold 12px helvetica, sans-serif',A.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,A.fillText('2: Try rebooting your computer, and reloading',30,t)}};aR=t=>{if(!t.dl)return!1;for(let i=0;i<t.dl.length;i++){const e=this.cR(t,i);if(!t.wl)return!1;const s=t.wl[i];if(2===t.dl[i]){if(e>=s)return!1}else if(3===t.dl[i]){if(e<=s)return!1}else if(4===t.dl[i]){if(e===s)return!1}else if(e!==s)return!1}return!0};fR=(t,i,e,s,n)=>{this.AC?.draw(t,i),this._C?.draw(t,i+n-16),m.fillRect(t,i+16,16,n-32,Ot.By);let r=(n-32)*n/s|0;r<8&&(r=8);const h=(n-r-32)*e/(s-n)|0;m.fillRect(t,i+h+16,16,r,Ot.Py),m.Et(t,i+h+16,Ot.Uy,r),m.Et(t+1,i+h+16,Ot.Uy,r),m.Ct(t,i+h+16,Ot.Uy,16),m.Ct(t,i+h+17,Ot.Uy,16),m.Et(t+15,i+h+16,Ot.Wy,r),m.Et(t+14,i+h+17,Ot.Wy,r-1),m.Ct(t,i+h+r+15,Ot.Wy,16),m.Ct(t+1,i+h+r+14,Ot.Wy,15)};uR=(t,i)=>{let e=!1;const s=Q.Qs[t];if(!s.yl)return!1;for(let t=0;t<s.yl.length&&-1!==s.yl[t];t++){const n=Q.Qs[s.yl[t]];if(1===n.type&&(e||=this.uR(n.id,i)),6===n.type&&(-1!==n.Ul||-1!==n.Wl)){let t;if(t=this.aR(n)?n.Wl:n.Ul,-1!==t){const s=bt.Qs[t];if(n.zl+=i,s.delay)for(;n.zl>s.delay[n.jl];)n.zl-=s.delay[n.jl]+1,n.jl++,n.jl>=s.wy&&(n.jl-=s.uy,(n.jl<0||n.jl>=s.wy)&&(n.jl=0)),e=!0}}}return e};dR=(t,i,e,s,n=!1)=>{if(0!==t.type||!t.yl||t.hide&&this.WE!==t.id&&this.GE!==t.id&&this.YE!==t.id)return;const r=m.left,h=m.top,o=m.right,l=m.bottom;m._t(i,e,i+t.width,e+t.height);const a=t.yl.length;for(let r=0;r<a;r++){if(!t.ml||!t.pl)continue;let h=t.ml[r]+i,o=t.pl[r]+e-s;const l=Q.Qs[t.yl[r]];if(h+=l.x,o+=l.y,n&&m.It(h,o,l.width,l.height,Ot.Ty),l.fl>0&&this.wR(l),l.type===Q.Wh)l.Xl>l.scroll-l.height&&(l.Xl=l.scroll-l.height),l.Xl<0&&(l.Xl=0),this.dR(l,h,o,l.Xl,n),l.scroll>l.height&&this.fR(h+l.width,o,l.Xl,l.scroll,l.height);else if(l.type===Q.Yh){let t=0;for(let i=0;i<l.height;i++)for(let e=0;e<l.width;e++){if(!(l.Tl&&l.bl&&l.Al&&l._l))continue;let s=h+e*(l.Cl+32),n=o+i*(l.El+32);if(t<20&&(s+=l.Tl[t],n+=l.bl[t]),l.Al[t]>0){let i=0,e=0;const r=l.Al[t]-1;if(s>=-32&&s<=512&&n>=-32&&n<=334||0!==this.KE&&this.VE===t){const h=Mt.kA(r,l._l[t]);if(0!==this.KE&&this.VE===t&&this.HE===l.id?(i=this.Xe-this.XE,e=this.je-this.jE,i<5&&i>-5&&(i=0),e<5&&e>-5&&(e=0),this.zE<5&&(i=0,e=0),h.Ch(128,s+i,n+e)):0!==this.iT&&this.eT===t&&this.sT===l.id?h.Ch(128,s,n):h.draw(s,n),33===h.gi||1!==l._l[t]){const r=l._l[t];this.oI?.yR(s+i+1,n+10+e,this.mR(r),Ot.by),this.oI?.yR(s+i,n+9+e,this.mR(r),Ot.Iy)}}}else if(l.Ol&&t<20){const i=l.Ol[t];i?.draw(s,n)}t++}}else if(l.type===Q.Hh)l.fill?m.fillRect(h,o,l.width,l.height,l.Ml):m.It(h,o,l.width,l.height,l.Ml);else if(l.type===Q.Vh){const t=l.font;let i=l.Ml,e=l.text;if(this.YE!==l.id&&this.GE!==l.id&&this.WE!==l.id||0===l.Dl||(i=l.Dl),this.aR(l)&&(i=l.kl,l.xl&&l.xl.length>0&&(e=l.xl)),l.cl===Q.Qh&&this.rT&&(e='Please wait...',i=l.Ml),!t||!e)continue;for(let s=o+t.height;e.length>0;s+=t.height){if(-1!==e.indexOf('%')){for(;;){const t=e.indexOf('%1');if(-1===t)break;e=e.substring(0,t)+this.pR(this.cR(l,0))+e.substring(t+2)}for(;;){const t=e.indexOf('%2');if(-1===t)break;e=e.substring(0,t)+this.pR(this.cR(l,1))+e.substring(t+2)}for(;;){const t=e.indexOf('%3');if(-1===t)break;e=e.substring(0,t)+this.pR(this.cR(l,2))+e.substring(t+2)}for(;;){const t=e.indexOf('%4');if(-1===t)break;e=e.substring(0,t)+this.pR(this.cR(l,3))+e.substring(t+2)}for(;;){const t=e.indexOf('%5');if(-1===t)break;e=e.substring(0,t)+this.pR(this.cR(l,4))+e.substring(t+2)}}const n=e.indexOf('\\n');let r;-1!==n?(r=e.substring(0,n),e=e.substring(n+2)):(r=e,e=''),l.Ll?t.AR(h+(l.width/2|0),s,r,i,l.Sl):t._R(h,s,r,i,l.Sl)}}else if(l.type===Q.Kh){let t;t=this.aR(l)?l.Fl:l.Nl,t?.draw(h,o)}else if(l.type===Q.Xh){const t=N.Ni,i=N.Fi;N.Ni=h+(l.width/2|0),N.Fi=o+(l.height/2|0);const e=N.sin[l.Gl]*l.zoom>>16,s=N.cos[l.Gl]*l.zoom>>16,n=this.aR(l);let r;r=n?l.Wl:l.Ul;let a=null;if(-1===r)a=l.Bl(-1,-1,n);else{const t=bt.Qs[r];t.frames&&t.yy&&(a=l.Bl(t.frames[l.jl],t.yy[l.jl],n))}a&&a.ah(0,l.Yl,0,l.Gl,0,e,s),N.Ni=t,N.Fi=i}else if(l.type===Q.jh){const t=l.font;if(!t||!l.Al||!l._l)continue;let i=0;for(let e=0;e<l.height;e++)for(let s=0;s<l.width;s++){if(l.Al[i]>0){const n=Mt.get(l.Al[i]-1);let r=n.name;if((n.VA||1!==l._l[i])&&(r=r+' x'+this.gR(l._l[i])),!r)continue;const a=h+s*(l.Cl+115),c=o+e*(l.El+12);l.Ll?t.AR(a+(l.width/2|0),c,r,l.Ml,l.Sl):t._R(a,c,r,l.Ml,l.Sl)}i++}}}m._t(r,h,o,l)};wR=t=>{let i=t.fl;if(i>=Q.io&&i<=Q.eo)i--,i>=this.gO?(t.text='',t.cl=0):(t.text=this.xO[i],t.cl=1);else if(i>=Q.so&&i<=Q.no)i-=Q.so,i>=this.gO?(t.text='',t.cl=0):(0===this.kO[i]?t.text='@red@Offline':this.kO[i]===Ut.tg?t.text='@gre@World-'+(this.kO[i]-9):t.text='@yel@World-'+(this.kO[i]-9),t.cl=1);else if(i===Q.oo)t.scroll=15*this.gO+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(i>=Q.Po&&i<=Q.Uo)i-=Q.Po,i>=this.sE?(t.text='',t.cl=0):(t.text=$.Fh($.Mh(this.nE[i])),t.cl=1);else if(i===Q.Yo)t.scroll=15*this.sE+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(i===Q.Bo){if(t.Gl=150,t.Yl=256*Math.sin(this.xg/40)&2047,this.pO){this.pO=!1;const i=new v(7,null);let e=0;for(let t=0;t<7;t++){const s=this.AO[t];s>=0&&(i[e++]=xt.Qs[s].Bl())}const s=j.Kr(i,e);for(let t=0;t<5;t++)0!==this._O[t]&&(s.nh(kt.A_[t][0],kt.A_[t][this._O[t]]),1===t&&s.nh(kt.p_[0],kt.p_[this._O[t]]));if(this.oO){const i=bt.Qs[this.oO.Sp].frames;i&&(s.$r(),s.ih(i[0]),s.hh(64,850,-30,-50,-30,!0),t.model=s)}}}else if(i===Q.Do)this.SC||(this.SC=t.Nl,this.xC=t.Fl),this.mO?t.Nl=this.xC:t.Nl=this.SC;else if(i===Q.No)this.SC||(this.SC=t.Nl,this.xC=t.Fl),this.mO?t.Nl=this.SC:t.Nl=this.xC;else if(i===Q.Ho)t.text=this.gT,this.xg%20<10?t.text=t.text+'|':t.text=t.text+' ';else if(i===Q.el)this.yO?this.IT?(t.Ml=Ot.RED,t.text='Moderator option: Mute player for 48 hours: <ON>'):(t.Ml=Ot.Ty,t.text='Moderator option: Mute player for 48 hours: <OFF>'):t.text='';else if(i===Q.sl||i===Q.ll)if(0===this.ET)t.text='';else{let i;i=0===this.TT?'earlier today':1===this.TT?'yesterday':this.TT+' days ago',t.text='You last logged in '+i+' from: '+$.Nh(this.ET)}else if(i===Q.nl)0===this.OT&&(t.text='0 unread messages',t.Ml=Ot.Iy),1===this.OT&&(t.text='1 unread message',t.Ml=Ot.GREEN),this.OT>1&&(t.text=this.OT+' unread messages',t.Ml=Ot.GREEN);else if(i===Q.rl)if(201===this.bT)t.text='';else if(200===this.bT)t.text='You have not yet set any password recovery questions.';else{let i;i=0===this.bT?'Earlier today':1===this.bT?'Yesterday':this.bT+' days ago',t.text=i+' you changed your recovery questions'}else i===Q.hl?201===this.bT?t.text='':200===this.bT?t.text='We strongly recommend you do so now to secure your account.':t.text='If you do not remember making this change then cancel it immediately':i===Q.ol&&(201===this.bT?t.text='':(this.bT,t.text="Do this from the 'account management' area on our front webpage"))};cR=(t,i)=>{if(!t.scripts||i>=t.scripts.length)return-2;try{const e=t.scripts[i];if(!e)return-1;let s=0,n=0;for(;;){const t=e[n++];if(0===t)return s;if(1===t)s+=this.wE[e[n++]];else if(2===t)s+=this.yE[e[n++]];else if(3===t)s+=this.dE[e[n++]];else if(4===t){const t=Q.Qs[e[n++]],i=e[n++]+1;if(t.Al&&t._l)for(let e=0;e<t.Al.length;e++)t.Al[e]===i&&(s+=t._l[e]);else s+=0}else if(5===t)s+=this.hT[e[n++]];else if(6===t)s+=this.mE[this.yE[e[n++]]-1];else if(7===t)s+=100*this.hT[e[n++]]/46875|0;else if(8===t)s+=this.oO?.E_||0;else if(9===t)for(let t=0;t<19;t++)18===t&&(t=20),s+=this.yE[t];else if(10===t){const t=Q.Qs[e[n++]],i=e[n++]+1;for(let e=0;e<t.Al.length;e++)if(t.Al[e]===i){s+=999999999;break}}else if(11===t)s+=this.lO;else if(12===t)s+=this.fO;else if(13===t){const t=this.hT[e[n++]];s+=t&1<<e[n++]?1:0}}}catch(t){return-1}};pR=t=>t<999999999?String(t):'*';gR=t=>{let i=String(t);for(let t=i.length-3;t>0;t-=3)i=i.substring(0,t)+','+i.substring(t);return i.length>8?i='@gre@'+i.substring(0,i.length-8)+' million @whi@('+i+')':i.length>4&&(i='@cya@'+i.substring(0,i.length-4)+'K @whi@('+i+')'),' '+i};mR=t=>t<1e5?String(t):t<1e7?(t/1e3|0)+'K':(t/1e6|0)+'M'}(new class extends Ut{Rg=!1;vg=!1;Lg=!1;Sg=!1;IR=null;CR=null;ER=null;TR=null;bR=null;OR=null;Du=0;Nu=0;Fu=0;RR=0;vR=0;LR=2;model={id:parseInt(U.getParameter('model'))||0,SR:null,x:0,y:0,z:420,La:0};constructor(){super(!0)}load=async()=>{if(this.Rg)this.vg=!0;else{this.Rg=!0;try{await async function(t){if(o||h)return;o=!0;const i=await r(t);h||(h=i)}(),await i.load(await(await fetch('bz2.wasm')).arrayBuffer()),this.db=new W(await W.openDatabase()),this.ke?.bind(),N.Zi(),this.IR=document.getElementById('rightPanel');const t=document.getElementById('mainPanel');t&&(t.ondragover=t=>{t.preventDefault(),t.stopPropagation()},t.ondrop=async t=>{if(t.preventDefault(),t.stopPropagation(),!t.dataTransfer||!t.dataTransfer.files.length)return;const i=['main_file_cache.dat','main_file_cache.idx0','main_file_cache.idx1','main_file_cache.idx2','main_file_cache.idx3','main_file_cache.idx4'],e=[];for(let s=0;s<t.dataTransfer.files.length;s++){const n=t.dataTransfer.files[s];i.includes(n.name)&&e.push(n)}for(let t=0;t<e.length;t++){const i=e[t],s=await i.arrayBuffer();await(this.db?.Bs(i.name,new Int8Array(s)))}await this.init()}),await this.init()}catch(t){this.Lg=!0,console.error(t)}}};update=async()=>{this.vg||this.Lg||this.Sg||(this.xR(),this.MR())};draw=async()=>{this.vg||this.Lg||this.Sg?this.lR():(m.clear(),m.fillRect(0,0,this.width,this.height,Ot.by),null!==this.model.SR&&this.model.SR.draw(this.model.La,N.sin[this.RR],N.cos[this.RR],N.sin[this.vR],N.cos[this.vR],this.model.x-this.Du,this.model.y-this.Nu,this.model.z-this.Fu,0),this.ke?.draw(0,0))};init=async()=>{const t=await(this.db?.Fs('main_file_cache.dat'));if(!t){return document.getElementById('helpme').style.display='block',void(p.style.display='none')}const i=await(this.db?.Fs('main_file_cache.idx0')),e=await(this.db?.Fs('main_file_cache.idx1')),s=await(this.db?.Fs('main_file_cache.idx2')),n=await(this.db?.Fs('main_file_cache.idx3')),r=await(this.db?.Fs('main_file_cache.idx4'));if(!(i&&e&&s&&n&&r)){return document.getElementById('helpme').style.display='block',void(p.style.display='none')}document.getElementById('helpme').style.display='none',p.style.display='block',this.CR=new Y(t,i,0),this.ER=new Y(t,e,1),this.TR=new Y(t,s,2),this.bR=new Y(t,n,3),this.OR=new Y(t,r,4),await this.ds(10,'Unpacking textures');const h=this.CR.read(6);N.$i(h),N.ie(.8),N.se(20),await this.ds(20,'Loading models...');for(let t=0;t<this.ER.Ws;t++){const i=this.ER.read(t);null!==i&&j.nr(i,t)}if(this.kR(0),null!==this.IR){const t=document.createElement('ul');t.id='modelList',t.className='list-group',this.IR.appendChild(t);for(let i=0;i<this.ER.Ws;i++){const e=document.createElement('li');e.className='list-group-item',e.innerText=`Model ${i}`,e.onclick=()=>{this.model.id=i,this.kR(i)},t.appendChild(e)}}};kR(t){if(null===this.ER)return;const i=this.ER.read(t);null!==i?(this.model.SR=j.Xr(i,t),this.model.SR.hh(64,850,-30,-50,-30,!0),document.title=`Model ${t} | 2004Scape Tools`):document.title=`Missing model ${t} | 2004Scape Tools`}xR(){for(;;){const t=this.As();if(-1===t)break;t==='r'.charCodeAt(0)?(this.LR=2,this.Du=0,this.Nu=0,this.Fu=0,this.RR=0,this.vR=0,this.model.x=0,this.model.y=0,this.model.z=420,this.model.La=0):t==='1'.charCodeAt(0)?(this.model.id--,j.metadata&&this.model.id<0&&(this.model.id=j.metadata.length-1),this.kR(this.model.id)):t==='2'.charCodeAt(0)&&(this.model.id++,j.metadata&&this.model.id>=j.metadata.length&&(this.model.id=0),this.kR(this.model.id))}}MR(){this.Je['['.charCodeAt(0)]?this.LR--:this.Je[']'.charCodeAt(0)]&&this.LR++,this.Je[1]?this.model.La+=this.LR:this.Je[2]&&(this.model.La-=this.LR),this.Je['w'.charCodeAt(0)]?this.model.z-=this.LR:this.Je['s'.charCodeAt(0)]&&(this.model.z+=this.LR),this.Je['a'.charCodeAt(0)]?this.model.x-=this.LR:this.Je['d'.charCodeAt(0)]&&(this.model.x+=this.LR),this.Je['q'.charCodeAt(0)]?this.model.y-=this.LR:this.Je['e'.charCodeAt(0)]&&(this.model.y+=this.LR),this.RR=2047&this.RR,this.vR=2047&this.vR,this.model.La=2047&this.model.La}}).run().then((()=>{}))})()})();